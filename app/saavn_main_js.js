function sniffedClass(element, cls) {
    return (" " + element.className + " ").indexOf(" " + cls + " ") > -1
}
if (!sniffedClass(document.documentElement, "saavn")) {
    var ua = navigator.userAgent, ie = /(msie|trident)/i.test(ua), chrome = /chrome/i.test(ua), safari = /safari/i.test(ua) && !chrome, iphone = /iphone/i.test(ua), ipad = /ipad/i.test(ua), android = /android/i.test(ua), opera = /opera/i.test(ua) || /opr/i.test(ua), firefox = /firefox/i.test(ua), gecko = /gecko\//i.test(ua), webkitV = /version\/(\d+(\.\d+)?)/i, firefoxV = /firefox\/(\d+(\.\d+)?)/i, mac = /(mac|darwin)/i.test(ua), win = /win/i.test(ua), linux = /linux/i.test(ua);
    var bo, bc;

    function sniffBrowser() {
        bo = {};
        bo.mobile = false;
        bc = "saavn";
        if (mac) {
            bo.mac = true;
            bc += " mac"
        } else if (linux) {
            bo.linux = true;
            bc += " linux"
        } else if (win) {
            bo.win = true;
            bc += " win"
        }
        if (ie) {
            bo.msie = true, bo.version = ua.match(/(msie |rv:)(\d+(\.\d+)?)/i)[2];
            bc += " ie ie" + bo.version.split(".")[0];
            if (bo.version.split(".")[0] == 8) bc += " ie8-loading"
        } else if (opera) {
            bo.opera = true, bo.version = ua.match(webkitV) ? ua.match(webkitV)[1] : ua.match(/opr\/(\d+(\.\d+)?)/i);
            bc += " opera"
        } else if (chrome) {
            bo.webkit = true, bo.chrome = true, bo.version = ua.match(/chrome\/(\d+(\.\d+)?)/i)[1];
            bc += " chrome chrome" + bo.version.split(".")[0]
        } else if (iphone || ipad) {
            bo.webkit = true, bo.mobile = true, bo.ios = true, bo.iphone = iphone, bo.ipad = ipad;
            bc += " ios ";
            bc += bo.iphone ? " iphone" : "";
            bc += bo.ipad ? " ipad" : ""
        } else if (android) {
            bo.webkit = true, bo.android = true, bo.mobile = true, bo.version = (ua.match(webkitV) || ua.match(firefoxV))[1];
            bc += " android"
        } else if (safari) {
            bo.webkit = true, bo.safari = true, bo.version = ua.match(webkitV)[1];
            bc += " safari safari" + bo.version.split(".")[0]
        } else if (gecko) {
            bo.firefox = firefox ? true : false, bo.gecko = true, bo.mozilla = true, bo.version = ua.match(firefoxV)[1];
            bc += " gecko";
            bc += bo.mozilla ? " mozilla" : "";
            bc += bo.firefox ? " firefox ff" + bo.version.split(".")[0] : ""
        }
        bc += bo.webkit ? " webkit" : "" + (bo.mobile == false) ? "" : " mobile";
        document.documentElement.className = bc;
        return bo
    }

    var cBrowser = sniffBrowser()
}
(function (e, t) {
    var n, r, i = typeof t, o = e.location, a = e.document, s = a.documentElement, l = e.jQuery, u = e.$, c = {}, p = [], f = "1.10.2", d = p.concat, h = p.push, g = p.slice, m = p.indexOf, y = c.toString, v = c.hasOwnProperty, b = f.trim, x = function (e, t) {
        return new x.fn.init(e, t, r)
    }, w = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, T = /\S+/g, C = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, N = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, k = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, E = /^[\],:{}\s]*$/, S = /(?:^|:|,)(?:\s*\[)+/g, A = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, j = /"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g, D = /^-ms-/, L = /-([\da-z])/gi, H = function (e, t) {
        return t.toUpperCase()
    }, q = function (e) {
        (a.addEventListener || "load" === e.type || "complete" === a.readyState) && (_(), x.ready())
    }, _ = function () {
        a.addEventListener ? (a.removeEventListener("DOMContentLoaded", q, !1), e.removeEventListener("load", q, !1)) : (a.detachEvent("onreadystatechange", q), e.detachEvent("onload", q))
    };
    x.fn = x.prototype = {
        jquery: f, constructor: x, init: function (e, n, r) {
            var i, o;
            if (!e)return this;
            if ("string" == typeof e) {
                if (i = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : N.exec(e), !i || !i[1] && n)return !n || n.jquery ? (n || r).find(e) : this.constructor(n).find(e);
                if (i[1]) {
                    if (n = n instanceof x ? n[0] : n, x.merge(this, x.parseHTML(i[1], n && n.nodeType ? n.ownerDocument || n : a, !0)), k.test(i[1]) && x.isPlainObject(n))for (i in n)x.isFunction(this[i]) ? this[i](n[i]) : this.attr(i, n[i]);
                    return this
                }
                if (o = a.getElementById(i[2]), o && o.parentNode) {
                    if (o.id !== i[2])return r.find(e);
                    this.length = 1, this[0] = o
                }
                return this.context = a, this.selector = e, this
            }
            return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : x.isFunction(e) ? r.ready(e) : (e.selector !== t && (this.selector = e.selector, this.context = e.context), x.makeArray(e, this))
        }, selector: "", length: 0, toArray: function () {
            return g.call(this)
        }, get: function (e) {
            return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
        }, pushStack: function (e) {
            var t = x.merge(this.constructor(), e);
            return t.prevObject = this, t.context = this.context, t
        }, each: function (e, t) {
            return x.each(this, e, t)
        }, ready: function (e) {
            return x.ready.promise().done(e), this
        }, slice: function () {
            return this.pushStack(g.apply(this, arguments))
        }, first: function () {
            return this.eq(0)
        }, last: function () {
            return this.eq(-1)
        }, eq: function (e) {
            var t = this.length, n = +e + (0 > e ? t : 0);
            return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
        }, map: function (e) {
            return this.pushStack(x.map(this, function (t, n) {
                return e.call(t, n, t)
            }))
        }, end: function () {
            return this.prevObject || this.constructor(null)
        }, push: h, sort: [].sort, splice: [].splice
    }, x.fn.init.prototype = x.fn, x.extend = x.fn.extend = function () {
        var e, n, r, i, o, a, s = arguments[0] || {}, l = 1, u = arguments.length, c = !1;
        for ("boolean" == typeof s && (c = s, s = arguments[1] || {}, l = 2), "object" == typeof s || x.isFunction(s) || (s = {}), u === l && (s = this, --l); u > l; l++)if (null != (o = arguments[l]))for (i in o)e = s[i], r = o[i], s !== r && (c && r && (x.isPlainObject(r) || (n = x.isArray(r))) ? (n ? (n = !1, a = e && x.isArray(e) ? e : []) : a = e && x.isPlainObject(e) ? e : {}, s[i] = x.extend(c, a, r)) : r !== t && (s[i] = r));
        return s
    }, x.extend({
        expando: "jQuery" + (f + Math.random()).replace(/\D/g, ""), noConflict: function (t) {
            return e.$ === x && (e.$ = u), t && e.jQuery === x && (e.jQuery = l), x
        }, isReady: !1, readyWait: 1, holdReady: function (e) {
            e ? x.readyWait++ : x.ready(!0)
        }, ready: function (e) {
            if (e === !0 ? !--x.readyWait : !x.isReady) {
                if (!a.body)return setTimeout(x.ready);
                x.isReady = !0, e !== !0 && --x.readyWait > 0 || (n.resolveWith(a, [x]), x.fn.trigger && x(a).trigger("ready").off("ready"))
            }
        }, isFunction: function (e) {
            return "function" === x.type(e)
        }, isArray: Array.isArray || function (e) {
            return "array" === x.type(e)
        }, isWindow: function (e) {
            return null != e && e == e.window
        }, isNumeric: function (e) {
            return !isNaN(parseFloat(e)) && isFinite(e)
        }, type: function (e) {
            return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? c[y.call(e)] || "object" : typeof e
        }, isPlainObject: function (e) {
            var n;
            if (!e || "object" !== x.type(e) || e.nodeType || x.isWindow(e))return !1;
            try {
                if (e.constructor && !v.call(e, "constructor") && !v.call(e.constructor.prototype, "isPrototypeOf"))return !1
            } catch (r) {
                return !1
            }
            if (x.support.ownLast)for (n in e)return v.call(e, n);
            for (n in e);
            return n === t || v.call(e, n)
        }, isEmptyObject: function (e) {
            var t;
            for (t in e)return !1;
            return !0
        }, error: function (e) {
            throw Error(e)
        }, parseHTML: function (e, t, n) {
            if (!e || "string" != typeof e)return null;
            "boolean" == typeof t && (n = t, t = !1), t = t || a;
            var r = k.exec(e), i = !n && [];
            return r ? [t.createElement(r[1])] : (r = x.buildFragment([e], t, i), i && x(i).remove(), x.merge([], r.childNodes))
        }, parseJSON: function (n) {
            return e.JSON && e.JSON.parse ? e.JSON.parse(n) : null === n ? n : "string" == typeof n && (n = x.trim(n), n && E.test(n.replace(A, "@").replace(j, "]").replace(S, ""))) ? Function("return " + n)() : (x.error("Invalid JSON: " + n), t)
        }, parseXML: function (n) {
            var r, i;
            if (!n || "string" != typeof n)return null;
            try {
                e.DOMParser ? (i = new DOMParser, r = i.parseFromString(n, "text/xml")) : (r = new ActiveXObject("Microsoft.XMLDOM"), r.async = "false", r.loadXML(n))
            } catch (o) {
                r = t
            }
            return r && r.documentElement && !r.getElementsByTagName("parsererror").length || x.error("Invalid XML: " + n), r
        }, noop: function () {
        }, globalEval: function (t) {
            t && x.trim(t) && (e.execScript || function (t) {
                e.eval.call(e, t)
            })(t)
        }, camelCase: function (e) {
            return e.replace(D, "ms-").replace(L, H)
        }, nodeName: function (e, t) {
            return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
        }, each: function (e, t, n) {
            var r, i = 0, o = e.length, a = M(e);
            if (n) {
                if (a) {
                    for (; o > i; i++)if (r = t.apply(e[i], n), r === !1)break
                } else for (i in e)if (r = t.apply(e[i], n), r === !1)break
            } else if (a) {
                for (; o > i; i++)if (r = t.call(e[i], i, e[i]), r === !1)break
            } else for (i in e)if (r = t.call(e[i], i, e[i]), r === !1)break;
            return e
        }, trim: b && !b.call("\ufeff ") ? function (e) {
            return null == e ? "" : b.call(e)
        } : function (e) {
            return null == e ? "" : (e + "").replace(C, "")
        }, makeArray: function (e, t) {
            var n = t || [];
            return null != e && (M(Object(e)) ? x.merge(n, "string" == typeof e ? [e] : e) : h.call(n, e)), n
        }, inArray: function (e, t, n) {
            var r;
            if (t) {
                if (m)return m.call(t, e, n);
                for (r = t.length, n = n ? 0 > n ? Math.max(0, r + n) : n : 0; r > n; n++)if (n in t && t[n] === e)return n
            }
            return -1
        }, merge: function (e, n) {
            var r = n.length, i = e.length, o = 0;
            if ("number" == typeof r)for (; r > o; o++)e[i++] = n[o]; else while (n[o] !== t)e[i++] = n[o++];
            return e.length = i, e
        }, grep: function (e, t, n) {
            var r, i = [], o = 0, a = e.length;
            for (n = !!n; a > o; o++)r = !!t(e[o], o), n !== r && i.push(e[o]);
            return i
        }, map: function (e, t, n) {
            var r, i = 0, o = e.length, a = M(e), s = [];
            if (a)for (; o > i; i++)r = t(e[i], i, n), null != r && (s[s.length] = r); else for (i in e)r = t(e[i], i, n), null != r && (s[s.length] = r);
            return d.apply([], s)
        }, guid: 1, proxy: function (e, n) {
            var r, i, o;
            return "string" == typeof n && (o = e[n], n = e, e = o), x.isFunction(e) ? (r = g.call(arguments, 2), i = function () {
                return e.apply(n || this, r.concat(g.call(arguments)))
            }, i.guid = e.guid = e.guid || x.guid++, i) : t
        }, access: function (e, n, r, i, o, a, s) {
            var l = 0, u = e.length, c = null == r;
            if ("object" === x.type(r)) {
                o = !0;
                for (l in r)x.access(e, n, l, r[l], !0, a, s)
            } else if (i !== t && (o = !0, x.isFunction(i) || (s = !0), c && (s ? (n.call(e, i), n = null) : (c = n, n = function (e, t, n) {
                    return c.call(x(e), n)
                })), n))for (; u > l; l++)n(e[l], r, s ? i : i.call(e[l], l, n(e[l], r)));
            return o ? e : c ? n.call(e) : u ? n(e[0], r) : a
        }, now: function () {
            return (new Date).getTime()
        }, swap: function (e, t, n, r) {
            var i, o, a = {};
            for (o in t)a[o] = e.style[o], e.style[o] = t[o];
            i = n.apply(e, r || []);
            for (o in t)e.style[o] = a[o];
            return i
        }
    }), x.ready.promise = function (t) {
        if (!n)if (n = x.Deferred(), "complete" === a.readyState) setTimeout(x.ready); else if (a.addEventListener) a.addEventListener("DOMContentLoaded", q, !1), e.addEventListener("load", q, !1); else {
            a.attachEvent("onreadystatechange", q), e.attachEvent("onload", q);
            var r = !1;
            try {
                r = null == e.frameElement && a.documentElement
            } catch (i) {
            }
            r && r.doScroll && function o() {
                if (!x.isReady) {
                    try {
                        r.doScroll("left")
                    } catch (e) {
                        return setTimeout(o, 50)
                    }
                    _(), x.ready()
                }
            }()
        }
        return n.promise(t)
    }, x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, t) {
        c["[object " + t + "]"] = t.toLowerCase()
    });
    function M(e) {
        var t = e.length, n = x.type(e);
        return x.isWindow(e) ? !1 : 1 === e.nodeType && t ? !0 : "array" === n || "function" !== n && (0 === t || "number" == typeof t && t > 0 && t - 1 in e)
    }

    r = x(a), function (e, t) {
        var n, r, i, o, a, s, l, u, c, p, f, d, h, g, m, y, v, b = "sizzle" + -new Date, w = e.document, T = 0, C = 0, N = st(), k = st(), E = st(), S = !1, A = function (e, t) {
            return e === t ? (S = !0, 0) : 0
        }, j = typeof t, D = 1 << 31, L = {}.hasOwnProperty, H = [], q = H.pop, _ = H.push, M = H.push, O = H.slice, F = H.indexOf || function (e) {
                var t = 0, n = this.length;
                for (; n > t; t++)if (this[t] === e)return t;
                return -1
            }, B = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", P = "[\\x20\\t\\r\\n\\f]", R = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", W = R.replace("w", "w#"), $ = "\\[" + P + "*(" + R + ")" + P + "*(?:([*^$|!~]?=)" + P + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + W + ")|)|)" + P + "*\\]", I = ":(" + R + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + $.replace(3, 8) + ")*)|.*)\\)|)", z = RegExp("^" + P + "+|((?:^|[^\\\\])(?:\\\\.)*)" + P + "+$", "g"), X = RegExp("^" + P + "*," + P + "*"), U = RegExp("^" + P + "*([>+~]|" + P + ")" + P + "*"), V = RegExp(P + "*[+~]"), Y = RegExp("=" + P + "*([^\\]'\"]*)" + P + "*\\]", "g"), J = RegExp(I), G = RegExp("^" + W + "$"), Q = {
            ID: RegExp("^#(" + R + ")"),
            CLASS: RegExp("^\\.(" + R + ")"),
            TAG: RegExp("^(" + R.replace("w", "w*") + ")"),
            ATTR: RegExp("^" + $),
            PSEUDO: RegExp("^" + I),
            CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + P + "*(even|odd|(([+-]|)(\\d*)n|)" + P + "*(?:([+-]|)" + P + "*(\\d+)|))" + P + "*\\)|)", "i"),
            bool: RegExp("^(?:" + B + ")$", "i"),
            needsContext: RegExp("^" + P + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + P + "*((?:-\\d)?\\d*)" + P + "*\\)|)(?=[^-]|$)", "i")
        }, K = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, et = /^(?:input|select|textarea|button)$/i, tt = /^h\d$/i, nt = /'|\\/g, rt = RegExp("\\\\([\\da-f]{1,6}" + P + "?|(" + P + ")|.)", "ig"), it = function (e, t, n) {
            var r = "0x" + t - 65536;
            return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(55296 | r >> 10, 56320 | 1023 & r)
        };
        try {
            M.apply(H = O.call(w.childNodes), w.childNodes), H[w.childNodes.length].nodeType
        } catch (ot) {
            M = {
                apply: H.length ? function (e, t) {
                    _.apply(e, O.call(t))
                } : function (e, t) {
                    var n = e.length, r = 0;
                    while (e[n++] = t[r++]);
                    e.length = n - 1
                }
            }
        }
        function at(e, t, n, i) {
            var o, a, s, l, u, c, d, m, y, x;
            if ((t ? t.ownerDocument || t : w) !== f && p(t), t = t || f, n = n || [], !e || "string" != typeof e)return n;
            if (1 !== (l = t.nodeType) && 9 !== l)return [];
            if (h && !i) {
                if (o = Z.exec(e))if (s = o[1]) {
                    if (9 === l) {
                        if (a = t.getElementById(s), !a || !a.parentNode)return n;
                        if (a.id === s)return n.push(a), n
                    } else if (t.ownerDocument && (a = t.ownerDocument.getElementById(s)) && v(t, a) && a.id === s)return n.push(a), n
                } else {
                    if (o[2])return M.apply(n, t.getElementsByTagName(e)), n;
                    if ((s = o[3]) && r.getElementsByClassName && t.getElementsByClassName)return M.apply(n, t.getElementsByClassName(s)), n
                }
                if (r.qsa && (!g || !g.test(e))) {
                    if (m = d = b, y = t, x = 9 === l && e, 1 === l && "object" !== t.nodeName.toLowerCase()) {
                        c = mt(e), (d = t.getAttribute("id")) ? m = d.replace(nt, "\\$&") : t.setAttribute("id", m), m = "[id='" + m + "'] ", u = c.length;
                        while (u--)c[u] = m + yt(c[u]);
                        y = V.test(e) && t.parentNode || t, x = c.join(",")
                    }
                    if (x)try {
                        return M.apply(n, y.querySelectorAll(x)), n
                    } catch (T) {
                    } finally {
                        d || t.removeAttribute("id")
                    }
                }
            }
            return kt(e.replace(z, "$1"), t, n, i)
        }

        function st() {
            var e = [];

            function t(n, r) {
                return e.push(n += " ") > o.cacheLength && delete t[e.shift()], t[n] = r
            }

            return t
        }

        function lt(e) {
            return e[b] = !0, e
        }

        function ut(e) {
            var t = f.createElement("div");
            try {
                return !!e(t)
            } catch (n) {
                return !1
            } finally {
                t.parentNode && t.parentNode.removeChild(t), t = null
            }
        }

        function ct(e, t) {
            var n = e.split("|"), r = e.length;
            while (r--)o.attrHandle[n[r]] = t
        }

        function pt(e, t) {
            var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || D) - (~e.sourceIndex || D);
            if (r)return r;
            if (n)while (n = n.nextSibling)if (n === t)return -1;
            return e ? 1 : -1
        }

        function ft(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return "input" === n && t.type === e
            }
        }

        function dt(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return ("input" === n || "button" === n) && t.type === e
            }
        }

        function ht(e) {
            return lt(function (t) {
                return t = +t, lt(function (n, r) {
                    var i, o = e([], n.length, t), a = o.length;
                    while (a--)n[i = o[a]] && (n[i] = !(r[i] = n[i]))
                })
            })
        }

        s = at.isXML = function (e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return t ? "HTML" !== t.nodeName : !1
        }, r = at.support = {}, p = at.setDocument = function (e) {
            var n = e ? e.ownerDocument || e : w, i = n.defaultView;
            return n !== f && 9 === n.nodeType && n.documentElement ? (f = n, d = n.documentElement, h = !s(n), i && i.attachEvent && i !== i.top && i.attachEvent("onbeforeunload", function () {
                p()
            }), r.attributes = ut(function (e) {
                return e.className = "i", !e.getAttribute("className")
            }), r.getElementsByTagName = ut(function (e) {
                return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length
            }), r.getElementsByClassName = ut(function (e) {
                return e.innerHTML = "<div class='a'></div><div class='a i'></div>", e.firstChild.className = "i", 2 === e.getElementsByClassName("i").length
            }), r.getById = ut(function (e) {
                return d.appendChild(e).id = b, !n.getElementsByName || !n.getElementsByName(b).length
            }), r.getById ? (o.find.ID = function (e, t) {
                if (typeof t.getElementById !== j && h) {
                    var n = t.getElementById(e);
                    return n && n.parentNode ? [n] : []
                }
            }, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    return e.getAttribute("id") === t
                }
            }) : (delete o.find.ID, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    var n = typeof e.getAttributeNode !== j && e.getAttributeNode("id");
                    return n && n.value === t
                }
            }), o.find.TAG = r.getElementsByTagName ? function (e, n) {
                return typeof n.getElementsByTagName !== j ? n.getElementsByTagName(e) : t
            } : function (e, t) {
                var n, r = [], i = 0, o = t.getElementsByTagName(e);
                if ("*" === e) {
                    while (n = o[i++])1 === n.nodeType && r.push(n);
                    return r
                }
                return o
            }, o.find.CLASS = r.getElementsByClassName && function (e, n) {
                    return typeof n.getElementsByClassName !== j && h ? n.getElementsByClassName(e) : t
                }, m = [], g = [], (r.qsa = K.test(n.querySelectorAll)) && (ut(function (e) {
                e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || g.push("\\[" + P + "*(?:value|" + B + ")"), e.querySelectorAll(":checked").length || g.push(":checked")
            }), ut(function (e) {
                var t = n.createElement("input");
                t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("t", ""), e.querySelectorAll("[t^='']").length && g.push("[*^$]=" + P + "*(?:''|\"\")"), e.querySelectorAll(":enabled").length || g.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), g.push(",.*:")
            })), (r.matchesSelector = K.test(y = d.webkitMatchesSelector || d.mozMatchesSelector || d.oMatchesSelector || d.msMatchesSelector)) && ut(function (e) {
                r.disconnectedMatch = y.call(e, "div"), y.call(e, "[s!='']:x"), m.push("!=", I)
            }), g = g.length && RegExp(g.join("|")), m = m.length && RegExp(m.join("|")), v = K.test(d.contains) || d.compareDocumentPosition ? function (e, t) {
                var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
            } : function (e, t) {
                if (t)while (t = t.parentNode)if (t === e)return !0;
                return !1
            }, A = d.compareDocumentPosition ? function (e, t) {
                if (e === t)return S = !0, 0;
                var i = t.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(t);
                return i ? 1 & i || !r.sortDetached && t.compareDocumentPosition(e) === i ? e === n || v(w, e) ? -1 : t === n || v(w, t) ? 1 : c ? F.call(c, e) - F.call(c, t) : 0 : 4 & i ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
            } : function (e, t) {
                var r, i = 0, o = e.parentNode, a = t.parentNode, s = [e], l = [t];
                if (e === t)return S = !0, 0;
                if (!o || !a)return e === n ? -1 : t === n ? 1 : o ? -1 : a ? 1 : c ? F.call(c, e) - F.call(c, t) : 0;
                if (o === a)return pt(e, t);
                r = e;
                while (r = r.parentNode)s.unshift(r);
                r = t;
                while (r = r.parentNode)l.unshift(r);
                while (s[i] === l[i])i++;
                return i ? pt(s[i], l[i]) : s[i] === w ? -1 : l[i] === w ? 1 : 0
            }, n) : f
        }, at.matches = function (e, t) {
            return at(e, null, null, t)
        }, at.matchesSelector = function (e, t) {
            if ((e.ownerDocument || e) !== f && p(e), t = t.replace(Y, "='$1']"), !(!r.matchesSelector || !h || m && m.test(t) || g && g.test(t)))try {
                var n = y.call(e, t);
                if (n || r.disconnectedMatch || e.document && 11 !== e.document.nodeType)return n
            } catch (i) {
            }
            return at(t, f, null, [e]).length > 0
        }, at.contains = function (e, t) {
            return (e.ownerDocument || e) !== f && p(e), v(e, t)
        }, at.attr = function (e, n) {
            (e.ownerDocument || e) !== f && p(e);
            var i = o.attrHandle[n.toLowerCase()], a = i && L.call(o.attrHandle, n.toLowerCase()) ? i(e, n, !h) : t;
            return a === t ? r.attributes || !h ? e.getAttribute(n) : (a = e.getAttributeNode(n)) && a.specified ? a.value : null : a
        }, at.error = function (e) {
            throw Error("Syntax error, unrecognized expression: " + e)
        }, at.uniqueSort = function (e) {
            var t, n = [], i = 0, o = 0;
            if (S = !r.detectDuplicates, c = !r.sortStable && e.slice(0), e.sort(A), S) {
                while (t = e[o++])t === e[o] && (i = n.push(o));
                while (i--)e.splice(n[i], 1)
            }
            return e
        }, a = at.getText = function (e) {
            var t, n = "", r = 0, i = e.nodeType;
            if (i) {
                if (1 === i || 9 === i || 11 === i) {
                    if ("string" == typeof e.textContent)return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling)n += a(e)
                } else if (3 === i || 4 === i)return e.nodeValue
            } else for (; t = e[r]; r++)n += a(t);
            return n
        }, o = at.selectors = {
            cacheLength: 50,
            createPseudo: lt,
            match: Q,
            attrHandle: {},
            find: {},
            relative: {
                ">": {dir: "parentNode", first: !0},
                " ": {dir: "parentNode"},
                "+": {dir: "previousSibling", first: !0},
                "~": {dir: "previousSibling"}
            },
            preFilter: {
                ATTR: function (e) {
                    return e[1] = e[1].replace(rt, it), e[3] = (e[4] || e[5] || "").replace(rt, it), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
                }, CHILD: function (e) {
                    return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || at.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && at.error(e[0]), e
                }, PSEUDO: function (e) {
                    var n, r = !e[5] && e[2];
                    return Q.CHILD.test(e[0]) ? null : (e[3] && e[4] !== t ? e[2] = e[4] : r && J.test(r) && (n = mt(r, !0)) && (n = r.indexOf(")", r.length - n) - r.length) && (e[0] = e[0].slice(0, n), e[2] = r.slice(0, n)), e.slice(0, 3))
                }
            },
            filter: {
                TAG: function (e) {
                    var t = e.replace(rt, it).toLowerCase();
                    return "*" === e ? function () {
                        return !0
                    } : function (e) {
                        return e.nodeName && e.nodeName.toLowerCase() === t
                    }
                }, CLASS: function (e) {
                    var t = N[e + " "];
                    return t || (t = RegExp("(^|" + P + ")" + e + "(" + P + "|$)")) && N(e, function (e) {
                            return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== j && e.getAttribute("class") || "")
                        })
                }, ATTR: function (e, t, n) {
                    return function (r) {
                        var i = at.attr(r, e);
                        return null == i ? "!=" === t : t ? (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i + " ").indexOf(n) > -1 : "|=" === t ? i === n || i.slice(0, n.length + 1) === n + "-" : !1) : !0
                    }
                }, CHILD: function (e, t, n, r, i) {
                    var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t;
                    return 1 === r && 0 === i ? function (e) {
                        return !!e.parentNode
                    } : function (t, n, l) {
                        var u, c, p, f, d, h, g = o !== a ? "nextSibling" : "previousSibling", m = t.parentNode, y = s && t.nodeName.toLowerCase(), v = !l && !s;
                        if (m) {
                            if (o) {
                                while (g) {
                                    p = t;
                                    while (p = p[g])if (s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType)return !1;
                                    h = g = "only" === e && !h && "nextSibling"
                                }
                                return !0
                            }
                            if (h = [a ? m.firstChild : m.lastChild], a && v) {
                                c = m[b] || (m[b] = {}), u = c[e] || [], d = u[0] === T && u[1], f = u[0] === T && u[2], p = d && m.childNodes[d];
                                while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if (1 === p.nodeType && ++f && p === t) {
                                    c[e] = [T, d, f];
                                    break
                                }
                            } else if (v && (u = (t[b] || (t[b] = {}))[e]) && u[0] === T) f = u[1]; else while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if ((s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType) && ++f && (v && ((p[b] || (p[b] = {}))[e] = [T, f]), p === t))break;
                            return f -= i, f === r || 0 === f % r && f / r >= 0
                        }
                    }
                }, PSEUDO: function (e, t) {
                    var n, r = o.pseudos[e] || o.setFilters[e.toLowerCase()] || at.error("unsupported pseudo: " + e);
                    return r[b] ? r(t) : r.length > 1 ? (n = [e, e, "", t], o.setFilters.hasOwnProperty(e.toLowerCase()) ? lt(function (e, n) {
                        var i, o = r(e, t), a = o.length;
                        while (a--)i = F.call(e, o[a]), e[i] = !(n[i] = o[a])
                    }) : function (e) {
                        return r(e, 0, n)
                    }) : r
                }
            },
            pseudos: {
                not: lt(function (e) {
                    var t = [], n = [], r = l(e.replace(z, "$1"));
                    return r[b] ? lt(function (e, t, n, i) {
                        var o, a = r(e, null, i, []), s = e.length;
                        while (s--)(o = a[s]) && (e[s] = !(t[s] = o))
                    }) : function (e, i, o) {
                        return t[0] = e, r(t, null, o, n), !n.pop()
                    }
                }), has: lt(function (e) {
                    return function (t) {
                        return at(e, t).length > 0
                    }
                }), contains: lt(function (e) {
                    return function (t) {
                        return (t.textContent || t.innerText || a(t)).indexOf(e) > -1
                    }
                }), lang: lt(function (e) {
                    return G.test(e || "") || at.error("unsupported lang: " + e), e = e.replace(rt, it).toLowerCase(), function (t) {
                        var n;
                        do if (n = h ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang"))return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-"); while ((t = t.parentNode) && 1 === t.nodeType);
                        return !1
                    }
                }), target: function (t) {
                    var n = e.location && e.location.hash;
                    return n && n.slice(1) === t.id
                }, root: function (e) {
                    return e === d
                }, focus: function (e) {
                    return e === f.activeElement && (!f.hasFocus || f.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
                }, enabled: function (e) {
                    return e.disabled === !1
                }, disabled: function (e) {
                    return e.disabled === !0
                }, checked: function (e) {
                    var t = e.nodeName.toLowerCase();
                    return "input" === t && !!e.checked || "option" === t && !!e.selected
                }, selected: function (e) {
                    return e.parentNode && e.parentNode.selectedIndex, e.selected === !0
                }, empty: function (e) {
                    for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType)return !1;
                    return !0
                }, parent: function (e) {
                    return !o.pseudos.empty(e)
                }, header: function (e) {
                    return tt.test(e.nodeName)
                }, input: function (e) {
                    return et.test(e.nodeName)
                }, button: function (e) {
                    var t = e.nodeName.toLowerCase();
                    return "input" === t && "button" === e.type || "button" === t
                }, text: function (e) {
                    var t;
                    return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || t.toLowerCase() === e.type)
                }, first: ht(function () {
                    return [0]
                }), last: ht(function (e, t) {
                    return [t - 1]
                }), eq: ht(function (e, t, n) {
                    return [0 > n ? n + t : n]
                }), even: ht(function (e, t) {
                    var n = 0;
                    for (; t > n; n += 2)e.push(n);
                    return e
                }), odd: ht(function (e, t) {
                    var n = 1;
                    for (; t > n; n += 2)e.push(n);
                    return e
                }), lt: ht(function (e, t, n) {
                    var r = 0 > n ? n + t : n;
                    for (; --r >= 0;)e.push(r);
                    return e
                }), gt: ht(function (e, t, n) {
                    var r = 0 > n ? n + t : n;
                    for (; t > ++r;)e.push(r);
                    return e
                })
            }
        }, o.pseudos.nth = o.pseudos.eq;
        for (n in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})o.pseudos[n] = ft(n);
        for (n in{submit: !0, reset: !0})o.pseudos[n] = dt(n);
        function gt() {
        }

        gt.prototype = o.filters = o.pseudos, o.setFilters = new gt;
        function mt(e, t) {
            var n, r, i, a, s, l, u, c = k[e + " "];
            if (c)return t ? 0 : c.slice(0);
            s = e, l = [], u = o.preFilter;
            while (s) {
                (!n || (r = X.exec(s))) && (r && (s = s.slice(r[0].length) || s), l.push(i = [])), n = !1, (r = U.exec(s)) && (n = r.shift(), i.push({
                    value: n,
                    type: r[0].replace(z, " ")
                }), s = s.slice(n.length));
                for (a in o.filter)!(r = Q[a].exec(s)) || u[a] && !(r = u[a](r)) || (n = r.shift(), i.push({
                    value: n,
                    type: a,
                    matches: r
                }), s = s.slice(n.length));
                if (!n)break
            }
            return t ? s.length : s ? at.error(e) : k(e, l).slice(0)
        }

        function yt(e) {
            var t = 0, n = e.length, r = "";
            for (; n > t; t++)r += e[t].value;
            return r
        }

        function vt(e, t, n) {
            var r = t.dir, o = n && "parentNode" === r, a = C++;
            return t.first ? function (t, n, i) {
                while (t = t[r])if (1 === t.nodeType || o)return e(t, n, i)
            } : function (t, n, s) {
                var l, u, c, p = T + " " + a;
                if (s) {
                    while (t = t[r])if ((1 === t.nodeType || o) && e(t, n, s))return !0
                } else while (t = t[r])if (1 === t.nodeType || o)if (c = t[b] || (t[b] = {}), (u = c[r]) && u[0] === p) {
                    if ((l = u[1]) === !0 || l === i)return l === !0
                } else if (u = c[r] = [p], u[1] = e(t, n, s) || i, u[1] === !0)return !0
            }
        }

        function bt(e) {
            return e.length > 1 ? function (t, n, r) {
                var i = e.length;
                while (i--)if (!e[i](t, n, r))return !1;
                return !0
            } : e[0]
        }

        function xt(e, t, n, r, i) {
            var o, a = [], s = 0, l = e.length, u = null != t;
            for (; l > s; s++)(o = e[s]) && (!n || n(o, r, i)) && (a.push(o), u && t.push(s));
            return a
        }

        function wt(e, t, n, r, i, o) {
            return r && !r[b] && (r = wt(r)), i && !i[b] && (i = wt(i, o)), lt(function (o, a, s, l) {
                var u, c, p, f = [], d = [], h = a.length, g = o || Nt(t || "*", s.nodeType ? [s] : s, []), m = !e || !o && t ? g : xt(g, f, e, s, l), y = n ? i || (o ? e : h || r) ? [] : a : m;
                if (n && n(m, y, s, l), r) {
                    u = xt(y, d), r(u, [], s, l), c = u.length;
                    while (c--)(p = u[c]) && (y[d[c]] = !(m[d[c]] = p))
                }
                if (o) {
                    if (i || e) {
                        if (i) {
                            u = [], c = y.length;
                            while (c--)(p = y[c]) && u.push(m[c] = p);
                            i(null, y = [], u, l)
                        }
                        c = y.length;
                        while (c--)(p = y[c]) && (u = i ? F.call(o, p) : f[c]) > -1 && (o[u] = !(a[u] = p))
                    }
                } else y = xt(y === a ? y.splice(h, y.length) : y), i ? i(null, a, y, l) : M.apply(a, y)
            })
        }

        function Tt(e) {
            var t, n, r, i = e.length, a = o.relative[e[0].type], s = a || o.relative[" "], l = a ? 1 : 0, c = vt(function (e) {
                return e === t
            }, s, !0), p = vt(function (e) {
                return F.call(t, e) > -1
            }, s, !0), f = [function (e, n, r) {
                return !a && (r || n !== u) || ((t = n).nodeType ? c(e, n, r) : p(e, n, r))
            }];
            for (; i > l; l++)if (n = o.relative[e[l].type]) f = [vt(bt(f), n)]; else {
                if (n = o.filter[e[l].type].apply(null, e[l].matches), n[b]) {
                    for (r = ++l; i > r; r++)if (o.relative[e[r].type])break;
                    return wt(l > 1 && bt(f), l > 1 && yt(e.slice(0, l - 1).concat({value: " " === e[l - 2].type ? "*" : ""})).replace(z, "$1"), n, r > l && Tt(e.slice(l, r)), i > r && Tt(e = e.slice(r)), i > r && yt(e))
                }
                f.push(n)
            }
            return bt(f)
        }

        function Ct(e, t) {
            var n = 0, r = t.length > 0, a = e.length > 0, s = function (s, l, c, p, d) {
                var h, g, m, y = [], v = 0, b = "0", x = s && [], w = null != d, C = u, N = s || a && o.find.TAG("*", d && l.parentNode || l), k = T += null == C ? 1 : Math.random() || .1;
                for (w && (u = l !== f && l, i = n); null != (h = N[b]); b++) {
                    if (a && h) {
                        g = 0;
                        while (m = e[g++])if (m(h, l, c)) {
                            p.push(h);
                            break
                        }
                        w && (T = k, i = ++n)
                    }
                    r && ((h = !m && h) && v--, s && x.push(h))
                }
                if (v += b, r && b !== v) {
                    g = 0;
                    while (m = t[g++])m(x, y, l, c);
                    if (s) {
                        if (v > 0)while (b--)x[b] || y[b] || (y[b] = q.call(p));
                        y = xt(y)
                    }
                    M.apply(p, y), w && !s && y.length > 0 && v + t.length > 1 && at.uniqueSort(p)
                }
                return w && (T = k, u = C), x
            };
            return r ? lt(s) : s
        }

        l = at.compile = function (e, t) {
            var n, r = [], i = [], o = E[e + " "];
            if (!o) {
                t || (t = mt(e)), n = t.length;
                while (n--)o = Tt(t[n]), o[b] ? r.push(o) : i.push(o);
                o = E(e, Ct(i, r))
            }
            return o
        };
        function Nt(e, t, n) {
            var r = 0, i = t.length;
            for (; i > r; r++)at(e, t[r], n);
            return n
        }

        function kt(e, t, n, i) {
            var a, s, u, c, p, f = mt(e);
            if (!i && 1 === f.length) {
                if (s = f[0] = f[0].slice(0), s.length > 2 && "ID" === (u = s[0]).type && r.getById && 9 === t.nodeType && h && o.relative[s[1].type]) {
                    if (t = (o.find.ID(u.matches[0].replace(rt, it), t) || [])[0], !t)return n;
                    e = e.slice(s.shift().value.length)
                }
                a = Q.needsContext.test(e) ? 0 : s.length;
                while (a--) {
                    if (u = s[a], o.relative[c = u.type])break;
                    if ((p = o.find[c]) && (i = p(u.matches[0].replace(rt, it), V.test(s[0].type) && t.parentNode || t))) {
                        if (s.splice(a, 1), e = i.length && yt(s), !e)return M.apply(n, i), n;
                        break
                    }
                }
            }
            return l(e, f)(i, t, !h, n, V.test(e)), n
        }

        r.sortStable = b.split("").sort(A).join("") === b, r.detectDuplicates = S, p(), r.sortDetached = ut(function (e) {
            return 1 & e.compareDocumentPosition(f.createElement("div"))
        }), ut(function (e) {
            return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href")
        }) || ct("type|href|height|width", function (e, n, r) {
            return r ? t : e.getAttribute(n, "type" === n.toLowerCase() ? 1 : 2)
        }), r.attributes && ut(function (e) {
            return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value")
        }) || ct("value", function (e, n, r) {
            return r || "input" !== e.nodeName.toLowerCase() ? t : e.defaultValue
        }), ut(function (e) {
            return null == e.getAttribute("disabled")
        }) || ct(B, function (e, n, r) {
            var i;
            return r ? t : (i = e.getAttributeNode(n)) && i.specified ? i.value : e[n] === !0 ? n.toLowerCase() : null
        }), x.find = at, x.expr = at.selectors, x.expr[":"] = x.expr.pseudos, x.unique = at.uniqueSort, x.text = at.getText, x.isXMLDoc = at.isXML, x.contains = at.contains
    }(e);
    var O = {};

    function F(e) {
        var t = O[e] = {};
        return x.each(e.match(T) || [], function (e, n) {
            t[n] = !0
        }), t
    }

    x.Callbacks = function (e) {
        e = "string" == typeof e ? O[e] || F(e) : x.extend({}, e);
        var n, r, i, o, a, s, l = [], u = !e.once && [], c = function (t) {
            for (r = e.memory && t, i = !0, a = s || 0, s = 0, o = l.length, n = !0; l && o > a; a++)if (l[a].apply(t[0], t[1]) === !1 && e.stopOnFalse) {
                r = !1;
                break
            }
            n = !1, l && (u ? u.length && c(u.shift()) : r ? l = [] : p.disable())
        }, p = {
            add: function () {
                if (l) {
                    var t = l.length;
                    (function i(t) {
                        x.each(t, function (t, n) {
                            var r = x.type(n);
                            "function" === r ? e.unique && p.has(n) || l.push(n) : n && n.length && "string" !== r && i(n)
                        })
                    })(arguments), n ? o = l.length : r && (s = t, c(r))
                }
                return this
            }, remove: function () {
                return l && x.each(arguments, function (e, t) {
                    var r;
                    while ((r = x.inArray(t, l, r)) > -1)l.splice(r, 1), n && (o >= r && o--, a >= r && a--)
                }), this
            }, has: function (e) {
                return e ? x.inArray(e, l) > -1 : !(!l || !l.length)
            }, empty: function () {
                return l = [], o = 0, this
            }, disable: function () {
                return l = u = r = t, this
            }, disabled: function () {
                return !l
            }, lock: function () {
                return u = t, r || p.disable(), this
            }, locked: function () {
                return !u
            }, fireWith: function (e, t) {
                return !l || i && !u || (t = t || [], t = [e, t.slice ? t.slice() : t], n ? u.push(t) : c(t)), this
            }, fire: function () {
                return p.fireWith(this, arguments), this
            }, fired: function () {
                return !!i
            }
        };
        return p
    }, x.extend({
        Deferred: function (e) {
            var t = [["resolve", "done", x.Callbacks("once memory"), "resolved"], ["reject", "fail", x.Callbacks("once memory"), "rejected"], ["notify", "progress", x.Callbacks("memory")]], n = "pending", r = {
                state: function () {
                    return n
                }, always: function () {
                    return i.done(arguments).fail(arguments), this
                }, then: function () {
                    var e = arguments;
                    return x.Deferred(function (n) {
                        x.each(t, function (t, o) {
                            var a = o[0], s = x.isFunction(e[t]) && e[t];
                            i[o[1]](function () {
                                var e = s && s.apply(this, arguments);
                                e && x.isFunction(e.promise) ? e.promise().done(n.resolve).fail(n.reject).progress(n.notify) : n[a + "With"](this === r ? n.promise() : this, s ? [e] : arguments)
                            })
                        }), e = null
                    }).promise()
                }, promise: function (e) {
                    return null != e ? x.extend(e, r) : r
                }
            }, i = {};
            return r.pipe = r.then, x.each(t, function (e, o) {
                var a = o[2], s = o[3];
                r[o[1]] = a.add, s && a.add(function () {
                    n = s
                }, t[1 ^ e][2].disable, t[2][2].lock), i[o[0]] = function () {
                    return i[o[0] + "With"](this === i ? r : this, arguments), this
                }, i[o[0] + "With"] = a.fireWith
            }), r.promise(i), e && e.call(i, i), i
        }, when: function (e) {
            var t = 0, n = g.call(arguments), r = n.length, i = 1 !== r || e && x.isFunction(e.promise) ? r : 0, o = 1 === i ? e : x.Deferred(), a = function (e, t, n) {
                return function (r) {
                    t[e] = this, n[e] = arguments.length > 1 ? g.call(arguments) : r, n === s ? o.notifyWith(t, n) : --i || o.resolveWith(t, n)
                }
            }, s, l, u;
            if (r > 1)for (s = Array(r), l = Array(r), u = Array(r); r > t; t++)n[t] && x.isFunction(n[t].promise) ? n[t].promise().done(a(t, u, n)).fail(o.reject).progress(a(t, l, s)) : --i;
            return i || o.resolveWith(u, n), o.promise()
        }
    }), x.support = function (t) {
        var n, r, o, s, l, u, c, p, f, d = a.createElement("div");
        if (d.setAttribute("className", "t"), d.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", n = d.getElementsByTagName("*") || [], r = d.getElementsByTagName("a")[0], !r || !r.style || !n.length)return t;
        s = a.createElement("select"), u = s.appendChild(a.createElement("option")), o = d.getElementsByTagName("input")[0], r.style.cssText = "top:1px;float:left;opacity:.5", t.getSetAttribute = "t" !== d.className, t.leadingWhitespace = 3 === d.firstChild.nodeType, t.tbody = !d.getElementsByTagName("tbody").length, t.htmlSerialize = !!d.getElementsByTagName("link").length, t.style = /top/.test(r.getAttribute("style")), t.hrefNormalized = "/a" === r.getAttribute("href"), t.opacity = /^0.5/.test(r.style.opacity), t.cssFloat = !!r.style.cssFloat, t.checkOn = !!o.value, t.optSelected = u.selected, t.enctype = !!a.createElement("form").enctype, t.html5Clone = "<:nav></:nav>" !== a.createElement("nav").cloneNode(!0).outerHTML, t.inlineBlockNeedsLayout = !1, t.shrinkWrapBlocks = !1, t.pixelPosition = !1, t.deleteExpando = !0, t.noCloneEvent = !0, t.reliableMarginRight = !0, t.boxSizingReliable = !0, o.checked = !0, t.noCloneChecked = o.cloneNode(!0).checked, s.disabled = !0, t.optDisabled = !u.disabled;
        try {
            delete d.test
        } catch (h) {
            t.deleteExpando = !1
        }
        o = a.createElement("input"), o.setAttribute("value", ""), t.input = "" === o.getAttribute("value"), o.value = "t", o.setAttribute("type", "radio"), t.radioValue = "t" === o.value, o.setAttribute("checked", "t"), o.setAttribute("name", "t"), l = a.createDocumentFragment(), l.appendChild(o), t.appendChecked = o.checked, t.checkClone = l.cloneNode(!0).cloneNode(!0).lastChild.checked, d.attachEvent && (d.attachEvent("onclick", function () {
            t.noCloneEvent = !1
        }), d.cloneNode(!0).click());
        for (f in{
            submit: !0, change: !0, focusin: !0
        })d.setAttribute(c = "on" + f, "t"), t[f + "Bubbles"] = c in e || d.attributes[c].expando === !1;
        d.style.backgroundClip = "content-box", d.cloneNode(!0).style.backgroundClip = "", t.clearCloneStyle = "content-box" === d.style.backgroundClip;
        for (f in x(t))break;
        return t.ownLast = "0" !== f, x(function () {
            var n, r, o, s = "padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;", l = a.getElementsByTagName("body")[0];
            l && (n = a.createElement("div"), n.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", l.appendChild(n).appendChild(d), d.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", o = d.getElementsByTagName("td"), o[0].style.cssText = "padding:0;margin:0;border:0;display:none", p = 0 === o[0].offsetHeight, o[0].style.display = "", o[1].style.display = "none", t.reliableHiddenOffsets = p && 0 === o[0].offsetHeight, d.innerHTML = "", d.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;", x.swap(l, null != l.style.zoom ? {zoom: 1} : {}, function () {
                t.boxSizing = 4 === d.offsetWidth
            }), e.getComputedStyle && (t.pixelPosition = "1%" !== (e.getComputedStyle(d, null) || {}).top, t.boxSizingReliable = "4px" === (e.getComputedStyle(d, null) || {width: "4px"}).width, r = d.appendChild(a.createElement("div")), r.style.cssText = d.style.cssText = s, r.style.marginRight = r.style.width = "0", d.style.width = "1px", t.reliableMarginRight = !parseFloat((e.getComputedStyle(r, null) || {}).marginRight)), typeof d.style.zoom !== i && (d.innerHTML = "", d.style.cssText = s + "width:1px;padding:1px;display:inline;zoom:1", t.inlineBlockNeedsLayout = 3 === d.offsetWidth, d.style.display = "block", d.innerHTML = "<div></div>", d.firstChild.style.width = "5px", t.shrinkWrapBlocks = 3 !== d.offsetWidth, t.inlineBlockNeedsLayout && (l.style.zoom = 1)), l.removeChild(n), n = d = o = r = null)
        }), n = s = l = u = r = o = null, t
    }({});
    var B = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, P = /([A-Z])/g;

    function R(e, n, r, i) {
        if (x.acceptData(e)) {
            var o, a, s = x.expando, l = e.nodeType, u = l ? x.cache : e, c = l ? e[s] : e[s] && s;
            if (c && u[c] && (i || u[c].data) || r !== t || "string" != typeof n)return c || (c = l ? e[s] = p.pop() || x.guid++ : s), u[c] || (u[c] = l ? {} : {toJSON: x.noop}), ("object" == typeof n || "function" == typeof n) && (i ? u[c] = x.extend(u[c], n) : u[c].data = x.extend(u[c].data, n)), a = u[c], i || (a.data || (a.data = {}), a = a.data), r !== t && (a[x.camelCase(n)] = r), "string" == typeof n ? (o = a[n], null == o && (o = a[x.camelCase(n)])) : o = a, o
        }
    }

    function W(e, t, n) {
        if (x.acceptData(e)) {
            var r, i, o = e.nodeType, a = o ? x.cache : e, s = o ? e[x.expando] : x.expando;
            if (a[s]) {
                if (t && (r = n ? a[s] : a[s].data)) {
                    x.isArray(t) ? t = t.concat(x.map(t, x.camelCase)) : t in r ? t = [t] : (t = x.camelCase(t), t = t in r ? [t] : t.split(" ")), i = t.length;
                    while (i--)delete r[t[i]];
                    if (n ? !I(r) : !x.isEmptyObject(r))return
                }
                (n || (delete a[s].data, I(a[s]))) && (o ? x.cleanData([e], !0) : x.support.deleteExpando || a != a.window ? delete a[s] : a[s] = null)
            }
        }
    }

    x.extend({
        cache: {},
        noData: {applet: !0, embed: !0, object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},
        hasData: function (e) {
            return e = e.nodeType ? x.cache[e[x.expando]] : e[x.expando], !!e && !I(e)
        },
        data: function (e, t, n) {
            return R(e, t, n)
        },
        removeData: function (e, t) {
            return W(e, t)
        },
        _data: function (e, t, n) {
            return R(e, t, n, !0)
        },
        _removeData: function (e, t) {
            return W(e, t, !0)
        },
        acceptData: function (e) {
            if (e.nodeType && 1 !== e.nodeType && 9 !== e.nodeType)return !1;
            var t = e.nodeName && x.noData[e.nodeName.toLowerCase()];
            return !t || t !== !0 && e.getAttribute("classid") === t
        }
    }), x.fn.extend({
        data: function (e, n) {
            var r, i, o = null, a = 0, s = this[0];
            if (e === t) {
                if (this.length && (o = x.data(s), 1 === s.nodeType && !x._data(s, "parsedAttrs"))) {
                    for (r = s.attributes; r.length > a; a++)i = r[a].name, 0 === i.indexOf("data-") && (i = x.camelCase(i.slice(5)), $(s, i, o[i]));
                    x._data(s, "parsedAttrs", !0)
                }
                return o
            }
            return "object" == typeof e ? this.each(function () {
                x.data(this, e)
            }) : arguments.length > 1 ? this.each(function () {
                x.data(this, e, n)
            }) : s ? $(s, e, x.data(s, e)) : null
        }, removeData: function (e) {
            return this.each(function () {
                x.removeData(this, e)
            })
        }
    });
    function $(e, n, r) {
        if (r === t && 1 === e.nodeType) {
            var i = "data-" + n.replace(P, "-$1").toLowerCase();
            if (r = e.getAttribute(i), "string" == typeof r) {
                try {
                    r = "true" === r ? !0 : "false" === r ? !1 : "null" === r ? null : +r + "" === r ? +r : B.test(r) ? x.parseJSON(r) : r
                } catch (o) {
                }
                x.data(e, n, r)
            } else r = t
        }
        return r
    }

    function I(e) {
        var t;
        for (t in e)if (("data" !== t || !x.isEmptyObject(e[t])) && "toJSON" !== t)return !1;
        return !0
    }

    x.extend({
        queue: function (e, n, r) {
            var i;
            return e ? (n = (n || "fx") + "queue", i = x._data(e, n), r && (!i || x.isArray(r) ? i = x._data(e, n, x.makeArray(r)) : i.push(r)), i || []) : t
        }, dequeue: function (e, t) {
            t = t || "fx";
            var n = x.queue(e, t), r = n.length, i = n.shift(), o = x._queueHooks(e, t), a = function () {
                x.dequeue(e, t)
            };
            "inprogress" === i && (i = n.shift(), r--), i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, a, o)), !r && o && o.empty.fire()
        }, _queueHooks: function (e, t) {
            var n = t + "queueHooks";
            return x._data(e, n) || x._data(e, n, {
                    empty: x.Callbacks("once memory").add(function () {
                        x._removeData(e, t + "queue"), x._removeData(e, n)
                    })
                })
        }
    }), x.fn.extend({
        queue: function (e, n) {
            var r = 2;
            return "string" != typeof e && (n = e, e = "fx", r--), r > arguments.length ? x.queue(this[0], e) : n === t ? this : this.each(function () {
                var t = x.queue(this, e, n);
                x._queueHooks(this, e), "fx" === e && "inprogress" !== t[0] && x.dequeue(this, e)
            })
        }, dequeue: function (e) {
            return this.each(function () {
                x.dequeue(this, e)
            })
        }, delay: function (e, t) {
            return e = x.fx ? x.fx.speeds[e] || e : e, t = t || "fx", this.queue(t, function (t, n) {
                var r = setTimeout(t, e);
                n.stop = function () {
                    clearTimeout(r)
                }
            })
        }, clearQueue: function (e) {
            return this.queue(e || "fx", [])
        }, promise: function (e, n) {
            var r, i = 1, o = x.Deferred(), a = this, s = this.length, l = function () {
                --i || o.resolveWith(a, [a])
            };
            "string" != typeof e && (n = e, e = t), e = e || "fx";
            while (s--)r = x._data(a[s], e + "queueHooks"), r && r.empty && (i++, r.empty.add(l));
            return l(), o.promise(n)
        }
    });
    var z, X, U = /[\t\r\n\f]/g, V = /\r/g, Y = /^(?:input|select|textarea|button|object)$/i, J = /^(?:a|area)$/i, G = /^(?:checked|selected)$/i, Q = x.support.getSetAttribute, K = x.support.input;
    x.fn.extend({
        attr: function (e, t) {
            return x.access(this, x.attr, e, t, arguments.length > 1)
        }, removeAttr: function (e) {
            return this.each(function () {
                x.removeAttr(this, e)
            })
        }, prop: function (e, t) {
            return x.access(this, x.prop, e, t, arguments.length > 1)
        }, removeProp: function (e) {
            return e = x.propFix[e] || e, this.each(function () {
                try {
                    this[e] = t, delete this[e]
                } catch (n) {
                }
            })
        }, addClass: function (e) {
            var t, n, r, i, o, a = 0, s = this.length, l = "string" == typeof e && e;
            if (x.isFunction(e))return this.each(function (t) {
                x(this).addClass(e.call(this, t, this.className))
            });
            if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : " ")) {
                o = 0;
                while (i = t[o++])0 > r.indexOf(" " + i + " ") && (r += i + " ");
                n.className = x.trim(r)
            }
            return this
        }, removeClass: function (e) {
            var t, n, r, i, o, a = 0, s = this.length, l = 0 === arguments.length || "string" == typeof e && e;
            if (x.isFunction(e))return this.each(function (t) {
                x(this).removeClass(e.call(this, t, this.className))
            });
            if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : "")) {
                o = 0;
                while (i = t[o++])while (r.indexOf(" " + i + " ") >= 0)r = r.replace(" " + i + " ", " ");
                n.className = e ? x.trim(r) : ""
            }
            return this
        }, toggleClass: function (e, t) {
            var n = typeof e;
            return "boolean" == typeof t && "string" === n ? t ? this.addClass(e) : this.removeClass(e) : x.isFunction(e) ? this.each(function (n) {
                x(this).toggleClass(e.call(this, n, this.className, t), t)
            }) : this.each(function () {
                if ("string" === n) {
                    var t, r = 0, o = x(this), a = e.match(T) || [];
                    while (t = a[r++])o.hasClass(t) ? o.removeClass(t) : o.addClass(t)
                } else(n === i || "boolean" === n) && (this.className && x._data(this, "__className__", this.className), this.className = this.className || e === !1 ? "" : x._data(this, "__className__") || "")
            })
        }, hasClass: function (e) {
            var t = " " + e + " ", n = 0, r = this.length;
            for (; r > n; n++)if (1 === this[n].nodeType && (" " + this[n].className + " ").replace(U, " ").indexOf(t) >= 0)return !0;
            return !1
        }, val: function (e) {
            var n, r, i, o = this[0];
            {
                if (arguments.length)return i = x.isFunction(e), this.each(function (n) {
                    var o;
                    1 === this.nodeType && (o = i ? e.call(this, n, x(this).val()) : e, null == o ? o = "" : "number" == typeof o ? o += "" : x.isArray(o) && (o = x.map(o, function (e) {
                        return null == e ? "" : e + ""
                    })), r = x.valHooks[this.type] || x.valHooks[this.nodeName.toLowerCase()], r && "set" in r && r.set(this, o, "value") !== t || (this.value = o))
                });
                if (o)return r = x.valHooks[o.type] || x.valHooks[o.nodeName.toLowerCase()], r && "get" in r && (n = r.get(o, "value")) !== t ? n : (n = o.value, "string" == typeof n ? n.replace(V, "") : null == n ? "" : n)
            }
        }
    }), x.extend({
        valHooks: {
            option: {
                get: function (e) {
                    var t = x.find.attr(e, "value");
                    return null != t ? t : e.text
                }
            }, select: {
                get: function (e) {
                    var t, n, r = e.options, i = e.selectedIndex, o = "select-one" === e.type || 0 > i, a = o ? null : [], s = o ? i + 1 : r.length, l = 0 > i ? s : o ? i : 0;
                    for (; s > l; l++)if (n = r[l], !(!n.selected && l !== i || (x.support.optDisabled ? n.disabled : null !== n.getAttribute("disabled")) || n.parentNode.disabled && x.nodeName(n.parentNode, "optgroup"))) {
                        if (t = x(n).val(), o)return t;
                        a.push(t)
                    }
                    return a
                }, set: function (e, t) {
                    var n, r, i = e.options, o = x.makeArray(t), a = i.length;
                    while (a--)r = i[a], (r.selected = x.inArray(x(r).val(), o) >= 0) && (n = !0);
                    return n || (e.selectedIndex = -1), o
                }
            }
        }, attr: function (e, n, r) {
            var o, a, s = e.nodeType;
            if (e && 3 !== s && 8 !== s && 2 !== s)return typeof e.getAttribute === i ? x.prop(e, n, r) : (1 === s && x.isXMLDoc(e) || (n = n.toLowerCase(), o = x.attrHooks[n] || (x.expr.match.bool.test(n) ? X : z)), r === t ? o && "get" in o && null !== (a = o.get(e, n)) ? a : (a = x.find.attr(e, n), null == a ? t : a) : null !== r ? o && "set" in o && (a = o.set(e, r, n)) !== t ? a : (e.setAttribute(n, r + ""), r) : (x.removeAttr(e, n), t))
        }, removeAttr: function (e, t) {
            var n, r, i = 0, o = t && t.match(T);
            if (o && 1 === e.nodeType)while (n = o[i++])r = x.propFix[n] || n, x.expr.match.bool.test(n) ? K && Q || !G.test(n) ? e[r] = !1 : e[x.camelCase("default-" + n)] = e[r] = !1 : x.attr(e, n, ""), e.removeAttribute(Q ? n : r)
        }, attrHooks: {
            type: {
                set: function (e, t) {
                    if (!x.support.radioValue && "radio" === t && x.nodeName(e, "input")) {
                        var n = e.value;
                        return e.setAttribute("type", t), n && (e.value = n), t
                    }
                }
            }
        }, propFix: {"for": "htmlFor", "class": "className"}, prop: function (e, n, r) {
            var i, o, a, s = e.nodeType;
            if (e && 3 !== s && 8 !== s && 2 !== s)return a = 1 !== s || !x.isXMLDoc(e), a && (n = x.propFix[n] || n, o = x.propHooks[n]), r !== t ? o && "set" in o && (i = o.set(e, r, n)) !== t ? i : e[n] = r : o && "get" in o && null !== (i = o.get(e, n)) ? i : e[n]
        }, propHooks: {
            tabIndex: {
                get: function (e) {
                    var t = x.find.attr(e, "tabindex");
                    return t ? parseInt(t, 10) : Y.test(e.nodeName) || J.test(e.nodeName) && e.href ? 0 : -1
                }
            }
        }
    }), X = {
        set: function (e, t, n) {
            return t === !1 ? x.removeAttr(e, n) : K && Q || !G.test(n) ? e.setAttribute(!Q && x.propFix[n] || n, n) : e[x.camelCase("default-" + n)] = e[n] = !0, n
        }
    }, x.each(x.expr.match.bool.source.match(/\w+/g), function (e, n) {
        var r = x.expr.attrHandle[n] || x.find.attr;
        x.expr.attrHandle[n] = K && Q || !G.test(n) ? function (e, n, i) {
            var o = x.expr.attrHandle[n], a = i ? t : (x.expr.attrHandle[n] = t) != r(e, n, i) ? n.toLowerCase() : null;
            return x.expr.attrHandle[n] = o, a
        } : function (e, n, r) {
            return r ? t : e[x.camelCase("default-" + n)] ? n.toLowerCase() : null
        }
    }), K && Q || (x.attrHooks.value = {
        set: function (e, n, r) {
            return x.nodeName(e, "input") ? (e.defaultValue = n, t) : z && z.set(e, n, r)
        }
    }), Q || (z = {
        set: function (e, n, r) {
            var i = e.getAttributeNode(r);
            return i || e.setAttributeNode(i = e.ownerDocument.createAttribute(r)), i.value = n += "", "value" === r || n === e.getAttribute(r) ? n : t
        }
    }, x.expr.attrHandle.id = x.expr.attrHandle.name = x.expr.attrHandle.coords = function (e, n, r) {
        var i;
        return r ? t : (i = e.getAttributeNode(n)) && "" !== i.value ? i.value : null
    }, x.valHooks.button = {
        get: function (e, n) {
            var r = e.getAttributeNode(n);
            return r && r.specified ? r.value : t
        }, set: z.set
    }, x.attrHooks.contenteditable = {
        set: function (e, t, n) {
            z.set(e, "" === t ? !1 : t, n)
        }
    }, x.each(["width", "height"], function (e, n) {
        x.attrHooks[n] = {
            set: function (e, r) {
                return "" === r ? (e.setAttribute(n, "auto"), r) : t
            }
        }
    })), x.support.hrefNormalized || x.each(["href", "src"], function (e, t) {
        x.propHooks[t] = {
            get: function (e) {
                return e.getAttribute(t, 4)
            }
        }
    }), x.support.style || (x.attrHooks.style = {
        get: function (e) {
            return e.style.cssText || t
        }, set: function (e, t) {
            return e.style.cssText = t + ""
        }
    }), x.support.optSelected || (x.propHooks.selected = {
        get: function (e) {
            var t = e.parentNode;
            return t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex), null
        }
    }), x.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
        x.propFix[this.toLowerCase()] = this
    }), x.support.enctype || (x.propFix.enctype = "encoding"), x.each(["radio", "checkbox"], function () {
        x.valHooks[this] = {
            set: function (e, n) {
                return x.isArray(n) ? e.checked = x.inArray(x(e).val(), n) >= 0 : t
            }
        }, x.support.checkOn || (x.valHooks[this].get = function (e) {
            return null === e.getAttribute("value") ? "on" : e.value
        })
    });
    var Z = /^(?:input|select|textarea)$/i, et = /^key/, tt = /^(?:mouse|contextmenu)|click/, nt = /^(?:focusinfocus|focusoutblur)$/, rt = /^([^.]*)(?:\.(.+)|)$/;

    function it() {
        return !0
    }

    function ot() {
        return !1
    }

    function at() {
        try {
            return a.activeElement
        } catch (e) {
        }
    }

    x.event = {
        global: {},
        add: function (e, n, r, o, a) {
            var s, l, u, c, p, f, d, h, g, m, y, v = x._data(e);
            if (v) {
                r.handler && (c = r, r = c.handler, a = c.selector), r.guid || (r.guid = x.guid++), (l = v.events) || (l = v.events = {}), (f = v.handle) || (f = v.handle = function (e) {
                    return typeof x === i || e && x.event.triggered === e.type ? t : x.event.dispatch.apply(f.elem, arguments)
                }, f.elem = e), n = (n || "").match(T) || [""], u = n.length;
                while (u--)s = rt.exec(n[u]) || [], g = y = s[1], m = (s[2] || "").split(".").sort(), g && (p = x.event.special[g] || {}, g = (a ? p.delegateType : p.bindType) || g, p = x.event.special[g] || {}, d = x.extend({
                    type: g,
                    origType: y,
                    data: o,
                    handler: r,
                    guid: r.guid,
                    selector: a,
                    needsContext: a && x.expr.match.needsContext.test(a),
                    namespace: m.join(".")
                }, c), (h = l[g]) || (h = l[g] = [], h.delegateCount = 0, p.setup && p.setup.call(e, o, m, f) !== !1 || (e.addEventListener ? e.addEventListener(g, f, !1) : e.attachEvent && e.attachEvent("on" + g, f))), p.add && (p.add.call(e, d), d.handler.guid || (d.handler.guid = r.guid)), a ? h.splice(h.delegateCount++, 0, d) : h.push(d), x.event.global[g] = !0);
                e = null
            }
        },
        remove: function (e, t, n, r, i) {
            var o, a, s, l, u, c, p, f, d, h, g, m = x.hasData(e) && x._data(e);
            if (m && (c = m.events)) {
                t = (t || "").match(T) || [""], u = t.length;
                while (u--)if (s = rt.exec(t[u]) || [], d = g = s[1], h = (s[2] || "").split(".").sort(), d) {
                    p = x.event.special[d] || {}, d = (r ? p.delegateType : p.bindType) || d, f = c[d] || [], s = s[2] && RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), l = o = f.length;
                    while (o--)a = f[o], !i && g !== a.origType || n && n.guid !== a.guid || s && !s.test(a.namespace) || r && r !== a.selector && ("**" !== r || !a.selector) || (f.splice(o, 1), a.selector && f.delegateCount--, p.remove && p.remove.call(e, a));
                    l && !f.length && (p.teardown && p.teardown.call(e, h, m.handle) !== !1 || x.removeEvent(e, d, m.handle), delete c[d])
                } else for (d in c)x.event.remove(e, d + t[u], n, r, !0);
                x.isEmptyObject(c) && (delete m.handle, x._removeData(e, "events"))
            }
        },
        trigger: function (n, r, i, o) {
            var s, l, u, c, p, f, d, h = [i || a], g = v.call(n, "type") ? n.type : n, m = v.call(n, "namespace") ? n.namespace.split(".") : [];
            if (u = f = i = i || a, 3 !== i.nodeType && 8 !== i.nodeType && !nt.test(g + x.event.triggered) && (g.indexOf(".") >= 0 && (m = g.split("."), g = m.shift(), m.sort()), l = 0 > g.indexOf(":") && "on" + g, n = n[x.expando] ? n : new x.Event(g, "object" == typeof n && n), n.isTrigger = o ? 2 : 3, n.namespace = m.join("."), n.namespace_re = n.namespace ? RegExp("(^|\\.)" + m.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, n.result = t, n.target || (n.target = i), r = null == r ? [n] : x.makeArray(r, [n]), p = x.event.special[g] || {}, o || !p.trigger || p.trigger.apply(i, r) !== !1)) {
                if (!o && !p.noBubble && !x.isWindow(i)) {
                    for (c = p.delegateType || g, nt.test(c + g) || (u = u.parentNode); u; u = u.parentNode)h.push(u), f = u;
                    f === (i.ownerDocument || a) && h.push(f.defaultView || f.parentWindow || e)
                }
                d = 0;
                while ((u = h[d++]) && !n.isPropagationStopped())n.type = d > 1 ? c : p.bindType || g, s = (x._data(u, "events") || {})[n.type] && x._data(u, "handle"), s && s.apply(u, r), s = l && u[l], s && x.acceptData(u) && s.apply && s.apply(u, r) === !1 && n.preventDefault();
                if (n.type = g, !o && !n.isDefaultPrevented() && (!p._default || p._default.apply(h.pop(), r) === !1) && x.acceptData(i) && l && i[g] && !x.isWindow(i)) {
                    f = i[l], f && (i[l] = null), x.event.triggered = g;
                    try {
                        i[g]()
                    } catch (y) {
                    }
                    x.event.triggered = t, f && (i[l] = f)
                }
                return n.result
            }
        },
        dispatch: function (e) {
            e = x.event.fix(e);
            var n, r, i, o, a, s = [], l = g.call(arguments), u = (x._data(this, "events") || {})[e.type] || [], c = x.event.special[e.type] || {};
            if (l[0] = e, e.delegateTarget = this, !c.preDispatch || c.preDispatch.call(this, e) !== !1) {
                s = x.event.handlers.call(this, e, u), n = 0;
                while ((o = s[n++]) && !e.isPropagationStopped()) {
                    e.currentTarget = o.elem, a = 0;
                    while ((i = o.handlers[a++]) && !e.isImmediatePropagationStopped())(!e.namespace_re || e.namespace_re.test(i.namespace)) && (e.handleObj = i, e.data = i.data, r = ((x.event.special[i.origType] || {}).handle || i.handler).apply(o.elem, l), r !== t && (e.result = r) === !1 && (e.preventDefault(), e.stopPropagation()))
                }
                return c.postDispatch && c.postDispatch.call(this, e), e.result
            }
        },
        handlers: function (e, n) {
            var r, i, o, a, s = [], l = n.delegateCount, u = e.target;
            if (l && u.nodeType && (!e.button || "click" !== e.type))for (; u != this; u = u.parentNode || this)if (1 === u.nodeType && (u.disabled !== !0 || "click" !== e.type)) {
                for (o = [], a = 0; l > a; a++)i = n[a], r = i.selector + " ", o[r] === t && (o[r] = i.needsContext ? x(r, this).index(u) >= 0 : x.find(r, this, null, [u]).length), o[r] && o.push(i);
                o.length && s.push({elem: u, handlers: o})
            }
            return n.length > l && s.push({elem: this, handlers: n.slice(l)}), s
        },
        fix: function (e) {
            if (e[x.expando])return e;
            var t, n, r, i = e.type, o = e, s = this.fixHooks[i];
            s || (this.fixHooks[i] = s = tt.test(i) ? this.mouseHooks : et.test(i) ? this.keyHooks : {}), r = s.props ? this.props.concat(s.props) : this.props, e = new x.Event(o), t = r.length;
            while (t--)n = r[t], e[n] = o[n];
            return e.target || (e.target = o.srcElement || a), 3 === e.target.nodeType && (e.target = e.target.parentNode), e.metaKey = !!e.metaKey, s.filter ? s.filter(e, o) : e
        },
        props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "), filter: function (e, t) {
                return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function (e, n) {
                var r, i, o, s = n.button, l = n.fromElement;
                return null == e.pageX && null != n.clientX && (i = e.target.ownerDocument || a, o = i.documentElement, r = i.body, e.pageX = n.clientX + (o && o.scrollLeft || r && r.scrollLeft || 0) - (o && o.clientLeft || r && r.clientLeft || 0), e.pageY = n.clientY + (o && o.scrollTop || r && r.scrollTop || 0) - (o && o.clientTop || r && r.clientTop || 0)), !e.relatedTarget && l && (e.relatedTarget = l === e.target ? n.toElement : l), e.which || s === t || (e.which = 1 & s ? 1 : 2 & s ? 3 : 4 & s ? 2 : 0), e
            }
        },
        special: {
            load: {noBubble: !0}, focus: {
                trigger: function () {
                    if (this !== at() && this.focus)try {
                        return this.focus(), !1
                    } catch (e) {
                    }
                }, delegateType: "focusin"
            }, blur: {
                trigger: function () {
                    return this === at() && this.blur ? (this.blur(), !1) : t
                }, delegateType: "focusout"
            }, click: {
                trigger: function () {
                    return x.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : t
                }, _default: function (e) {
                    return x.nodeName(e.target, "a")
                }
            }, beforeunload: {
                postDispatch: function (e) {
                    e.result !== t && (e.originalEvent.returnValue = e.result)
                }
            }
        },
        simulate: function (e, t, n, r) {
            var i = x.extend(new x.Event, n, {type: e, isSimulated: !0, originalEvent: {}});
            r ? x.event.trigger(i, null, t) : x.event.dispatch.call(t, i), i.isDefaultPrevented() && n.preventDefault()
        }
    }, x.removeEvent = a.removeEventListener ? function (e, t, n) {
        e.removeEventListener && e.removeEventListener(t, n, !1)
    } : function (e, t, n) {
        var r = "on" + t;
        e.detachEvent && (typeof e[r] === i && (e[r] = null), e.detachEvent(r, n))
    }, x.Event = function (e, n) {
        return this instanceof x.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.returnValue === !1 || e.getPreventDefault && e.getPreventDefault() ? it : ot) : this.type = e, n && x.extend(this, n), this.timeStamp = e && e.timeStamp || x.now(), this[x.expando] = !0, t) : new x.Event(e, n)
    }, x.Event.prototype = {
        isDefaultPrevented: ot,
        isPropagationStopped: ot,
        isImmediatePropagationStopped: ot,
        preventDefault: function () {
            var e = this.originalEvent;
            this.isDefaultPrevented = it, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1)
        },
        stopPropagation: function () {
            var e = this.originalEvent;
            this.isPropagationStopped = it, e && (e.stopPropagation && e.stopPropagation(), e.cancelBubble = !0)
        },
        stopImmediatePropagation: function () {
            this.isImmediatePropagationStopped = it, this.stopPropagation()
        }
    }, x.each({mouseenter: "mouseover", mouseleave: "mouseout"}, function (e, t) {
        x.event.special[e] = {
            delegateType: t, bindType: t, handle: function (e) {
                var n, r = this, i = e.relatedTarget, o = e.handleObj;
                return (!i || i !== r && !x.contains(r, i)) && (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
            }
        }
    }), x.support.submitBubbles || (x.event.special.submit = {
        setup: function () {
            return x.nodeName(this, "form") ? !1 : (x.event.add(this, "click._submit keypress._submit", function (e) {
                var n = e.target, r = x.nodeName(n, "input") || x.nodeName(n, "button") ? n.form : t;
                r && !x._data(r, "submitBubbles") && (x.event.add(r, "submit._submit", function (e) {
                    e._submit_bubble = !0
                }), x._data(r, "submitBubbles", !0))
            }), t)
        }, postDispatch: function (e) {
            e._submit_bubble && (delete e._submit_bubble, this.parentNode && !e.isTrigger && x.event.simulate("submit", this.parentNode, e, !0))
        }, teardown: function () {
            return x.nodeName(this, "form") ? !1 : (x.event.remove(this, "._submit"), t)
        }
    }), x.support.changeBubbles || (x.event.special.change = {
        setup: function () {
            return Z.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (x.event.add(this, "propertychange._change", function (e) {
                "checked" === e.originalEvent.propertyName && (this._just_changed = !0)
            }), x.event.add(this, "click._change", function (e) {
                this._just_changed && !e.isTrigger && (this._just_changed = !1), x.event.simulate("change", this, e, !0)
            })), !1) : (x.event.add(this, "beforeactivate._change", function (e) {
                var t = e.target;
                Z.test(t.nodeName) && !x._data(t, "changeBubbles") && (x.event.add(t, "change._change", function (e) {
                    !this.parentNode || e.isSimulated || e.isTrigger || x.event.simulate("change", this.parentNode, e, !0)
                }), x._data(t, "changeBubbles", !0))
            }), t)
        }, handle: function (e) {
            var n = e.target;
            return this !== n || e.isSimulated || e.isTrigger || "radio" !== n.type && "checkbox" !== n.type ? e.handleObj.handler.apply(this, arguments) : t
        }, teardown: function () {
            return x.event.remove(this, "._change"), !Z.test(this.nodeName)
        }
    }), x.support.focusinBubbles || x.each({focus: "focusin", blur: "focusout"}, function (e, t) {
        var n = 0, r = function (e) {
            x.event.simulate(t, e.target, x.event.fix(e), !0)
        };
        x.event.special[t] = {
            setup: function () {
                0 === n++ && a.addEventListener(e, r, !0)
            }, teardown: function () {
                0 === --n && a.removeEventListener(e, r, !0)
            }
        }
    }), x.fn.extend({
        on: function (e, n, r, i, o) {
            var a, s;
            if ("object" == typeof e) {
                "string" != typeof n && (r = r || n, n = t);
                for (a in e)this.on(a, n, r, e[a], o);
                return this
            }
            if (null == r && null == i ? (i = n, r = n = t) : null == i && ("string" == typeof n ? (i = r, r = t) : (i = r, r = n, n = t)), i === !1) i = ot; else if (!i)return this;
            return 1 === o && (s = i, i = function (e) {
                return x().off(e), s.apply(this, arguments)
            }, i.guid = s.guid || (s.guid = x.guid++)), this.each(function () {
                x.event.add(this, e, i, r, n)
            })
        }, one: function (e, t, n, r) {
            return this.on(e, t, n, r, 1)
        }, off: function (e, n, r) {
            var i, o;
            if (e && e.preventDefault && e.handleObj)return i = e.handleObj, x(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
            if ("object" == typeof e) {
                for (o in e)this.off(o, n, e[o]);
                return this
            }
            return (n === !1 || "function" == typeof n) && (r = n, n = t), r === !1 && (r = ot), this.each(function () {
                x.event.remove(this, e, r, n)
            })
        }, trigger: function (e, t) {
            return this.each(function () {
                x.event.trigger(e, t, this)
            })
        }, triggerHandler: function (e, n) {
            var r = this[0];
            return r ? x.event.trigger(e, n, r, !0) : t
        }
    });
    var st = /^.[^:#\[\.,]*$/, lt = /^(?:parents|prev(?:Until|All))/, ut = x.expr.match.needsContext, ct = {
        children: !0,
        contents: !0,
        next: !0,
        prev: !0
    };
    x.fn.extend({
        find: function (e) {
            var t, n = [], r = this, i = r.length;
            if ("string" != typeof e)return this.pushStack(x(e).filter(function () {
                for (t = 0; i > t; t++)if (x.contains(r[t], this))return !0
            }));
            for (t = 0; i > t; t++)x.find(e, r[t], n);
            return n = this.pushStack(i > 1 ? x.unique(n) : n), n.selector = this.selector ? this.selector + " " + e : e, n
        }, has: function (e) {
            var t, n = x(e, this), r = n.length;
            return this.filter(function () {
                for (t = 0; r > t; t++)if (x.contains(this, n[t]))return !0
            })
        }, not: function (e) {
            return this.pushStack(ft(this, e || [], !0))
        }, filter: function (e) {
            return this.pushStack(ft(this, e || [], !1))
        }, is: function (e) {
            return !!ft(this, "string" == typeof e && ut.test(e) ? x(e) : e || [], !1).length
        }, closest: function (e, t) {
            var n, r = 0, i = this.length, o = [], a = ut.test(e) || "string" != typeof e ? x(e, t || this.context) : 0;
            for (; i > r; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (11 > n.nodeType && (a ? a.index(n) > -1 : 1 === n.nodeType && x.find.matchesSelector(n, e))) {
                n = o.push(n);
                break
            }
            return this.pushStack(o.length > 1 ? x.unique(o) : o)
        }, index: function (e) {
            return e ? "string" == typeof e ? x.inArray(this[0], x(e)) : x.inArray(e.jquery ? e[0] : e, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
        }, add: function (e, t) {
            var n = "string" == typeof e ? x(e, t) : x.makeArray(e && e.nodeType ? [e] : e), r = x.merge(this.get(), n);
            return this.pushStack(x.unique(r))
        }, addBack: function (e) {
            return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
        }
    });
    function pt(e, t) {
        do e = e[t]; while (e && 1 !== e.nodeType);
        return e
    }

    x.each({
        parent: function (e) {
            var t = e.parentNode;
            return t && 11 !== t.nodeType ? t : null
        }, parents: function (e) {
            return x.dir(e, "parentNode")
        }, parentsUntil: function (e, t, n) {
            return x.dir(e, "parentNode", n)
        }, next: function (e) {
            return pt(e, "nextSibling")
        }, prev: function (e) {
            return pt(e, "previousSibling")
        }, nextAll: function (e) {
            return x.dir(e, "nextSibling")
        }, prevAll: function (e) {
            return x.dir(e, "previousSibling")
        }, nextUntil: function (e, t, n) {
            return x.dir(e, "nextSibling", n)
        }, prevUntil: function (e, t, n) {
            return x.dir(e, "previousSibling", n)
        }, siblings: function (e) {
            return x.sibling((e.parentNode || {}).firstChild, e)
        }, children: function (e) {
            return x.sibling(e.firstChild)
        }, contents: function (e) {
            return x.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : x.merge([], e.childNodes)
        }
    }, function (e, t) {
        x.fn[e] = function (n, r) {
            var i = x.map(this, t, n);
            return "Until" !== e.slice(-5) && (r = n), r && "string" == typeof r && (i = x.filter(r, i)), this.length > 1 && (ct[e] || (i = x.unique(i)), lt.test(e) && (i = i.reverse())), this.pushStack(i)
        }
    }), x.extend({
        filter: function (e, t, n) {
            var r = t[0];
            return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? x.find.matchesSelector(r, e) ? [r] : [] : x.find.matches(e, x.grep(t, function (e) {
                return 1 === e.nodeType
            }))
        }, dir: function (e, n, r) {
            var i = [], o = e[n];
            while (o && 9 !== o.nodeType && (r === t || 1 !== o.nodeType || !x(o).is(r)))1 === o.nodeType && i.push(o), o = o[n];
            return i
        }, sibling: function (e, t) {
            var n = [];
            for (; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e);
            return n
        }
    });
    function ft(e, t, n) {
        if (x.isFunction(t))return x.grep(e, function (e, r) {
            return !!t.call(e, r, e) !== n
        });
        if (t.nodeType)return x.grep(e, function (e) {
            return e === t !== n
        });
        if ("string" == typeof t) {
            if (st.test(t))return x.filter(t, e, n);
            t = x.filter(t, e)
        }
        return x.grep(e, function (e) {
            return x.inArray(e, t) >= 0 !== n
        })
    }

    function dt(e) {
        var t = ht.split("|"), n = e.createDocumentFragment();
        if (n.createElement)while (t.length)n.createElement(t.pop());
        return n
    }

    var ht = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", gt = / jQuery\d+="(?:null|\d+)"/g, mt = RegExp("<(?:" + ht + ")[\\s/>]", "i"), yt = /^\s+/, vt = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, bt = /<([\w:]+)/, xt = /<tbody/i, wt = /<|&#?\w+;/, Tt = /<(?:script|style|link)/i, Ct = /^(?:checkbox|radio)$/i, Nt = /checked\s*(?:[^=]|=\s*.checked.)/i, kt = /^$|\/(?:java|ecma)script/i, Et = /^true\/(.*)/, St = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, At = {
        option: [1, "<select multiple='multiple'>", "</select>"],
        legend: [1, "<fieldset>", "</fieldset>"],
        area: [1, "<map>", "</map>"],
        param: [1, "<object>", "</object>"],
        thead: [1, "<table>", "</table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        _default: x.support.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]
    }, jt = dt(a), Dt = jt.appendChild(a.createElement("div"));
    At.optgroup = At.option, At.tbody = At.tfoot = At.colgroup = At.caption = At.thead, At.th = At.td, x.fn.extend({
        text: function (e) {
            return x.access(this, function (e) {
                return e === t ? x.text(this) : this.empty().append((this[0] && this[0].ownerDocument || a).createTextNode(e))
            }, null, e, arguments.length)
        }, append: function () {
            return this.domManip(arguments, function (e) {
                if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                    var t = Lt(this, e);
                    t.appendChild(e)
                }
            })
        }, prepend: function () {
            return this.domManip(arguments, function (e) {
                if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                    var t = Lt(this, e);
                    t.insertBefore(e, t.firstChild)
                }
            })
        }, before: function () {
            return this.domManip(arguments, function (e) {
                this.parentNode && this.parentNode.insertBefore(e, this)
            })
        }, after: function () {
            return this.domManip(arguments, function (e) {
                this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
            })
        }, remove: function (e, t) {
            var n, r = e ? x.filter(e, this) : this, i = 0;
            for (; null != (n = r[i]); i++)t || 1 !== n.nodeType || x.cleanData(Ft(n)), n.parentNode && (t && x.contains(n.ownerDocument, n) && _t(Ft(n, "script")), n.parentNode.removeChild(n));
            return this
        }, empty: function () {
            var e, t = 0;
            for (; null != (e = this[t]); t++) {
                1 === e.nodeType && x.cleanData(Ft(e, !1));
                while (e.firstChild)e.removeChild(e.firstChild);
                e.options && x.nodeName(e, "select") && (e.options.length = 0)
            }
            return this
        }, clone: function (e, t) {
            return e = null == e ? !1 : e, t = null == t ? e : t, this.map(function () {
                return x.clone(this, e, t)
            })
        }, html: function (e) {
            return x.access(this, function (e) {
                var n = this[0] || {}, r = 0, i = this.length;
                if (e === t)return 1 === n.nodeType ? n.innerHTML.replace(gt, "") : t;
                if (!("string" != typeof e || Tt.test(e) || !x.support.htmlSerialize && mt.test(e) || !x.support.leadingWhitespace && yt.test(e) || At[(bt.exec(e) || ["", ""])[1].toLowerCase()])) {
                    e = e.replace(vt, "<$1></$2>");
                    try {
                        for (; i > r; r++)n = this[r] || {}, 1 === n.nodeType && (x.cleanData(Ft(n, !1)), n.innerHTML = e);
                        n = 0
                    } catch (o) {
                    }
                }
                n && this.empty().append(e)
            }, null, e, arguments.length)
        }, replaceWith: function () {
            var e = x.map(this, function (e) {
                return [e.nextSibling, e.parentNode]
            }), t = 0;
            return this.domManip(arguments, function (n) {
                var r = e[t++], i = e[t++];
                i && (r && r.parentNode !== i && (r = this.nextSibling), x(this).remove(), i.insertBefore(n, r))
            }, !0), t ? this : this.remove()
        }, detach: function (e) {
            return this.remove(e, !0)
        }, domManip: function (e, t, n) {
            e = d.apply([], e);
            var r, i, o, a, s, l, u = 0, c = this.length, p = this, f = c - 1, h = e[0], g = x.isFunction(h);
            if (g || !(1 >= c || "string" != typeof h || x.support.checkClone) && Nt.test(h))return this.each(function (r) {
                var i = p.eq(r);
                g && (e[0] = h.call(this, r, i.html())), i.domManip(e, t, n)
            });
            if (c && (l = x.buildFragment(e, this[0].ownerDocument, !1, !n && this), r = l.firstChild, 1 === l.childNodes.length && (l = r), r)) {
                for (a = x.map(Ft(l, "script"), Ht), o = a.length; c > u; u++)i = l, u !== f && (i = x.clone(i, !0, !0), o && x.merge(a, Ft(i, "script"))), t.call(this[u], i, u);
                if (o)for (s = a[a.length - 1].ownerDocument, x.map(a, qt), u = 0; o > u; u++)i = a[u], kt.test(i.type || "") && !x._data(i, "globalEval") && x.contains(s, i) && (i.src ? x._evalUrl(i.src) : x.globalEval((i.text || i.textContent || i.innerHTML || "").replace(St, "")));
                l = r = null
            }
            return this
        }
    });
    function Lt(e, t) {
        return x.nodeName(e, "table") && x.nodeName(1 === t.nodeType ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e
    }

    function Ht(e) {
        return e.type = (null !== x.find.attr(e, "type")) + "/" + e.type, e
    }

    function qt(e) {
        var t = Et.exec(e.type);
        return t ? e.type = t[1] : e.removeAttribute("type"), e
    }

    function _t(e, t) {
        var n, r = 0;
        for (; null != (n = e[r]); r++)x._data(n, "globalEval", !t || x._data(t[r], "globalEval"))
    }

    function Mt(e, t) {
        if (1 === t.nodeType && x.hasData(e)) {
            var n, r, i, o = x._data(e), a = x._data(t, o), s = o.events;
            if (s) {
                delete a.handle, a.events = {};
                for (n in s)for (r = 0, i = s[n].length; i > r; r++)x.event.add(t, n, s[n][r])
            }
            a.data && (a.data = x.extend({}, a.data))
        }
    }

    function Ot(e, t) {
        var n, r, i;
        if (1 === t.nodeType) {
            if (n = t.nodeName.toLowerCase(), !x.support.noCloneEvent && t[x.expando]) {
                i = x._data(t);
                for (r in i.events)x.removeEvent(t, r, i.handle);
                t.removeAttribute(x.expando)
            }
            "script" === n && t.text !== e.text ? (Ht(t).text = e.text, qt(t)) : "object" === n ? (t.parentNode && (t.outerHTML = e.outerHTML), x.support.html5Clone && e.innerHTML && !x.trim(t.innerHTML) && (t.innerHTML = e.innerHTML)) : "input" === n && Ct.test(e.type) ? (t.defaultChecked = t.checked = e.checked, t.value !== e.value && (t.value = e.value)) : "option" === n ? t.defaultSelected = t.selected = e.defaultSelected : ("input" === n || "textarea" === n) && (t.defaultValue = e.defaultValue)
        }
    }

    x.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function (e, t) {
        x.fn[e] = function (e) {
            var n, r = 0, i = [], o = x(e), a = o.length - 1;
            for (; a >= r; r++)n = r === a ? this : this.clone(!0), x(o[r])[t](n), h.apply(i, n.get());
            return this.pushStack(i)
        }
    });
    function Ft(e, n) {
        var r, o, a = 0, s = typeof e.getElementsByTagName !== i ? e.getElementsByTagName(n || "*") : typeof e.querySelectorAll !== i ? e.querySelectorAll(n || "*") : t;
        if (!s)for (s = [], r = e.childNodes || e; null != (o = r[a]); a++)!n || x.nodeName(o, n) ? s.push(o) : x.merge(s, Ft(o, n));
        return n === t || n && x.nodeName(e, n) ? x.merge([e], s) : s
    }

    function Bt(e) {
        Ct.test(e.type) && (e.defaultChecked = e.checked)
    }

    x.extend({
        clone: function (e, t, n) {
            var r, i, o, a, s, l = x.contains(e.ownerDocument, e);
            if (x.support.html5Clone || x.isXMLDoc(e) || !mt.test("<" + e.nodeName + ">") ? o = e.cloneNode(!0) : (Dt.innerHTML = e.outerHTML, Dt.removeChild(o = Dt.firstChild)), !(x.support.noCloneEvent && x.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || x.isXMLDoc(e)))for (r = Ft(o), s = Ft(e), a = 0; null != (i = s[a]); ++a)r[a] && Ot(i, r[a]);
            if (t)if (n)for (s = s || Ft(e), r = r || Ft(o), a = 0; null != (i = s[a]); a++)Mt(i, r[a]); else Mt(e, o);
            return r = Ft(o, "script"), r.length > 0 && _t(r, !l && Ft(e, "script")), r = s = i = null, o
        }, buildFragment: function (e, t, n, r) {
            var i, o, a, s, l, u, c, p = e.length, f = dt(t), d = [], h = 0;
            for (; p > h; h++)if (o = e[h], o || 0 === o)if ("object" === x.type(o)) x.merge(d, o.nodeType ? [o] : o); else if (wt.test(o)) {
                s = s || f.appendChild(t.createElement("div")), l = (bt.exec(o) || ["", ""])[1].toLowerCase(), c = At[l] || At._default, s.innerHTML = c[1] + o.replace(vt, "<$1></$2>") + c[2], i = c[0];
                while (i--)s = s.lastChild;
                if (!x.support.leadingWhitespace && yt.test(o) && d.push(t.createTextNode(yt.exec(o)[0])), !x.support.tbody) {
                    o = "table" !== l || xt.test(o) ? "<table>" !== c[1] || xt.test(o) ? 0 : s : s.firstChild, i = o && o.childNodes.length;
                    while (i--)x.nodeName(u = o.childNodes[i], "tbody") && !u.childNodes.length && o.removeChild(u)
                }
                x.merge(d, s.childNodes), s.textContent = "";
                while (s.firstChild)s.removeChild(s.firstChild);
                s = f.lastChild
            } else d.push(t.createTextNode(o));
            s && f.removeChild(s), x.support.appendChecked || x.grep(Ft(d, "input"), Bt), h = 0;
            while (o = d[h++])if ((!r || -1 === x.inArray(o, r)) && (a = x.contains(o.ownerDocument, o), s = Ft(f.appendChild(o), "script"), a && _t(s), n)) {
                i = 0;
                while (o = s[i++])kt.test(o.type || "") && n.push(o)
            }
            return s = null, f
        }, cleanData: function (e, t) {
            var n, r, o, a, s = 0, l = x.expando, u = x.cache, c = x.support.deleteExpando, f = x.event.special;
            for (; null != (n = e[s]); s++)if ((t || x.acceptData(n)) && (o = n[l], a = o && u[o])) {
                if (a.events)for (r in a.events)f[r] ? x.event.remove(n, r) : x.removeEvent(n, r, a.handle);
                u[o] && (delete u[o], c ? delete n[l] : typeof n.removeAttribute !== i ? n.removeAttribute(l) : n[l] = null, p.push(o))
            }
        }, _evalUrl: function (e) {
            return x.ajax({url: e, type: "GET", dataType: "script", async: !1, global: !1, "throws": !0})
        }
    }), x.fn.extend({
        wrapAll: function (e) {
            if (x.isFunction(e))return this.each(function (t) {
                x(this).wrapAll(e.call(this, t))
            });
            if (this[0]) {
                var t = x(e, this[0].ownerDocument).eq(0).clone(!0);
                this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                    var e = this;
                    while (e.firstChild && 1 === e.firstChild.nodeType)e = e.firstChild;
                    return e
                }).append(this)
            }
            return this
        }, wrapInner: function (e) {
            return x.isFunction(e) ? this.each(function (t) {
                x(this).wrapInner(e.call(this, t))
            }) : this.each(function () {
                var t = x(this), n = t.contents();
                n.length ? n.wrapAll(e) : t.append(e)
            })
        }, wrap: function (e) {
            var t = x.isFunction(e);
            return this.each(function (n) {
                x(this).wrapAll(t ? e.call(this, n) : e)
            })
        }, unwrap: function () {
            return this.parent().each(function () {
                x.nodeName(this, "body") || x(this).replaceWith(this.childNodes)
            }).end()
        }
    });
    var Pt, Rt, Wt, $t = /alpha\([^)]*\)/i, It = /opacity\s*=\s*([^)]*)/, zt = /^(top|right|bottom|left)$/, Xt = /^(none|table(?!-c[ea]).+)/, Ut = /^margin/, Vt = RegExp("^(" + w + ")(.*)$", "i"), Yt = RegExp("^(" + w + ")(?!px)[a-z%]+$", "i"), Jt = RegExp("^([+-])=(" + w + ")", "i"), Gt = {BODY: "block"}, Qt = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }, Kt = {
        letterSpacing: 0,
        fontWeight: 400
    }, Zt = ["Top", "Right", "Bottom", "Left"], en = ["Webkit", "O", "Moz", "ms"];

    function tn(e, t) {
        if (t in e)return t;
        var n = t.charAt(0).toUpperCase() + t.slice(1), r = t, i = en.length;
        while (i--)if (t = en[i] + n, t in e)return t;
        return r
    }

    function nn(e, t) {
        return e = t || e, "none" === x.css(e, "display") || !x.contains(e.ownerDocument, e)
    }

    function rn(e, t) {
        var n, r, i, o = [], a = 0, s = e.length;
        for (; s > a; a++)r = e[a], r.style && (o[a] = x._data(r, "olddisplay"), n = r.style.display, t ? (o[a] || "none" !== n || (r.style.display = ""), "" === r.style.display && nn(r) && (o[a] = x._data(r, "olddisplay", ln(r.nodeName)))) : o[a] || (i = nn(r), (n && "none" !== n || !i) && x._data(r, "olddisplay", i ? n : x.css(r, "display"))));
        for (a = 0; s > a; a++)r = e[a], r.style && (t && "none" !== r.style.display && "" !== r.style.display || (r.style.display = t ? o[a] || "" : "none"));
        return e
    }

    x.fn.extend({
        css: function (e, n) {
            return x.access(this, function (e, n, r) {
                var i, o, a = {}, s = 0;
                if (x.isArray(n)) {
                    for (o = Rt(e), i = n.length; i > s; s++)a[n[s]] = x.css(e, n[s], !1, o);
                    return a
                }
                return r !== t ? x.style(e, n, r) : x.css(e, n)
            }, e, n, arguments.length > 1)
        }, show: function () {
            return rn(this, !0)
        }, hide: function () {
            return rn(this)
        }, toggle: function (e) {
            return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function () {
                nn(this) ? x(this).show() : x(this).hide()
            })
        }
    }), x.extend({
        cssHooks: {
            opacity: {
                get: function (e, t) {
                    if (t) {
                        var n = Wt(e, "opacity");
                        return "" === n ? "1" : n
                    }
                }
            }
        },
        cssNumber: {
            columnCount: !0,
            fillOpacity: !0,
            fontWeight: !0,
            lineHeight: !0,
            opacity: !0,
            order: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: {"float": x.support.cssFloat ? "cssFloat" : "styleFloat"},
        style: function (e, n, r, i) {
            if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                var o, a, s, l = x.camelCase(n), u = e.style;
                if (n = x.cssProps[l] || (x.cssProps[l] = tn(u, l)), s = x.cssHooks[n] || x.cssHooks[l], r === t)return s && "get" in s && (o = s.get(e, !1, i)) !== t ? o : u[n];
                if (a = typeof r, "string" === a && (o = Jt.exec(r)) && (r = (o[1] + 1) * o[2] + parseFloat(x.css(e, n)), a = "number"), !(null == r || "number" === a && isNaN(r) || ("number" !== a || x.cssNumber[l] || (r += "px"), x.support.clearCloneStyle || "" !== r || 0 !== n.indexOf("background") || (u[n] = "inherit"), s && "set" in s && (r = s.set(e, r, i)) === t)))try {
                    u[n] = r
                } catch (c) {
                }
            }
        },
        css: function (e, n, r, i) {
            var o, a, s, l = x.camelCase(n);
            return n = x.cssProps[l] || (x.cssProps[l] = tn(e.style, l)), s = x.cssHooks[n] || x.cssHooks[l], s && "get" in s && (a = s.get(e, !0, r)), a === t && (a = Wt(e, n, i)), "normal" === a && n in Kt && (a = Kt[n]), "" === r || r ? (o = parseFloat(a), r === !0 || x.isNumeric(o) ? o || 0 : a) : a
        }
    }), e.getComputedStyle ? (Rt = function (t) {
        return e.getComputedStyle(t, null)
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s.getPropertyValue(n) || s[n] : t, u = e.style;
        return s && ("" !== l || x.contains(e.ownerDocument, e) || (l = x.style(e, n)), Yt.test(l) && Ut.test(n) && (i = u.width, o = u.minWidth, a = u.maxWidth, u.minWidth = u.maxWidth = u.width = l, l = s.width, u.width = i, u.minWidth = o, u.maxWidth = a)), l
    }) : a.documentElement.currentStyle && (Rt = function (e) {
        return e.currentStyle
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s[n] : t, u = e.style;
        return null == l && u && u[n] && (l = u[n]), Yt.test(l) && !zt.test(n) && (i = u.left, o = e.runtimeStyle, a = o && o.left, a && (o.left = e.currentStyle.left), u.left = "fontSize" === n ? "1em" : l, l = u.pixelLeft + "px", u.left = i, a && (o.left = a)), "" === l ? "auto" : l
    });
    function on(e, t, n) {
        var r = Vt.exec(t);
        return r ? Math.max(0, r[1] - (n || 0)) + (r[2] || "px") : t
    }

    function an(e, t, n, r, i) {
        var o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0, a = 0;
        for (; 4 > o; o += 2)"margin" === n && (a += x.css(e, n + Zt[o], !0, i)), r ? ("content" === n && (a -= x.css(e, "padding" + Zt[o], !0, i)), "margin" !== n && (a -= x.css(e, "border" + Zt[o] + "Width", !0, i))) : (a += x.css(e, "padding" + Zt[o], !0, i), "padding" !== n && (a += x.css(e, "border" + Zt[o] + "Width", !0, i)));
        return a
    }

    function sn(e, t, n) {
        var r = !0, i = "width" === t ? e.offsetWidth : e.offsetHeight, o = Rt(e), a = x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, o);
        if (0 >= i || null == i) {
            if (i = Wt(e, t, o), (0 > i || null == i) && (i = e.style[t]), Yt.test(i))return i;
            r = a && (x.support.boxSizingReliable || i === e.style[t]), i = parseFloat(i) || 0
        }
        return i + an(e, t, n || (a ? "border" : "content"), r, o) + "px"
    }

    function ln(e) {
        var t = a, n = Gt[e];
        return n || (n = un(e, t), "none" !== n && n || (Pt = (Pt || x("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement), t = (Pt[0].contentWindow || Pt[0].contentDocument).document, t.write("<!doctype html><html><body>"), t.close(), n = un(e, t), Pt.detach()), Gt[e] = n), n
    }

    function un(e, t) {
        var n = x(t.createElement(e)).appendTo(t.body), r = x.css(n[0], "display");
        return n.remove(), r
    }

    x.each(["height", "width"], function (e, n) {
        x.cssHooks[n] = {
            get: function (e, r, i) {
                return r ? 0 === e.offsetWidth && Xt.test(x.css(e, "display")) ? x.swap(e, Qt, function () {
                    return sn(e, n, i)
                }) : sn(e, n, i) : t
            }, set: function (e, t, r) {
                var i = r && Rt(e);
                return on(e, t, r ? an(e, n, r, x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, i), i) : 0)
            }
        }
    }), x.support.opacity || (x.cssHooks.opacity = {
        get: function (e, t) {
            return It.test((t && e.currentStyle ? e.currentStyle.filter : e.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : t ? "1" : ""
        }, set: function (e, t) {
            var n = e.style, r = e.currentStyle, i = x.isNumeric(t) ? "alpha(opacity=" + 100 * t + ")" : "", o = r && r.filter || n.filter || "";
            n.zoom = 1, (t >= 1 || "" === t) && "" === x.trim(o.replace($t, "")) && n.removeAttribute && (n.removeAttribute("filter"), "" === t || r && !r.filter) || (n.filter = $t.test(o) ? o.replace($t, i) : o + " " + i)
        }
    }), x(function () {
        x.support.reliableMarginRight || (x.cssHooks.marginRight = {
            get: function (e, n) {
                return n ? x.swap(e, {display: "inline-block"}, Wt, [e, "marginRight"]) : t
            }
        }), !x.support.pixelPosition && x.fn.position && x.each(["top", "left"], function (e, n) {
            x.cssHooks[n] = {
                get: function (e, r) {
                    return r ? (r = Wt(e, n), Yt.test(r) ? x(e).position()[n] + "px" : r) : t
                }
            }
        })
    }), x.expr && x.expr.filters && (x.expr.filters.hidden = function (e) {
        return 0 >= e.offsetWidth && 0 >= e.offsetHeight || !x.support.reliableHiddenOffsets && "none" === (e.style && e.style.display || x.css(e, "display"))
    }, x.expr.filters.visible = function (e) {
        return !x.expr.filters.hidden(e)
    }), x.each({margin: "", padding: "", border: "Width"}, function (e, t) {
        x.cssHooks[e + t] = {
            expand: function (n) {
                var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n];
                for (; 4 > r; r++)i[e + Zt[r] + t] = o[r] || o[r - 2] || o[0];
                return i
            }
        }, Ut.test(e) || (x.cssHooks[e + t].set = on)
    });
    var cn = /%20/g, pn = /\[\]$/, fn = /\r?\n/g, dn = /^(?:submit|button|image|reset|file)$/i, hn = /^(?:input|select|textarea|keygen)/i;
    x.fn.extend({
        serialize: function () {
            return x.param(this.serializeArray())
        }, serializeArray: function () {
            return this.map(function () {
                var e = x.prop(this, "elements");
                return e ? x.makeArray(e) : this
            }).filter(function () {
                var e = this.type;
                return this.name && !x(this).is(":disabled") && hn.test(this.nodeName) && !dn.test(e) && (this.checked || !Ct.test(e))
            }).map(function (e, t) {
                var n = x(this).val();
                return null == n ? null : x.isArray(n) ? x.map(n, function (e) {
                    return {name: t.name, value: e.replace(fn, "\r\n")}
                }) : {name: t.name, value: n.replace(fn, "\r\n")}
            }).get()
        }
    }), x.param = function (e, n) {
        var r, i = [], o = function (e, t) {
            t = x.isFunction(t) ? t() : null == t ? "" : t, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t)
        };
        if (n === t && (n = x.ajaxSettings && x.ajaxSettings.traditional), x.isArray(e) || e.jquery && !x.isPlainObject(e)) x.each(e, function () {
            o(this.name, this.value)
        }); else for (r in e)gn(r, e[r], n, o);
        return i.join("&").replace(cn, "+")
    };
    function gn(e, t, n, r) {
        var i;
        if (x.isArray(t)) x.each(t, function (t, i) {
            n || pn.test(e) ? r(e, i) : gn(e + "[" + ("object" == typeof i ? t : "") + "]", i, n, r)
        }); else if (n || "object" !== x.type(t)) r(e, t); else for (i in t)gn(e + "[" + i + "]", t[i], n, r)
    }

    x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, t) {
        x.fn[t] = function (e, n) {
            return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
        }
    }), x.fn.extend({
        hover: function (e, t) {
            return this.mouseenter(e).mouseleave(t || e)
        }, bind: function (e, t, n) {
            return this.on(e, null, t, n)
        }, unbind: function (e, t) {
            return this.off(e, null, t)
        }, delegate: function (e, t, n, r) {
            return this.on(t, e, n, r)
        }, undelegate: function (e, t, n) {
            return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
        }
    });
    var mn, yn, vn = x.now(), bn = /\?/, xn = /#.*$/, wn = /([?&])_=[^&]*/, Tn = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Cn = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Nn = /^(?:GET|HEAD)$/, kn = /^\/\//, En = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, Sn = x.fn.load, An = {}, jn = {}, Dn = "*/".concat("*");
    try {
        yn = o.href
    } catch (Ln) {
        yn = a.createElement("a"), yn.href = "", yn = yn.href
    }
    mn = En.exec(yn.toLowerCase()) || [];
    function Hn(e) {
        return function (t, n) {
            "string" != typeof t && (n = t, t = "*");
            var r, i = 0, o = t.toLowerCase().match(T) || [];
            if (x.isFunction(n))while (r = o[i++])"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
        }
    }

    function qn(e, n, r, i) {
        var o = {}, a = e === jn;

        function s(l) {
            var u;
            return o[l] = !0, x.each(e[l] || [], function (e, l) {
                var c = l(n, r, i);
                return "string" != typeof c || a || o[c] ? a ? !(u = c) : t : (n.dataTypes.unshift(c), s(c), !1)
            }), u
        }

        return s(n.dataTypes[0]) || !o["*"] && s("*")
    }

    function _n(e, n) {
        var r, i, o = x.ajaxSettings.flatOptions || {};
        for (i in n)n[i] !== t && ((o[i] ? e : r || (r = {}))[i] = n[i]);
        return r && x.extend(!0, e, r), e
    }

    x.fn.load = function (e, n, r) {
        if ("string" != typeof e && Sn)return Sn.apply(this, arguments);
        var i, o, a, s = this, l = e.indexOf(" ");
        return l >= 0 && (i = e.slice(l, e.length), e = e.slice(0, l)), x.isFunction(n) ? (r = n, n = t) : n && "object" == typeof n && (a = "POST"), s.length > 0 && x.ajax({
            url: e,
            type: a,
            dataType: "html",
            data: n
        }).done(function (e) {
            o = arguments, s.html(i ? x("<div>").append(x.parseHTML(e)).find(i) : e)
        }).complete(r && function (e, t) {
                s.each(r, o || [e.responseText, t, e])
            }), this
    }, x.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
        x.fn[t] = function (e) {
            return this.on(t, e)
        }
    }), x.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: yn,
            type: "GET",
            isLocal: Cn.test(mn[1]),
            global: !0,
            processData: !0,
            async: !0,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": Dn,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: {xml: /xml/, html: /html/, json: /json/},
            responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"},
            converters: {"* text": String, "text html": !0, "text json": x.parseJSON, "text xml": x.parseXML},
            flatOptions: {url: !0, context: !0}
        },
        ajaxSetup: function (e, t) {
            return t ? _n(_n(e, x.ajaxSettings), t) : _n(x.ajaxSettings, e)
        },
        ajaxPrefilter: Hn(An),
        ajaxTransport: Hn(jn),
        ajax: function (e, n) {
            "object" == typeof e && (n = e, e = t), n = n || {};
            var r, i, o, a, s, l, u, c, p = x.ajaxSetup({}, n), f = p.context || p, d = p.context && (f.nodeType || f.jquery) ? x(f) : x.event, h = x.Deferred(), g = x.Callbacks("once memory"), m = p.statusCode || {}, y = {}, v = {}, b = 0, w = "canceled", C = {
                readyState: 0,
                getResponseHeader: function (e) {
                    var t;
                    if (2 === b) {
                        if (!c) {
                            c = {};
                            while (t = Tn.exec(a))c[t[1].toLowerCase()] = t[2]
                        }
                        t = c[e.toLowerCase()]
                    }
                    return null == t ? null : t
                },
                getAllResponseHeaders: function () {
                    return 2 === b ? a : null
                },
                setRequestHeader: function (e, t) {
                    var n = e.toLowerCase();
                    return b || (e = v[n] = v[n] || e, y[e] = t), this
                },
                overrideMimeType: function (e) {
                    return b || (p.mimeType = e), this
                },
                statusCode: function (e) {
                    var t;
                    if (e)if (2 > b)for (t in e)m[t] = [m[t], e[t]]; else C.always(e[C.status]);
                    return this
                },
                abort: function (e) {
                    var t = e || w;
                    return u && u.abort(t), k(0, t), this
                }
            };
            if (h.promise(C).complete = g.add, C.success = C.done, C.error = C.fail, p.url = ((e || p.url || yn) + "").replace(xn, "").replace(kn, mn[1] + "//"), p.type = n.method || n.type || p.method || p.type, p.dataTypes = x.trim(p.dataType || "*").toLowerCase().match(T) || [""], null == p.crossDomain && (r = En.exec(p.url.toLowerCase()), p.crossDomain = !(!r || r[1] === mn[1] && r[2] === mn[2] && (r[3] || ("http:" === r[1] ? "80" : "443")) === (mn[3] || ("http:" === mn[1] ? "80" : "443")))), p.data && p.processData && "string" != typeof p.data && (p.data = x.param(p.data, p.traditional)), qn(An, p, n, C), 2 === b)return C;
            l = p.global, l && 0 === x.active++ && x.event.trigger("ajaxStart"), p.type = p.type.toUpperCase(), p.hasContent = !Nn.test(p.type), o = p.url, p.hasContent || (p.data && (o = p.url += (bn.test(o) ? "&" : "?") + p.data, delete p.data), p.cache === !1 && (p.url = wn.test(o) ? o.replace(wn, "$1_=" + vn++) : o + (bn.test(o) ? "&" : "?") + "_=" + vn++)), p.ifModified && (x.lastModified[o] && C.setRequestHeader("If-Modified-Since", x.lastModified[o]), x.etag[o] && C.setRequestHeader("If-None-Match", x.etag[o])), (p.data && p.hasContent && p.contentType !== !1 || n.contentType) && C.setRequestHeader("Content-Type", p.contentType), C.setRequestHeader("Accept", p.dataTypes[0] && p.accepts[p.dataTypes[0]] ? p.accepts[p.dataTypes[0]] + ("*" !== p.dataTypes[0] ? ", " + Dn + "; q=0.01" : "") : p.accepts["*"]);
            for (i in p.headers)C.setRequestHeader(i, p.headers[i]);
            if (p.beforeSend && (p.beforeSend.call(f, C, p) === !1 || 2 === b))return C.abort();
            w = "abort";
            for (i in{success: 1, error: 1, complete: 1})C[i](p[i]);
            if (u = qn(jn, p, n, C)) {
                C.readyState = 1, l && d.trigger("ajaxSend", [C, p]), p.async && p.timeout > 0 && (s = setTimeout(function () {
                    C.abort("timeout")
                }, p.timeout));
                try {
                    b = 1, u.send(y, k)
                } catch (N) {
                    if (!(2 > b))throw N;
                    k(-1, N)
                }
            } else k(-1, "No Transport");
            function k(e, n, r, i) {
                var c, y, v, w, T, N = n;
                2 !== b && (b = 2, s && clearTimeout(s), u = t, a = i || "", C.readyState = e > 0 ? 4 : 0, c = e >= 200 && 300 > e || 304 === e, r && (w = Mn(p, C, r)), w = On(p, w, C, c), c ? (p.ifModified && (T = C.getResponseHeader("Last-Modified"), T && (x.lastModified[o] = T), T = C.getResponseHeader("etag"), T && (x.etag[o] = T)), 204 === e || "HEAD" === p.type ? N = "nocontent" : 304 === e ? N = "notmodified" : (N = w.state, y = w.data, v = w.error, c = !v)) : (v = N, (e || !N) && (N = "error", 0 > e && (e = 0))), C.status = e, C.statusText = (n || N) + "", c ? h.resolveWith(f, [y, N, C]) : h.rejectWith(f, [C, N, v]), C.statusCode(m), m = t, l && d.trigger(c ? "ajaxSuccess" : "ajaxError", [C, p, c ? y : v]), g.fireWith(f, [C, N]), l && (d.trigger("ajaxComplete", [C, p]), --x.active || x.event.trigger("ajaxStop")))
            }

            return C
        },
        getJSON: function (e, t, n) {
            return x.get(e, t, n, "json")
        },
        getScript: function (e, n) {
            return x.get(e, t, n, "script")
        }
    }), x.each(["get", "post"], function (e, n) {
        x[n] = function (e, r, i, o) {
            return x.isFunction(r) && (o = o || i, i = r, r = t), x.ajax({
                url: e,
                type: n,
                dataType: o,
                data: r,
                success: i
            })
        }
    });
    function Mn(e, n, r) {
        var i, o, a, s, l = e.contents, u = e.dataTypes;
        while ("*" === u[0])u.shift(), o === t && (o = e.mimeType || n.getResponseHeader("Content-Type"));
        if (o)for (s in l)if (l[s] && l[s].test(o)) {
            u.unshift(s);
            break
        }
        if (u[0] in r) a = u[0]; else {
            for (s in r) {
                if (!u[0] || e.converters[s + " " + u[0]]) {
                    a = s;
                    break
                }
                i || (i = s)
            }
            a = a || i
        }
        return a ? (a !== u[0] && u.unshift(a), r[a]) : t
    }

    function On(e, t, n, r) {
        var i, o, a, s, l, u = {}, c = e.dataTypes.slice();
        if (c[1])for (a in e.converters)u[a.toLowerCase()] = e.converters[a];
        o = c.shift();
        while (o)if (e.responseFields[o] && (n[e.responseFields[o]] = t), !l && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), l = o, o = c.shift())if ("*" === o) o = l; else if ("*" !== l && l !== o) {
            if (a = u[l + " " + o] || u["* " + o], !a)for (i in u)if (s = i.split(" "), s[1] === o && (a = u[l + " " + s[0]] || u["* " + s[0]])) {
                a === !0 ? a = u[i] : u[i] !== !0 && (o = s[0], c.unshift(s[1]));
                break
            }
            if (a !== !0)if (a && e["throws"]) t = a(t); else try {
                t = a(t)
            } catch (p) {
                return {state: "parsererror", error: a ? p : "No conversion from " + l + " to " + o}
            }
        }
        return {state: "success", data: t}
    }

    x.ajaxSetup({
        accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
        contents: {script: /(?:java|ecma)script/},
        converters: {
            "text script": function (e) {
                return x.globalEval(e), e
            }
        }
    }), x.ajaxPrefilter("script", function (e) {
        e.cache === t && (e.cache = !1), e.crossDomain && (e.type = "GET", e.global = !1)
    }), x.ajaxTransport("script", function (e) {
        if (e.crossDomain) {
            var n, r = a.head || x("head")[0] || a.documentElement;
            return {
                send: function (t, i) {
                    n = a.createElement("script"), n.async = !0, e.scriptCharset && (n.charset = e.scriptCharset), n.src = e.url, n.onload = n.onreadystatechange = function (e, t) {
                        (t || !n.readyState || /loaded|complete/.test(n.readyState)) && (n.onload = n.onreadystatechange = null, n.parentNode && n.parentNode.removeChild(n), n = null, t || i(200, "success"))
                    }, r.insertBefore(n, r.firstChild)
                }, abort: function () {
                    n && n.onload(t, !0)
                }
            }
        }
    });
    var Fn = [], Bn = /(=)\?(?=&|$)|\?\?/;
    x.ajaxSetup({
        jsonp: "callback", jsonpCallback: function () {
            var e = Fn.pop() || x.expando + "_" + vn++;
            return this[e] = !0, e
        }
    }), x.ajaxPrefilter("json jsonp", function (n, r, i) {
        var o, a, s, l = n.jsonp !== !1 && (Bn.test(n.url) ? "url" : "string" == typeof n.data && !(n.contentType || "").indexOf("application/x-www-form-urlencoded") && Bn.test(n.data) && "data");
        return l || "jsonp" === n.dataTypes[0] ? (o = n.jsonpCallback = x.isFunction(n.jsonpCallback) ? n.jsonpCallback() : n.jsonpCallback, l ? n[l] = n[l].replace(Bn, "$1" + o) : n.jsonp !== !1 && (n.url += (bn.test(n.url) ? "&" : "?") + n.jsonp + "=" + o), n.converters["script json"] = function () {
            return s || x.error(o + " was not called"), s[0]
        }, n.dataTypes[0] = "json", a = e[o], e[o] = function () {
            s = arguments
        }, i.always(function () {
            e[o] = a, n[o] && (n.jsonpCallback = r.jsonpCallback, Fn.push(o)), s && x.isFunction(a) && a(s[0]), s = a = t
        }), "script") : t
    });
    var Pn, Rn, Wn = 0, $n = e.ActiveXObject && function () {
            var e;
            for (e in Pn)Pn[e](t, !0)
        };

    function In() {
        try {
            return new e.XMLHttpRequest
        } catch (t) {
        }
    }

    function zn() {
        try {
            return new e.ActiveXObject("Microsoft.XMLHTTP")
        } catch (t) {
        }
    }

    x.ajaxSettings.xhr = e.ActiveXObject ? function () {
        return !this.isLocal && In() || zn()
    } : In, Rn = x.ajaxSettings.xhr(), x.support.cors = !!Rn && "withCredentials" in Rn, Rn = x.support.ajax = !!Rn, Rn && x.ajaxTransport(function (n) {
        if (!n.crossDomain || x.support.cors) {
            var r;
            return {
                send: function (i, o) {
                    var a, s, l = n.xhr();
                    if (n.username ? l.open(n.type, n.url, n.async, n.username, n.password) : l.open(n.type, n.url, n.async), n.xhrFields)for (s in n.xhrFields)l[s] = n.xhrFields[s];
                    n.mimeType && l.overrideMimeType && l.overrideMimeType(n.mimeType), n.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest");
                    try {
                        for (s in i)l.setRequestHeader(s, i[s])
                    } catch (u) {
                    }
                    l.send(n.hasContent && n.data || null), r = function (e, i) {
                        var s, u, c, p;
                        try {
                            if (r && (i || 4 === l.readyState))if (r = t, a && (l.onreadystatechange = x.noop, $n && delete Pn[a]), i) 4 !== l.readyState && l.abort(); else {
                                p = {}, s = l.status, u = l.getAllResponseHeaders(), "string" == typeof l.responseText && (p.text = l.responseText);
                                try {
                                    c = l.statusText
                                } catch (f) {
                                    c = ""
                                }
                                s || !n.isLocal || n.crossDomain ? 1223 === s && (s = 204) : s = p.text ? 200 : 404
                            }
                        } catch (d) {
                            i || o(-1, d)
                        }
                        p && o(s, c, p, u)
                    }, n.async ? 4 === l.readyState ? setTimeout(r) : (a = ++Wn, $n && (Pn || (Pn = {}, x(e).unload($n)), Pn[a] = r), l.onreadystatechange = r) : r()
                }, abort: function () {
                    r && r(t, !0)
                }
            }
        }
    });
    var Xn, Un, Vn = /^(?:toggle|show|hide)$/, Yn = RegExp("^(?:([+-])=|)(" + w + ")([a-z%]*)$", "i"), Jn = /queueHooks$/, Gn = [nr], Qn = {
        "*": [function (e, t) {
            var n = this.createTween(e, t), r = n.cur(), i = Yn.exec(t), o = i && i[3] || (x.cssNumber[e] ? "" : "px"), a = (x.cssNumber[e] || "px" !== o && +r) && Yn.exec(x.css(n.elem, e)), s = 1, l = 20;
            if (a && a[3] !== o) {
                o = o || a[3], i = i || [], a = +r || 1;
                do s = s || ".5", a /= s, x.style(n.elem, e, a + o); while (s !== (s = n.cur() / r) && 1 !== s && --l)
            }
            return i && (a = n.start = +a || +r || 0, n.unit = o, n.end = i[1] ? a + (i[1] + 1) * i[2] : +i[2]), n
        }]
    };

    function Kn() {
        return setTimeout(function () {
            Xn = t
        }), Xn = x.now()
    }

    function Zn(e, t, n) {
        var r, i = (Qn[t] || []).concat(Qn["*"]), o = 0, a = i.length;
        for (; a > o; o++)if (r = i[o].call(n, t, e))return r
    }

    function er(e, t, n) {
        var r, i, o = 0, a = Gn.length, s = x.Deferred().always(function () {
            delete l.elem
        }), l = function () {
            if (i)return !1;
            var t = Xn || Kn(), n = Math.max(0, u.startTime + u.duration - t), r = n / u.duration || 0, o = 1 - r, a = 0, l = u.tweens.length;
            for (; l > a; a++)u.tweens[a].run(o);
            return s.notifyWith(e, [u, o, n]), 1 > o && l ? n : (s.resolveWith(e, [u]), !1)
        }, u = s.promise({
            elem: e,
            props: x.extend({}, t),
            opts: x.extend(!0, {specialEasing: {}}, n),
            originalProperties: t,
            originalOptions: n,
            startTime: Xn || Kn(),
            duration: n.duration,
            tweens: [],
            createTween: function (t, n) {
                var r = x.Tween(e, u.opts, t, n, u.opts.specialEasing[t] || u.opts.easing);
                return u.tweens.push(r), r
            },
            stop: function (t) {
                var n = 0, r = t ? u.tweens.length : 0;
                if (i)return this;
                for (i = !0; r > n; n++)u.tweens[n].run(1);
                return t ? s.resolveWith(e, [u, t]) : s.rejectWith(e, [u, t]), this
            }
        }), c = u.props;
        for (tr(c, u.opts.specialEasing); a > o; o++)if (r = Gn[o].call(u, e, c, u.opts))return r;
        return x.map(c, Zn, u), x.isFunction(u.opts.start) && u.opts.start.call(e, u), x.fx.timer(x.extend(l, {
            elem: e,
            anim: u,
            queue: u.opts.queue
        })), u.progress(u.opts.progress).done(u.opts.done, u.opts.complete).fail(u.opts.fail).always(u.opts.always)
    }

    function tr(e, t) {
        var n, r, i, o, a;
        for (n in e)if (r = x.camelCase(n), i = t[r], o = e[n], x.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), a = x.cssHooks[r], a && "expand" in a) {
            o = a.expand(o), delete e[r];
            for (n in o)n in e || (e[n] = o[n], t[n] = i)
        } else t[r] = i
    }

    x.Animation = x.extend(er, {
        tweener: function (e, t) {
            x.isFunction(e) ? (t = e, e = ["*"]) : e = e.split(" ");
            var n, r = 0, i = e.length;
            for (; i > r; r++)n = e[r], Qn[n] = Qn[n] || [], Qn[n].unshift(t)
        }, prefilter: function (e, t) {
            t ? Gn.unshift(e) : Gn.push(e)
        }
    });
    function nr(e, t, n) {
        var r, i, o, a, s, l, u = this, c = {}, p = e.style, f = e.nodeType && nn(e), d = x._data(e, "fxshow");
        n.queue || (s = x._queueHooks(e, "fx"), null == s.unqueued && (s.unqueued = 0, l = s.empty.fire, s.empty.fire = function () {
            s.unqueued || l()
        }), s.unqueued++, u.always(function () {
            u.always(function () {
                s.unqueued--, x.queue(e, "fx").length || s.empty.fire()
            })
        })), 1 === e.nodeType && ("height" in t || "width" in t) && (n.overflow = [p.overflow, p.overflowX, p.overflowY], "inline" === x.css(e, "display") && "none" === x.css(e, "float") && (x.support.inlineBlockNeedsLayout && "inline" !== ln(e.nodeName) ? p.zoom = 1 : p.display = "inline-block")), n.overflow && (p.overflow = "hidden", x.support.shrinkWrapBlocks || u.always(function () {
            p.overflow = n.overflow[0], p.overflowX = n.overflow[1], p.overflowY = n.overflow[2]
        }));
        for (r in t)if (i = t[r], Vn.exec(i)) {
            if (delete t[r], o = o || "toggle" === i, i === (f ? "hide" : "show"))continue;
            c[r] = d && d[r] || x.style(e, r)
        }
        if (!x.isEmptyObject(c)) {
            d ? "hidden" in d && (f = d.hidden) : d = x._data(e, "fxshow", {}), o && (d.hidden = !f), f ? x(e).show() : u.done(function () {
                x(e).hide()
            }), u.done(function () {
                var t;
                x._removeData(e, "fxshow");
                for (t in c)x.style(e, t, c[t])
            });
            for (r in c)a = Zn(f ? d[r] : 0, r, u), r in d || (d[r] = a.start, f && (a.end = a.start, a.start = "width" === r || "height" === r ? 1 : 0))
        }
    }

    function rr(e, t, n, r, i) {
        return new rr.prototype.init(e, t, n, r, i)
    }

    x.Tween = rr, rr.prototype = {
        constructor: rr, init: function (e, t, n, r, i, o) {
            this.elem = e, this.prop = n, this.easing = i || "swing", this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (x.cssNumber[n] ? "" : "px")
        }, cur: function () {
            var e = rr.propHooks[this.prop];
            return e && e.get ? e.get(this) : rr.propHooks._default.get(this)
        }, run: function (e) {
            var t, n = rr.propHooks[this.prop];
            return this.pos = t = this.options.duration ? x.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : rr.propHooks._default.set(this), this
        }
    }, rr.prototype.init.prototype = rr.prototype, rr.propHooks = {
        _default: {
            get: function (e) {
                var t;
                return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (t = x.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) : e.elem[e.prop]
            }, set: function (e) {
                x.fx.step[e.prop] ? x.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[x.cssProps[e.prop]] || x.cssHooks[e.prop]) ? x.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
            }
        }
    }, rr.propHooks.scrollTop = rr.propHooks.scrollLeft = {
        set: function (e) {
            e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
        }
    }, x.each(["toggle", "show", "hide"], function (e, t) {
        var n = x.fn[t];
        x.fn[t] = function (e, r, i) {
            return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(ir(t, !0), e, r, i)
        }
    }), x.fn.extend({
        fadeTo: function (e, t, n, r) {
            return this.filter(nn).css("opacity", 0).show().end().animate({opacity: t}, e, n, r)
        }, animate: function (e, t, n, r) {
            var i = x.isEmptyObject(e), o = x.speed(t, n, r), a = function () {
                var t = er(this, x.extend({}, e), o);
                (i || x._data(this, "finish")) && t.stop(!0)
            };
            return a.finish = a, i || o.queue === !1 ? this.each(a) : this.queue(o.queue, a)
        }, stop: function (e, n, r) {
            var i = function (e) {
                var t = e.stop;
                delete e.stop, t(r)
            };
            return "string" != typeof e && (r = n, n = e, e = t), n && e !== !1 && this.queue(e || "fx", []), this.each(function () {
                var t = !0, n = null != e && e + "queueHooks", o = x.timers, a = x._data(this);
                if (n) a[n] && a[n].stop && i(a[n]); else for (n in a)a[n] && a[n].stop && Jn.test(n) && i(a[n]);
                for (n = o.length; n--;)o[n].elem !== this || null != e && o[n].queue !== e || (o[n].anim.stop(r), t = !1, o.splice(n, 1));
                (t || !r) && x.dequeue(this, e)
            })
        }, finish: function (e) {
            return e !== !1 && (e = e || "fx"), this.each(function () {
                var t, n = x._data(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = x.timers, a = r ? r.length : 0;
                for (n.finish = !0, x.queue(this, e, []), i && i.stop && i.stop.call(this, !0), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
                for (t = 0; a > t; t++)r[t] && r[t].finish && r[t].finish.call(this);
                delete n.finish
            })
        }
    });
    function ir(e, t) {
        var n, r = {height: e}, i = 0;
        for (t = t ? 1 : 0; 4 > i; i += 2 - t)n = Zt[i], r["margin" + n] = r["padding" + n] = e;
        return t && (r.opacity = r.width = e), r
    }

    x.each({
        slideDown: ir("show"),
        slideUp: ir("hide"),
        slideToggle: ir("toggle"),
        fadeIn: {opacity: "show"},
        fadeOut: {opacity: "hide"},
        fadeToggle: {opacity: "toggle"}
    }, function (e, t) {
        x.fn[e] = function (e, n, r) {
            return this.animate(t, e, n, r)
        }
    }), x.speed = function (e, t, n) {
        var r = e && "object" == typeof e ? x.extend({}, e) : {
            complete: n || !n && t || x.isFunction(e) && e,
            duration: e,
            easing: n && t || t && !x.isFunction(t) && t
        };
        return r.duration = x.fx.off ? 0 : "number" == typeof r.duration ? r.duration : r.duration in x.fx.speeds ? x.fx.speeds[r.duration] : x.fx.speeds._default, (null == r.queue || r.queue === !0) && (r.queue = "fx"), r.old = r.complete, r.complete = function () {
            x.isFunction(r.old) && r.old.call(this), r.queue && x.dequeue(this, r.queue)
        }, r
    }, x.easing = {
        linear: function (e) {
            return e
        }, swing: function (e) {
            return .5 - Math.cos(e * Math.PI) / 2
        }
    }, x.timers = [], x.fx = rr.prototype.init, x.fx.tick = function () {
        var e, n = x.timers, r = 0;
        for (Xn = x.now(); n.length > r; r++)e = n[r], e() || n[r] !== e || n.splice(r--, 1);
        n.length || x.fx.stop(), Xn = t
    }, x.fx.timer = function (e) {
        e() && x.timers.push(e) && x.fx.start()
    }, x.fx.interval = 13, x.fx.start = function () {
        Un || (Un = setInterval(x.fx.tick, x.fx.interval))
    }, x.fx.stop = function () {
        clearInterval(Un), Un = null
    }, x.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    }, x.fx.step = {}, x.expr && x.expr.filters && (x.expr.filters.animated = function (e) {
        return x.grep(x.timers, function (t) {
            return e === t.elem
        }).length
    }), x.fn.offset = function (e) {
        if (arguments.length)return e === t ? this : this.each(function (t) {
            x.offset.setOffset(this, e, t)
        });
        var n, r, o = {top: 0, left: 0}, a = this[0], s = a && a.ownerDocument;
        if (s)return n = s.documentElement, x.contains(n, a) ? (typeof a.getBoundingClientRect !== i && (o = a.getBoundingClientRect()), r = or(s), {
            top: o.top + (r.pageYOffset || n.scrollTop) - (n.clientTop || 0),
            left: o.left + (r.pageXOffset || n.scrollLeft) - (n.clientLeft || 0)
        }) : o
    }, x.offset = {
        setOffset: function (e, t, n) {
            var r = x.css(e, "position");
            "static" === r && (e.style.position = "relative");
            var i = x(e), o = i.offset(), a = x.css(e, "top"), s = x.css(e, "left"), l = ("absolute" === r || "fixed" === r) && x.inArray("auto", [a, s]) > -1, u = {}, c = {}, p, f;
            l ? (c = i.position(), p = c.top, f = c.left) : (p = parseFloat(a) || 0, f = parseFloat(s) || 0), x.isFunction(t) && (t = t.call(e, n, o)), null != t.top && (u.top = t.top - o.top + p), null != t.left && (u.left = t.left - o.left + f), "using" in t ? t.using.call(e, u) : i.css(u)
        }
    }, x.fn.extend({
        position: function () {
            if (this[0]) {
                var e, t, n = {top: 0, left: 0}, r = this[0];
                return "fixed" === x.css(r, "position") ? t = r.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), x.nodeName(e[0], "html") || (n = e.offset()), n.top += x.css(e[0], "borderTopWidth", !0), n.left += x.css(e[0], "borderLeftWidth", !0)), {
                    top: t.top - n.top - x.css(r, "marginTop", !0),
                    left: t.left - n.left - x.css(r, "marginLeft", !0)
                }
            }
        }, offsetParent: function () {
            return this.map(function () {
                var e = this.offsetParent || s;
                while (e && !x.nodeName(e, "html") && "static" === x.css(e, "position"))e = e.offsetParent;
                return e || s
            })
        }
    }), x.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (e, n) {
        var r = /Y/.test(n);
        x.fn[e] = function (i) {
            return x.access(this, function (e, i, o) {
                var a = or(e);
                return o === t ? a ? n in a ? a[n] : a.document.documentElement[i] : e[i] : (a ? a.scrollTo(r ? x(a).scrollLeft() : o, r ? o : x(a).scrollTop()) : e[i] = o, t)
            }, e, i, arguments.length, null)
        }
    });
    function or(e) {
        return x.isWindow(e) ? e : 9 === e.nodeType ? e.defaultView || e.parentWindow : !1
    }

    x.each({Height: "height", Width: "width"}, function (e, n) {
        x.each({padding: "inner" + e, content: n, "": "outer" + e}, function (r, i) {
            x.fn[i] = function (i, o) {
                var a = arguments.length && (r || "boolean" != typeof i), s = r || (i === !0 || o === !0 ? "margin" : "border");
                return x.access(this, function (n, r, i) {
                    var o;
                    return x.isWindow(n) ? n.document.documentElement["client" + e] : 9 === n.nodeType ? (o = n.documentElement, Math.max(n.body["scroll" + e], o["scroll" + e], n.body["offset" + e], o["offset" + e], o["client" + e])) : i === t ? x.css(n, r, s) : x.style(n, r, i, s)
                }, n, a ? i : t, a, null)
            }
        })
    }), x.fn.size = function () {
        return this.length
    }, x.fn.andSelf = x.fn.addBack, "object" == typeof module && module && "object" == typeof module.exports ? module.exports = x : (e.jQuery = e.$ = x, "function" == typeof define && define.amd && define("jquery", [], function () {
        return x
    }))
})(window);
(function ($, undefined) {
    var uuid = 0, runiqueId = /^ui-id-\d+$/;
    $.ui = $.ui || {};
    $.extend($.ui, {
        version: "1.10.3",
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            NUMPAD_ADD: 107,
            NUMPAD_DECIMAL: 110,
            NUMPAD_DIVIDE: 111,
            NUMPAD_ENTER: 108,
            NUMPAD_MULTIPLY: 106,
            NUMPAD_SUBTRACT: 109,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    });
    $.fn.extend({
        focus: function (orig) {
            return function (delay, fn) {
                return typeof delay === "number" ? this.each(function () {
                    var elem = this;
                    setTimeout(function () {
                        $(elem).focus();
                        if (fn) {
                            fn.call(elem)
                        }
                    }, delay)
                }) : orig.apply(this, arguments)
            }
        }($.fn.focus), scrollParent: function () {
            var scrollParent;
            if ($.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position"))) {
                scrollParent = this.parents().filter(function () {
                    return /(relative|absolute|fixed)/.test($.css(this, "position")) && /(auto|scroll)/.test($.css(this, "overflow") + $.css(this, "overflow-y") + $.css(this, "overflow-x"))
                }).eq(0)
            } else {
                scrollParent = this.parents().filter(function () {
                    return /(auto|scroll)/.test($.css(this, "overflow") + $.css(this, "overflow-y") + $.css(this, "overflow-x"))
                }).eq(0)
            }
            return /fixed/.test(this.css("position")) || !scrollParent.length ? $(document) : scrollParent;
        }, zIndex: function (zIndex) {
            if (zIndex !== undefined) {
                return this.css("zIndex", zIndex)
            }
            if (this.length) {
                var elem = $(this[0]), position, value;
                while (elem.length && elem[0] !== document) {
                    position = elem.css("position");
                    if (position === "absolute" || position === "relative" || position === "fixed") {
                        value = parseInt(elem.css("zIndex"), 10);
                        if (!isNaN(value) && value !== 0) {
                            return value
                        }
                    }
                    elem = elem.parent()
                }
            }
            return 0
        }, uniqueId: function () {
            return this.each(function () {
                if (!this.id) {
                    this.id = "ui-id-" + ++uuid
                }
            })
        }, removeUniqueId: function () {
            return this.each(function () {
                if (runiqueId.test(this.id)) {
                    $(this).removeAttr("id")
                }
            })
        }
    });
    function focusable(element, isTabIndexNotNaN) {
        var map, mapName, img, nodeName = element.nodeName.toLowerCase();
        if ("area" === nodeName) {
            map = element.parentNode;
            mapName = map.name;
            if (!element.href || !mapName || map.nodeName.toLowerCase() !== "map") {
                return false
            }
            img = $("img[usemap=#" + mapName + "]")[0];
            return !!img && visible(img)
        }
        return (/input|select|textarea|button|object/.test(nodeName) ? !element.disabled : "a" === nodeName ? element.href || isTabIndexNotNaN : isTabIndexNotNaN) && visible(element)
    }

    function visible(element) {
        return $.expr.filters.visible(element) && !$(element).parents().addBack().filter(function () {
                return $.css(this, "visibility") === "hidden"
            }).length
    }

    $.extend($.expr[":"], {
        data: $.expr.createPseudo ? $.expr.createPseudo(function (dataName) {
            return function (elem) {
                return !!$.data(elem, dataName)
            }
        }) : function (elem, i, match) {
            return !!$.data(elem, match[3])
        }, focusable: function (element) {
            return focusable(element, !isNaN($.attr(element, "tabindex")))
        }, tabbable: function (element) {
            var tabIndex = $.attr(element, "tabindex"), isTabIndexNaN = isNaN(tabIndex);
            return (isTabIndexNaN || tabIndex >= 0) && focusable(element, !isTabIndexNaN)
        }
    });
    if (!$("<a>").outerWidth(1).jquery) {
        $.each(["Width", "Height"], function (i, name) {
            var side = name === "Width" ? ["Left", "Right"] : ["Top", "Bottom"], type = name.toLowerCase(), orig = {
                innerWidth: $.fn.innerWidth,
                innerHeight: $.fn.innerHeight,
                outerWidth: $.fn.outerWidth,
                outerHeight: $.fn.outerHeight
            };

            function reduce(elem, size, border, margin) {
                $.each(side, function () {
                    size -= parseFloat($.css(elem, "padding" + this)) || 0;
                    if (border) {
                        size -= parseFloat($.css(elem, "border" + this + "Width")) || 0
                    }
                    if (margin) {
                        size -= parseFloat($.css(elem, "margin" + this)) || 0
                    }
                });
                return size
            }

            $.fn["inner" + name] = function (size) {
                if (size === undefined) {
                    return orig["inner" + name].call(this)
                }
                return this.each(function () {
                    $(this).css(type, reduce(this, size) + "px")
                })
            };
            $.fn["outer" + name] = function (size, margin) {
                if (typeof size !== "number") {
                    return orig["outer" + name].call(this, size)
                }
                return this.each(function () {
                    $(this).css(type, reduce(this, size, true, margin) + "px")
                })
            }
        })
    }
    if (!$.fn.addBack) {
        $.fn.addBack = function (selector) {
            return this.add(selector == null ? this.prevObject : this.prevObject.filter(selector))
        }
    }
    if ($("<a>").data("a-b", "a").removeData("a-b").data("a-b")) {
        $.fn.removeData = function (removeData) {
            return function (key) {
                if (arguments.length) {
                    return removeData.call(this, $.camelCase(key))
                } else {
                    return removeData.call(this)
                }
            }
        }($.fn.removeData)
    }
    $.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
    $.support.selectstart = "onselectstart" in document.createElement("div");
    $.fn.extend({
        disableSelection: function () {
            return this.bind(($.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function (event) {
                event.preventDefault()
            })
        }, enableSelection: function () {
            return this.unbind(".ui-disableSelection")
        }
    });
    $.extend($.ui, {
        plugin: {
            add: function (module, option, set) {
                var i, proto = $.ui[module].prototype;
                for (i in set) {
                    proto.plugins[i] = proto.plugins[i] || [];
                    proto.plugins[i].push([option, set[i]])
                }
            }, call: function (instance, name, args) {
                var i, set = instance.plugins[name];
                if (!set || !instance.element[0].parentNode || instance.element[0].parentNode.nodeType === 11) {
                    return
                }
                for (i = 0; i < set.length; i++) {
                    if (instance.options[set[i][0]]) {
                        set[i][1].apply(instance.element, args)
                    }
                }
            }
        }, hasScroll: function (el, a) {
            if ($(el).css("overflow") === "hidden") {
                return false
            }
            var scroll = a && a === "left" ? "scrollLeft" : "scrollTop", has = false;
            if (el[scroll] > 0) {
                return true
            }
            el[scroll] = 1;
            has = el[scroll] > 0;
            el[scroll] = 0;
            return has
        }
    })
})(jQuery);
(function ($, undefined) {
    var uuid = 0, slice = Array.prototype.slice, _cleanData = $.cleanData;
    $.cleanData = function (elems) {
        for (var i = 0, elem; (elem = elems[i]) != null; i++) {
            try {
                $(elem).triggerHandler("remove")
            } catch (e) {
            }
        }
        _cleanData(elems)
    };
    $.widget = function (name, base, prototype) {
        var fullName, existingConstructor, constructor, basePrototype, proxiedPrototype = {}, namespace = name.split(".")[0];
        name = name.split(".")[1];
        fullName = namespace + "-" + name;
        if (!prototype) {
            prototype = base;
            base = $.Widget
        }
        $.expr[":"][fullName.toLowerCase()] = function (elem) {
            return !!$.data(elem, fullName)
        };
        $[namespace] = $[namespace] || {};
        existingConstructor = $[namespace][name];
        constructor = $[namespace][name] = function (options, element) {
            if (!this._createWidget) {
                return new constructor(options, element)
            }
            if (arguments.length) {
                this._createWidget(options, element)
            }
        };
        $.extend(constructor, existingConstructor, {
            version: prototype.version,
            _proto: $.extend({}, prototype),
            _childConstructors: []
        });
        basePrototype = new base;
        basePrototype.options = $.widget.extend({}, basePrototype.options);
        $.each(prototype, function (prop, value) {
            if (!$.isFunction(value)) {
                proxiedPrototype[prop] = value;
                return
            }
            proxiedPrototype[prop] = function () {
                var _super = function () {
                    return base.prototype[prop].apply(this, arguments)
                }, _superApply = function (args) {
                    return base.prototype[prop].apply(this, args)
                };
                return function () {
                    var __super = this._super, __superApply = this._superApply, returnValue;
                    this._super = _super;
                    this._superApply = _superApply;
                    returnValue = value.apply(this, arguments);
                    this._super = __super;
                    this._superApply = __superApply;
                    return returnValue
                }
            }()
        });
        constructor.prototype = $.widget.extend(basePrototype, {widgetEventPrefix: existingConstructor ? basePrototype.widgetEventPrefix : name}, proxiedPrototype, {
            constructor: constructor,
            namespace: namespace,
            widgetName: name,
            widgetFullName: fullName
        });
        if (existingConstructor) {
            $.each(existingConstructor._childConstructors, function (i, child) {
                var childPrototype = child.prototype;
                $.widget(childPrototype.namespace + "." + childPrototype.widgetName, constructor, child._proto)
            });
            delete existingConstructor._childConstructors
        } else {
            base._childConstructors.push(constructor)
        }
        $.widget.bridge(name, constructor)
    };
    $.widget.extend = function (target) {
        var input = slice.call(arguments, 1), inputIndex = 0, inputLength = input.length, key, value;
        for (; inputIndex < inputLength; inputIndex++) {
            for (key in input[inputIndex]) {
                value = input[inputIndex][key];
                if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {
                    if ($.isPlainObject(value)) {
                        target[key] = $.isPlainObject(target[key]) ? $.widget.extend({}, target[key], value) : $.widget.extend({}, value)
                    } else {
                        target[key] = value
                    }
                }
            }
        }
        return target
    };
    $.widget.bridge = function (name, object) {
        var fullName = object.prototype.widgetFullName || name;
        $.fn[name] = function (options) {
            var isMethodCall = typeof options === "string", args = slice.call(arguments, 1), returnValue = this;
            options = !isMethodCall && args.length ? $.widget.extend.apply(null, [options].concat(args)) : options;
            if (isMethodCall) {
                this.each(function () {
                    var methodValue, instance = $.data(this, fullName);
                    if (!instance) {
                        return $.error("cannot call methods on " + name + " prior to initialization; " + "attempted to call method '" + options + "'")
                    }
                    if (!$.isFunction(instance[options]) || options.charAt(0) === "_") {
                        return $.error("no such method '" + options + "' for " + name + " widget instance")
                    }
                    methodValue = instance[options].apply(instance, args);
                    if (methodValue !== instance && methodValue !== undefined) {
                        returnValue = methodValue && methodValue.jquery ? returnValue.pushStack(methodValue.get()) : methodValue;
                        return false
                    }
                })
            } else {
                this.each(function () {
                    var instance = $.data(this, fullName);
                    if (instance) {
                        instance.option(options || {})._init()
                    } else {
                        $.data(this, fullName, new object(options, this))
                    }
                })
            }
            return returnValue
        }
    };
    $.Widget = function () {
    };
    $.Widget._childConstructors = [];
    $.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {disabled: false, create: null},
        _createWidget: function (options, element) {
            element = $(element || this.defaultElement || this)[0];
            this.element = $(element);
            this.uuid = uuid++;
            this.eventNamespace = "." + this.widgetName + this.uuid;
            this.options = $.widget.extend({}, this.options, this._getCreateOptions(), options);
            this.bindings = $();
            this.hoverable = $();
            this.focusable = $();
            if (element !== this) {
                $.data(element, this.widgetFullName, this);
                this._on(true, this.element, {
                    remove: function (event) {
                        if (event.target === element) {
                            this.destroy()
                        }
                    }
                });
                this.document = $(element.style ? element.ownerDocument : element.document || element);
                this.window = $(this.document[0].defaultView || this.document[0].parentWindow)
            }
            this._create();
            this._trigger("create", null, this._getCreateEventData());
            this._init()
        },
        _getCreateOptions: $.noop,
        _getCreateEventData: $.noop,
        _create: $.noop,
        _init: $.noop,
        destroy: function () {
            this._destroy();
            this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));
            this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled");
            this.bindings.unbind(this.eventNamespace);
            this.hoverable.removeClass("ui-state-hover");
            this.focusable.removeClass("ui-state-focus")
        },
        _destroy: $.noop,
        widget: function () {
            return this.element
        },
        option: function (key, value) {
            var options = key, parts, curOption, i;
            if (arguments.length === 0) {
                return $.widget.extend({}, this.options)
            }
            if (typeof key === "string") {
                options = {};
                parts = key.split(".");
                key = parts.shift();
                if (parts.length) {
                    curOption = options[key] = $.widget.extend({}, this.options[key]);
                    for (i = 0; i < parts.length - 1; i++) {
                        curOption[parts[i]] = curOption[parts[i]] || {};
                        curOption = curOption[parts[i]]
                    }
                    key = parts.pop();
                    if (value === undefined) {
                        return curOption[key] === undefined ? null : curOption[key]
                    }
                    curOption[key] = value
                } else {
                    if (value === undefined) {
                        return this.options[key] === undefined ? null : this.options[key]
                    }
                    options[key] = value
                }
            }
            this._setOptions(options);
            return this
        },
        _setOptions: function (options) {
            var key;
            for (key in options) {
                this._setOption(key, options[key])
            }
            return this
        },
        _setOption: function (key, value) {
            this.options[key] = value;
            if (key === "disabled") {
                this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!value).attr("aria-disabled", value);
                this.hoverable.removeClass("ui-state-hover");
                this.focusable.removeClass("ui-state-focus")
            }
            return this
        },
        enable: function () {
            return this._setOption("disabled", false)
        },
        disable: function () {
            return this._setOption("disabled", true)
        },
        _on: function (suppressDisabledCheck, element, handlers) {
            var delegateElement, instance = this;
            if (typeof suppressDisabledCheck !== "boolean") {
                handlers = element;
                element = suppressDisabledCheck;
                suppressDisabledCheck = false
            }
            if (!handlers) {
                handlers = element;
                element = this.element;
                delegateElement = this.widget()
            } else {
                element = delegateElement = $(element);
                this.bindings = this.bindings.add(element)
            }
            $.each(handlers, function (event, handler) {
                function handlerProxy() {
                    if (!suppressDisabledCheck && (instance.options.disabled === true || $(this).hasClass("ui-state-disabled"))) {
                        return
                    }
                    return (typeof handler === "string" ? instance[handler] : handler).apply(instance, arguments)
                }

                if (typeof handler !== "string") {
                    handlerProxy.guid = handler.guid = handler.guid || handlerProxy.guid || $.guid++
                }
                var match = event.match(/^(\w+)\s*(.*)$/), eventName = match[1] + instance.eventNamespace, selector = match[2];
                if (selector) {
                    delegateElement.delegate(selector, eventName, handlerProxy)
                } else {
                    element.bind(eventName, handlerProxy)
                }
            })
        },
        _off: function (element, eventName) {
            eventName = (eventName || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace;
            element.unbind(eventName).undelegate(eventName)
        },
        _delay: function (handler, delay) {
            function handlerProxy() {
                return (typeof handler === "string" ? instance[handler] : handler).apply(instance, arguments)
            }

            var instance = this;
            return setTimeout(handlerProxy, delay || 0)
        },
        _hoverable: function (element) {
            this.hoverable = this.hoverable.add(element);
            this._on(element, {
                mouseenter: function (event) {
                    $(event.currentTarget).addClass("ui-state-hover")
                }, mouseleave: function (event) {
                    $(event.currentTarget).removeClass("ui-state-hover")
                }
            })
        },
        _focusable: function (element) {
            this.focusable = this.focusable.add(element);
            this._on(element, {
                focusin: function (event) {
                    $(event.currentTarget).addClass("ui-state-focus")
                }, focusout: function (event) {
                    $(event.currentTarget).removeClass("ui-state-focus")
                }
            })
        },
        _trigger: function (type, event, data) {
            var prop, orig, callback = this.options[type];
            data = data || {};
            event = $.Event(event);
            event.type = (type === this.widgetEventPrefix ? type : this.widgetEventPrefix + type).toLowerCase();
            event.target = this.element[0];
            orig = event.originalEvent;
            if (orig) {
                for (prop in orig) {
                    if (!(prop in event)) {
                        event[prop] = orig[prop]
                    }
                }
            }
            this.element.trigger(event, data);
            return !($.isFunction(callback) && callback.apply(this.element[0], [event].concat(data)) === false || event.isDefaultPrevented())
        }
    };
    $.each({show: "fadeIn", hide: "fadeOut"}, function (method, defaultEffect) {
        $.Widget.prototype["_" + method] = function (element, options, callback) {
            if (typeof options === "string") {
                options = {effect: options}
            }
            var hasOptions, effectName = !options ? method : options === true || typeof options === "number" ? defaultEffect : options.effect || defaultEffect;
            options = options || {};
            if (typeof options === "number") {
                options = {duration: options}
            }
            hasOptions = !$.isEmptyObject(options);
            options.complete = callback;
            if (options.delay) {
                element.delay(options.delay)
            }
            if (hasOptions && $.effects && $.effects.effect[effectName]) {
                element[method](options)
            } else if (effectName !== method && element[effectName]) {
                element[effectName](options.duration, options.easing, callback)
            } else {
                element.queue(function (next) {
                    $(this)[method]();
                    if (callback) {
                        callback.call(element[0])
                    }
                    next()
                })
            }
        }
    })
})(jQuery);
(function ($, undefined) {
    var mouseHandled = false;
    $(document).mouseup(function () {
        mouseHandled = false
    });
    $.widget("ui.mouse", {
        version: "1.10.3",
        options: {cancel: "input,textarea,button,select,option", distance: 1, delay: 0},
        _mouseInit: function () {
            var that = this;
            this.element.bind("mousedown." + this.widgetName, function (event) {
                return that._mouseDown(event)
            }).bind("click." + this.widgetName, function (event) {
                if (true === $.data(event.target, that.widgetName + ".preventClickEvent")) {
                    $.removeData(event.target, that.widgetName + ".preventClickEvent");
                    event.stopImmediatePropagation();
                    return false
                }
            });
            this.started = false
        },
        _mouseDestroy: function () {
            this.element.unbind("." + this.widgetName);
            if (this._mouseMoveDelegate) {
                $(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
            }
        },
        _mouseDown: function (event) {
            if (mouseHandled) {
                return
            }
            this._mouseStarted && this._mouseUp(event);
            this._mouseDownEvent = event;
            var that = this, btnIsLeft = event.which === 1, elIsCancel = typeof this.options.cancel === "string" && event.target.nodeName ? $(event.target).closest(this.options.cancel).length : false;
            if (!btnIsLeft || elIsCancel || !this._mouseCapture(event)) {
                return true
            }
            this.mouseDelayMet = !this.options.delay;
            if (!this.mouseDelayMet) {
                this._mouseDelayTimer = setTimeout(function () {
                    that.mouseDelayMet = true
                }, this.options.delay)
            }
            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted = this._mouseStart(event) !== false;
                if (!this._mouseStarted) {
                    event.preventDefault();
                    return true
                }
            }
            if (true === $.data(event.target, this.widgetName + ".preventClickEvent")) {
                $.removeData(event.target, this.widgetName + ".preventClickEvent")
            }
            this._mouseMoveDelegate = function (event) {
                return that._mouseMove(event)
            };
            this._mouseUpDelegate = function (event) {
                return that._mouseUp(event)
            };
            $(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate);
            event.preventDefault();
            mouseHandled = true;
            return true
        },
        _mouseMove: function (event) {
            if ($.ui.ie && (!document.documentMode || document.documentMode < 9) && !event.button) {
                return this._mouseUp(event)
            }
            if (this._mouseStarted) {
                this._mouseDrag(event);
                return event.preventDefault()
            }
            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted = this._mouseStart(this._mouseDownEvent, event) !== false;
                this._mouseStarted ? this._mouseDrag(event) : this._mouseUp(event)
            }
            return !this._mouseStarted
        },
        _mouseUp: function (event) {
            $(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate);
            if (this._mouseStarted) {
                this._mouseStarted = false;
                if (event.target === this._mouseDownEvent.target) {
                    $.data(event.target, this.widgetName + ".preventClickEvent", true)
                }
                this._mouseStop(event)
            }
            return false
        },
        _mouseDistanceMet: function (event) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - event.pageX), Math.abs(this._mouseDownEvent.pageY - event.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function () {
            return this.mouseDelayMet
        },
        _mouseStart: function () {
        },
        _mouseDrag: function () {
        },
        _mouseStop: function () {
        },
        _mouseCapture: function () {
            return true
        }
    })
})(jQuery);
(function ($, undefined) {
    $.widget("ui.draggable", $.ui.mouse, {
        version: "1.10.3",
        widgetEventPrefix: "drag",
        options: {
            addClasses: true,
            appendTo: "parent",
            axis: false,
            connectToSortable: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            grid: false,
            handle: false,
            helper: "original",
            iframeFix: false,
            opacity: false,
            refreshPositions: false,
            revert: false,
            revertDuration: 500,
            scope: "default",
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: false,
            snapMode: "both",
            snapTolerance: 20,
            stack: false,
            zIndex: false,
            drag: null,
            start: null,
            stop: null
        },
        _create: function () {
            if (this.options.helper === "original" && !/^(?:r|a|f)/.test(this.element.css("position"))) {
                this.element[0].style.position = "relative"
            }
            if (this.options.addClasses) {
                this.element.addClass("ui-draggable")
            }
            if (this.options.disabled) {
                this.element.addClass("ui-draggable-disabled")
            }
            this._mouseInit()
        },
        _destroy: function () {
            this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");
            this._mouseDestroy()
        },
        _mouseCapture: function (event) {
            var o = this.options;
            if (this.helper || o.disabled || $(event.target).closest(".ui-resizable-handle").length > 0) {
                return false
            }
            this.handle = this._getHandle(event);
            if (!this.handle) {
                return false
            }
            $(o.iframeFix === true ? "iframe" : o.iframeFix).each(function () {
                $("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({
                    width: this.offsetWidth + "px",
                    height: this.offsetHeight + "px",
                    position: "absolute",
                    opacity: "0.001",
                    zIndex: 1e3
                }).css($(this).offset()).appendTo("body")
            });
            return true
        },
        _mouseStart: function (event) {
            var o = this.options;
            this.helper = this._createHelper(event);
            this.helper.addClass("ui-draggable-dragging");
            this._cacheHelperProportions();
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this
            }
            this._cacheMargins();
            this.cssPosition = this.helper.css("position");
            this.scrollParent = this.helper.scrollParent();
            this.offsetParent = this.helper.offsetParent();
            this.offsetParentCssPosition = this.offsetParent.css("position");
            this.offset = this.positionAbs = this.element.offset();
            this.offset = {top: this.offset.top - this.margins.top, left: this.offset.left - this.margins.left};
            this.offset.scroll = false;
            $.extend(this.offset, {
                click: {left: event.pageX - this.offset.left, top: event.pageY - this.offset.top},
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            });
            this.originalPosition = this.position = this._generatePosition(event);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;
            o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt);
            this._setContainment();
            if (this._trigger("start", event) === false) {
                this._clear();
                return false
            }
            this._cacheHelperProportions();
            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event)
            }
            this._mouseDrag(event, true);
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStart(this, event)
            }
            return true
        },
        _mouseDrag: function (event, noPropagation) {
            if (this.offsetParentCssPosition === "fixed") {
                this.offset.parent = this._getParentOffset()
            }
            this.position = this._generatePosition(event);
            this.positionAbs = this._convertPositionTo("absolute");
            if (!noPropagation) {
                var ui = this._uiHash();
                if (this._trigger("drag", event, ui) === false) {
                    this._mouseUp({});
                    return false
                }
                this.position = ui.position
            }
            if (!this.options.axis || this.options.axis !== "y") {
                this.helper[0].style.left = this.position.left + "px"
            }
            if (!this.options.axis || this.options.axis !== "x") {
                this.helper[0].style.top = this.position.top + "px"
            }
            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event)
            }
            return false
        },
        _mouseStop: function (event) {
            var that = this, dropped = false;
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                dropped = $.ui.ddmanager.drop(this, event)
            }
            if (this.dropped) {
                dropped = this.dropped;
                this.dropped = false
            }
            if (this.options.helper === "original" && !$.contains(this.element[0].ownerDocument, this.element[0])) {
                return false
            }
            if (this.options.revert === "invalid" && !dropped || this.options.revert === "valid" && dropped || this.options.revert === true || $.isFunction(this.options.revert) && this.options.revert.call(this.element, dropped)) {
                $(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () {
                    if (that._trigger("stop", event) !== false) {
                        that._clear()
                    }
                })
            } else {
                if (this._trigger("stop", event) !== false) {
                    this._clear()
                }
            }
            return false
        },
        _mouseUp: function (event) {
            $("div.ui-draggable-iframeFix").each(function () {
                this.parentNode.removeChild(this)
            });
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStop(this, event)
            }
            return $.ui.mouse.prototype._mouseUp.call(this, event)
        },
        cancel: function () {
            if (this.helper.is(".ui-draggable-dragging")) {
                this._mouseUp({})
            } else {
                this._clear()
            }
            return this
        },
        _getHandle: function (event) {
            return this.options.handle ? !!$(event.target).closest(this.element.find(this.options.handle)).length : true
        },
        _createHelper: function (event) {
            var o = this.options, helper = $.isFunction(o.helper) ? $(o.helper.apply(this.element[0], [event])) : o.helper === "clone" ? this.element.clone().removeAttr("id") : this.element;
            if (!helper.parents("body").length) {
                helper.appendTo(o.appendTo === "parent" ? this.element[0].parentNode : o.appendTo)
            }
            if (helper[0] !== this.element[0] && !/(fixed|absolute)/.test(helper.css("position"))) {
                helper.css("position", "absolute")
            }
            return helper
        },
        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ")
            }
            if ($.isArray(obj)) {
                obj = {left: +obj[0], top: +obj[1] || 0}
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top
            }
        },
        _getParentOffset: function () {
            var po = this.offsetParent.offset();
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop()
            }
            if (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && this.offsetParent[0].tagName.toLowerCase() === "html" && $.ui.ie) {
                po = {top: 0, left: 0}
            }
            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function () {
            if (this.cssPosition === "relative") {
                var p = this.element.position();
                return {
                    top: p.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: p.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            } else {
                return {top: 0, left: 0}
            }
        },
        _cacheMargins: function () {
            this.margins = {
                left: parseInt(this.element.css("marginLeft"), 10) || 0,
                top: parseInt(this.element.css("marginTop"), 10) || 0,
                right: parseInt(this.element.css("marginRight"), 10) || 0,
                bottom: parseInt(this.element.css("marginBottom"), 10) || 0
            }
        },
        _cacheHelperProportions: function () {
            this.helperProportions = {width: this.helper.outerWidth(), height: this.helper.outerHeight()}
        },
        _setContainment: function () {
            var over, c, ce, o = this.options;
            if (!o.containment) {
                this.containment = null;
                return
            }
            if (o.containment === "window") {
                this.containment = [$(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, $(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, $(window).scrollLeft() + $(window).width() - this.helperProportions.width - this.margins.left, $(window).scrollTop() + ($(window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top];
                return
            }
            if (o.containment === "document") {
                this.containment = [0, 0, $(document).width() - this.helperProportions.width - this.margins.left, ($(document).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top];
                return
            }
            if (o.containment.constructor === Array) {
                this.containment = o.containment;
                return
            }
            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode
            }
            c = $(o.containment);
            ce = c[0];
            if (!ce) {
                return
            }
            over = c.css("overflow") !== "hidden";
            this.containment = [(parseInt(c.css("borderLeftWidth"), 10) || 0) + (parseInt(c.css("paddingLeft"), 10) || 0), (parseInt(c.css("borderTopWidth"), 10) || 0) + (parseInt(c.css("paddingTop"), 10) || 0), (over ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) - (parseInt(c.css("borderRightWidth"), 10) || 0) - (parseInt(c.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (over ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) - (parseInt(c.css("borderBottomWidth"), 10) || 0) - (parseInt(c.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom];
            this.relative_container = c
        },
        _convertPositionTo: function (d, pos) {
            if (!pos) {
                pos = this.position
            }
            var mod = d === "absolute" ? 1 : -1, scroll = this.cssPosition === "absolute" && !(this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent;
            if (!this.offset.scroll) {
                this.offset.scroll = {top: scroll.scrollTop(), left: scroll.scrollLeft()}
            }
            return {
                top: pos.top + this.offset.relative.top * mod + this.offset.parent.top * mod - (this.cssPosition === "fixed" ? -this.scrollParent.scrollTop() : this.offset.scroll.top) * mod,
                left: pos.left + this.offset.relative.left * mod + this.offset.parent.left * mod - (this.cssPosition === "fixed" ? -this.scrollParent.scrollLeft() : this.offset.scroll.left) * mod
            }
        },
        _generatePosition: function (event) {
            var containment, co, top, left, o = this.options, scroll = this.cssPosition === "absolute" && !(this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent, pageX = event.pageX, pageY = event.pageY;
            if (!this.offset.scroll) {
                this.offset.scroll = {top: scroll.scrollTop(), left: scroll.scrollLeft()}
            }
            if (this.originalPosition) {
                if (this.containment) {
                    if (this.relative_container) {
                        co = this.relative_container.offset();
                        containment = [this.containment[0] + co.left, this.containment[1] + co.top, this.containment[2] + co.left, this.containment[3] + co.top]
                    } else {
                        containment = this.containment
                    }
                    if (event.pageX - this.offset.click.left < containment[0]) {
                        pageX = containment[0] + this.offset.click.left
                    }
                    if (event.pageY - this.offset.click.top < containment[1]) {
                        pageY = containment[1] + this.offset.click.top
                    }
                    if (event.pageX - this.offset.click.left > containment[2]) {
                        pageX = containment[2] + this.offset.click.left
                    }
                    if (event.pageY - this.offset.click.top > containment[3]) {
                        pageY = containment[3] + this.offset.click.top
                    }
                }
                if (o.grid) {
                    top = o.grid[1] ? this.originalPageY + Math.round((pageY - this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY;
                    pageY = containment ? top - this.offset.click.top >= containment[1] || top - this.offset.click.top > containment[3] ? top : top - this.offset.click.top >= containment[1] ? top - o.grid[1] : top + o.grid[1] : top;
                    left = o.grid[0] ? this.originalPageX + Math.round((pageX - this.originalPageX) / o.grid[0]) * o.grid[0] : this.originalPageX;
                    pageX = containment ? left - this.offset.click.left >= containment[0] || left - this.offset.click.left > containment[2] ? left : left - this.offset.click.left >= containment[0] ? left - o.grid[0] : left + o.grid[0] : left
                }
            }
            return {
                top: pageY - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition === "fixed" ? -this.scrollParent.scrollTop() : this.offset.scroll.top),
                left: pageX - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition === "fixed" ? -this.scrollParent.scrollLeft() : this.offset.scroll.left)
            }
        },
        _clear: function () {
            this.helper.removeClass("ui-draggable-dragging");
            if (this.helper[0] !== this.element[0] && !this.cancelHelperRemoval) {
                this.helper.remove()
            }
            this.helper = null;
            this.cancelHelperRemoval = false
        },
        _trigger: function (type, event, ui) {
            ui = ui || this._uiHash();
            $.ui.plugin.call(this, type, [event, ui]);
            if (type === "drag") {
                this.positionAbs = this._convertPositionTo("absolute")
            }
            return $.Widget.prototype._trigger.call(this, type, event, ui)
        },
        plugins: {},
        _uiHash: function () {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            }
        }
    });
    $.ui.plugin.add("draggable", "connectToSortable", {
        start: function (event, ui) {
            var inst = $(this).data("ui-draggable"), o = inst.options, uiSortable = $.extend({}, ui, {item: inst.element});
            inst.sortables = [];
            $(o.connectToSortable).each(function () {
                var sortable = $.data(this, "ui-sortable");
                if (sortable && !sortable.options.disabled) {
                    inst.sortables.push({instance: sortable, shouldRevert: sortable.options.revert});
                    sortable.refreshPositions();
                    sortable._trigger("activate", event, uiSortable)
                }
            })
        }, stop: function (event, ui) {
            var inst = $(this).data("ui-draggable"), uiSortable = $.extend({}, ui, {item: inst.element});
            $.each(inst.sortables, function () {
                if (this.instance.isOver) {
                    this.instance.isOver = 0;
                    inst.cancelHelperRemoval = true;
                    this.instance.cancelHelperRemoval = false;
                    if (this.shouldRevert) {
                        this.instance.options.revert = this.shouldRevert
                    }
                    this.instance._mouseStop(event);
                    this.instance.options.helper = this.instance.options._helper;
                    if (inst.options.helper === "original") {
                        this.instance.currentItem.css({top: "auto", left: "auto"})
                    }
                } else {
                    this.instance.cancelHelperRemoval = false;
                    this.instance._trigger("deactivate", event, uiSortable)
                }
            })
        }, drag: function (event, ui) {
            var inst = $(this).data("ui-draggable"), that = this;
            $.each(inst.sortables, function () {
                var innermostIntersecting = false, thisSortable = this;
                this.instance.positionAbs = inst.positionAbs;
                this.instance.helperProportions = inst.helperProportions;
                this.instance.offset.click = inst.offset.click;
                if (this.instance._intersectsWith(this.instance.containerCache)) {
                    innermostIntersecting = true;
                    $.each(inst.sortables, function () {
                        this.instance.positionAbs = inst.positionAbs;
                        this.instance.helperProportions = inst.helperProportions;
                        this.instance.offset.click = inst.offset.click;
                        if (this !== thisSortable && this.instance._intersectsWith(this.instance.containerCache) && $.contains(thisSortable.instance.element[0], this.instance.element[0])) {
                            innermostIntersecting = false
                        }
                        return innermostIntersecting
                    })
                }
                if (innermostIntersecting) {
                    if (!this.instance.isOver) {
                        this.instance.isOver = 1;
                        this.instance.currentItem = $(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item", true);
                        this.instance.options._helper = this.instance.options.helper;
                        this.instance.options.helper = function () {
                            return ui.helper[0]
                        };
                        event.target = this.instance.currentItem[0];
                        this.instance._mouseCapture(event, true);
                        this.instance._mouseStart(event, true, true);
                        this.instance.offset.click.top = inst.offset.click.top;
                        this.instance.offset.click.left = inst.offset.click.left;
                        this.instance.offset.parent.left -= inst.offset.parent.left - this.instance.offset.parent.left;
                        this.instance.offset.parent.top -= inst.offset.parent.top - this.instance.offset.parent.top;
                        inst._trigger("toSortable", event);
                        inst.dropped = this.instance.element;
                        inst.currentItem = inst.element;
                        this.instance.fromOutside = inst
                    }
                    if (this.instance.currentItem) {
                        this.instance._mouseDrag(event)
                    }
                } else {
                    if (this.instance.isOver) {
                        this.instance.isOver = 0;
                        this.instance.cancelHelperRemoval = true;
                        this.instance.options.revert = false;
                        this.instance._trigger("out", event, this.instance._uiHash(this.instance));
                        this.instance._mouseStop(event, true);
                        this.instance.options.helper = this.instance.options._helper;
                        this.instance.currentItem.remove();
                        if (this.instance.placeholder) {
                            this.instance.placeholder.remove()
                        }
                        inst._trigger("fromSortable", event);
                        inst.dropped = false
                    }
                }
            })
        }
    });
    $.ui.plugin.add("draggable", "cursor", {
        start: function () {
            var t = $("body"), o = $(this).data("ui-draggable").options;
            if (t.css("cursor")) {
                o._cursor = t.css("cursor")
            }
            t.css("cursor", o.cursor)
        }, stop: function () {
            var o = $(this).data("ui-draggable").options;
            if (o._cursor) {
                $("body").css("cursor", o._cursor)
            }
        }
    });
    $.ui.plugin.add("draggable", "opacity", {
        start: function (event, ui) {
            var t = $(ui.helper), o = $(this).data("ui-draggable").options;
            if (t.css("opacity")) {
                o._opacity = t.css("opacity")
            }
            t.css("opacity", o.opacity)
        }, stop: function (event, ui) {
            var o = $(this).data("ui-draggable").options;
            if (o._opacity) {
                $(ui.helper).css("opacity", o._opacity)
            }
        }
    });
    $.ui.plugin.add("draggable", "scroll", {
        start: function () {
            var i = $(this).data("ui-draggable");
            if (i.scrollParent[0] !== document && i.scrollParent[0].tagName !== "HTML") {
                i.overflowOffset = i.scrollParent.offset()
            }
        }, drag: function (event) {
            var i = $(this).data("ui-draggable"), o = i.options, scrolled = false;
            if (i.scrollParent[0] !== document && i.scrollParent[0].tagName !== "HTML") {
                if (!o.axis || o.axis !== "x") {
                    if (i.overflowOffset.top + i.scrollParent[0].offsetHeight - event.pageY < o.scrollSensitivity) {
                        i.scrollParent[0].scrollTop = scrolled = i.scrollParent[0].scrollTop + o.scrollSpeed
                    } else if (event.pageY - i.overflowOffset.top < o.scrollSensitivity) {
                        i.scrollParent[0].scrollTop = scrolled = i.scrollParent[0].scrollTop - o.scrollSpeed
                    }
                }
                if (!o.axis || o.axis !== "y") {
                    if (i.overflowOffset.left + i.scrollParent[0].offsetWidth - event.pageX < o.scrollSensitivity) {
                        i.scrollParent[0].scrollLeft = scrolled = i.scrollParent[0].scrollLeft + o.scrollSpeed
                    } else if (event.pageX - i.overflowOffset.left < o.scrollSensitivity) {
                        i.scrollParent[0].scrollLeft = scrolled = i.scrollParent[0].scrollLeft - o.scrollSpeed
                    }
                }
            } else {
                if (!o.axis || o.axis !== "x") {
                    if (event.pageY - $(document).scrollTop() < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed)
                    } else if ($(window).height() - (event.pageY - $(document).scrollTop()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed)
                    }
                }
                if (!o.axis || o.axis !== "y") {
                    if (event.pageX - $(document).scrollLeft() < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() - o.scrollSpeed)
                    } else if ($(window).width() - (event.pageX - $(document).scrollLeft()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() + o.scrollSpeed)
                    }
                }
            }
            if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(i, event)
            }
        }
    });
    $.ui.plugin.add("draggable", "snap", {
        start: function () {
            var i = $(this).data("ui-draggable"), o = i.options;
            i.snapElements = [];
            $(o.snap.constructor !== String ? o.snap.items || ":data(ui-draggable)" : o.snap).each(function () {
                var $t = $(this), $o = $t.offset();
                if (this !== i.element[0]) {
                    i.snapElements.push({
                        item: this,
                        width: $t.outerWidth(),
                        height: $t.outerHeight(),
                        top: $o.top,
                        left: $o.left
                    })
                }
            })
        }, drag: function (event, ui) {
            var ts, bs, ls, rs, l, r, t, b, i, first, inst = $(this).data("ui-draggable"), o = inst.options, d = o.snapTolerance, x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width, y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;
            for (i = inst.snapElements.length - 1; i >= 0; i--) {
                l = inst.snapElements[i].left;
                r = l + inst.snapElements[i].width;
                t = inst.snapElements[i].top;
                b = t + inst.snapElements[i].height;
                if (x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d || !$.contains(inst.snapElements[i].item.ownerDocument, inst.snapElements[i].item)) {
                    if (inst.snapElements[i].snapping) {
                        inst.options.snap.release && inst.options.snap.release.call(inst.element, event, $.extend(inst._uiHash(), {snapItem: inst.snapElements[i].item}))
                    }
                    inst.snapElements[i].snapping = false;
                    continue
                }
                if (o.snapMode !== "inner") {
                    ts = Math.abs(t - y2) <= d;
                    bs = Math.abs(b - y1) <= d;
                    ls = Math.abs(l - x2) <= d;
                    rs = Math.abs(r - x1) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {
                                top: t - inst.helperProportions.height,
                                left: 0
                            }).top - inst.margins.top
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {top: b, left: 0}).top - inst.margins.top
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                                top: 0,
                                left: l - inst.helperProportions.width
                            }).left - inst.margins.left
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                                top: 0,
                                left: r
                            }).left - inst.margins.left
                    }
                }
                first = ts || bs || ls || rs;
                if (o.snapMode !== "outer") {
                    ts = Math.abs(t - y1) <= d;
                    bs = Math.abs(b - y2) <= d;
                    ls = Math.abs(l - x1) <= d;
                    rs = Math.abs(r - x2) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {top: t, left: 0}).top - inst.margins.top
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {
                                top: b - inst.helperProportions.height,
                                left: 0
                            }).top - inst.margins.top
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                                top: 0,
                                left: l
                            }).left - inst.margins.left
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                                top: 0,
                                left: r - inst.helperProportions.width
                            }).left - inst.margins.left
                    }
                }
                if (!inst.snapElements[i].snapping && (ts || bs || ls || rs || first)) {
                    inst.options.snap.snap && inst.options.snap.snap.call(inst.element, event, $.extend(inst._uiHash(), {snapItem: inst.snapElements[i].item}))
                }
                inst.snapElements[i].snapping = ts || bs || ls || rs || first
            }
        }
    });
    $.ui.plugin.add("draggable", "stack", {
        start: function () {
            var min, o = this.data("ui-draggable").options, group = $.makeArray($(o.stack)).sort(function (a, b) {
                return (parseInt($(a).css("zIndex"), 10) || 0) - (parseInt($(b).css("zIndex"), 10) || 0)
            });
            if (!group.length) {
                return
            }
            min = parseInt($(group[0]).css("zIndex"), 10) || 0;
            $(group).each(function (i) {
                $(this).css("zIndex", min + i)
            });
            this.css("zIndex", min + group.length)
        }
    });
    $.ui.plugin.add("draggable", "zIndex", {
        start: function (event, ui) {
            var t = $(ui.helper), o = $(this).data("ui-draggable").options;
            if (t.css("zIndex")) {
                o._zIndex = t.css("zIndex")
            }
            t.css("zIndex", o.zIndex)
        }, stop: function (event, ui) {
            var o = $(this).data("ui-draggable").options;
            if (o._zIndex) {
                $(ui.helper).css("zIndex", o._zIndex)
            }
        }
    })
})(jQuery);
(function ($, undefined) {
    function isOverAxis(x, reference, size) {
        return x > reference && x < reference + size
    }

    function isFloating(item) {
        return /left|right/.test(item.css("float")) || /inline|table-cell/.test(item.css("display"))
    }

    $.widget("ui.sortable", $.ui.mouse, {
        version: "1.10.3",
        widgetEventPrefix: "sort",
        ready: false,
        options: {
            appendTo: "parent",
            axis: false,
            connectWith: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            dropOnEmpty: true,
            forcePlaceholderSize: false,
            forceHelperSize: false,
            grid: false,
            handle: false,
            helper: "original",
            items: "> *",
            opacity: false,
            placeholder: false,
            revert: false,
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1e3,
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },
        _create: function () {
            var o = this.options;
            this.containerCache = {};
            this.element.addClass("ui-sortable");
            this.refresh();
            this.floating = this.items.length ? o.axis === "x" || isFloating(this.items[0].item) : false;
            this.offset = this.element.offset();
            this._mouseInit();
            this.ready = true
        },
        _destroy: function () {
            this.element.removeClass("ui-sortable ui-sortable-disabled");
            this._mouseDestroy();
            for (var i = this.items.length - 1; i >= 0; i--) {
                this.items[i].item.removeData(this.widgetName + "-item")
            }
            return this
        },
        _setOption: function (key, value) {
            if (key === "disabled") {
                this.options[key] = value;
                this.widget().toggleClass("ui-sortable-disabled", !!value)
            } else {
                $.Widget.prototype._setOption.apply(this, arguments)
            }
        },
        _mouseCapture: function (event, overrideHandle) {
            var currentItem = null, validHandle = false, that = this;
            if (this.reverting) {
                return false
            }
            if (this.options.disabled || this.options.type === "static") {
                return false
            }
            this._refreshItems(event);
            $(event.target).parents().each(function () {
                if ($.data(this, that.widgetName + "-item") === that) {
                    currentItem = $(this);
                    return false
                }
            });
            if ($.data(event.target, that.widgetName + "-item") === that) {
                currentItem = $(event.target)
            }
            if (!currentItem) {
                return false
            }
            if (this.options.handle && !overrideHandle) {
                $(this.options.handle, currentItem).find("*").addBack().each(function () {
                    if (this === event.target) {
                        validHandle = true
                    }
                });
                if (!validHandle) {
                    return false
                }
            }
            this.currentItem = currentItem;
            this._removeCurrentsFromItems();
            return true
        },
        _mouseStart: function (event, overrideHandle, noActivation) {
            var i, body, o = this.options;
            this.currentContainer = this;
            this.refreshPositions();
            this.helper = this._createHelper(event);
            this._cacheHelperProportions();
            this._cacheMargins();
            this.scrollParent = this.helper.scrollParent();
            this.offset = this.currentItem.offset();
            this.offset = {top: this.offset.top - this.margins.top, left: this.offset.left - this.margins.left};
            $.extend(this.offset, {
                click: {left: event.pageX - this.offset.left, top: event.pageY - this.offset.top},
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            });
            this.helper.css("position", "absolute");
            this.cssPosition = this.helper.css("position");
            this.originalPosition = this._generatePosition(event);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;
            o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt);
            this.domPosition = {prev: this.currentItem.prev()[0], parent: this.currentItem.parent()[0]};
            if (this.helper[0] !== this.currentItem[0]) {
                this.currentItem.hide()
            }
            this._createPlaceholder();
            if (o.containment) {
                this._setContainment()
            }
            if (o.cursor && o.cursor !== "auto") {
                body = this.document.find("body");
                this.storedCursor = body.css("cursor");
                body.css("cursor", o.cursor);
                this.storedStylesheet = $("<style>*{ cursor: " + o.cursor + " !important; }</style>").appendTo(body)
            }
            if (o.opacity) {
                if (this.helper.css("opacity")) {
                    this._storedOpacity = this.helper.css("opacity")
                }
                this.helper.css("opacity", o.opacity)
            }
            if (o.zIndex) {
                if (this.helper.css("zIndex")) {
                    this._storedZIndex = this.helper.css("zIndex")
                }
                this.helper.css("zIndex", o.zIndex)
            }
            if (this.scrollParent[0] !== document && this.scrollParent[0].tagName !== "HTML") {
                this.overflowOffset = this.scrollParent.offset()
            }
            this._trigger("start", event, this._uiHash());
            if (!this._preserveHelperProportions) {
                this._cacheHelperProportions()
            }
            if (!noActivation) {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("activate", event, this._uiHash(this))
                }
            }
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this
            }
            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event)
            }
            this.dragging = true;
            this.helper.addClass("ui-sortable-helper");
            this._mouseDrag(event);
            return true
        },
        _mouseDrag: function (event) {
            var i, item, itemElement, intersection, o = this.options, scrolled = false;
            this.position = this._generatePosition(event);
            this.positionAbs = this._convertPositionTo("absolute");
            if (!this.lastPositionAbs) {
                this.lastPositionAbs = this.positionAbs
            }
            if (this.options.scroll) {
                if (this.scrollParent[0] !== document && this.scrollParent[0].tagName !== "HTML") {
                    if (this.overflowOffset.top + this.scrollParent[0].offsetHeight - event.pageY < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed
                    } else if (event.pageY - this.overflowOffset.top < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed
                    }
                    if (this.overflowOffset.left + this.scrollParent[0].offsetWidth - event.pageX < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft + o.scrollSpeed
                    } else if (event.pageX - this.overflowOffset.left < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft - o.scrollSpeed
                    }
                } else {
                    if (event.pageY - $(document).scrollTop() < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed)
                    } else if ($(window).height() - (event.pageY - $(document).scrollTop()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed)
                    }
                    if (event.pageX - $(document).scrollLeft() < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() - o.scrollSpeed)
                    } else if ($(window).width() - (event.pageX - $(document).scrollLeft()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() + o.scrollSpeed)
                    }
                }
                if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                    $.ui.ddmanager.prepareOffsets(this, event)
                }
            }
            this.positionAbs = this._convertPositionTo("absolute");
            if (!this.options.axis || this.options.axis !== "y") {
                this.helper[0].style.left = this.position.left + "px"
            }
            if (!this.options.axis || this.options.axis !== "x") {
                this.helper[0].style.top = this.position.top + "px"
            }
            for (i = this.items.length - 1; i >= 0; i--) {
                item = this.items[i];
                itemElement = item.item[0];
                intersection = this._intersectsWithPointer(item);
                if (!intersection) {
                    continue
                }
                if (item.instance !== this.currentContainer) {
                    continue
                }
                if (itemElement !== this.currentItem[0] && this.placeholder[intersection === 1 ? "next" : "prev"]()[0] !== itemElement && !$.contains(this.placeholder[0], itemElement) && (this.options.type === "semi-dynamic" ? !$.contains(this.element[0], itemElement) : true)) {
                    this.direction = intersection === 1 ? "down" : "up";
                    if (this.options.tolerance === "pointer" || this._intersectsWithSides(item)) {
                        this._rearrange(event, item)
                    } else {
                        break
                    }
                    this._trigger("change", event, this._uiHash());
                    break
                }
            }
            this._contactContainers(event);
            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event)
            }
            this._trigger("sort", event, this._uiHash());
            this.lastPositionAbs = this.positionAbs;
            return false
        },
        _mouseStop: function (event, noPropagation) {
            if (!event) {
                return
            }
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                $.ui.ddmanager.drop(this, event)
            }
            if (this.options.revert) {
                var that = this, cur = this.placeholder.offset(), axis = this.options.axis, animation = {};
                if (!axis || axis === "x") {
                    animation.left = cur.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)
                }
                if (!axis || axis === "y") {
                    animation.top = cur.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)
                }
                this.reverting = true;
                $(this.helper).animate(animation, parseInt(this.options.revert, 10) || 500, function () {
                    that._clear(event)
                })
            } else {
                this._clear(event, noPropagation)
            }
            return false
        },
        cancel: function () {
            if (this.dragging) {
                this._mouseUp({target: null});
                if (this.options.helper === "original") {
                    this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
                } else {
                    this.currentItem.show()
                }
                for (var i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("deactivate", null, this._uiHash(this));
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", null, this._uiHash(this));
                        this.containers[i].containerCache.over = 0
                    }
                }
            }
            if (this.placeholder) {
                if (this.placeholder[0].parentNode) {
                    this.placeholder[0].parentNode.removeChild(this.placeholder[0])
                }
                if (this.options.helper !== "original" && this.helper && this.helper[0].parentNode) {
                    this.helper.remove()
                }
                $.extend(this, {helper: null, dragging: false, reverting: false, _noFinalSort: null});
                if (this.domPosition.prev) {
                    $(this.domPosition.prev).after(this.currentItem)
                } else {
                    $(this.domPosition.parent).prepend(this.currentItem)
                }
            }
            return this
        },
        serialize: function (o) {
            var items = this._getItemsAsjQuery(o && o.connected), str = [];
            o = o || {};
            $(items).each(function () {
                var res = ($(o.item || this).attr(o.attribute || "id") || "").match(o.expression || /(.+)[\-=_](.+)/);
                if (res) {
                    str.push((o.key || res[1] + "[]") + "=" + (o.key && o.expression ? res[1] : res[2]))
                }
            });
            if (!str.length && o.key) {
                str.push(o.key + "=")
            }
            return str.join("&")
        },
        toArray: function (o) {
            var items = this._getItemsAsjQuery(o && o.connected), ret = [];
            o = o || {};
            items.each(function () {
                ret.push($(o.item || this).attr(o.attribute || "id") || "")
            });
            return ret
        },
        _intersectsWith: function (item) {
            var x1 = this.positionAbs.left, x2 = x1 + this.helperProportions.width, y1 = this.positionAbs.top, y2 = y1 + this.helperProportions.height, l = item.left, r = l + item.width, t = item.top, b = t + item.height, dyClick = this.offset.click.top, dxClick = this.offset.click.left, isOverElementHeight = this.options.axis === "x" || y1 + dyClick > t && y1 + dyClick < b, isOverElementWidth = this.options.axis === "y" || x1 + dxClick > l && x1 + dxClick < r, isOverElement = isOverElementHeight && isOverElementWidth;
            if (this.options.tolerance === "pointer" || this.options.forcePointerForContainers || this.options.tolerance !== "pointer" && this.helperProportions[this.floating ? "width" : "height"] > item[this.floating ? "width" : "height"]) {
                return isOverElement
            } else {
                return l < x1 + this.helperProportions.width / 2 && x2 - this.helperProportions.width / 2 < r && t < y1 + this.helperProportions.height / 2 && y2 - this.helperProportions.height / 2 < b
            }
        },
        _intersectsWithPointer: function (item) {
            var isOverElementHeight = this.options.axis === "x" || isOverAxis(this.positionAbs.top + this.offset.click.top, item.top, item.height), isOverElementWidth = this.options.axis === "y" || isOverAxis(this.positionAbs.left + this.offset.click.left, item.left, item.width), isOverElement = isOverElementHeight && isOverElementWidth, verticalDirection = this._getDragVerticalDirection(), horizontalDirection = this._getDragHorizontalDirection();
            if (!isOverElement) {
                return false
            }
            return this.floating ? horizontalDirection && horizontalDirection === "right" || verticalDirection === "down" ? 2 : 1 : verticalDirection && (verticalDirection === "down" ? 2 : 1)
        },
        _intersectsWithSides: function (item) {
            var isOverBottomHalf = isOverAxis(this.positionAbs.top + this.offset.click.top, item.top + item.height / 2, item.height), isOverRightHalf = isOverAxis(this.positionAbs.left + this.offset.click.left, item.left + item.width / 2, item.width), verticalDirection = this._getDragVerticalDirection(), horizontalDirection = this._getDragHorizontalDirection();
            if (this.floating && horizontalDirection) {
                return horizontalDirection === "right" && isOverRightHalf || horizontalDirection === "left" && !isOverRightHalf
            } else {
                return verticalDirection && (verticalDirection === "down" && isOverBottomHalf || verticalDirection === "up" && !isOverBottomHalf)
            }
        },
        _getDragVerticalDirection: function () {
            var delta = this.positionAbs.top - this.lastPositionAbs.top;
            return delta !== 0 && (delta > 0 ? "down" : "up")
        },
        _getDragHorizontalDirection: function () {
            var delta = this.positionAbs.left - this.lastPositionAbs.left;
            return delta !== 0 && (delta > 0 ? "right" : "left")
        },
        refresh: function (event) {
            this._refreshItems(event);
            this.refreshPositions();
            return this
        },
        _connectWith: function () {
            var options = this.options;
            return options.connectWith.constructor === String ? [options.connectWith] : options.connectWith
        },
        _getItemsAsjQuery: function (connected) {
            var i, j, cur, inst, items = [], queries = [], connectWith = this._connectWith();
            if (connectWith && connected) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ? inst.options.items.call(inst.element) : $(inst.options.items, inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), inst])
                        }
                    }
                }
            }
            queries.push([$.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                options: this.options,
                item: this.currentItem
            }) : $(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]);
            for (i = queries.length - 1; i >= 0; i--) {
                queries[i][0].each(function () {
                    items.push(this)
                })
            }
            return $(items)
        },
        _removeCurrentsFromItems: function () {
            var list = this.currentItem.find(":data(" + this.widgetName + "-item)");
            this.items = $.grep(this.items, function (item) {
                for (var j = 0; j < list.length; j++) {
                    if (list[j] === item.item[0]) {
                        return false
                    }
                }
                return true
            })
        },
        _refreshItems: function (event) {
            this.items = [];
            this.containers = [this];
            var i, j, cur, inst, targetData, _queries, item, queriesLength, items = this.items, queries = [[$.isFunction(this.options.items) ? this.options.items.call(this.element[0], event, {item: this.currentItem}) : $(this.options.items, this.element), this]], connectWith = this._connectWith();
            if (connectWith && this.ready) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ? inst.options.items.call(inst.element[0], event, {item: this.currentItem}) : $(inst.options.items, inst.element), inst]);
                            this.containers.push(inst)
                        }
                    }
                }
            }
            for (i = queries.length - 1; i >= 0; i--) {
                targetData = queries[i][1];
                _queries = queries[i][0];
                for (j = 0, queriesLength = _queries.length; j < queriesLength; j++) {
                    item = $(_queries[j]);
                    item.data(this.widgetName + "-item", targetData);
                    items.push({item: item, instance: targetData, width: 0, height: 0, left: 0, top: 0})
                }
            }
        },
        refreshPositions: function (fast) {
            if (this.offsetParent && this.helper) {
                this.offset.parent = this._getParentOffset()
            }
            var i, item, t, p;
            for (i = this.items.length - 1; i >= 0; i--) {
                item = this.items[i];
                if (item.instance !== this.currentContainer && this.currentContainer && item.item[0] !== this.currentItem[0]) {
                    continue
                }
                t = this.options.toleranceElement ? $(this.options.toleranceElement, item.item) : item.item;
                if (!fast) {
                    item.width = t.outerWidth();
                    item.height = t.outerHeight()
                }
                p = t.offset();
                item.left = p.left;
                item.top = p.top
            }
            if (this.options.custom && this.options.custom.refreshContainers) {
                this.options.custom.refreshContainers.call(this)
            } else {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    p = this.containers[i].element.offset();
                    this.containers[i].containerCache.left = p.left;
                    this.containers[i].containerCache.top = p.top;
                    this.containers[i].containerCache.width = this.containers[i].element.outerWidth();
                    this.containers[i].containerCache.height = this.containers[i].element.outerHeight()
                }
            }
            return this
        },
        _createPlaceholder: function (that) {
            that = that || this;
            var className, o = that.options;
            if (!o.placeholder || o.placeholder.constructor === String) {
                className = o.placeholder;
                o.placeholder = {
                    element: function () {
                        var nodeName = that.currentItem[0].nodeName.toLowerCase(), element = $("<" + nodeName + ">", that.document[0]).addClass(className || that.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
                        if (nodeName === "tr") {
                            that.currentItem.children().each(function () {
                                $("<td>&#160;</td>", that.document[0]).attr("colspan", $(this).attr("colspan") || 1).appendTo(element)
                            })
                        } else if (nodeName === "img") {
                            element.attr("src", that.currentItem.attr("src"))
                        }
                        if (!className) {
                            element.css("visibility", "hidden")
                        }
                        return element
                    }, update: function (container, p) {
                        if (className && !o.forcePlaceholderSize) {
                            return
                        }
                        if (!p.height()) {
                            p.height(that.currentItem.innerHeight() - parseInt(that.currentItem.css("paddingTop") || 0, 10) - parseInt(that.currentItem.css("paddingBottom") || 0, 10))
                        }
                        if (!p.width()) {
                            p.width(that.currentItem.innerWidth() - parseInt(that.currentItem.css("paddingLeft") || 0, 10) - parseInt(that.currentItem.css("paddingRight") || 0, 10))
                        }
                    }
                }
            }
            that.placeholder = $(o.placeholder.element.call(that.element, that.currentItem));
            that.currentItem.after(that.placeholder);
            o.placeholder.update(that, that.placeholder)
        },
        _contactContainers: function (event) {
            var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, base, cur, nearBottom, floating, innermostContainer = null, innermostIndex = null;
            for (i = this.containers.length - 1; i >= 0; i--) {
                if ($.contains(this.currentItem[0], this.containers[i].element[0])) {
                    continue
                }
                if (this._intersectsWith(this.containers[i].containerCache)) {
                    if (innermostContainer && $.contains(this.containers[i].element[0], innermostContainer.element[0])) {
                        continue
                    }
                    innermostContainer = this.containers[i];
                    innermostIndex = i
                } else {
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", event, this._uiHash(this));
                        this.containers[i].containerCache.over = 0
                    }
                }
            }
            if (!innermostContainer) {
                return
            }
            if (this.containers.length === 1) {
                if (!this.containers[innermostIndex].containerCache.over) {
                    this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                    this.containers[innermostIndex].containerCache.over = 1
                }
            } else {
                dist = 1e4;
                itemWithLeastDistance = null;
                floating = innermostContainer.floating || isFloating(this.currentItem);
                posProperty = floating ? "left" : "top";
                sizeProperty = floating ? "width" : "height";
                base = this.positionAbs[posProperty] + this.offset.click[posProperty];
                for (j = this.items.length - 1; j >= 0; j--) {
                    if (!$.contains(this.containers[innermostIndex].element[0], this.items[j].item[0])) {
                        continue
                    }
                    if (this.items[j].item[0] === this.currentItem[0]) {
                        continue
                    }
                    if (floating && !isOverAxis(this.positionAbs.top + this.offset.click.top, this.items[j].top, this.items[j].height)) {
                        continue
                    }
                    cur = this.items[j].item.offset()[posProperty];
                    nearBottom = false;
                    if (Math.abs(cur - base) > Math.abs(cur + this.items[j][sizeProperty] - base)) {
                        nearBottom = true;
                        cur += this.items[j][sizeProperty]
                    }
                    if (Math.abs(cur - base) < dist) {
                        dist = Math.abs(cur - base);
                        itemWithLeastDistance = this.items[j];
                        this.direction = nearBottom ? "up" : "down"
                    }
                }
                if (!itemWithLeastDistance && !this.options.dropOnEmpty) {
                    return
                }
                if (this.currentContainer === this.containers[innermostIndex]) {
                    return
                }
                itemWithLeastDistance ? this._rearrange(event, itemWithLeastDistance, null, true) : this._rearrange(event, null, this.containers[innermostIndex].element, true);
                this._trigger("change", event, this._uiHash());
                this.containers[innermostIndex]._trigger("change", event, this._uiHash(this));
                this.currentContainer = this.containers[innermostIndex];
                this.options.placeholder.update(this.currentContainer, this.placeholder);
                this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                this.containers[innermostIndex].containerCache.over = 1
            }
        },
        _createHelper: function (event) {
            var o = this.options, helper = $.isFunction(o.helper) ? $(o.helper.apply(this.element[0], [event, this.currentItem])) : o.helper === "clone" ? this.currentItem.clone() : this.currentItem;
            if (!helper.parents("body").length) {
                $(o.appendTo !== "parent" ? o.appendTo : this.currentItem[0].parentNode)[0].appendChild(helper[0])
            }
            if (helper[0] === this.currentItem[0]) {
                this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css("position"),
                    top: this.currentItem.css("top"),
                    left: this.currentItem.css("left")
                }
            }
            if (!helper[0].style.width || o.forceHelperSize) {
                helper.width(this.currentItem.width())
            }
            if (!helper[0].style.height || o.forceHelperSize) {
                helper.height(this.currentItem.height())
            }
            return helper
        },
        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ")
            }
            if ($.isArray(obj)) {
                obj = {left: +obj[0], top: +obj[1] || 0}
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top
            }
        },
        _getParentOffset: function () {
            this.offsetParent = this.helper.offsetParent();
            var po = this.offsetParent.offset();
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop()
            }
            if (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && this.offsetParent[0].tagName.toLowerCase() === "html" && $.ui.ie) {
                po = {top: 0, left: 0}
            }
            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function () {
            if (this.cssPosition === "relative") {
                var p = this.currentItem.position();
                return {
                    top: p.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: p.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            } else {
                return {top: 0, left: 0}
            }
        },
        _cacheMargins: function () {
            this.margins = {
                left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                top: parseInt(this.currentItem.css("marginTop"), 10) || 0
            }
        },
        _cacheHelperProportions: function () {
            this.helperProportions = {width: this.helper.outerWidth(), height: this.helper.outerHeight()}
        },
        _setContainment: function () {
            var ce, co, over, o = this.options;
            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode
            }
            if (o.containment === "document" || o.containment === "window") {
                this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, $(o.containment === "document" ? document : window).width() - this.helperProportions.width - this.margins.left, ($(o.containment === "document" ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]
            }
            if (!/^(document|window|parent)$/.test(o.containment)) {
                ce = $(o.containment)[0];
                co = $(o.containment).offset();
                over = $(ce).css("overflow") !== "hidden";
                this.containment = [co.left + (parseInt($(ce).css("borderLeftWidth"), 10) || 0) + (parseInt($(ce).css("paddingLeft"), 10) || 0) - this.margins.left, co.top + (parseInt($(ce).css("borderTopWidth"), 10) || 0) + (parseInt($(ce).css("paddingTop"), 10) || 0) - this.margins.top, co.left + (over ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) - (parseInt($(ce).css("borderLeftWidth"), 10) || 0) - (parseInt($(ce).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, co.top + (over ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) - (parseInt($(ce).css("borderTopWidth"), 10) || 0) - (parseInt($(ce).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top]
            }
        },
        _convertPositionTo: function (d, pos) {
            if (!pos) {
                pos = this.position
            }
            var mod = d === "absolute" ? 1 : -1, scroll = this.cssPosition === "absolute" && !(this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent, scrollIsRootNode = /(html|body)/i.test(scroll[0].tagName);
            return {
                top: pos.top + this.offset.relative.top * mod + this.offset.parent.top * mod - (this.cssPosition === "fixed" ? -this.scrollParent.scrollTop() : scrollIsRootNode ? 0 : scroll.scrollTop()) * mod,
                left: pos.left + this.offset.relative.left * mod + this.offset.parent.left * mod - (this.cssPosition === "fixed" ? -this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 : scroll.scrollLeft()) * mod
            }
        },
        _generatePosition: function (event) {
            var top, left, o = this.options, pageX = event.pageX, pageY = event.pageY, scroll = this.cssPosition === "absolute" && !(this.scrollParent[0] !== document && $.contains(this.scrollParent[0], this.offsetParent[0])) ? this.offsetParent : this.scrollParent, scrollIsRootNode = /(html|body)/i.test(scroll[0].tagName);
            if (this.cssPosition === "relative" && !(this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0])) {
                this.offset.relative = this._getRelativeOffset()
            }
            if (this.originalPosition) {
                if (this.containment) {
                    if (event.pageX - this.offset.click.left < this.containment[0]) {
                        pageX = this.containment[0] + this.offset.click.left
                    }
                    if (event.pageY - this.offset.click.top < this.containment[1]) {
                        pageY = this.containment[1] + this.offset.click.top
                    }
                    if (event.pageX - this.offset.click.left > this.containment[2]) {
                        pageX = this.containment[2] + this.offset.click.left
                    }
                    if (event.pageY - this.offset.click.top > this.containment[3]) {
                        pageY = this.containment[3] + this.offset.click.top
                    }
                }
                if (o.grid) {
                    top = this.originalPageY + Math.round((pageY - this.originalPageY) / o.grid[1]) * o.grid[1];
                    pageY = this.containment ? top - this.offset.click.top >= this.containment[1] && top - this.offset.click.top <= this.containment[3] ? top : top - this.offset.click.top >= this.containment[1] ? top - o.grid[1] : top + o.grid[1] : top;
                    left = this.originalPageX + Math.round((pageX - this.originalPageX) / o.grid[0]) * o.grid[0];
                    pageX = this.containment ? left - this.offset.click.left >= this.containment[0] && left - this.offset.click.left <= this.containment[2] ? left : left - this.offset.click.left >= this.containment[0] ? left - o.grid[0] : left + o.grid[0] : left
                }
            }
            return {
                top: pageY - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition === "fixed" ? -this.scrollParent.scrollTop() : scrollIsRootNode ? 0 : scroll.scrollTop()),
                left: pageX - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition === "fixed" ? -this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 : scroll.scrollLeft())
            }
        },
        _rearrange: function (event, i, a, hardRefresh) {
            a ? a[0].appendChild(this.placeholder[0]) : i.item[0].parentNode.insertBefore(this.placeholder[0], this.direction === "down" ? i.item[0] : i.item[0].nextSibling);
            this.counter = this.counter ? ++this.counter : 1;
            var counter = this.counter;
            this._delay(function () {
                if (counter === this.counter) {
                    this.refreshPositions(!hardRefresh)
                }
            })
        },
        _clear: function (event, noPropagation) {
            this.reverting = false;
            var i, delayedTriggers = [];
            if (!this._noFinalSort && this.currentItem.parent().length) {
                this.placeholder.before(this.currentItem)
            }
            this._noFinalSort = null;
            if (this.helper[0] === this.currentItem[0]) {
                for (i in this._storedCSS) {
                    if (this._storedCSS[i] === "auto" || this._storedCSS[i] === "static") {
                        this._storedCSS[i] = ""
                    }
                }
                this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
            } else {
                this.currentItem.show()
            }
            if (this.fromOutside && !noPropagation) {
                delayedTriggers.push(function (event) {
                    this._trigger("receive", event, this._uiHash(this.fromOutside))
                })
            }
            if ((this.fromOutside || this.domPosition.prev !== this.currentItem.prev().not(".ui-sortable-helper")[0] || this.domPosition.parent !== this.currentItem.parent()[0]) && !noPropagation) {
                delayedTriggers.push(function (event) {
                    this._trigger("update", event, this._uiHash())
                })
            }
            if (this !== this.currentContainer) {
                if (!noPropagation) {
                    delayedTriggers.push(function (event) {
                        this._trigger("remove", event, this._uiHash())
                    });
                    delayedTriggers.push(function (c) {
                        return function (event) {
                            c._trigger("receive", event, this._uiHash(this))
                        }
                    }.call(this, this.currentContainer));
                    delayedTriggers.push(function (c) {
                        return function (event) {
                            c._trigger("update", event, this._uiHash(this))
                        }
                    }.call(this, this.currentContainer))
                }
            }
            for (i = this.containers.length - 1; i >= 0; i--) {
                if (!noPropagation) {
                    delayedTriggers.push(function (c) {
                        return function (event) {
                            c._trigger("deactivate", event, this._uiHash(this))
                        }
                    }.call(this, this.containers[i]))
                }
                if (this.containers[i].containerCache.over) {
                    delayedTriggers.push(function (c) {
                        return function (event) {
                            c._trigger("out", event, this._uiHash(this))
                        }
                    }.call(this, this.containers[i]));
                    this.containers[i].containerCache.over = 0
                }
            }
            if (this.storedCursor) {
                this.document.find("body").css("cursor", this.storedCursor);
                this.storedStylesheet.remove()
            }
            if (this._storedOpacity) {
                this.helper.css("opacity", this._storedOpacity)
            }
            if (this._storedZIndex) {
                this.helper.css("zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex)
            }
            this.dragging = false;
            if (this.cancelHelperRemoval) {
                if (!noPropagation) {
                    this._trigger("beforeStop", event, this._uiHash());
                    for (i = 0; i < delayedTriggers.length; i++) {
                        delayedTriggers[i].call(this, event)
                    }
                    this._trigger("stop", event, this._uiHash())
                }
                this.fromOutside = false;
                return false
            }
            if (!noPropagation) {
                this._trigger("beforeStop", event, this._uiHash())
            }
            this.placeholder[0].parentNode.removeChild(this.placeholder[0]);
            if (this.helper[0] !== this.currentItem[0]) {
                this.helper.remove()
            }
            this.helper = null;
            if (!noPropagation) {
                for (i = 0; i < delayedTriggers.length; i++) {
                    delayedTriggers[i].call(this, event)
                }
                this._trigger("stop", event, this._uiHash())
            }
            this.fromOutside = false;
            return true
        },
        _trigger: function () {
            if ($.Widget.prototype._trigger.apply(this, arguments) === false) {
                this.cancel()
            }
        },
        _uiHash: function (_inst) {
            var inst = _inst || this;
            return {
                helper: inst.helper,
                placeholder: inst.placeholder || $([]),
                position: inst.position,
                originalPosition: inst.originalPosition,
                offset: inst.positionAbs,
                item: inst.currentItem,
                sender: _inst ? _inst.element : null
            }
        }
    })
})(jQuery);
(function ($, undefined) {
    var dataSpace = "ui-effects-";
    $.effects = {effect: {}};
    (function (jQuery, undefined) {
        var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor", rplusequals = /^([\-+])=\s*(\d+\.?\d*)/, stringParsers = [{
            re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
            parse: function (execResult) {
                return [execResult[1], execResult[2], execResult[3], execResult[4]]
            }
        }, {
            re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
            parse: function (execResult) {
                return [execResult[1] * 2.55, execResult[2] * 2.55, execResult[3] * 2.55, execResult[4]]
            }
        }, {
            re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/, parse: function (execResult) {
                return [parseInt(execResult[1], 16), parseInt(execResult[2], 16), parseInt(execResult[3], 16)]
            }
        }, {
            re: /#([a-f0-9])([a-f0-9])([a-f0-9])/, parse: function (execResult) {
                return [parseInt(execResult[1] + execResult[1], 16), parseInt(execResult[2] + execResult[2], 16), parseInt(execResult[3] + execResult[3], 16)]
            }
        }, {
            re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
            space: "hsla",
            parse: function (execResult) {
                return [execResult[1], execResult[2] / 100, execResult[3] / 100, execResult[4]]
            }
        }], color = jQuery.Color = function (color, green, blue, alpha) {
            return new jQuery.Color.fn.parse(color, green, blue, alpha)
        }, spaces = {
            rgba: {
                props: {
                    red: {idx: 0, type: "byte"},
                    green: {idx: 1, type: "byte"},
                    blue: {idx: 2, type: "byte"}
                }
            },
            hsla: {
                props: {
                    hue: {idx: 0, type: "degrees"},
                    saturation: {idx: 1, type: "percent"},
                    lightness: {idx: 2, type: "percent"}
                }
            }
        }, propTypes = {
            "byte": {floor: true, max: 255},
            percent: {max: 1},
            degrees: {mod: 360, floor: true}
        }, support = color.support = {}, supportElem = jQuery("<p>")[0], colors, each = jQuery.each;
        supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
        support.rgba = supportElem.style.backgroundColor.indexOf("rgba") > -1;
        each(spaces, function (spaceName, space) {
            space.cache = "_" + spaceName;
            space.props.alpha = {idx: 3, type: "percent", def: 1}
        });
        function clamp(value, prop, allowEmpty) {
            var type = propTypes[prop.type] || {};
            if (value == null) {
                return allowEmpty || !prop.def ? null : prop.def
            }
            value = type.floor ? ~~value : parseFloat(value);
            if (isNaN(value)) {
                return prop.def
            }
            if (type.mod) {
                return (value + type.mod) % type.mod
            }
            return 0 > value ? 0 : type.max < value ? type.max : value
        }

        function stringParse(string) {
            var inst = color(), rgba = inst._rgba = [];
            string = string.toLowerCase();
            each(stringParsers, function (i, parser) {
                var parsed, match = parser.re.exec(string), values = match && parser.parse(match), spaceName = parser.space || "rgba";
                if (values) {
                    parsed = inst[spaceName](values);
                    inst[spaces[spaceName].cache] = parsed[spaces[spaceName].cache];
                    rgba = inst._rgba = parsed._rgba;
                    return false
                }
            });
            if (rgba.length) {
                if (rgba.join() === "0,0,0,0") {
                    jQuery.extend(rgba, colors.transparent)
                }
                return inst
            }
            return colors[string]
        }

        color.fn = jQuery.extend(color.prototype, {
            parse: function (red, green, blue, alpha) {
                if (red === undefined) {
                    this._rgba = [null, null, null, null];
                    return this
                }
                if (red.jquery || red.nodeType) {
                    red = jQuery(red).css(green);
                    green = undefined
                }
                var inst = this, type = jQuery.type(red), rgba = this._rgba = [];
                if (green !== undefined) {
                    red = [red, green, blue, alpha];
                    type = "array"
                }
                if (type === "string") {
                    return this.parse(stringParse(red) || colors._default)
                }
                if (type === "array") {
                    each(spaces.rgba.props, function (key, prop) {
                        rgba[prop.idx] = clamp(red[prop.idx], prop)
                    });
                    return this
                }
                if (type === "object") {
                    if (red instanceof color) {
                        each(spaces, function (spaceName, space) {
                            if (red[space.cache]) {
                                inst[space.cache] = red[space.cache].slice()
                            }
                        })
                    } else {
                        each(spaces, function (spaceName, space) {
                            var cache = space.cache;
                            each(space.props, function (key, prop) {
                                if (!inst[cache] && space.to) {
                                    if (key === "alpha" || red[key] == null) {
                                        return
                                    }
                                    inst[cache] = space.to(inst._rgba)
                                }
                                inst[cache][prop.idx] = clamp(red[key], prop, true)
                            });
                            if (inst[cache] && jQuery.inArray(null, inst[cache].slice(0, 3)) < 0) {
                                inst[cache][3] = 1;
                                if (space.from) {
                                    inst._rgba = space.from(inst[cache])
                                }
                            }
                        })
                    }
                    return this
                }
            }, is: function (compare) {
                var is = color(compare), same = true, inst = this;
                each(spaces, function (_, space) {
                    var localCache, isCache = is[space.cache];
                    if (isCache) {
                        localCache = inst[space.cache] || space.to && space.to(inst._rgba) || [];
                        each(space.props, function (_, prop) {
                            if (isCache[prop.idx] != null) {
                                same = isCache[prop.idx] === localCache[prop.idx];
                                return same
                            }
                        })
                    }
                    return same
                });
                return same
            }, _space: function () {
                var used = [], inst = this;
                each(spaces, function (spaceName, space) {
                    if (inst[space.cache]) {
                        used.push(spaceName)
                    }
                });
                return used.pop()
            }, transition: function (other, distance) {
                var end = color(other), spaceName = end._space(), space = spaces[spaceName], startColor = this.alpha() === 0 ? color("transparent") : this, start = startColor[space.cache] || space.to(startColor._rgba), result = start.slice();
                end = end[space.cache];
                each(space.props, function (key, prop) {
                    var index = prop.idx, startValue = start[index], endValue = end[index], type = propTypes[prop.type] || {};
                    if (endValue === null) {
                        return
                    }
                    if (startValue === null) {
                        result[index] = endValue
                    } else {
                        if (type.mod) {
                            if (endValue - startValue > type.mod / 2) {
                                startValue += type.mod
                            } else if (startValue - endValue > type.mod / 2) {
                                startValue -= type.mod
                            }
                        }
                        result[index] = clamp((endValue - startValue) * distance + startValue, prop)
                    }
                });
                return this[spaceName](result)
            }, blend: function (opaque) {
                if (this._rgba[3] === 1) {
                    return this
                }
                var rgb = this._rgba.slice(), a = rgb.pop(), blend = color(opaque)._rgba;
                return color(jQuery.map(rgb, function (v, i) {
                    return (1 - a) * blend[i] + a * v
                }))
            }, toRgbaString: function () {
                var prefix = "rgba(", rgba = jQuery.map(this._rgba, function (v, i) {
                    return v == null ? i > 2 ? 1 : 0 : v
                });
                if (rgba[3] === 1) {
                    rgba.pop();
                    prefix = "rgb("
                }
                return prefix + rgba.join() + ")"
            }, toHslaString: function () {
                var prefix = "hsla(", hsla = jQuery.map(this.hsla(), function (v, i) {
                    if (v == null) {
                        v = i > 2 ? 1 : 0
                    }
                    if (i && i < 3) {
                        v = Math.round(v * 100) + "%"
                    }
                    return v
                });
                if (hsla[3] === 1) {
                    hsla.pop();
                    prefix = "hsl("
                }
                return prefix + hsla.join() + ")"
            }, toHexString: function (includeAlpha) {
                var rgba = this._rgba.slice(), alpha = rgba.pop();
                if (includeAlpha) {
                    rgba.push(~~(alpha * 255))
                }
                return "#" + jQuery.map(rgba, function (v) {
                        v = (v || 0).toString(16);
                        return v.length === 1 ? "0" + v : v
                    }).join("")
            }, toString: function () {
                return this._rgba[3] === 0 ? "transparent" : this.toRgbaString()
            }
        });
        color.fn.parse.prototype = color.fn;
        function hue2rgb(p, q, h) {
            h = (h + 1) % 1;
            if (h * 6 < 1) {
                return p + (q - p) * h * 6
            }
            if (h * 2 < 1) {
                return q
            }
            if (h * 3 < 2) {
                return p + (q - p) * (2 / 3 - h) * 6
            }
            return p
        }

        spaces.hsla.to = function (rgba) {
            if (rgba[0] == null || rgba[1] == null || rgba[2] == null) {
                return [null, null, null, rgba[3]]
            }
            var r = rgba[0] / 255, g = rgba[1] / 255, b = rgba[2] / 255, a = rgba[3], max = Math.max(r, g, b), min = Math.min(r, g, b), diff = max - min, add = max + min, l = add * .5, h, s;
            if (min === max) {
                h = 0
            } else if (r === max) {
                h = 60 * (g - b) / diff + 360
            } else if (g === max) {
                h = 60 * (b - r) / diff + 120
            } else {
                h = 60 * (r - g) / diff + 240
            }
            if (diff === 0) {
                s = 0
            } else if (l <= .5) {
                s = diff / add
            } else {
                s = diff / (2 - add)
            }
            return [Math.round(h) % 360, s, l, a == null ? 1 : a]
        };
        spaces.hsla.from = function (hsla) {
            if (hsla[0] == null || hsla[1] == null || hsla[2] == null) {
                return [null, null, null, hsla[3]]
            }
            var h = hsla[0] / 360, s = hsla[1], l = hsla[2], a = hsla[3], q = l <= .5 ? l * (1 + s) : l + s - l * s, p = 2 * l - q;
            return [Math.round(hue2rgb(p, q, h + 1 / 3) * 255), Math.round(hue2rgb(p, q, h) * 255), Math.round(hue2rgb(p, q, h - 1 / 3) * 255), a]
        };
        each(spaces, function (spaceName, space) {
            var props = space.props, cache = space.cache, to = space.to, from = space.from;
            color.fn[spaceName] = function (value) {
                if (to && !this[cache]) {
                    this[cache] = to(this._rgba)
                }
                if (value === undefined) {
                    return this[cache].slice()
                }
                var ret, type = jQuery.type(value), arr = type === "array" || type === "object" ? value : arguments, local = this[cache].slice();
                each(props, function (key, prop) {
                    var val = arr[type === "object" ? key : prop.idx];
                    if (val == null) {
                        val = local[prop.idx]
                    }
                    local[prop.idx] = clamp(val, prop)
                });
                if (from) {
                    ret = color(from(local));
                    ret[cache] = local;
                    return ret
                } else {
                    return color(local)
                }
            };
            each(props, function (key, prop) {
                if (color.fn[key]) {
                    return
                }
                color.fn[key] = function (value) {
                    var vtype = jQuery.type(value), fn = key === "alpha" ? this._hsla ? "hsla" : "rgba" : spaceName, local = this[fn](), cur = local[prop.idx], match;
                    if (vtype === "undefined") {
                        return cur
                    }
                    if (vtype === "function") {
                        value = value.call(this, cur);
                        vtype = jQuery.type(value)
                    }
                    if (value == null && prop.empty) {
                        return this
                    }
                    if (vtype === "string") {
                        match = rplusequals.exec(value);
                        if (match) {
                            value = cur + parseFloat(match[2]) * (match[1] === "+" ? 1 : -1)
                        }
                    }
                    local[prop.idx] = value;
                    return this[fn](local)
                }
            })
        });
        color.hook = function (hook) {
            var hooks = hook.split(" ");
            each(hooks, function (i, hook) {
                jQuery.cssHooks[hook] = {
                    set: function (elem, value) {
                        var parsed, curElem, backgroundColor = "";
                        if (value !== "transparent" && (jQuery.type(value) !== "string" || (parsed = stringParse(value)))) {
                            value = color(parsed || value);
                            if (!support.rgba && value._rgba[3] !== 1) {
                                curElem = hook === "backgroundColor" ? elem.parentNode : elem;
                                while ((backgroundColor === "" || backgroundColor === "transparent") && curElem && curElem.style) {
                                    try {
                                        backgroundColor = jQuery.css(curElem, "backgroundColor");
                                        curElem = curElem.parentNode
                                    } catch (e) {
                                    }
                                }
                                value = value.blend(backgroundColor && backgroundColor !== "transparent" ? backgroundColor : "_default")
                            }
                            value = value.toRgbaString()
                        }
                        try {
                            elem.style[hook] = value
                        } catch (e) {
                        }
                    }
                };
                jQuery.fx.step[hook] = function (fx) {
                    if (!fx.colorInit) {
                        fx.start = color(fx.elem, hook);
                        fx.end = color(fx.end);
                        fx.colorInit = true
                    }
                    jQuery.cssHooks[hook].set(fx.elem, fx.start.transition(fx.end, fx.pos))
                }
            })
        };
        color.hook(stepHooks);
        jQuery.cssHooks.borderColor = {
            expand: function (value) {
                var expanded = {};
                each(["Top", "Right", "Bottom", "Left"], function (i, part) {
                    expanded["border" + part + "Color"] = value
                });
                return expanded
            }
        };
        colors = jQuery.Color.names = {
            aqua: "#00ffff",
            black: "#000000",
            blue: "#0000ff",
            fuchsia: "#ff00ff",
            gray: "#808080",
            green: "#008000",
            lime: "#00ff00",
            maroon: "#800000",
            navy: "#000080",
            olive: "#808000",
            purple: "#800080",
            red: "#ff0000",
            silver: "#c0c0c0",
            teal: "#008080",
            white: "#ffffff",
            yellow: "#ffff00",
            transparent: [null, null, null, 0],
            _default: "#ffffff"
        }
    })(jQuery);
    (function () {
        var classAnimationActions = ["add", "remove", "toggle"], shorthandStyles = {
            border: 1,
            borderBottom: 1,
            borderColor: 1,
            borderLeft: 1,
            borderRight: 1,
            borderTop: 1,
            borderWidth: 1,
            margin: 1,
            padding: 1
        };
        $.each(["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"], function (_, prop) {
            $.fx.step[prop] = function (fx) {
                if (fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr) {
                    jQuery.style(fx.elem, prop, fx.end);
                    fx.setAttr = true
                }
            }
        });
        function getElementStyles(elem) {
            var key, len, style = elem.ownerDocument.defaultView ? elem.ownerDocument.defaultView.getComputedStyle(elem, null) : elem.currentStyle, styles = {};
            if (style && style.length && style[0] && style[style[0]]) {
                len = style.length;
                while (len--) {
                    key = style[len];
                    if (typeof style[key] === "string") {
                        styles[$.camelCase(key)] = style[key]
                    }
                }
            } else {
                for (key in style) {
                    if (typeof style[key] === "string") {
                        styles[key] = style[key]
                    }
                }
            }
            return styles
        }

        function styleDifference(oldStyle, newStyle) {
            var diff = {}, name, value;
            for (name in newStyle) {
                value = newStyle[name];
                if (oldStyle[name] !== value) {
                    if (!shorthandStyles[name]) {
                        if ($.fx.step[name] || !isNaN(parseFloat(value))) {
                            diff[name] = value
                        }
                    }
                }
            }
            return diff
        }

        if (!$.fn.addBack) {
            $.fn.addBack = function (selector) {
                return this.add(selector == null ? this.prevObject : this.prevObject.filter(selector))
            }
        }
        $.effects.animateClass = function (value, duration, easing, callback) {
            var o = $.speed(duration, easing, callback);
            return this.queue(function () {
                var animated = $(this), baseClass = animated.attr("class") || "", applyClassChange, allAnimations = o.children ? animated.find("*").addBack() : animated;
                allAnimations = allAnimations.map(function () {
                    var el = $(this);
                    return {el: el, start: getElementStyles(this)}
                });
                applyClassChange = function () {
                    $.each(classAnimationActions, function (i, action) {
                        if (value[action]) {
                            animated[action + "Class"](value[action])
                        }
                    })
                };
                applyClassChange();
                allAnimations = allAnimations.map(function () {
                    this.end = getElementStyles(this.el[0]);
                    this.diff = styleDifference(this.start, this.end);
                    return this
                });
                animated.attr("class", baseClass);
                allAnimations = allAnimations.map(function () {
                    var styleInfo = this, dfd = $.Deferred(), opts = $.extend({}, o, {
                        queue: false,
                        complete: function () {
                            dfd.resolve(styleInfo)
                        }
                    });
                    this.el.animate(this.diff, opts);
                    return dfd.promise()
                });
                $.when.apply($, allAnimations.get()).done(function () {
                    applyClassChange();
                    $.each(arguments, function () {
                        var el = this.el;
                        $.each(this.diff, function (key) {
                            el.css(key, "")
                        })
                    });
                    o.complete.call(animated[0])
                })
            })
        };
        $.fn.extend({
            addClass: function (orig) {
                return function (classNames, speed, easing, callback) {
                    return speed ? $.effects.animateClass.call(this, {add: classNames}, speed, easing, callback) : orig.apply(this, arguments)
                }
            }($.fn.addClass), removeClass: function (orig) {
                return function (classNames, speed, easing, callback) {
                    return arguments.length > 1 ? $.effects.animateClass.call(this, {remove: classNames}, speed, easing, callback) : orig.apply(this, arguments)
                }
            }($.fn.removeClass), toggleClass: function (orig) {
                return function (classNames, force, speed, easing, callback) {
                    if (typeof force === "boolean" || force === undefined) {
                        if (!speed) {
                            return orig.apply(this, arguments)
                        } else {
                            return $.effects.animateClass.call(this, force ? {add: classNames} : {remove: classNames}, speed, easing, callback)
                        }
                    } else {
                        return $.effects.animateClass.call(this, {toggle: classNames}, force, speed, easing)
                    }
                }
            }($.fn.toggleClass), switchClass: function (remove, add, speed, easing, callback) {
                return $.effects.animateClass.call(this, {add: add, remove: remove}, speed, easing, callback)
            }
        })
    })();
    (function () {
        $.extend($.effects, {
            version: "1.10.3", save: function (element, set) {
                for (var i = 0; i < set.length; i++) {
                    if (set[i] !== null) {
                        element.data(dataSpace + set[i], element[0].style[set[i]])
                    }
                }
            }, restore: function (element, set) {
                var val, i;
                for (i = 0; i < set.length; i++) {
                    if (set[i] !== null) {
                        val = element.data(dataSpace + set[i]);
                        if (val === undefined) {
                            val = ""
                        }
                        element.css(set[i], val)
                    }
                }
            }, setMode: function (el, mode) {
                if (mode === "toggle") {
                    mode = el.is(":hidden") ? "show" : "hide"
                }
                return mode
            }, getBaseline: function (origin, original) {
                var y, x;
                switch (origin[0]) {
                    case"top":
                        y = 0;
                        break;
                    case"middle":
                        y = .5;
                        break;
                    case"bottom":
                        y = 1;
                        break;
                    default:
                        y = origin[0] / original.height
                }
                switch (origin[1]) {
                    case"left":
                        x = 0;
                        break;
                    case"center":
                        x = .5;
                        break;
                    case"right":
                        x = 1;
                        break;
                    default:
                        x = origin[1] / original.width
                }
                return {x: x, y: y}
            }, createWrapper: function (element) {
                if (element.parent().is(".ui-effects-wrapper")) {
                    return element.parent()
                }
                var props = {
                    width: element.outerWidth(true),
                    height: element.outerHeight(true),
                    "float": element.css("float")
                }, wrapper = $("<div></div>").addClass("ui-effects-wrapper").css({
                    fontSize: "100%",
                    background: "transparent",
                    border: "none",
                    margin: 0,
                    padding: 0
                }), size = {width: element.width(), height: element.height()}, active = document.activeElement;
                try {
                    active.id
                } catch (e) {
                    active = document.body
                }
                element.wrap(wrapper);
                if (element[0] === active || $.contains(element[0], active)) {
                    $(active).focus()
                }
                wrapper = element.parent();
                if (element.css("position") === "static") {
                    wrapper.css({position: "relative"});
                    element.css({position: "relative"})
                } else {
                    $.extend(props, {position: element.css("position"), zIndex: element.css("z-index")});
                    $.each(["top", "left", "bottom", "right"], function (i, pos) {
                        props[pos] = element.css(pos);
                        if (isNaN(parseInt(props[pos], 10))) {
                            props[pos] = "auto"
                        }
                    });
                    element.css({position: "relative", top: 0, left: 0, right: "auto", bottom: "auto"})
                }
                element.css(size);
                return wrapper.css(props).show()
            }, removeWrapper: function (element) {
                var active = document.activeElement;
                if (element.parent().is(".ui-effects-wrapper")) {
                    element.parent().replaceWith(element);
                    if (element[0] === active || $.contains(element[0], active)) {
                        $(active).focus()
                    }
                }
                return element
            }, setTransition: function (element, list, factor, value) {
                value = value || {};
                $.each(list, function (i, x) {
                    var unit = element.cssUnit(x);
                    if (unit[0] > 0) {
                        value[x] = unit[0] * factor + unit[1]
                    }
                });
                return value
            }
        });
        function _normalizeArguments(effect, options, speed, callback) {
            if ($.isPlainObject(effect)) {
                options = effect;
                effect = effect.effect
            }
            effect = {effect: effect};
            if (options == null) {
                options = {}
            }
            if ($.isFunction(options)) {
                callback = options;
                speed = null;
                options = {}
            }
            if (typeof options === "number" || $.fx.speeds[options]) {
                callback = speed;
                speed = options;
                options = {}
            }
            if ($.isFunction(speed)) {
                callback = speed;
                speed = null
            }
            if (options) {
                $.extend(effect, options)
            }
            speed = speed || options.duration;
            effect.duration = $.fx.off ? 0 : typeof speed === "number" ? speed : speed in $.fx.speeds ? $.fx.speeds[speed] : $.fx.speeds._default;
            effect.complete = callback || options.complete;
            return effect
        }

        function standardAnimationOption(option) {
            if (!option || typeof option === "number" || $.fx.speeds[option]) {
                return true
            }
            if (typeof option === "string" && !$.effects.effect[option]) {
                return true
            }
            if ($.isFunction(option)) {
                return true
            }
            if (typeof option === "object" && !option.effect) {
                return true
            }
            return false
        }

        $.fn.extend({
            effect: function () {
                var args = _normalizeArguments.apply(this, arguments), mode = args.mode, queue = args.queue, effectMethod = $.effects.effect[args.effect];
                if ($.fx.off || !effectMethod) {
                    if (mode) {
                        return this[mode](args.duration, args.complete)
                    } else {
                        return this.each(function () {
                            if (args.complete) {
                                args.complete.call(this)
                            }
                        })
                    }
                }
                function run(next) {
                    var elem = $(this), complete = args.complete, mode = args.mode;

                    function done() {
                        if ($.isFunction(complete)) {
                            complete.call(elem[0])
                        }
                        if ($.isFunction(next)) {
                            next()
                        }
                    }

                    if (elem.is(":hidden") ? mode === "hide" : mode === "show") {
                        elem[mode]();
                        done()
                    } else {
                        effectMethod.call(elem[0], args, done)
                    }
                }

                return queue === false ? this.each(run) : this.queue(queue || "fx", run)
            }, show: function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments)
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "show";
                        return this.effect.call(this, args)
                    }
                }
            }($.fn.show), hide: function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments)
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "hide";
                        return this.effect.call(this, args)
                    }
                }
            }($.fn.hide), toggle: function (orig) {
                return function (option) {
                    if (standardAnimationOption(option) || typeof option === "boolean") {
                        return orig.apply(this, arguments)
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "toggle";
                        return this.effect.call(this, args)
                    }
                }
            }($.fn.toggle), cssUnit: function (key) {
                var style = this.css(key), val = [];
                $.each(["em", "px", "%", "pt"], function (i, unit) {
                    if (style.indexOf(unit) > 0) {
                        val = [parseFloat(style), unit]
                    }
                });
                return val
            }
        })
    })();
    (function () {
        var baseEasings = {};
        $.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function (i, name) {
            baseEasings[name] = function (p) {
                return Math.pow(p, i + 2)
            }
        });
        $.extend(baseEasings, {
            Sine: function (p) {
                return 1 - Math.cos(p * Math.PI / 2)
            }, Circ: function (p) {
                return 1 - Math.sqrt(1 - p * p)
            }, Elastic: function (p) {
                return p === 0 || p === 1 ? p : -Math.pow(2, 8 * (p - 1)) * Math.sin(((p - 1) * 80 - 7.5) * Math.PI / 15)
            }, Back: function (p) {
                return p * p * (3 * p - 2)
            }, Bounce: function (p) {
                var pow2, bounce = 4;
                while (p < ((pow2 = Math.pow(2, --bounce)) - 1) / 11) {
                }
                return 1 / Math.pow(4, 3 - bounce) - 7.5625 * Math.pow((pow2 * 3 - 2) / 22 - p, 2)
            }
        });
        $.each(baseEasings, function (name, easeIn) {
            $.easing["easeIn" + name] = easeIn;
            $.easing["easeOut" + name] = function (p) {
                return 1 - easeIn(1 - p)
            };
            $.easing["easeInOut" + name] = function (p) {
                return p < .5 ? easeIn(p * 2) / 2 : 1 - easeIn(p * -2 + 2) / 2
            }
        })
    })()
})(jQuery);
(function ($, undefined) {
    $.effects.effect.pulsate = function (o, done) {
        var elem = $(this), mode = $.effects.setMode(elem, o.mode || "show"), show = mode === "show", hide = mode === "hide", showhide = show || mode === "hide", anims = (o.times || 5) * 2 + (showhide ? 1 : 0), duration = o.duration / anims, animateTo = 0, queue = elem.queue(), queuelen = queue.length, i;
        if (show || !elem.is(":visible")) {
            elem.css("opacity", 0).show();
            animateTo = 1
        }
        for (i = 1; i < anims; i++) {
            elem.animate({opacity: animateTo}, duration, o.easing);
            animateTo = 1 - animateTo
        }
        elem.animate({opacity: animateTo}, duration, o.easing);
        elem.queue(function () {
            if (hide) {
                elem.hide()
            }
            done()
        });
        if (queuelen > 1) {
            queue.splice.apply(queue, [1, 0].concat(queue.splice(queuelen, anims + 1)))
        }
        elem.dequeue()
    }
})(jQuery);
(function ($) {
    var pluginName = "sCroller";

    function Plugin(element, options) {
        var el = element;
        var $el = $(element);
        var $contentEl = $el.find(".sCroller-content");
        var $scrollbarEl;
        var $dragHandleEl;
        var $scrollContentEl;
        var dragOffset;
        var hideTimer;
        var scrollDir = "vert";
        var scrollOffsetAttr = "scrollTop";
        var sizeAttr = "height";
        var offsetAttr = "top";
        var isScrolling = false;
        var scrollInt;
        options = $.extend({}, $.fn[pluginName].defaults, options);
        function init() {
            if ($el.hasClass("horizontal")) {
                scrollDir = "horiz";
                scrollOffsetAttr = "scrollLeft";
                sizeAttr = "width";
                offsetAttr = "left"
            }
            $el.attr("data-scroll", 0);
            $el.prepend('<div class="sCroll-bar"><div class="sCroll-handle"></div></div>');
            $scrollbarEl = $el.find(".sCroll-bar");
            $dragHandleEl = $el.find(".sCroll-handle");
            $contentEl.wrap('<div class="sCroll-wrap" />');
            $scrollContentEl = $el.find(".sCroll-wrap");
            resizeScrollContent();
            if ($el.parent().hasClass("scroll-contain")) {
                $el.parent().on("mouseenter", function () {
                    $(this).addClass("hover");
                    showScrollbar()
                });
                $el.parent().on("mouseleave", function () {
                    $(this).removeClass("hover");
                    hideScrollbar()
                })
            } else {
                $el.on("mouseenter", showScrollbar);
                $el.on("mouseleave", hideScrollbar)
            }
            $dragHandleEl.on("mousedown", startDrag);
            $scrollContentEl.on("scroll", onScrolled);
            $scrollbarEl.on("click.scrollbar", scrollbarClick);
            positionScrollbar();
            resizeScrollbar()
        }

        function startDrag(e) {
            e.preventDefault();
            var eventOffset = scrollDir === "horiz" ? e.pageX : e.pageY;
            dragOffset = eventOffset - $dragHandleEl.offset()[offsetAttr];
            $(document).on("mousemove", drag);
            $(document).on("mouseup", endDrag)
        }

        function drag(e) {
            e.preventDefault();
            var eOffset = scrollDir === "horiz" ? e.pageX : e.pageY;
            var dragPos = eOffset - $scrollbarEl.offset()[offsetAttr] - dragOffset;
            var dragPerc = dragPos / $scrollbarEl[sizeAttr]();
            var scrollPos = dragPerc * $contentEl[sizeAttr]();
            $scrollContentEl[scrollOffsetAttr](scrollPos)
        }

        function endDrag() {
            $(document).off("mousemove", drag);
            $(document).off("mouseup", endDrag)
        }

        function onScrolled(e) {
            $el.attr("data-scroll", $scrollContentEl[scrollOffsetAttr]());
            positionScrollbar();
            isScrolling = true
        }

        function scrollChecks() {
            $el.parent().removeClass("scrollStart scrollEnd");
            if ($el.attr("data-scroll") > 0) $el.parent().addClass("scrollStart");
            if (parseInt($el.attr("data-scroll")) + parseInt($scrollContentEl[sizeAttr]()) >= parseInt($contentEl[sizeAttr]())) $el.parent().addClass("scrollEnd")
        }

        function scrollbarClick(e) {
            if ($(e.target).hasClass("sCroll-handle"))return;
            var clickPos = e.pageX - $(e.target).offset().left;
            var delta = Math.ceil($scrollContentEl[sizeAttr]() * .9);
            if (clickPos > $dragHandleEl.position().left + $dragHandleEl.outerWidth()) {
                scrollTo(parseInt($el.attr("data-scroll")) + delta, 340);
                return
            }
            if (clickPos < $dragHandleEl.position().left) {
                scrollTo(parseInt($el.attr("data-scroll")) - delta, 340);
                return
            }
        }

        function showScrollbar() {
            positionScrollbar();
            resizeScrollbar();
            $scrollbarEl.addClass("visible");
            $dragHandleEl.addClass("visible");
            if (typeof hideTimer === "number") window.clearTimeout(hideTimer);
            scrollInt = setInterval(function () {
                if (isScrolling) {
                    isScrolling = false;
                    scrollChecks()
                }
            }, 500)
        }

        function hideScrollbar() {
            $scrollbarEl.removeClass("visible");
            $dragHandleEl.removeClass("visible");
            clearInterval(scrollInt)
        }

        function resizeScrollbar() {
            var contentSize = $contentEl[sizeAttr]();
            var containerSize = $scrollContentEl[sizeAttr]();
            var ratio = containerSize / contentSize;
            var scrollbarSize = $scrollbarEl[sizeAttr]();
            var handleSize = Math.floor(scrollbarSize * ratio);
            if (handleSize < scrollbarSize) {
                if (scrollDir === "vert") $dragHandleEl.css({height: handleSize}); else $dragHandleEl.css({width: handleSize});
                $scrollbarEl.show()
            } else {
                $scrollbarEl.hide()
            }
        }

        function positionScrollbar() {
            var scrollOffset = $scrollContentEl[scrollOffsetAttr]();
            var scrollbarRatio = $scrollbarEl[sizeAttr]() / $contentEl[sizeAttr]();
            var handleOffset = Math.round(scrollbarRatio * scrollOffset);
            if (scrollDir === "vert") $dragHandleEl.css({top: handleOffset}); else $dragHandleEl.css({left: handleOffset})
        }

        function scrollbarWidth() {
            var tempEl = $('<div class="sCroller-temp"><div class="sCroller-temp-stuff"></div></div>');
            $("body").append(tempEl);
            var width = $(tempEl).innerWidth();
            var widthMinusScrollbars = $("div", tempEl).innerWidth();
            tempEl.remove();
            return width - widthMinusScrollbars
        }

        function resizeScrollContent() {
            if (scrollDir === "vert") {
                $scrollContentEl.width($el.width() + scrollbarWidth());
                $scrollContentEl.height($el.height())
            } else {
                $scrollContentEl.width($el.width());
                $scrollContentEl.height($el.height() + scrollbarWidth());
                $contentEl.height($el.height())
            }
        }

        function resize() {
            resizeScrollContent();
            positionScrollbar();
            resizeScrollbar()
        }

        function option(key, val) {
            if (val) options[key] = val; else return options[key]
        }

        function destroy() {
            $contentEl.insertBefore($scrollbarEl);
            $scrollbarEl.remove();
            $scrollContentEl.remove();
            $contentEl.css({height: $el.height() + "px", "overflow-y": "scroll"});
            hook("onDestroy");
            $el.removeData("plugin_" + pluginName);
            clearInterval(scrollInt);
            $("body").removeClass("scrollCheckActive")
        }

        function hook(hookName) {
            if (options[hookName] !== undefined) options[hookName].call(el)
        }

        function scrollTo(pos, time) {
            if (time === undefined)var time = 480;
            $({scrollPos: $scrollContentEl[scrollOffsetAttr]()}).stop().animate({scrollPos: pos}, {
                duration: time,
                step: function () {
                    $scrollContentEl[scrollOffsetAttr](this.scrollPos);
                    positionScrollbar()
                }
            })
        }

        init();
        return {option: option, destroy: destroy, resize: resize, scrollTo: scrollTo}
    }

    $.fn[pluginName] = function (options) {
        if (typeof arguments[0] === "string") {
            var methodName = arguments[0];
            var args = Array.prototype.slice.call(arguments, 1);
            var returnVal;
            this.each(function () {
                if ($.data(this, "plugin_" + pluginName) && typeof $.data(this, "plugin_" + pluginName)[methodName] === "function") returnVal = $.data(this, "plugin_" + pluginName)[methodName].apply(this, args); else throw new Error("Method " + methodName + " doesn't exist... -> " + pluginName)
            });
            if (returnVal !== undefined)return returnVal; else return this
        } else if (typeof options === "object" || !options) {
            return this.each(function () {
                if (!$.data(this, "plugin_" + pluginName)) $.data(this, "plugin_" + pluginName, new Plugin(this, options))
            })
        }
    };
    $.fn[pluginName].defaults = {
        onInit: function () {
        }, onDestroy: function () {
        }
    }
})(jQuery);
function UUID() {
}
UUID.generate = function () {
    var a = UUID._gri, b = UUID._ha;
    return b(a(32), 8) + "-" + b(a(16), 4) + "-" + b(16384 | a(12), 4) + "-" + b(32768 | a(14), 4) + "-" + b(a(48), 12)
};
UUID._gri = function (a) {
    return 0 > a ? NaN : 30 >= a ? 0 | Math.random() * (1 << a) : 53 >= a ? (0 | 1073741824 * Math.random()) + 1073741824 * (0 | Math.random() * (1 << a - 30)) : NaN
};
UUID._ha = function (a, b) {
    for (var c = a.toString(16), d = b - c.length, e = "0"; 0 < d; d >>>= 1, e += e)d & 1 && (c = e + c);
    return c
};
(function ($, e, b) {
    var c = "hashchange", h = document, f, g = $.event.special, i = h.documentMode, d = "on" + c in e && (i === b || i > 7);

    function a(j) {
        j = j || location.href;
        return "#" + j.replace(/^[^#]*#?(.*)$/, "$1")
    }

    $.fn[c] = function (j) {
        return j ? this.bind(c, j) : this.trigger(c)
    };
    $.fn[c].delay = 50;
    g[c] = $.extend(g[c], {
        setup: function () {
            if (d) {
                return false
            }
            $(f.start)
        }, teardown: function () {
            if (d) {
                return false
            }
            $(f.stop)
        }
    });
    f = function () {
        var j = {}, p, m = a(), k = function (q) {
            return q
        }, l = k, o = k;
        j.start = function () {
            p || n()
        };
        j.stop = function () {
            p && clearTimeout(p);
            p = b
        };
        function n() {
            var r = a(), q = o(m);
            if (r !== m) {
                l(m = r, q);
                $(e).trigger(c)
            } else {
                if (q !== m) {
                    location.href = location.href.replace(/#.*/, "") + q
                }
            }
            p = setTimeout(n, $.fn[c].delay)
        }

        $("html").hasClass("ie") && !d && function () {
            var q, r;
            j.start = function () {
                if (!q) {
                    r = $.fn[c].src;
                    r = r && r + a();
                    q = $('<iframe tabindex="-1" title="empty"/>').hide().one("load", function () {
                        r || l(a());
                        n()
                    }).attr("src", r || "javascript:0").insertAfter("body")[0].contentWindow;
                    h.onpropertychange = function () {
                        try {
                            if (event.propertyName === "title") {
                                q.document.title = h.title
                            }
                        } catch (s) {
                        }
                    }
                }
            };
            j.stop = k;
            o = function () {
                return a(q.location.href)
            };
            l = function (v, s) {
                var u = q.document, t = $.fn[c].domain;
                if (v !== s) {
                    u.title = h.title;
                    u.open();
                    t && u.write('<script>document.domain="' + t + '"</script>');
                    u.close();
                    q.location.hash = v
                }
            }
        }();
        return j
    }()
})(jQuery, this);
var FlashDetect = new function () {
    var self = this;
    self.installed = false;
    self.raw = "";
    self.major = -1;
    self.minor = -1;
    self.revision = -1;
    self.revisionStr = "";
    var activeXDetectRules = [{
        name: "ShockwaveFlash.ShockwaveFlash.7", version: function (obj) {
            return getActiveXVersion(obj)
        }
    }, {
        name: "ShockwaveFlash.ShockwaveFlash.6", version: function (obj) {
            var version = "6,0,21";
            try {
                obj.AllowScriptAccess = "always";
                version = getActiveXVersion(obj)
            } catch (err) {
            }
            return version
        }
    }, {
        name: "ShockwaveFlash.ShockwaveFlash", version: function (obj) {
            return getActiveXVersion(obj)
        }
    }];
    var getActiveXVersion = function (activeXObj) {
        var version = -1;
        try {
            version = activeXObj.GetVariable("$version")
        } catch (err) {
        }
        return version
    };
    var getActiveXObject = function (name) {
        var obj = -1;
        try {
            obj = new ActiveXObject(name)
        } catch (err) {
            obj = {activeXError: true}
        }
        return obj
    };
    var parseActiveXVersion = function (str) {
        var versionArray = str.split(",");
        return {
            raw: str,
            major: parseInt(versionArray[0].split(" ")[1], 10),
            minor: parseInt(versionArray[1], 10),
            revision: parseInt(versionArray[2], 10),
            revisionStr: versionArray[2]
        }
    };
    var parseStandardVersion = function (str) {
        var descParts = str.split(/ +/);
        var majorMinor = descParts[2].split(/\./);
        var revisionStr = descParts[3];
        return {
            raw: str,
            major: parseInt(majorMinor[0], 10),
            minor: parseInt(majorMinor[1], 10),
            revisionStr: revisionStr,
            revision: parseRevisionStrToInt(revisionStr)
        }
    };
    var parseRevisionStrToInt = function (str) {
        return parseInt(str.replace(/[a-zA-Z]/g, ""), 10) || self.revision
    };
    self.majorAtLeast = function (version) {
        return self.major >= version
    };
    self.minorAtLeast = function (version) {
        return self.minor >= version
    };
    self.revisionAtLeast = function (version) {
        return self.revision >= version
    };
    self.versionAtLeast = function (major) {
        var properties = [self.major, self.minor, self.revision];
        var len = Math.min(properties.length, arguments.length);
        for (i = 0; i < len; i++) {
            if (properties[i] >= arguments[i]) {
                if (i + 1 < len && properties[i] == arguments[i]) {
                    continue
                } else {
                    return true
                }
            } else {
                return false
            }
        }
    };
    self.FlashDetect = function () {
        if (navigator.plugins && navigator.plugins.length > 0) {
            var type = "application/x-shockwave-flash";
            var mimeTypes = navigator.mimeTypes;
            if (mimeTypes && mimeTypes[type] && mimeTypes[type].enabledPlugin && mimeTypes[type].enabledPlugin.description) {
                var version = mimeTypes[type].enabledPlugin.description;
                var versionObj = parseStandardVersion(version);
                self.raw = versionObj.raw;
                self.major = versionObj.major;
                self.minor = versionObj.minor;
                self.revisionStr = versionObj.revisionStr;
                self.revision = versionObj.revision;
                self.installed = true
            }
        } else if (navigator.appVersion.indexOf("Mac") == -1 && window.execScript) {
            var version = -1;
            for (var i = 0; i < activeXDetectRules.length && version == -1; i++) {
                var obj = getActiveXObject(activeXDetectRules[i].name);
                if (!obj.activeXError) {
                    self.installed = true;
                    version = activeXDetectRules[i].version(obj);
                    if (version != -1) {
                        var versionObj = parseActiveXVersion(version);
                        self.raw = versionObj.raw;
                        self.major = versionObj.major;
                        self.minor = versionObj.minor;
                        self.revision = versionObj.revision;
                        self.revisionStr = versionObj.revisionStr
                    }
                }
            }
        }
    }()
};
FlashDetect.JS_RELEASE = "1.0.4";
typeof JSON != "object" && (JSON = {}), function () {
    "use strict";
    function f(e) {
        return e < 10 ? "0" + e : e
    }

    function quote(e) {
        return escapable.lastIndex = 0, escapable.test(e) ? '"' + e.replace(escapable, function (e) {
            var t = meta[e];
            return typeof t == "string" ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        }) + '"' : '"' + e + '"'
    }

    function str(e, t) {
        var n, r, i, s, o = gap, u, a = t[e];
        a && typeof a == "object" && typeof a.toJSON == "function" && (a = a.toJSON(e)), typeof rep == "function" && (a = rep.call(t, e, a));
        switch (typeof a) {
            case"string":
                return quote(a);
            case"number":
                return isFinite(a) ? String(a) : "null";
            case"boolean":
            case"null":
                return String(a);
            case"object":
                if (!a)return "null";
                gap += indent, u = [];
                if (Object.prototype.toString.apply(a) === "[object Array]") {
                    s = a.length;
                    for (n = 0; n < s; n += 1)u[n] = str(n, a) || "null";
                    return i = u.length === 0 ? "[]" : gap ? "[\n" + gap + u.join(",\n" + gap) + "\n" + o + "]" : "[" + u.join(",") + "]", gap = o, i
                }
                if (rep && typeof rep == "object") {
                    s = rep.length;
                    for (n = 0; n < s; n += 1)typeof rep[n] == "string" && (r = rep[n], i = str(r, a), i && u.push(quote(r) + (gap ? ": " : ":") + i))
                } else for (r in a)Object.prototype.hasOwnProperty.call(a, r) && (i = str(r, a), i && u.push(quote(r) + (gap ? ": " : ":") + i));
                return i = u.length === 0 ? "{}" : gap ? "{\n" + gap + u.join(",\n" + gap) + "\n" + o + "}" : "{" + u.join(",") + "}", gap = o, i
        }
    }

    typeof Date.prototype.toJSON != "function" && (Date.prototype.toJSON = function (e) {
        return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null;
    }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function (e) {
        return this.valueOf()
    });
    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, gap, indent, meta = {
        "\b": "\\b",
        "	": "\\t",
        "\n": "\\n",
        "\f": "\\f",
        "\r": "\\r",
        '"': '\\"',
        "\\": "\\\\"
    }, rep;
    typeof JSON.stringify != "function" && (JSON.stringify = function (e, t, n) {
        var r;
        gap = "", indent = "";
        if (typeof n == "number")for (r = 0; r < n; r += 1)indent += " "; else typeof n == "string" && (indent = n);
        rep = t;
        if (!t || typeof t == "function" || typeof t == "object" && typeof t.length == "number")return str("", {"": e});
        throw new Error("JSON.stringify")
    }), typeof JSON.parse != "function" && (JSON.parse = function (text, reviver) {
        function walk(e, t) {
            var n, r, i = e[t];
            if (i && typeof i == "object")for (n in i)Object.prototype.hasOwnProperty.call(i, n) && (r = walk(i, n), r !== undefined ? i[n] = r : delete i[n]);
            return reviver.call(e, t, i)
        }

        var j;
        text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function (e) {
            return "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        }));
        if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, "")))return j = eval("(" + text + ")"), typeof reviver == "function" ? walk({"": j}, "") : j;
        throw new SyntaxError("JSON.parse")
    })
}(), function (e, t) {
    "use strict";
    var n = e.History = e.History || {}, r = e.jQuery;
    if (typeof n.Adapter != "undefined")throw new Error("History.js Adapter has already been loaded...");
    n.Adapter = {
        bind: function (e, t, n) {
            r(e).bind(t, n)
        }, trigger: function (e, t, n) {
            r(e).trigger(t, n)
        }, extractEventData: function (e, n, r) {
            var i = n && n.originalEvent && n.originalEvent[e] || r && r[e] || t;
            return i
        }, onDomLoad: function (e) {
            r(e)
        }
    }, typeof n.init != "undefined" && n.init()
}(window), function (e, t) {
    "use strict";
    var n = e.document, r = e.setTimeout || r, i = e.clearTimeout || i, s = e.setInterval || s, o = e.History = e.History || {};
    if (typeof o.initHtml4 != "undefined")throw new Error("History.js HTML4 Support has already been loaded...");
    o.initHtml4 = function () {
        if (typeof o.initHtml4.initialized != "undefined")return !1;
        o.initHtml4.initialized = !0, o.enabled = !0, o.savedHashes = [], o.isLastHash = function (e) {
            var t = o.getHashByIndex(), n;
            return n = e === t, n
        }, o.isHashEqual = function (e, t) {
            return e = encodeURIComponent(e).replace(/%25/g, "%"), t = encodeURIComponent(t).replace(/%25/g, "%"), e === t
        }, o.saveHash = function (e) {
            return o.isLastHash(e) ? !1 : (o.savedHashes.push(e), !0)
        }, o.getHashByIndex = function (e) {
            var t = null;
            return typeof e == "undefined" ? t = o.savedHashes[o.savedHashes.length - 1] : e < 0 ? t = o.savedHashes[o.savedHashes.length + e] : t = o.savedHashes[e], t
        }, o.discardedHashes = {}, o.discardedStates = {}, o.discardState = function (e, t, n) {
            var r = o.getHashByState(e), i;
            return i = {discardedState: e, backState: n, forwardState: t}, o.discardedStates[r] = i, !0
        }, o.discardHash = function (e, t, n) {
            var r = {discardedHash: e, backState: n, forwardState: t};
            return o.discardedHashes[e] = r, !0
        }, o.discardedState = function (e) {
            var t = o.getHashByState(e), n;
            return n = o.discardedStates[t] || !1, n
        }, o.discardedHash = function (e) {
            var t = o.discardedHashes[e] || !1;
            return t
        }, o.recycleState = function (e) {
            var t = o.getHashByState(e);
            return o.discardedState(e) && delete o.discardedStates[t], !0
        }, o.emulated.hashChange && (o.hashChangeInit = function () {
            o.checkerFunction = null;
            var t = "", r, i, u, a, f = Boolean(o.getHash());
            return o.isInternetExplorer() ? (r = "historyjs-iframe", i = n.createElement("iframe"), i.setAttribute("id", r), i.setAttribute("src", "#"), i.style.display = "none", n.body.appendChild(i), i.contentWindow.document.open(), i.contentWindow.document.close(), u = "", a = !1, o.checkerFunction = function () {
                if (a)return !1;
                a = !0;
                var n = o.getHash(), r = o.getHash(i.contentWindow.document);
                return n !== t ? (t = n, r !== n && (u = r = n, i.contentWindow.document.open(), i.contentWindow.document.close(), i.contentWindow.document.location.hash = o.escapeHash(n)), o.Adapter.trigger(e, "hashchange")) : r !== u && (u = r, f && r === "" ? o.back() : o.setHash(r, !1)), a = !1, !0
            }) : o.checkerFunction = function () {
                var n = o.getHash() || "";
                return n !== t && (t = n, o.Adapter.trigger(e, "hashchange")), !0
            }, o.intervalList.push(s(o.checkerFunction, o.options.hashChangeInterval)), !0
        }, o.Adapter.onDomLoad(o.hashChangeInit)), o.emulated.pushState && (o.onHashChange = function (t) {
            var n = t && t.newURL || o.getLocationHref(), r = o.getHashByUrl(n), i = null, s = null, u = null, a;
            return o.isLastHash(r) ? (o.busy(!1), !1) : (o.doubleCheckComplete(), o.saveHash(r), r && o.isTraditionalAnchor(r) ? (o.Adapter.trigger(e, "anchorchange"), o.busy(!1), !1) : (i = o.extractState(o.getFullUrl(r || o.getLocationHref()), !0), o.isLastSavedState(i) ? (o.busy(!1), !1) : (s = o.getHashByState(i), a = o.discardedState(i), a ? (o.getHashByIndex(-2) === o.getHashByState(a.forwardState) ? o.back(!1) : o.forward(!1), !1) : (o.pushState(i.data, i.title, encodeURI(i.url), !1), !0))))
        }, o.Adapter.bind(e, "hashchange", o.onHashChange), o.pushState = function (t, n, r, i) {
            r = encodeURI(r).replace(/%25/g, "%");
            if (o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
            if (i !== !1 && o.busy())return o.pushQueue({
                scope: o,
                callback: o.pushState,
                args: arguments,
                queue: i
            }), !1;
            o.busy(!0);
            var s = o.createStateObject(t, n, r), u = o.getHashByState(s), a = o.getState(!1), f = o.getHashByState(a), l = o.getHash(), c = o.expectedStateId == s.id;
            return o.storeState(s), o.expectedStateId = s.id, o.recycleState(s), o.setTitle(s), u === f ? (o.busy(!1), !1) : (o.saveState(s), c || o.Adapter.trigger(e, "statechange"), !o.isHashEqual(u, l) && !o.isHashEqual(u, o.getShortUrl(o.getLocationHref())) && o.setHash(u, !1), o.busy(!1), !0)
        }, o.replaceState = function (t, n, r, i) {
            r = encodeURI(r).replace(/%25/g, "%");
            if (o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
            if (i !== !1 && o.busy())return o.pushQueue({
                scope: o,
                callback: o.replaceState,
                args: arguments,
                queue: i
            }), !1;
            o.busy(!0);
            var s = o.createStateObject(t, n, r), u = o.getHashByState(s), a = o.getState(!1), f = o.getHashByState(a), l = o.getStateByIndex(-2);
            return o.discardState(a, s, l), u === f ? (o.storeState(s), o.expectedStateId = s.id, o.recycleState(s), o.setTitle(s), o.saveState(s), o.Adapter.trigger(e, "statechange"), o.busy(!1)) : o.pushState(s.data, s.title, s.url, !1), !0
        }), o.emulated.pushState && o.getHash() && !o.emulated.hashChange && o.Adapter.onDomLoad(function () {
            o.Adapter.trigger(e, "hashchange")
        })
    }, typeof o.init != "undefined" && o.init()
}(window), function (e, t) {
    "use strict";
    var n = e.console || t, r = e.document, i = e.navigator, s = e.sessionStorage || !1, o = e.setTimeout, u = e.clearTimeout, a = e.setInterval, f = e.clearInterval, l = e.JSON, c = e.alert, h = e.History = e.History || {}, p = e.history;
    try {
        s.setItem("TEST", "1"), s.removeItem("TEST")
    } catch (d) {
        s = !1
    }
    l.stringify = l.stringify || l.encode, l.parse = l.parse || l.decode;
    if (typeof h.init != "undefined")throw new Error("History.js Core has already been loaded...");
    h.init = function (e) {
        return typeof h.Adapter == "undefined" ? !1 : (typeof h.initCore != "undefined" && h.initCore(), typeof h.initHtml4 != "undefined" && h.initHtml4(), !0)
    }, h.initCore = function (d) {
        if (typeof h.initCore.initialized != "undefined")return !1;
        h.initCore.initialized = !0, h.options = h.options || {}, h.options.hashChangeInterval = h.options.hashChangeInterval || 100, h.options.safariPollInterval = h.options.safariPollInterval || 500, h.options.doubleCheckInterval = h.options.doubleCheckInterval || 500, h.options.disableSuid = h.options.disableSuid || !1, h.options.storeInterval = h.options.storeInterval || 1e3, h.options.busyDelay = h.options.busyDelay || 250, h.options.debug = h.options.debug || !1, h.options.initialTitle = h.options.initialTitle || r.title, h.options.html4Mode = h.options.html4Mode || !1, h.options.delayInit = h.options.delayInit || !1, h.intervalList = [], h.clearAllIntervals = function () {
            var e, t = h.intervalList;
            if (typeof t != "undefined" && t !== null) {
                for (e = 0; e < t.length; e++)f(t[e]);
                h.intervalList = null
            }
        }, h.debug = function () {
            (h.options.debug || !1) && h.log.apply(h, arguments)
        }, h.log = function () {
            var e = typeof n != "undefined" && typeof n.log != "undefined" && typeof n.log.apply != "undefined", t = r.getElementById("log"), i, s, o, u, a;
            e ? (u = Array.prototype.slice.call(arguments), i = u.shift(), typeof n.debug != "undefined" ? n.debug.apply(n, [i, u]) : n.log.apply(n, [i, u])) : i = "\n" + arguments[0] + "\n";
            for (s = 1, o = arguments.length; s < o; ++s) {
                a = arguments[s];
                if (typeof a == "object" && typeof l != "undefined")try {
                    a = l.stringify(a)
                } catch (f) {
                }
                i += "\n" + a + "\n"
            }
            return t ? (t.value += i + "\n-----\n", t.scrollTop = t.scrollHeight - t.clientHeight) : e || c(i), !0
        }, h.getInternetExplorerMajorVersion = function () {
            var e = h.getInternetExplorerMajorVersion.cached = typeof h.getInternetExplorerMajorVersion.cached != "undefined" ? h.getInternetExplorerMajorVersion.cached : function () {
                var e = 3, t = r.createElement("div"), n = t.getElementsByTagName("i");
                while ((t.innerHTML = "<!--[if gt IE " + ++e + "]><i></i><![endif]-->") && n[0]);
                return e > 4 ? e : !1
            }();
            return e
        }, h.isInternetExplorer = function () {
            var e = h.isInternetExplorer.cached = typeof h.isInternetExplorer.cached != "undefined" ? h.isInternetExplorer.cached : Boolean(h.getInternetExplorerMajorVersion());
            return e
        }, h.options.html4Mode ? h.emulated = {
            pushState: !0,
            hashChange: !0
        } : h.emulated = {
            pushState: !Boolean(e.history && e.history.pushState && e.history.replaceState && !/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent) && !/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),
            hashChange: Boolean(!("onhashchange" in e || "onhashchange" in r) || h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 8)
        }, h.enabled = !h.emulated.pushState, h.bugs = {
            setHash: Boolean(!h.emulated.pushState && i.vendor === "Apple Computer, Inc." && /AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),
            safariPoll: Boolean(!h.emulated.pushState && i.vendor === "Apple Computer, Inc." && /AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),
            ieDoubleCheck: Boolean(h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 8),
            hashEscape: Boolean(h.isInternetExplorer() && h.getInternetExplorerMajorVersion() < 7)
        }, h.isEmptyObject = function (e) {
            for (var t in e)if (e.hasOwnProperty(t))return !1;
            return !0
        }, h.cloneObject = function (e) {
            var t, n;
            return e ? (t = l.stringify(e), n = l.parse(t)) : n = {}, n
        }, h.getRootUrl = function () {
            var e = r.location.protocol + "//" + (r.location.hostname || r.location.host);
            if (r.location.port || !1) e += ":" + r.location.port;
            return e += "/", e
        }, h.getBaseHref = function () {
            var e = r.getElementsByTagName("base"), t = null, n = "";
            return e.length === 1 && (t = e[0], n = t.href.replace(/[^\/]+$/, "")), n = n.replace(/\/+$/, ""), n && (n += "/"), n
        }, h.getBaseUrl = function () {
            var e = h.getBaseHref() || h.getBasePageUrl() || h.getRootUrl();
            return e
        }, h.getPageUrl = function () {
            var e = h.getState(!1, !1), t = (e || {}).url || h.getLocationHref(), n;
            return n = t.replace(/\/+$/, "").replace(/[^\/]+$/, function (e, t, n) {
                return /\./.test(e) ? e : e + "/"
            }), n
        }, h.getBasePageUrl = function () {
            var e = h.getLocationHref().replace(/[#\?].*/, "").replace(/[^\/]+$/, function (e, t, n) {
                    return /[^\/]$/.test(e) ? "" : e
                }).replace(/\/+$/, "") + "/";
            return e
        }, h.getFullUrl = function (e, t) {
            var n = e, r = e.substring(0, 1);
            return t = typeof t == "undefined" ? !0 : t, /[a-z]+\:\/\//.test(e) || (r === "/" ? n = h.getRootUrl() + e.replace(/^\/+/, "") : r === "#" ? n = h.getPageUrl().replace(/#.*/, "") + e : r === "?" ? n = h.getPageUrl().replace(/[\?#].*/, "") + e : t ? n = h.getBaseUrl() + e.replace(/^(\.\/)+/, "") : n = h.getBasePageUrl() + e.replace(/^(\.\/)+/, "")), n.replace(/\#$/, "")
        }, h.getShortUrl = function (e) {
            var t = e, n = h.getBaseUrl(), r = h.getRootUrl();
            return h.emulated.pushState && (t = t.replace(n, "")), t = t.replace(r, "/"), h.isTraditionalAnchor(t) && (t = "./" + t), t = t.replace(/^(\.\/)+/g, "./").replace(/\#$/, ""), t
        }, h.getLocationHref = function (e) {
            return e = e || r, e.URL === e.location.href ? e.location.href : e.location.href === decodeURIComponent(e.URL) ? e.URL : e.location.hash && decodeURIComponent(e.location.href.replace(/^[^#]+/, "")) === e.location.hash ? e.location.href : e.URL.indexOf("#") == -1 && e.location.href.indexOf("#") != -1 ? e.location.href : e.URL || e.location.href
        }, h.store = {}, h.idToState = h.idToState || {}, h.stateToId = h.stateToId || {}, h.urlToId = h.urlToId || {}, h.storedStates = h.storedStates || [], h.savedStates = h.savedStates || [], h.normalizeStore = function () {
            h.store.idToState = h.store.idToState || {}, h.store.urlToId = h.store.urlToId || {}, h.store.stateToId = h.store.stateToId || {}
        }, h.getState = function (e, t) {
            typeof e == "undefined" && (e = !0), typeof t == "undefined" && (t = !0);
            var n = h.getLastSavedState();
            return !n && t && (n = h.createStateObject()), e && (n = h.cloneObject(n), n.url = n.cleanUrl || n.url), n
        }, h.getIdByState = function (e) {
            var t = h.extractId(e.url), n;
            if (!t) {
                n = h.getStateString(e);
                if (typeof h.stateToId[n] != "undefined") t = h.stateToId[n]; else if (typeof h.store.stateToId[n] != "undefined") t = h.store.stateToId[n]; else {
                    for (; ;) {
                        t = (new Date).getTime() + String(Math.random()).replace(/\D/g, "");
                        if (typeof h.idToState[t] == "undefined" && typeof h.store.idToState[t] == "undefined")break
                    }
                    h.stateToId[n] = t, h.idToState[t] = e
                }
            }
            return t
        }, h.normalizeState = function (e) {
            var t, n;
            if (!e || typeof e != "object") e = {};
            if (typeof e.normalized != "undefined")return e;
            if (!e.data || typeof e.data != "object") e.data = {};
            return t = {}, t.normalized = !0, t.title = e.title || "", t.url = h.getFullUrl(e.url ? e.url : h.getLocationHref()), t.hash = h.getShortUrl(t.url), t.data = h.cloneObject(e.data), t.id = h.getIdByState(t), t.cleanUrl = t.url.replace(/\??\&_suid.*/, ""), t.url = t.cleanUrl, n = !h.isEmptyObject(t.data), (t.title || n) && h.options.disableSuid !== !0 && (t.hash = h.getShortUrl(t.url).replace(/\??\&_suid.*/, ""), /\?/.test(t.hash) || (t.hash += "?"), t.hash += "&_suid=" + t.id), t.hashedUrl = h.getFullUrl(t.hash), (h.emulated.pushState || h.bugs.safariPoll) && h.hasUrlDuplicate(t) && (t.url = t.hashedUrl), t
        }, h.createStateObject = function (e, t, n) {
            var r = {data: e, title: t, url: n};
            return r = h.normalizeState(r), r
        }, h.getStateById = function (e) {
            e = String(e);
            var n = h.idToState[e] || h.store.idToState[e] || t;
            return n
        }, h.getStateString = function (e) {
            var t, n, r;
            return t = h.normalizeState(e), n = {data: t.data, title: e.title, url: e.url}, r = l.stringify(n), r
        }, h.getStateId = function (e) {
            var t, n;
            return t = h.normalizeState(e), n = t.id, n
        }, h.getHashByState = function (e) {
            var t, n;
            return t = h.normalizeState(e), n = t.hash, n
        }, h.extractId = function (e) {
            var t, n, r, i;
            return e.indexOf("#") != -1 ? i = e.split("#")[0] : i = e, n = /(.*)\&_suid=([0-9]+)$/.exec(i), r = n ? n[1] || e : e, t = n ? String(n[2] || "") : "", t || !1
        }, h.isTraditionalAnchor = function (e) {
            var t = !/[\/\?\.]/.test(e);
            return t
        }, h.extractState = function (e, t) {
            var n = null, r, i;
            return t = t || !1, r = h.extractId(e), r && (n = h.getStateById(r)), n || (i = h.getFullUrl(e), r = h.getIdByUrl(i) || !1, r && (n = h.getStateById(r)), !n && t && !h.isTraditionalAnchor(e) && (n = h.createStateObject(null, null, i))), n
        }, h.getIdByUrl = function (e) {
            var n = h.urlToId[e] || h.store.urlToId[e] || t;
            return n
        }, h.getLastSavedState = function () {
            return h.savedStates[h.savedStates.length - 1] || t
        }, h.getLastStoredState = function () {
            return h.storedStates[h.storedStates.length - 1] || t
        }, h.hasUrlDuplicate = function (e) {
            var t = !1, n;
            return n = h.extractState(e.url), t = n && n.id !== e.id, t
        }, h.storeState = function (e) {
            return h.urlToId[e.url] = e.id, h.storedStates.push(h.cloneObject(e)), e
        }, h.isLastSavedState = function (e) {
            var t = !1, n, r, i;
            return h.savedStates.length && (n = e.id, r = h.getLastSavedState(), i = r.id, t = n === i), t
        }, h.saveState = function (e) {
            return h.isLastSavedState(e) ? !1 : (h.savedStates.push(h.cloneObject(e)), !0)
        }, h.getStateByIndex = function (e) {
            var t = null;
            return typeof e == "undefined" ? t = h.savedStates[h.savedStates.length - 1] : e < 0 ? t = h.savedStates[h.savedStates.length + e] : t = h.savedStates[e], t
        }, h.getCurrentIndex = function () {
            var e = null;
            return h.savedStates.length < 1 ? e = 0 : e = h.savedStates.length - 1, e
        }, h.getHash = function (e) {
            var t = h.getLocationHref(e), n;
            return n = h.getHashByUrl(t), n
        }, h.unescapeHash = function (e) {
            var t = h.normalizeHash(e);
            return t = decodeURIComponent(t), t
        }, h.normalizeHash = function (e) {
            var t = e.replace(/[^#]*#/, "").replace(/#.*/, "");
            return t
        }, h.setHash = function (e, t) {
            var n, i;
            return t !== !1 && h.busy() ? (h.pushQueue({
                scope: h,
                callback: h.setHash,
                args: arguments,
                queue: t
            }), !1) : (h.busy(!0), n = h.extractState(e, !0), n && !h.emulated.pushState ? h.pushState(n.data, n.title, n.url, !1) : h.getHash() !== e && (h.bugs.setHash ? (i = h.getPageUrl(), h.pushState(null, null, i + "#" + e, !1)) : r.location.hash = e), h)
        }, h.escapeHash = function (t) {
            var n = h.normalizeHash(t);
            return n = e.encodeURIComponent(n), h.bugs.hashEscape || (n = n.replace(/\%21/g, "!").replace(/\%26/g, "&").replace(/\%3D/g, "=").replace(/\%3F/g, "?")), n
        }, h.getHashByUrl = function (e) {
            var t = String(e).replace(/([^#]*)#?([^#]*)#?(.*)/, "$2");
            return t = h.unescapeHash(t), t
        }, h.setTitle = function (e) {
            var t = e.title, n;
            t || (n = h.getStateByIndex(0), n && n.url === e.url && (t = n.title || h.options.initialTitle));
            try {
                r.getElementsByTagName("title")[0].innerHTML = t.replace("<", "&lt;").replace(">", "&gt;").replace(" & ", " &amp; ")
            } catch (i) {
            }
            return r.title = t, h
        }, h.queues = [], h.busy = function (e) {
            typeof e != "undefined" ? h.busy.flag = e : typeof h.busy.flag == "undefined" && (h.busy.flag = !1);
            if (!h.busy.flag) {
                u(h.busy.timeout);
                var t = function () {
                    var e, n, r;
                    if (h.busy.flag)return;
                    for (e = h.queues.length - 1; e >= 0; --e) {
                        n = h.queues[e];
                        if (n.length === 0)continue;
                        r = n.shift(), h.fireQueueItem(r), h.busy.timeout = o(t, h.options.busyDelay)
                    }
                };
                h.busy.timeout = o(t, h.options.busyDelay)
            }
            return h.busy.flag
        }, h.busy.flag = !1, h.fireQueueItem = function (e) {
            return e.callback.apply(e.scope || h, e.args || [])
        }, h.pushQueue = function (e) {
            return h.queues[e.queue || 0] = h.queues[e.queue || 0] || [], h.queues[e.queue || 0].push(e), h
        }, h.queue = function (e, t) {
            return typeof e == "function" && (e = {callback: e}), typeof t != "undefined" && (e.queue = t), h.busy() ? h.pushQueue(e) : h.fireQueueItem(e), h
        }, h.clearQueue = function () {
            return h.busy.flag = !1, h.queues = [], h
        }, h.stateChanged = !1, h.doubleChecker = !1, h.doubleCheckComplete = function () {
            return h.stateChanged = !0, h.doubleCheckClear(), h
        }, h.doubleCheckClear = function () {
            return h.doubleChecker && (u(h.doubleChecker), h.doubleChecker = !1), h
        }, h.doubleCheck = function (e) {
            return h.stateChanged = !1, h.doubleCheckClear(), h.bugs.ieDoubleCheck && (h.doubleChecker = o(function () {
                return h.doubleCheckClear(), h.stateChanged || e(), !0
            }, h.options.doubleCheckInterval)), h
        }, h.safariStatePoll = function () {
            var t = h.extractState(h.getLocationHref()), n;
            if (!h.isLastSavedState(t))return n = t, n || (n = h.createStateObject()), h.Adapter.trigger(e, "popstate"), h;
            return
        }, h.back = function (e) {
            return e !== !1 && h.busy() ? (h.pushQueue({
                scope: h,
                callback: h.back,
                args: arguments,
                queue: e
            }), !1) : (h.busy(!0), h.doubleCheck(function () {
                h.back(!1)
            }), p.go(-1), !0)
        }, h.forward = function (e) {
            return e !== !1 && h.busy() ? (h.pushQueue({
                scope: h,
                callback: h.forward,
                args: arguments,
                queue: e
            }), !1) : (h.busy(!0), h.doubleCheck(function () {
                h.forward(!1)
            }), p.go(1), !0)
        }, h.go = function (e, t) {
            var n;
            if (e > 0)for (n = 1; n <= e; ++n)h.forward(t); else {
                if (!(e < 0))throw new Error("History.go: History.go requires a positive or negative integer passed.");
                for (n = -1; n >= e; --n)h.back(t)
            }
            return h
        };
        if (h.emulated.pushState) {
            var v = function () {
            };
            h.pushState = h.pushState || v, h.replaceState = h.replaceState || v
        } else h.onPopState = function (t, n) {
            var r = !1, i = !1, s, o;
            return h.doubleCheckComplete(), s = h.getHash(), s ? (o = h.extractState(s || h.getLocationHref(), !0), o ? h.replaceState(o.data, o.title, o.url, !1) : (h.Adapter.trigger(e, "anchorchange"), h.busy(!1)), h.expectedStateId = !1, !1) : (r = h.Adapter.extractEventData("state", t, n) || !1, r ? i = h.getStateById(r) : h.expectedStateId ? i = h.getStateById(h.expectedStateId) : i = h.extractState(h.getLocationHref()), i || (i = h.createStateObject(null, null, h.getLocationHref())), h.expectedStateId = !1, h.isLastSavedState(i) ? (h.busy(!1), !1) : (h.storeState(i), h.saveState(i), h.setTitle(i), h.Adapter.trigger(e, "statechange"), h.busy(!1), !0))
        }, h.Adapter.bind(e, "popstate", h.onPopState), h.pushState = function (t, n, r, i) {
            if (h.getHashByUrl(r) && h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
            if (i !== !1 && h.busy())return h.pushQueue({
                scope: h,
                callback: h.pushState,
                args: arguments,
                queue: i
            }), !1;
            h.busy(!0);
            var s = h.createStateObject(t, n, r);
            return h.isLastSavedState(s) ? h.busy(!1) : (h.storeState(s), h.expectedStateId = s.id, p.pushState(s.id, s.title, s.url), h.Adapter.trigger(e, "popstate")), !0
        }, h.replaceState = function (t, n, r, i) {
            if (h.getHashByUrl(r) && h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
            if (i !== !1 && h.busy())return h.pushQueue({
                scope: h,
                callback: h.replaceState,
                args: arguments,
                queue: i
            }), !1;
            h.busy(!0);
            var s = h.createStateObject(t, n, r);
            return h.isLastSavedState(s) ? h.busy(!1) : (h.storeState(s), h.expectedStateId = s.id, p.replaceState(s.id, s.title, s.url), h.Adapter.trigger(e, "popstate")), !0
        };
        if (s) {
            try {
                h.store = l.parse(s.getItem("History.store")) || {}
            } catch (m) {
                h.store = {}
            }
            h.normalizeStore()
        } else h.store = {}, h.normalizeStore();
        h.Adapter.bind(e, "unload", h.clearAllIntervals), h.saveState(h.storeState(h.extractState(h.getLocationHref(), !0))), s && (h.onUnload = function () {
            var e, t, n;
            try {
                e = l.parse(s.getItem("History.store")) || {}
            } catch (r) {
                e = {}
            }
            e.idToState = e.idToState || {}, e.urlToId = e.urlToId || {}, e.stateToId = e.stateToId || {};
            for (t in h.idToState) {
                if (!h.idToState.hasOwnProperty(t))continue;
                e.idToState[t] = h.idToState[t]
            }
            for (t in h.urlToId) {
                if (!h.urlToId.hasOwnProperty(t))continue;
                e.urlToId[t] = h.urlToId[t]
            }
            for (t in h.stateToId) {
                if (!h.stateToId.hasOwnProperty(t))continue;
                e.stateToId[t] = h.stateToId[t]
            }
            h.store = e, h.normalizeStore(), n = l.stringify(e);
            try {
                s.setItem("History.store", n)
            } catch (i) {
                if (i.code !== DOMException.QUOTA_EXCEEDED_ERR)throw i;
                s.length && (s.removeItem("History.store"), s.setItem("History.store", n))
            }
        }, h.intervalList.push(a(h.onUnload, h.options.storeInterval)), h.Adapter.bind(e, "beforeunload", h.onUnload), h.Adapter.bind(e, "unload", h.onUnload));
        if (!h.emulated.pushState) {
            h.bugs.safariPoll && h.intervalList.push(a(h.safariStatePoll, h.options.safariPollInterval));
            if (i.vendor === "Apple Computer, Inc." || (i.appCodeName || "") === "Mozilla") h.Adapter.bind(e, "hashchange", function () {
                h.Adapter.trigger(e, "popstate")
            }), h.getHash() && h.Adapter.onDomLoad(function () {
                h.Adapter.trigger(e, "hashchange")
            })
        }
    }, (!h.options || !h.options.delayInit) && h.init()
}(window);
(function ($) {
    var pluginName = "autoComplete";
    $.fn[pluginName] = function (settings) {
        settings = $.extend({highlight: true, rateLimit: 300, selectFirst: true}, settings);
        var KEY = {UP: 38, DOWN: 40, ENTER: 13, ESC: 27};
        return this.each(function () {
            var input = $(this);
            var autoC_wrap, results_wrap;
            var rateManager;
            var ready = true;
            var mouseSelect = false;
            var nextQueued, lastFetched = "";
            var results = [];

            function init() {
                input.wrap('<div class="autoC-wrap" />');
                autoC_wrap = input.closest(".autoC-wrap");
                autoC_wrap.append('<div class="autoC-spinner"></div>');
                var baseState = '	<div class="results drop empty">' + "		<ol></ol>" + '		<div class="help empty">Search for any artist or song. We\'ll create a station featuring similar music. Cool, eh?</div>' + '		<div class="help no-results">No results found...</div>' + "	</div>";
                autoC_wrap.append(baseState);
                results_wrap = autoC_wrap.find(".results");
                input.bind("focus.ac", function () {
                    autoC_wrap.addClass("active")
                });
                input.bind("blur.ac", function () {
                    if (!mouseSelect) blurInput()
                });
                input.bind("keydown.ac", function (k) {
                    switch (k.keyCode) {
                        case KEY.UP:
                            k.preventDefault();
                            selectPrev();
                            break;
                        case KEY.DOWN:
                            k.preventDefault();
                            selectNext();
                            break
                    }
                });
                input.bind("keyup.ac", function (k) {
                    switch (k.keyCode) {
                        case KEY.ENTER:
                            k.preventDefault();
                            doSelected();
                            break;
                        case KEY.ESC:
                            k.preventDefault();
                            input.trigger("blur.ac");
                            break;
                        default:
                            fetch(input.val());
                            break
                    }
                })
            }

            function selectNext() {
                if (results_wrap.find("li.selected").next().length) results_wrap.find("li.selected").removeClass("selected").next().addClass("selected")
            }

            function selectPrev() {
                if (results_wrap.find("li.selected").prev().length) results_wrap.find("li.selected").removeClass("selected").prev().addClass("selected")
            }

            function setReady(bool) {
                ready = bool;
                if (bool) autoC_wrap.removeClass("loading"); else autoC_wrap.addClass("loading")
            }

            function blurInput() {
                autoC_wrap.removeClass("active");
                results_wrap.find("ol").html("");
                results = [];
                showEmptyResults();
                mouseSelect = false;
                if (input.hasClass("autofill")) input.val("").trigger("blur.autofill")
            }

            function showEmptyResults(noResults) {
                if (noResults === undefined)var noResults = false;
                results = [];
                results_wrap.addClass("empty");
                setReady(true);
                if (noResults) results_wrap.addClass("no-results"); else results_wrap.removeClass("no-results")
            }

            function paintResults() {
                if (results.length == 0 || results[0] == "") {
                    showEmptyResults(true);
                    return
                }
                if ($.trim(input.val()) == "") {
                    showEmptyResults();
                    return
                }
                var resultsList = "";
                for (var i = 0; i < results.length; i++) {
                    var str = settings.highlight ? results[i].replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + lastFetched.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi, "\\$1") + ")(?![^<>]*>)(?![^&;]+;)", "gi"), "<strong>$1</strong>") : results[i];
                    resultsList += "<li><a>" + str.toLowerCase() + "</a></li>"
                }
                results_wrap.find("ol").html(resultsList);
                results_wrap.removeClass("empty no-results");
                results_wrap.find("li").each(function () {
                    $(this).hover(function () {
                        results_wrap.find("li").removeClass("selected");
                        $(this).addClass("selected")
                    }, function () {
                    });
                    $(this).bind("mousedown.ac", function () {
                        mouseSelect = true;
                        doSelected()
                    })
                });
                if (settings.selectFirst) results_wrap.find("ol li:first-child").addClass("selected")
            }

            function fetch(query) {
                nextQueued = query;
                if (ready && $.trim(query) != "") {
                    setReady(false);
                    if (lastFetched != nextQueued) {
                        $.ajax({
                            async: true,
                            dataType: "JSON",
                            type: "POST",
                            url: "/api.php?__call=search.getqueries&query=q&_marker=0&q=" + escape(query) + "&limit=10&isRadio=1"
                        }).always(function (response) {
                            results = [];
                            if (!response.responseText || $.trim(response.responseText) == "") {
                                showEmptyResults(true)
                            } else {
                                raw = response.responseText.split("\n");
                                for (var i = 0; i < raw.length; i++) {
                                    if (raw[i]) results.push(raw[i])
                                }
                                paintResults()
                            }
                        });
                        lastFetched = nextQueued;
                        rateManager = setTimeout(function () {
                            setReady(true);
                            fetch(nextQueued)
                        }, settings.rateLimit)
                    } else {
                        setReady(true)
                    }
                }
                if ($.trim(query) == "") showEmptyResults()
            }

            function doSelected() {
                var selected = results_wrap.find("li.selected a").text();
                if (!results_wrap.hasClass("empty")) {
                    Radio.startScratchStation("", selected);
                    blurInput()
                }
            }

            init()
        })
    }
})(jQuery);
if (!$("html").hasClass("ie8")) {
    BOOMR_start = (new Date).getTime();
    (function (w) {
        var impl, boomr, k, d = w.document;
        if (typeof BOOMR === "undefined") {
            BOOMR = {}
        }
        if (BOOMR.version) {
            return
        }
        BOOMR.version = "0.9";
        impl = {
            beacon_url: "",
            site_domain: w.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/, "$1").toLowerCase(),
            user_ip: "",
            events: {page_ready: [], page_unload: [], visibility_changed: [], before_beacon: []},
            vars: {},
            disabled_plugins: {},
            fireEvent: function (e_name, data) {
                var i, h, e;
                if (!this.events.hasOwnProperty(e_name)) {
                    return false
                }
                e = this.events[e_name];
                for (i = 0; i < e.length; i++) {
                    h = e[i];
                    h[0].call(h[2], data, h[1])
                }
                return true
            },
            addListener: function (el, sType, fn) {
                if (el.addEventListener) {
                    el.addEventListener(sType, fn, false)
                } else if (el.attachEvent) {
                    el.attachEvent("on" + sType, fn)
                }
            }
        };
        boomr = {
            t_start: BOOMR_start, t_end: null, utils: {
                getCookie: function (name) {
                    if (!name) {
                        return null
                    }
                    name = " " + name + "=";
                    var i, cookies;
                    cookies = " " + d.cookie + ";";
                    if ((i = cookies.indexOf(name)) >= 0) {
                        i += name.length;
                        cookies = cookies.substring(i, cookies.indexOf(";", i));
                        return cookies
                    }
                    return null
                }, setCookie: function (name, subcookies, max_age, path, domain, sec) {
                    var value = "", k, nameval, c, exp = "";
                    if (!name) {
                        return false
                    }
                    for (k in subcookies) {
                        if (subcookies.hasOwnProperty(k)) {
                            value += "&" + encodeURIComponent(k) + "=" + encodeURIComponent(subcookies[k])
                        }
                    }
                    value = value.replace(/^&/, "");
                    if (max_age) {
                        exp = new Date;
                        exp.setTime(exp.getTime() + max_age * 1e3);
                        exp = exp.toGMTString()
                    }
                    nameval = name + "=" + value;
                    c = nameval + (max_age ? "; expires=" + exp : "") + (path ? "; path=" + path : "") + (typeof domain !== "undefined" ? "; domain=" + (domain !== null ? domain : impl.site_domain) : "") + (sec ? "; secure" : "");
                    if (nameval.length < 4e3) {
                        d.cookie = c;
                        return value === this.getCookie(name)
                    }
                    return false
                }, getSubCookies: function (cookie) {
                    var cookies_a, i, l, kv, cookies = {};
                    if (!cookie) {
                        return null
                    }
                    cookies_a = cookie.split("&");
                    if (cookies_a.length === 0) {
                        return null
                    }
                    for (i = 0, l = cookies_a.length; i < l; i++) {
                        kv = cookies_a[i].split("=");
                        kv.push("");
                        cookies[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1])
                    }
                    return cookies
                }, removeCookie: function (name) {
                    return this.setCookie(name, {}, 0, "/", null)
                }, pluginConfig: function (o, config, plugin_name, properties) {
                    var i, props = 0;
                    if (!config || !config[plugin_name]) {
                        return false
                    }
                    for (i = 0; i < properties.length; i++) {
                        if (typeof config[plugin_name][properties[i]] !== "undefined") {
                            o[properties[i]] = config[plugin_name][properties[i]];
                            props++
                        }
                    }
                    return props > 0
                }
            }, init: function (config) {
                var i, k, properties = ["beacon_url", "site_domain", "user_ip"];
                if (!config) {
                    config = {}
                }
                for (i = 0; i < properties.length; i++) {
                    if (typeof config[properties[i]] !== "undefined") {
                        impl[properties[i]] = config[properties[i]]
                    }
                }
                if (typeof config.log !== "undefined") {
                    this.log = config.log
                }
                if (!this.log) {
                    this.log = function (m, l, s) {
                    }
                }
                for (k in this.plugins) {
                    if (config[k] && "enabled" in config[k] && config[k].enabled === false) {
                        impl.disabled_plugins[k] = 1;
                        continue
                    } else if (impl.disabled_plugins[k]) {
                        delete impl.disabled_plugins[k]
                    }
                    if (this.plugins.hasOwnProperty(k) && typeof this.plugins[k].init === "function") {
                        this.plugins[k].init(config)
                    }
                }
                if (!("autorun" in config) || config.autorun !== false) {
                    impl.addListener(w, "load", function () {
                        impl.fireEvent("page_ready")
                    })
                }
                var fire_visible = function () {
                    impl.fireEvent("visibility_changed")
                };
                if (d.webkitVisibilityState) impl.addListener(d, "webkitvisibilitychange", fire_visible); else if (d.msVisibilityState) impl.addListener(d, "msvisibilitychange", fire_visible); else if (d.visibilityState) impl.addListener(d, "visibilitychange", fire_visible);
                impl.addListener(w, "unload", function () {
                    w = null
                });
                return this
            }, page_ready: function () {
                impl.fireEvent("page_ready");
                return this
            }, subscribe: function (e_name, fn, cb_data, cb_scope) {
                var i, h, e;
                if (!impl.events.hasOwnProperty(e_name)) {
                    return this
                }
                e = impl.events[e_name];
                for (i = 0; i < e.length; i++) {
                    h = e[i];
                    if (h[0] === fn && h[1] === cb_data && h[2] === cb_scope) {
                        return this
                    }
                }
                e.push([fn, cb_data || {}, cb_scope || null]);
                if (e_name === "page_unload") {
                    impl.addListener(w, "unload", function () {
                        if (fn) {
                            fn.call(cb_scope, null, cb_data)
                        }
                        fn = cb_scope = cb_data = null
                    });
                    impl.addListener(w, "beforeunload", function () {
                        if (fn) {
                            fn.call(cb_scope, null, cb_data)
                        }
                        fn = cb_scope = cb_data = null
                    })
                }
                return this
            }, addVar: function (name, value) {
                if (typeof name === "string") {
                    impl.vars[name] = value
                } else if (typeof name === "object") {
                    var o = name, k;
                    for (k in o) {
                        if (o.hasOwnProperty(k)) {
                            impl.vars[k] = o[k]
                        }
                    }
                }
                return this
            }, removeVar: function () {
                var i, params;
                if (!arguments.length) {
                    return this
                }
                if (arguments.length === 1 && Object.prototype.toString.apply(arguments[0]) === "[object Array]") {
                    params = arguments[0]
                } else {
                    params = arguments
                }
                for (i = 0; i < params.length; i++) {
                    if (impl.vars.hasOwnProperty(params[i])) {
                        delete impl.vars[params[i]]
                    }
                }
                return this
            }, sendBeacon: function () {
                var k, url, img, nparams = 0;
                for (k in this.plugins) {
                    if (this.plugins.hasOwnProperty(k)) {
                        if (impl.disabled_plugins[k]) {
                            continue
                        }
                        if (!this.plugins[k].is_complete()) {
                            return this
                        }
                    }
                }
                impl.fireEvent("before_beacon", impl.vars);
                if (!impl.beacon_url) {
                    return this
                }
                url = impl.beacon_url + (impl.beacon_url.indexOf("?") > -1 ? "&" : "?") + "v=" + encodeURIComponent(BOOMR.version) + "&u=" + encodeURIComponent(d.URL.replace(/#.*/, ""));
                for (k in impl.vars) {
                    if (impl.vars.hasOwnProperty(k)) {
                        nparams++;
                        url += "&" + encodeURIComponent(k) + "=" + (impl.vars[k] === undefined || impl.vars[k] === null ? "" : encodeURIComponent(impl.vars[k]))
                    }
                }
                if (nparams) {
                    img = new Image;
                    img.src = url
                }
                return this
            }
        };
        delete BOOMR_start;
        var make_logger = function (l) {
            return function (m, s) {
                this.log(m, l, "boomerang" + (s ? "." + s : ""));
                return this
            }
        };
        boomr.debug = make_logger("debug");
        boomr.info = make_logger("info");
        boomr.warn = make_logger("warn");
        boomr.error = make_logger("error");
        if (w.YAHOO && w.YAHOO.widget && w.YAHOO.widget.Logger) {
            boomr.log = w.YAHOO.log
        } else if (typeof w.Y !== "undefined" && typeof w.Y.log !== "undefined") {
            boomr.log = w.Y.log
        } else if (typeof console !== "undefined" && typeof console.log !== "undefined") {
            boomr.log = function (m, l, s) {
                console.log(s + ": [" + l + "] ", m)
            }
        }
        for (k in boomr) {
            if (boomr.hasOwnProperty(k)) {
                BOOMR[k] = boomr[k]
            }
        }
        BOOMR.plugins = BOOMR.plugins || {}
    })(window);
    (function (w) {
        var d = w.document;
        BOOMR = BOOMR || {};
        BOOMR.plugins = BOOMR.plugins || {};
        var impl = {
            complete: false,
            timers: {},
            cookie: "RT",
            cookie_exp: 600,
            strict_referrer: true,
            navigationType: 0,
            navigationStart: undefined,
            responseStart: undefined,
            start: function () {
                var t_end, t_start = (new Date).getTime();
                if (!this.cookie) {
                    return this
                }
                if (!BOOMR.utils.setCookie(this.cookie, {
                        s: t_start,
                        r: d.URL.replace(/#.*/, "")
                    }, this.cookie_exp, "/", null)) {
                    BOOMR.error("cannot set start cookie", "rt");
                    return this
                }
                t_end = (new Date).getTime();
                if (t_end - t_start > 50) {
                    BOOMR.utils.removeCookie(this.cookie);
                    BOOMR.error("took more than 50ms to set cookie... aborting: " + t_start + " -> " + t_end, "rt")
                }
                return this
            },
            initNavTiming: function () {
                var ti, p, source;
                if (this.navigationStart) {
                    return
                }
                p = w.performance || w.msPerformance || w.webkitPerformance || w.mozPerformance;
                if (p && p.navigation) {
                    this.navigationType = p.navigation.type
                }
                if (p && p.timing) {
                    ti = p.timing
                } else if (w.chrome && w.chrome.csi && w.chrome.csi().startE) {
                    ti = {navigationStart: w.chrome.csi().startE};
                    source = "csi"
                } else if (w.gtbExternal && w.gtbExternal.startE()) {
                    ti = {navigationStart: w.gtbExternal.startE()};
                    source = "gtb"
                }
                if (ti) {
                    BOOMR.addVar("rt.start", source || "navigation");
                    this.navigationStart = ti.navigationStart || undefined;
                    this.responseStart = ti.responseStart || undefined;
                    if (navigator.userAgent.match(/Firefox\/[78]\./)) {
                        this.navigationStart = ti.unloadEventStart || ti.fetchStart || undefined
                    }
                } else {
                    BOOMR.warn("This browser doesn't support the WebTiming API", "rt")
                }
                return
            }
        };
        BOOMR.plugins.RT = {
            init: function (config) {
                impl.complete = false;
                impl.timers = {};
                BOOMR.utils.pluginConfig(impl, config, "RT", ["cookie", "cookie_exp", "strict_referrer"]);
                BOOMR.subscribe("page_ready", this.done, null, this);
                BOOMR.subscribe("page_unload", impl.start, null, impl);
                if (BOOMR.t_start) {
                    this.startTimer("boomerang", BOOMR.t_start);
                    this.endTimer("boomerang", BOOMR.t_end);
                    this.endTimer("boomr_fb", BOOMR.t_start)
                }
                return this
            }, startTimer: function (timer_name, time_value) {
                if (timer_name) {
                    if (timer_name === "t_page") {
                        this.endTimer("t_resp", time_value)
                    }
                    impl.timers[timer_name] = {start: typeof time_value === "number" ? time_value : (new Date).getTime()};
                    impl.complete = false
                }
                return this
            }, endTimer: function (timer_name, time_value) {
                if (timer_name) {
                    impl.timers[timer_name] = impl.timers[timer_name] || {};
                    if (!("end" in impl.timers[timer_name])) {
                        impl.timers[timer_name].end = typeof time_value === "number" ? time_value : (new Date).getTime()
                    }
                }
                return this
            }, setTimer: function (timer_name, time_delta) {
                if (timer_name) {
                    impl.timers[timer_name] = {delta: time_delta}
                }
                return this
            }, done: function () {
                var t_start, r, r2, subcookies, basic_timers = {
                    t_done: 1,
                    t_resp: 1,
                    t_page: 1
                }, ntimers = 0, t_name, timer, t_other = [];
                if (impl.complete) {
                    return this
                }
                impl.initNavTiming();
                if (d.webkitVisibilityState && d.webkitVisibilityState === "prerender" || d.msVisibilityState && d.msVisibilityState === 3) {
                    this.startTimer("t_load", impl.navigationStart);
                    this.endTimer("t_load");
                    this.startTimer("t_prerender", impl.navigationStart);
                    this.startTimer("t_postrender");
                    BOOMR.subscribe("visibility_changed", this.done, null, this);
                    return this
                }
                this.endTimer("t_done");
                if (impl.responseStart) {
                    this.endTimer("t_resp", impl.responseStart);
                    if (impl.timers.t_load) {
                        this.setTimer("t_page", impl.timers.t_load.end - impl.responseStart)
                    } else {
                        this.setTimer("t_page", (new Date).getTime() - impl.responseStart)
                    }
                } else if (impl.timers.hasOwnProperty("t_page")) {
                    this.endTimer("t_page")
                }
                if (impl.timers.hasOwnProperty("t_postrender")) {
                    this.endTimer("t_postrender");
                    this.endTimer("t_prerender")
                }
                r = r2 = d.referrer.replace(/#.*/, "");
                if (impl.cookie) {
                    subcookies = BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(impl.cookie));
                    BOOMR.utils.removeCookie(impl.cookie);
                    if (subcookies && subcookies.s && subcookies.r) {
                        r = subcookies.r;
                        if (!impl.strict_referrer || r === r2) {
                            t_start = parseInt(subcookies.s, 10)
                        }
                    }
                }
                if (t_start && impl.navigationType != 2) {
                    BOOMR.addVar("rt.start", "cookie")
                } else {
                    t_start = impl.navigationStart
                }
                BOOMR.removeVar("t_done", "t_page", "t_resp", "r", "r2", "rt.bstart", "rt.end");
                BOOMR.addVar("rt.bstart", BOOMR.t_start);
                BOOMR.addVar("rt.end", impl.timers.t_done.end);
                for (t_name in impl.timers) {
                    if (!impl.timers.hasOwnProperty(t_name)) {
                        continue
                    }
                    timer = impl.timers[t_name];
                    if (typeof timer.delta !== "number") {
                        if (typeof timer.start !== "number") {
                            timer.start = t_start
                        }
                        timer.delta = timer.end - timer.start
                    }
                    if (isNaN(timer.delta)) {
                        continue
                    }
                    if (basic_timers.hasOwnProperty(t_name)) {
                        BOOMR.addVar(t_name, timer.delta)
                    } else {
                        t_other.push(t_name + "|" + timer.delta)
                    }
                    ntimers++
                }
                if (ntimers) {
                    BOOMR.addVar("r", r);
                    if (r2 !== r) {
                        BOOMR.addVar("r2", r2)
                    }
                    if (t_other.length) {
                        BOOMR.addVar("t_other", t_other.join(","))
                    }
                }
                impl.timers = {};
                impl.complete = true;
                BOOMR.sendBeacon();
                return this
            }, is_complete: function () {
                return impl.complete
            }
        }
    })(window);
    (function (w) {
        var d = w.document;
        BOOMR = BOOMR || {};
        BOOMR.plugins = BOOMR.plugins || {};
        var images = [{name: "image-0.png", size: 11483, timeout: 1400}, {
            name: "image-1.png",
            size: 40658,
            timeout: 1200
        }, {name: "image-2.png", size: 164897, timeout: 1300}, {
            name: "image-3.png",
            size: 381756,
            timeout: 1500
        }, {name: "image-4.png", size: 1234664, timeout: 1200}, {
            name: "image-5.png",
            size: 4509613,
            timeout: 1200
        }, {name: "image-6.png", size: 9084559, timeout: 1200}];
        images.end = images.length;
        images.start = 0;
        images.l = {name: "image-l.gif", size: 35, timeout: 1e3};
        var impl = {
            base_url: "images/",
            timeout: 15e3,
            nruns: 5,
            latency_runs: 10,
            user_ip: "",
            cookie_exp: 7 * 86400,
            cookie: "BA",
            results: [],
            latencies: [],
            latency: null,
            runs_left: 0,
            aborted: false,
            complete: false,
            running: false,
            ncmp: function (a, b) {
                return a - b
            },
            iqr: function (a) {
                var l = a.length - 1, q1, q3, fw, b = [], i;
                q1 = (a[Math.floor(l * .25)] + a[Math.ceil(l * .25)]) / 2;
                q3 = (a[Math.floor(l * .75)] + a[Math.ceil(l * .75)]) / 2;
                fw = (q3 - q1) * 1.5;
                l++;
                for (i = 0; i < l && a[i] < q3 + fw; i++) {
                    if (a[i] > q1 - fw) {
                        b.push(a[i])
                    }
                }
                return b
            },
            calc_latency: function () {
                var i, n, sum = 0, sumsq = 0, amean, median, std_dev, std_err, lat_filtered;
                lat_filtered = this.iqr(this.latencies.sort(this.ncmp));
                n = lat_filtered.length;
                BOOMR.debug(lat_filtered, "bw");
                for (i = 1; i < n; i++) {
                    sum += lat_filtered[i];
                    sumsq += lat_filtered[i] * lat_filtered[i]
                }
                n--;
                amean = Math.round(sum / n);
                std_dev = Math.sqrt(sumsq / n - sum * sum / (n * n));
                std_err = (1.96 * std_dev / Math.sqrt(n)).toFixed(2);
                std_dev = std_dev.toFixed(2);
                n = lat_filtered.length - 1;
                median = Math.round((lat_filtered[Math.floor(n / 2)] + lat_filtered[Math.ceil(n / 2)]) / 2);
                return {mean: amean, median: median, stddev: std_dev, stderr: std_err}
            },
            calc_bw: function () {
                var i, j, n = 0, r, bandwidths = [], bandwidths_corrected = [], sum = 0, sumsq = 0, sum_corrected = 0, sumsq_corrected = 0, amean, std_dev, std_err, median, amean_corrected, std_dev_corrected, std_err_corrected, median_corrected, nimgs, bw, bw_c;
                for (i = 0; i < this.nruns; i++) {
                    if (!this.results[i] || !this.results[i].r) {
                        continue
                    }
                    r = this.results[i].r;
                    nimgs = 0;
                    for (j = r.length - 1; j >= 0 && nimgs < 3; j--) {
                        if (!r[j]) {
                            break
                        }
                        if (r[j].t === null) {
                            continue
                        }
                        n++;
                        nimgs++;
                        bw = images[j].size * 1e3 / r[j].t;
                        bandwidths.push(bw);
                        bw_c = images[j].size * 1e3 / (r[j].t - this.latency.mean);
                        bandwidths_corrected.push(bw_c)
                    }
                }
                BOOMR.debug("got " + n + " readings", "bw");
                BOOMR.debug("bandwidths: " + bandwidths, "bw");
                BOOMR.debug("corrected: " + bandwidths_corrected, "bw");
                if (bandwidths.length > 3) {
                    bandwidths = this.iqr(bandwidths.sort(this.ncmp));
                    bandwidths_corrected = this.iqr(bandwidths_corrected.sort(this.ncmp))
                } else {
                    bandwidths = bandwidths.sort(this.ncmp);
                    bandwidths_corrected = bandwidths_corrected.sort(this.ncmp)
                }
                BOOMR.debug("after iqr: " + bandwidths, "bw");
                BOOMR.debug("corrected: " + bandwidths_corrected, "bw");
                n = Math.max(bandwidths.length, bandwidths_corrected.length);
                for (i = 0; i < n; i++) {
                    if (i < bandwidths.length) {
                        sum += bandwidths[i];
                        sumsq += Math.pow(bandwidths[i], 2)
                    }
                    if (i < bandwidths_corrected.length) {
                        sum_corrected += bandwidths_corrected[i];
                        sumsq_corrected += Math.pow(bandwidths_corrected[i], 2)
                    }
                }
                n = bandwidths.length;
                amean = Math.round(sum / n);
                std_dev = Math.sqrt(sumsq / n - Math.pow(sum / n, 2));
                std_err = Math.round(1.96 * std_dev / Math.sqrt(n));
                std_dev = Math.round(std_dev);
                n = bandwidths.length - 1;
                median = Math.round((bandwidths[Math.floor(n / 2)] + bandwidths[Math.ceil(n / 2)]) / 2);
                n = bandwidths_corrected.length;
                amean_corrected = Math.round(sum_corrected / n);
                std_dev_corrected = Math.sqrt(sumsq_corrected / n - Math.pow(sum_corrected / n, 2));
                std_err_corrected = (1.96 * std_dev_corrected / Math.sqrt(n)).toFixed(2);
                std_dev_corrected = std_dev_corrected.toFixed(2);
                n = bandwidths_corrected.length - 1;
                median_corrected = Math.round((bandwidths_corrected[Math.floor(n / 2)] + bandwidths_corrected[Math.ceil(n / 2)]) / 2);
                BOOMR.debug("amean: " + amean + ", median: " + median, "bw");
                BOOMR.debug("corrected amean: " + amean_corrected + ", " + "median: " + median_corrected, "bw");
                return {
                    mean: amean,
                    stddev: std_dev,
                    stderr: std_err,
                    median: median,
                    mean_corrected: amean_corrected,
                    stddev_corrected: std_dev_corrected,
                    stderr_corrected: std_err_corrected,
                    median_corrected: median_corrected
                }
            },
            defer: function (method) {
                var that = this;
                return setTimeout(function () {
                    method.call(that);
                    that = null
                }, 10)
            },
            load_img: function (i, run, callback) {
                var url = this.base_url + images[i].name + "?t=" + (new Date).getTime() + Math.random(), timer = 0, tstart = 0, img = new Image, that = this;
                img.onload = function () {
                    img.onload = img.onerror = null;
                    img = null;
                    clearTimeout(timer);
                    if (callback) {
                        callback.call(that, i, tstart, run, true)
                    }
                    that = callback = null
                };
                img.onerror = function () {
                    img.onload = img.onerror = null;
                    img = null;
                    clearTimeout(timer);
                    if (callback) {
                        callback.call(that, i, tstart, run, false)
                    }
                    that = callback = null
                };
                timer = setTimeout(function () {
                    if (callback) {
                        callback.call(that, i, tstart, run, null)
                    }
                }, images[i].timeout + Math.min(400, this.latency ? this.latency.mean : 400));
                tstart = (new Date).getTime();
                img.src = url
            },
            lat_loaded: function (i, tstart, run, success) {
                if (run !== this.latency_runs + 1) {
                    return
                }
                if (success !== null) {
                    var lat = (new Date).getTime() - tstart;
                    this.latencies.push(lat)
                }
                if (this.latency_runs === 0) {
                    this.latency = this.calc_latency()
                }
                this.defer(this.iterate)
            },
            img_loaded: function (i, tstart, run, success) {
                if (run !== this.runs_left + 1) {
                    return
                }
                if (this.results[this.nruns - run].r[i]) {
                    return
                }
                if (success === null) {
                    this.results[this.nruns - run].r[i + 1] = {t: null, state: null, run: run};
                    return
                }
                var result = {start: tstart, end: (new Date).getTime(), t: null, state: success, run: run};
                if (success) {
                    result.t = result.end - result.start
                }
                this.results[this.nruns - run].r[i] = result;
                if (i >= images.end - 1 || typeof this.results[this.nruns - run].r[i + 1] !== "undefined") {
                    BOOMR.debug(this.results[this.nruns - run], "bw");
                    if (run === this.nruns) {
                        images.start = i
                    }
                    this.defer(this.iterate)
                } else {
                    this.load_img(i + 1, run, this.img_loaded)
                }
            },
            finish: function () {
                if (!this.latency) {
                    this.latency = this.calc_latency()
                }
                var bw = this.calc_bw(), o = {
                    bw: bw.median_corrected,
                    bw_err: parseFloat(bw.stderr_corrected, 10),
                    lat: this.latency.mean,
                    lat_err: parseFloat(this.latency.stderr, 10),
                    bw_time: Math.round((new Date).getTime() / 1e3)
                };
                BOOMR.addVar(o);
                if (!isNaN(o.bw)) {
                    BOOMR.utils.setCookie(this.cookie, {
                        ba: Math.round(o.bw),
                        be: o.bw_err,
                        l: o.lat,
                        le: o.lat_err,
                        ip: this.user_ip,
                        t: o.bw_time
                    }, this.user_ip ? this.cookie_exp : 0, "/", null)
                }
                this.complete = true;
                BOOMR.sendBeacon();
                this.running = false
            },
            iterate: function () {
                if (this.aborted) {
                    return false
                }
                if (!this.runs_left) {
                    this.finish()
                } else if (this.latency_runs) {
                    this.load_img("l", this.latency_runs--, this.lat_loaded)
                } else {
                    this.results.push({r: []});
                    this.load_img(images.start, this.runs_left--, this.img_loaded)
                }
            },
            setVarsFromCookie: function (cookies) {
                var ba = parseInt(cookies.ba, 10), bw_e = parseFloat(cookies.be, 10), lat = parseInt(cookies.l, 10) || 0, lat_e = parseFloat(cookies.le, 10) || 0, c_sn = cookies.ip.replace(/\.\d+$/, "0"), t = parseInt(cookies.t, 10), p_sn = this.user_ip.replace(/\.\d+$/, "0"), t_now = Math.round((new Date).getTime() / 1e3);
                if (c_sn === p_sn && t >= t_now - this.cookie_exp) {
                    this.complete = true;
                    BOOMR.addVar({bw: ba, lat: lat, bw_err: bw_e, lat_err: lat_e});
                    return true
                }
                return false
            }
        };
        BOOMR.plugins.BW = {
            init: function (config) {
                var cookies;
                BOOMR.utils.pluginConfig(impl, config, "BW", ["base_url", "timeout", "nruns", "cookie", "cookie_exp"]);
                if (config && config.user_ip) {
                    impl.user_ip = config.user_ip
                }
                images.start = 0;
                impl.runs_left = impl.nruns;
                impl.latency_runs = 10;
                impl.results = [];
                impl.latencies = [];
                impl.latency = null;
                impl.complete = false;
                impl.aborted = false;
                BOOMR.removeVar("ba", "ba_err", "lat", "lat_err");
                cookies = BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(impl.cookie));
                if (!cookies || !cookies.ba || !impl.setVarsFromCookie(cookies)) {
                    BOOMR.subscribe("page_ready", this.run, null, this)
                }
                return this
            }, run: function () {
                if (impl.running || impl.complete) {
                    return this
                }
                if (w.location.protocol === "https:") {
                    BOOMR.info("HTTPS detected, skipping bandwidth test", "bw");
                    impl.complete = true;
                    BOOMR.sendBeacon();
                    return this
                }
                impl.running = true;
                setTimeout(this.abort, impl.timeout);
                impl.defer(impl.iterate);
                return this
            }, abort: function () {
                impl.aborted = true;
                if (impl.running) {
                    impl.finish()
                }
                return this
            }, is_complete: function () {
                return impl.complete
            }
        }
    })(window)
}
!function (a, b) {
    "function" == typeof define && define.amd ? define("bloodhound", ["jquery"], function (c) {
        return a.Bloodhound = b(c)
    }) : "object" == typeof exports ? module.exports = b(require("jquery")) : a.Bloodhound = b(jQuery)
}(this, function (a) {
    var b = function () {
        "use strict";
        return {
            isMsie: function () {
                return !!/(msie|trident)/i.test(navigator.userAgent) && navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]
            }, isBlankString: function (a) {
                return !a || /^\s*$/.test(a)
            }, escapeRegExChars: function (a) {
                return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
            }, isString: function (a) {
                return "string" == typeof a
            }, isNumber: function (a) {
                return "number" == typeof a
            }, isArray: a.isArray, isFunction: a.isFunction, isObject: a.isPlainObject, isUndefined: function (a) {
                return "undefined" == typeof a
            }, isElement: function (a) {
                return !(!a || 1 !== a.nodeType)
            }, isJQuery: function (b) {
                return b instanceof a
            }, toStr: function (c) {
                return b.isUndefined(c) || null === c ? "" : c + ""
            }, bind: a.proxy, each: function (b, c) {
                function d(a, b) {
                    return c(b, a)
                }

                a.each(b, d)
            }, map: a.map, filter: a.grep, every: function (b, c) {
                var d = !0;
                return b ? (a.each(b, function (a, e) {
                    if (!(d = c.call(null, e, a, b)))return !1
                }), !!d) : d
            }, some: function (b, c) {
                var d = !1;
                return b ? (a.each(b, function (a, e) {
                    if (d = c.call(null, e, a, b))return !1
                }), !!d) : d
            }, mixin: a.extend, identity: function (a) {
                return a
            }, clone: function (b) {
                return a.extend(!0, {}, b)
            }, getIdGenerator: function () {
                var a = 0;
                return function () {
                    return a++
                }
            }, templatify: function (c) {
                function d() {
                    return String(c)
                }

                return a.isFunction(c) ? c : d
            }, defer: function (a) {
                setTimeout(a, 0)
            }, debounce: function (a, b, c) {
                var d, e;
                return function () {
                    var h, i, f = this, g = arguments;
                    return h = function () {
                        d = null, c || (e = a.apply(f, g))
                    }, i = c && !d, clearTimeout(d), d = setTimeout(h, b), i && (e = a.apply(f, g)), e
                }
            }, throttle: function (a, b) {
                var c, d, e, f, g, h;
                return g = 0, h = function () {
                    g = new Date, e = null, f = a.apply(c, d)
                }, function () {
                    var i = new Date, j = b - (i - g);
                    return c = this, d = arguments, j <= 0 ? (clearTimeout(e), e = null, g = i, f = a.apply(c, d)) : e || (e = setTimeout(h, j)), f
                }
            }, stringify: function (a) {
                return b.isString(a) ? a : JSON.stringify(a)
            }, noop: function () {
            }
        }
    }(), c = "0.11.1", d = function () {
        "use strict";
        function a(a) {
            return a = b.toStr(a), a ? a.split(/\s+/) : []
        }

        function c(a) {
            return a = b.toStr(a), a ? a.split(/\W+/) : []
        }

        function d(a) {
            return function (d) {
                return d = b.isArray(d) ? d : [].slice.call(arguments, 0), function (e) {
                    var f = [];
                    return b.each(d, function (c) {
                        f = f.concat(a(b.toStr(e[c])))
                    }), f
                }
            }
        }

        return {nonword: c, whitespace: a, obj: {nonword: d(c), whitespace: d(a)}}
    }(), e = function () {
        "use strict";
        function c(c) {
            this.maxSize = b.isNumber(c) ? c : 100, this.reset(), this.maxSize <= 0 && (this.set = this.get = a.noop)
        }

        function d() {
            this.head = this.tail = null
        }

        function e(a, b) {
            this.key = a, this.val = b, this.prev = this.next = null
        }

        return b.mixin(c.prototype, {
            set: function (b, c) {
                var f, d = this.list.tail;
                this.size >= this.maxSize && (this.list.remove(d), delete this.hash[d.key], this.size--), (f = this.hash[b]) ? (f.val = c, this.list.moveToFront(f)) : (f = new e(b, c), this.list.add(f), this.hash[b] = f, this.size++)
            }, get: function (b) {
                var c = this.hash[b];
                if (c)return this.list.moveToFront(c), c.val
            }, reset: function () {
                this.size = 0, this.hash = {}, this.list = new d
            }
        }), b.mixin(d.prototype, {
            add: function (b) {
                this.head && (b.next = this.head, this.head.prev = b), this.head = b, this.tail = this.tail || b
            }, remove: function (b) {
                b.prev ? b.prev.next = b.next : this.head = b.next, b.next ? b.next.prev = b.prev : this.tail = b.prev
            }, moveToFront: function (a) {
                this.remove(a), this.add(a)
            }
        }), c
    }(), f = function () {
        "use strict";
        function d(a, d) {
            this.prefix = ["__", a, "__"].join(""), this.ttlKey = "__ttl__", this.keyMatcher = new RegExp("^" + b.escapeRegExChars(this.prefix)), this.ls = d || c, !this.ls && this._noop()
        }

        function e() {
            return (new Date).getTime()
        }

        function f(a) {
            return JSON.stringify(b.isUndefined(a) ? null : a)
        }

        function g(b) {
            return a.parseJSON(b)
        }

        function h(a) {
            var b, d, e = [], f = c.length;
            for (b = 0; b < f; b++)(d = c.key(b)).match(a) && e.push(d.replace(a, ""));
            return e
        }

        var c;
        try {
            c = window.localStorage, c.setItem("~~~", "!"), c.removeItem("~~~")
        } catch (a) {
            c = null
        }
        return b.mixin(d.prototype, {
            _prefix: function (a) {
                return this.prefix + a
            }, _ttlKey: function (a) {
                return this._prefix(a) + this.ttlKey
            }, _noop: function () {
                this.get = this.set = this.remove = this.clear = this.isExpired = b.noop
            }, _safeSet: function (a, b) {
                try {
                    this.ls.setItem(a, b)
                } catch (a) {
                    "QuotaExceededError" === a.name && (this.clear(), this._noop())
                }
            }, get: function (a) {
                return this.isExpired(a) && this.remove(a), g(this.ls.getItem(this._prefix(a)))
            }, set: function (a, c, d) {
                return b.isNumber(d) ? this._safeSet(this._ttlKey(a), f(e() + d)) : this.ls.removeItem(this._ttlKey(a)), this._safeSet(this._prefix(a), f(c))
            }, remove: function (a) {
                return this.ls.removeItem(this._ttlKey(a)), this.ls.removeItem(this._prefix(a)), this
            }, clear: function () {
                var a, b = h(this.keyMatcher);
                for (a = b.length; a--;)this.remove(b[a]);
                return this
            }, isExpired: function (a) {
                var c = g(this.ls.getItem(this._ttlKey(a)));
                return !!(b.isNumber(c) && e() > c)
            }
        }), d
    }(), g = function () {
        "use strict";
        function h(a) {
            a = a || {}, this.cancelled = !1, this.lastReq = null, this._send = a.transport, this._get = a.limiter ? a.limiter(this._get) : this._get, this._cache = a.cache === !1 ? new e(0) : g
        }

        var c = 0, d = {}, f = 6, g = new e(10);
        return h.setMaxPendingRequests = function (b) {
            f = b
        }, h.resetCache = function () {
            g.reset()
        }, b.mixin(h.prototype, {
            _fingerprint: function (c) {
                return c = c || {}, c.url + c.type + a.param(c.data || {})
            }, _get: function (a, b) {
                function i(a) {
                    b(null, a), e._cache.set(g, a)
                }

                function j() {
                    b(!0)
                }

                function k() {
                    c--, delete d[g], e.onDeckRequestArgs && (e._get.apply(e, e.onDeckRequestArgs), e.onDeckRequestArgs = null)
                }

                var g, h, e = this;
                g = this._fingerprint(a), this.cancelled || g !== this.lastReq || ((h = d[g]) ? h.done(i).fail(j) : c < f ? (c++, d[g] = this._send(a).done(i).fail(j).always(k)) : this.onDeckRequestArgs = [].slice.call(arguments, 0))
            }, get: function (c, d) {
                var e, f;
                d = d || a.noop, c = b.isString(c) ? {url: c} : c || {}, f = this._fingerprint(c), this.cancelled = !1, this.lastReq = f, (e = this._cache.get(f)) ? d(null, e) : this._get(c, d)
            }, cancel: function () {
                this.cancelled = !0
            }
        }), h
    }(), h = window.SearchIndex = function () {
        "use strict";
        function e(c) {
            c = c || {}, c.datumTokenizer && c.queryTokenizer || a.error("datumTokenizer and queryTokenizer are both required"), this.identify = c.identify || b.stringify, this.datumTokenizer = c.datumTokenizer, this.queryTokenizer = c.queryTokenizer, this.reset()
        }

        function f(a) {
            return a = b.filter(a, function (a) {
                return !!a
            }), a = b.map(a, function (a) {
                return a.toLowerCase()
            })
        }

        function g() {
            var a = {};
            return a[d] = [], a[c] = {}, a
        }

        function h(a) {
            for (var b = {}, c = [], d = 0, e = a.length; d < e; d++)b[a[d]] || (b[a[d]] = !0, c.push(a[d]));
            return c
        }

        function i(a, b) {
            var c = 0, d = 0, e = [];
            a = a.sort(), b = b.sort();
            for (var f = a.length, g = b.length; c < f && d < g;)a[c] < b[d] ? c++ : a[c] > b[d] ? d++ : (e.push(a[c]), c++, d++);
            return e
        }

        var c = "c", d = "i";
        return b.mixin(e.prototype, {
            bootstrap: function (b) {
                this.datums = b.datums, this.trie = b.trie
            }, add: function (a) {
                var e = this;
                a = b.isArray(a) ? a : [a], b.each(a, function (a) {
                    var h, i;
                    e.datums[h = e.identify(a)] = a, i = f(e.datumTokenizer(a)), b.each(i, function (a) {
                        var b, f, i;
                        for (b = e.trie, f = a.split(""); i = f.shift();)b = b[c][i] || (b[c][i] = g()), b[d].push(h)
                    })
                })
            }, get: function (c) {
                var d = this;
                return b.map(c, function (a) {
                    return d.datums[a]
                })
            }, search: function (e) {
                var j, k, g = this;
                return j = f(this.queryTokenizer(e)), b.each(j, function (a) {
                    var b, e, f, h;
                    if (k && 0 === k.length)return !1;
                    for (b = g.trie, e = a.split(""); b && (f = e.shift());)b = b[c][f];
                    return b && 0 === e.length ? (h = b[d].slice(0), void(k = k ? i(k, h) : h)) : (k = [], !1)
                }), k ? b.map(h(k), function (a) {
                    return g.datums[a]
                }) : []
            }, all: function () {
                var b = [];
                for (var c in this.datums)b.push(this.datums[c]);
                return b
            }, reset: function () {
                this.datums = {}, this.trie = g()
            }, serialize: function () {
                return {datums: this.datums, trie: this.trie}
            }
        }), e
    }(), i = function () {
        "use strict";
        function c(a) {
            this.url = a.url, this.ttl = a.ttl, this.cache = a.cache, this.prepare = a.prepare, this.transform = a.transform, this.transport = a.transport, this.thumbprint = a.thumbprint, this.storage = new f(a.cacheKey)
        }

        var a;
        return a = {
            data: "data",
            protocol: "protocol",
            thumbprint: "thumbprint"
        }, b.mixin(c.prototype, {
            _settings: function () {
                return {url: this.url, type: "GET", dataType: "json"}
            }, store: function (c) {
                this.cache && (this.storage.set(a.data, c, this.ttl), this.storage.set(a.protocol, location.protocol, this.ttl), this.storage.set(a.thumbprint, this.thumbprint, this.ttl))
            }, fromCache: function () {
                var d, c = {};
                return this.cache ? (c.data = this.storage.get(a.data), c.protocol = this.storage.get(a.protocol), c.thumbprint = this.storage.get(a.thumbprint), d = c.thumbprint !== this.thumbprint || c.protocol !== location.protocol, c.data && !d ? c.data : null) : null
            }, fromNetwork: function (a) {
                function d() {
                    a(!0)
                }

                function e(c) {
                    a(null, b.transform(c))
                }

                var c, b = this;
                a && (c = this.prepare(this._settings()), this.transport(c).fail(d).done(e))
            }, clear: function () {
                return this.storage.clear(), this
            }
        }), c
    }(), j = function () {
        "use strict";
        function a(a) {
            this.url = a.url, this.prepare = a.prepare, this.transform = a.transform, this.transport = new g({
                cache: a.cache,
                limiter: a.limiter,
                transport: a.transport
            })
        }

        return b.mixin(a.prototype, {
            _settings: function () {
                return {url: this.url, type: "GET", dataType: "json"}
            }, get: function (b, c) {
                function f(a, b) {
                    c(a ? [] : d.transform(b))
                }

                var e, d = this;
                if (c)return b = b || "", e = this.prepare(b, this._settings()), this.transport.get(e, f)
            }, cancelLastRequest: function () {
                this.transport.cancel()
            }
        }), a
    }(), k = function () {
        "use strict";
        function d(d) {
            var e;
            return d ? (e = {
                url: null,
                ttl: 864e5,
                cache: !0,
                cacheKey: null,
                thumbprint: "",
                prepare: b.identity,
                transform: b.identity,
                transport: null
            }, d = b.isString(d) ? {url: d} : d, d = b.mixin(e, d), !d.url && a.error("prefetch requires url to be set"), d.transform = d.filter || d.transform, d.cacheKey = d.cacheKey || d.url, d.thumbprint = c + d.thumbprint, d.transport = d.transport ? h(d.transport) : a.ajax, d) : null
        }

        function e(c) {
            var d;
            if (c)return d = {
                url: null,
                cache: !0,
                prepare: null,
                replace: null,
                wildcard: null,
                limiter: null,
                rateLimitBy: "debounce",
                rateLimitWait: 300,
                transform: b.identity,
                transport: null
            }, c = b.isString(c) ? {url: c} : c, c = b.mixin(d, c), !c.url && a.error("remote requires url to be set"), c.transform = c.filter || c.transform, c.prepare = f(c), c.limiter = g(c), c.transport = c.transport ? h(c.transport) : a.ajax, delete c.replace, delete c.wildcard, delete c.rateLimitBy, delete c.rateLimitWait, c
        }

        function f(a) {
            function e(a, b) {
                return b.url = c(b.url, a), b
            }

            function f(a, b) {
                return b.url = b.url.replace(d, encodeURIComponent(a)), b
            }

            function g(a, b) {
                return b
            }

            var b, c, d;
            return b = a.prepare, c = a.replace, d = a.wildcard, b ? b : b = c ? e : a.wildcard ? f : g
        }

        function g(a) {
            function f(a) {
                return function (d) {
                    return b.debounce(d, a)
                }
            }

            function g(a) {
                return function (d) {
                    return b.throttle(d, a)
                }
            }

            var c, d, e;
            return c = a.limiter, d = a.rateLimitBy, e = a.rateLimitWait, c || (c = /^throttle$/i.test(d) ? g(e) : f(e)), c
        }

        function h(c) {
            return function (e) {
                function g(a) {
                    return b.defer(function () {
                        f.resolve(a)
                    }), f
                }

                function h(a) {
                    b.defer(function () {
                        f.reject(a)
                    })
                }

                var f = a.Deferred();
                return c(e, g, h), f
            }
        }

        return function (f) {
            var g, h;
            return g = {
                initialize: !0,
                identify: b.stringify,
                datumTokenizer: null,
                queryTokenizer: null,
                sufficient: 5,
                sorter: null,
                local: [],
                prefetch: null,
                remote: null
            }, f = b.mixin(g, f || {}), !f.datumTokenizer && a.error("datumTokenizer is required"), !f.queryTokenizer && a.error("queryTokenizer is required"), h = f.sorter, f.sorter = h ? function (a) {
                return a.sort(h)
            } : b.identity, f.local = b.isFunction(f.local) ? f.local() : f.local, f.prefetch = d(f.prefetch), f.remote = e(f.remote), f
        }
    }(), l = function () {
        "use strict";
        function e(a) {
            a = k(a), this.sorter = a.sorter, this.identify = a.identify, this.sufficient = a.sufficient, this.local = a.local, this.remote = a.remote ? new j(a.remote) : null, this.prefetch = a.prefetch ? new i(a.prefetch) : null, this.index = new h({
                identify: this.identify,
                datumTokenizer: a.datumTokenizer,
                queryTokenizer: a.queryTokenizer
            }), a.initialize !== !1 && this.initialize()
        }

        var c;
        return c = window && window.Bloodhound, e.noConflict = function () {
            return window && (window.Bloodhound = c), e
        }, e.tokenizers = d, b.mixin(e.prototype, {
            __ttAdapter: function () {
                function c(a, c, d) {
                    return b.search(a, c, d)
                }

                function d(a, c) {
                    return b.search(a, c)
                }

                var b = this;
                return this.remote ? c : d
            }, _loadPrefetch: function () {
                function f(a, b) {
                    return a ? d.reject() : (c.add(b), c.prefetch.store(c.index.serialize()), void d.resolve())
                }

                var d, e, c = this;
                return d = a.Deferred(), this.prefetch ? (e = this.prefetch.fromCache()) ? (this.index.bootstrap(e), d.resolve()) : this.prefetch.fromNetwork(f) : d.resolve(), d.promise()
            }, _initialize: function () {
                function d() {
                    b.add(b.local)
                }

                var b = this;
                return this.clear(), (this.initPromise = this._loadPrefetch()).done(d), this.initPromise
            }, initialize: function (b) {
                return !this.initPromise || b ? this._initialize() : this.initPromise
            }, add: function (b) {
                return this.index.add(b), this
            }, get: function (c) {
                return c = b.isArray(c) ? c : [].slice.call(arguments), this.index.get(c)
            }, search: function (c, d, e) {
                function h(a) {
                    var c = [];
                    b.each(a, function (a) {
                        !b.some(g, function (b) {
                            return f.identify(a) === f.identify(b)
                        }) && c.push(a)
                    }), e && e(c)
                }

                var g, f = this;
                return g = this.sorter(this.index.search(c)), d(this.remote ? g.slice() : g), this.remote && g.length < this.sufficient ? this.remote.get(c, h) : this.remote && this.remote.cancelLastRequest(), this
            }, all: function () {
                return this.index.all()
            }, clear: function () {
                return this.index.reset(), this
            }, clearPrefetchCache: function () {
                return this.prefetch && this.prefetch.clear(), this
            }, clearRemoteCache: function () {
                return g.resetCache(), this
            }, ttAdapter: function () {
                return this.__ttAdapter()
            }
        }), e
    }();
    return l
}), function (a, b) {
    "function" == typeof define && define.amd ? define("typeahead.js", ["jquery"], function (a) {
        return b(a)
    }) : "object" == typeof exports ? module.exports = b(require("jquery")) : b(jQuery)
}(this, function (a) {
    var b = function () {
        "use strict";
        return {
            isMsie: function () {
                return !!/(msie|trident)/i.test(navigator.userAgent) && navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]
            }, isBlankString: function (a) {
                return !a || /^\s*$/.test(a)
            }, escapeRegExChars: function (a) {
                return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
            }, isString: function (a) {
                return "string" == typeof a
            }, isNumber: function (a) {
                return "number" == typeof a
            }, isArray: a.isArray, isFunction: a.isFunction, isObject: a.isPlainObject, isUndefined: function (a) {
                return "undefined" == typeof a
            }, isElement: function (a) {
                return !(!a || 1 !== a.nodeType)
            }, isJQuery: function (b) {
                return b instanceof a
            }, toStr: function (c) {
                return b.isUndefined(c) || null === c ? "" : c + ""
            }, bind: a.proxy, each: function (b, c) {
                function d(a, b) {
                    return c(b, a)
                }

                a.each(b, d)
            }, map: a.map, filter: a.grep, every: function (b, c) {
                var d = !0;
                return b ? (a.each(b, function (a, e) {
                    if (!(d = c.call(null, e, a, b)))return !1
                }), !!d) : d
            }, some: function (b, c) {
                var d = !1;
                return b ? (a.each(b, function (a, e) {
                    if (d = c.call(null, e, a, b))return !1
                }), !!d) : d
            }, mixin: a.extend, identity: function (a) {
                return a
            }, clone: function (b) {
                return a.extend(!0, {}, b)
            }, getIdGenerator: function () {
                var a = 0;
                return function () {
                    return a++
                }
            }, templatify: function (c) {
                function d() {
                    return String(c)
                }

                return a.isFunction(c) ? c : d
            }, defer: function (a) {
                setTimeout(a, 0)
            }, debounce: function (a, b, c) {
                var d, e;
                return function () {
                    var h, i, f = this, g = arguments;
                    return h = function () {
                        d = null, c || (e = a.apply(f, g))
                    }, i = c && !d, clearTimeout(d), d = setTimeout(h, b), i && (e = a.apply(f, g)), e
                }
            }, throttle: function (a, b) {
                var c, d, e, f, g, h;
                return g = 0, h = function () {
                    g = new Date, e = null, f = a.apply(c, d)
                }, function () {
                    var i = new Date, j = b - (i - g);
                    return c = this, d = arguments, j <= 0 ? (clearTimeout(e), e = null, g = i, f = a.apply(c, d)) : e || (e = setTimeout(h, j)), f
                }
            }, stringify: function (a) {
                return b.isString(a) ? a : JSON.stringify(a)
            }, noop: function () {
            }
        }
    }(), c = function () {
        "use strict";
        function c(c) {
            var g, h;
            return h = b.mixin({}, a, c), g = {css: f(), classes: h, html: d(h), selectors: e(h)}, {
                css: g.css,
                html: g.html,
                classes: g.classes,
                selectors: g.selectors,
                mixin: function (a) {
                    b.mixin(a, g)
                }
            }
        }

        function d(a) {
            return {wrapper: '<span class="' + a.wrapper + '"></span>', menu: '<div class="' + a.menu + '"></div>'}
        }

        function e(a) {
            var c = {};
            return b.each(a, function (a, b) {
                c[b] = "." + a
            }), c
        }

        function f() {
            var a = {
                wrapper: {position: "relative", display: "inline-block"},
                hint: {
                    position: "absolute",
                    top: "0",
                    left: "0",
                    borderColor: "transparent",
                    boxShadow: "none",
                    opacity: "1"
                },
                input: {position: "relative", verticalAlign: "top", backgroundColor: "transparent"},
                inputWithNoHint: {position: "relative", verticalAlign: "top"},
                menu: {position: "absolute", top: "100%", left: "0", zIndex: "100", display: "none"},
                ltr: {left: "0", right: "auto"},
                rtl: {left: "auto", right: " 0"}
            };
            return b.isMsie() && b.mixin(a.input, {backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}), a
        }

        var a = {
            wrapper: "twitter-typeahead",
            input: "tt-input",
            hint: "tt-hint",
            menu: "tt-menu",
            dataset: "tt-dataset",
            suggestion: "tt-suggestion",
            selectable: "tt-selectable",
            empty: "tt-empty",
            open: "tt-open",
            cursor: "tt-cursor",
            highlight: "tt-highlight"
        };
        return c
    }(), d = function () {
        "use strict";
        function e(b) {
            b && b.el || a.error("EventBus initialized without el"), this.$el = a(b.el)
        }

        var c, d;
        return c = "typeahead:", d = {
            render: "rendered",
            cursorchange: "cursorchanged",
            select: "selected",
            autocomplete: "autocompleted"
        }, b.mixin(e.prototype, {
            _trigger: function (b, d) {
                var e;
                return e = a.Event(c + b), (d = d || []).unshift(e), this.$el.trigger.apply(this.$el, d), e
            }, before: function (a) {
                var b, c;
                return b = [].slice.call(arguments, 1), c = this._trigger("before" + a, b), c.isDefaultPrevented()
            }, trigger: function (a) {
                var b;
                this._trigger(a, [].slice.call(arguments, 1)), (b = d[a]) && this._trigger(b, [].slice.call(arguments, 1))
            }
        }), e
    }(), e = function () {
        "use strict";
        function c(b, c, d, e) {
            var f;
            if (!d)return this;
            for (c = c.split(a), d = e ? j(d, e) : d, this._callbacks = this._callbacks || {}; f = c.shift();)this._callbacks[f] = this._callbacks[f] || {
                    sync: [],
                    async: []
                }, this._callbacks[f][b].push(d);
            return this
        }

        function d(a, b, d) {
            return c.call(this, "async", a, b, d)
        }

        function e(a, b, d) {
            return c.call(this, "sync", a, b, d)
        }

        function f(b) {
            var c;
            if (!this._callbacks)return this;
            for (b = b.split(a); c = b.shift();)delete this._callbacks[c];
            return this
        }

        function g(c) {
            var d, e, f, g, i;
            if (!this._callbacks)return this;
            for (c = c.split(a), f = [].slice.call(arguments, 1); (d = c.shift()) && (e = this._callbacks[d]);)g = h(e.sync, this, [d].concat(f)), i = h(e.async, this, [d].concat(f)), g() && b(i);
            return this
        }

        function h(a, b, c) {
            function d() {
                for (var d, e = 0, f = a.length; !d && e < f; e += 1)d = a[e].apply(b, c) === !1;
                return !d
            }

            return d
        }

        function i() {
            var a;
            return a = window.setImmediate ? function (b) {
                setImmediate(function () {
                    b()
                })
            } : function (b) {
                setTimeout(function () {
                    b()
                }, 0)
            }
        }

        function j(a, b) {
            return a.bind ? a.bind(b) : function () {
                a.apply(b, [].slice.call(arguments, 0))
            }
        }

        var a = /\s+/, b = i();
        return {onSync: e, onAsync: d, off: f, trigger: g}
    }(), f = function (a) {
        "use strict";
        function d(a, c, d) {
            for (var f, e = [], g = 0, h = a.length; g < h; g++)e.push(b.escapeRegExChars(a[g]));
            return f = d ? "\\b(" + e.join("|") + ")\\b" : "(" + e.join("|") + ")", c ? new RegExp(f) : new RegExp(f, "i")
        }

        var c = {node: null, pattern: null, tagName: "strong", className: null, wordsOnly: !1, caseSensitive: !1};
        return function (f) {
            function h(b) {
                var c, d, e;
                return (c = g.exec(b.data)) && (e = a.createElement(f.tagName), f.className && (e.className = f.className), d = b.splitText(c.index), d.splitText(c[0].length), e.appendChild(d.cloneNode(!0)), b.parentNode.replaceChild(e, d)), !!c
            }

            function i(a, b) {
                for (var c, d = 3, e = 0; e < a.childNodes.length; e++)c = a.childNodes[e], c.nodeType === d ? e += b(c) ? 1 : 0 : i(c, b)
            }

            var g;
            f = b.mixin({}, c, f), f.node && f.pattern && (f.pattern = b.isArray(f.pattern) ? f.pattern : [f.pattern], g = d(f.pattern, f.caseSensitive, f.wordsOnly), i(f.node, h))
        }
    }(window.document), g = function () {
        "use strict";
        function d(c, d) {
            c = c || {}, c.input || a.error("input is missing"), d.mixin(this), this.$hint = a(c.hint), this.$input = a(c.input), this.query = this.$input.val(), this.queryWhenFocused = this.hasFocus() ? this.query : null, this.$overflowHelper = f(this.$input), this._checkLanguageDirection(), 0 === this.$hint.length && (this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = b.noop)
        }

        function f(b) {
            return a('<pre aria-hidden="true"></pre>').css({
                position: "absolute",
                visibility: "hidden",
                whiteSpace: "pre",
                fontFamily: b.css("font-family"),
                fontSize: b.css("font-size"),
                fontStyle: b.css("font-style"),
                fontVariant: b.css("font-variant"),
                fontWeight: b.css("font-weight"),
                wordSpacing: b.css("word-spacing"),
                letterSpacing: b.css("letter-spacing"),
                textIndent: b.css("text-indent"),
                textRendering: b.css("text-rendering"),
                textTransform: b.css("text-transform")
            }).insertAfter(b)
        }

        function g(a, b) {
            return d.normalizeQuery(a) === d.normalizeQuery(b)
        }

        function h(a) {
            return a.altKey || a.ctrlKey || a.metaKey || a.shiftKey
        }

        var c;
        return c = {
            9: "tab",
            27: "esc",
            37: "left",
            39: "right",
            13: "enter",
            38: "up",
            40: "down"
        }, d.normalizeQuery = function (a) {
            return b.toStr(a).replace(/^\s*/g, "").replace(/\s{2,}/g, " ")
        }, b.mixin(d.prototype, e, {
            _onBlur: function () {
                this.resetInputValue(), this.trigger("blurred")
            }, _onFocus: function () {
                this.queryWhenFocused = this.query, this.trigger("focused")
            }, _onKeydown: function (b) {
                var d = c[b.which || b.keyCode];
                this._managePreventDefault(d, b), d && this._shouldTrigger(d, b) && this.trigger(d + "Keyed", b)
            }, _onInput: function () {
                this._setQuery(this.getInputValue()), this.clearHintIfInvalid(), this._checkLanguageDirection()
            }, _managePreventDefault: function (b, c) {
                var d;
                switch (b) {
                    case"up":
                    case"down":
                        d = !h(c);
                        break;
                    default:
                        d = !1
                }
                d && c.preventDefault()
            }, _shouldTrigger: function (b, c) {
                var d;
                switch (b) {
                    case"tab":
                        d = !h(c);
                        break;
                    default:
                        d = !0
                }
                return d
            }, _checkLanguageDirection: function () {
                var b = (this.$input.css("direction") || "ltr").toLowerCase();
                this.dir !== b && (this.dir = b,
                    this.$hint.attr("dir", b), this.trigger("langDirChanged", b))
            }, _setQuery: function (b, c) {
                var d, e;
                d = g(b, this.query), e = !!d && this.query.length !== b.length, this.query = b, c || d ? !c && e && this.trigger("whitespaceChanged", this.query) : this.trigger("queryChanged", this.query)
            }, bind: function () {
                var d, e, f, g, a = this;
                return d = b.bind(this._onBlur, this), e = b.bind(this._onFocus, this), f = b.bind(this._onKeydown, this), g = b.bind(this._onInput, this), this.$input.on("blur.tt", d).on("focus.tt", e).on("keydown.tt", f), !b.isMsie() || b.isMsie() > 9 ? this.$input.on("input.tt", g) : this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function (d) {
                    c[d.which || d.keyCode] || b.defer(b.bind(a._onInput, a, d))
                }), this
            }, focus: function () {
                this.$input.focus()
            }, blur: function () {
                this.$input.blur()
            }, getLangDir: function () {
                return this.dir
            }, getQuery: function () {
                return this.query || ""
            }, setQuery: function (b, c) {
                this.setInputValue(b), this._setQuery(b, c)
            }, hasQueryChangedSinceLastFocus: function () {
                return this.query !== this.queryWhenFocused
            }, getInputValue: function () {
                return this.$input.val()
            }, setInputValue: function (b) {
                this.$input.val(b), this.clearHintIfInvalid(), this._checkLanguageDirection()
            }, resetInputValue: function () {
                this.setInputValue(this.query)
            }, getHint: function () {
                return this.$hint.val()
            }, setHint: function (b) {
                this.$hint.val(b)
            }, clearHint: function () {
                this.setHint("")
            }, clearHintIfInvalid: function () {
                var b, c, d, e;
                b = this.getInputValue(), c = this.getHint(), d = b !== c && 0 === c.indexOf(b), e = "" !== b && d && !this.hasOverflow(), !e && this.clearHint()
            }, hasFocus: function () {
                return this.$input.is(":focus")
            }, hasOverflow: function () {
                var b = this.$input.width() - 2;
                return this.$overflowHelper.text(this.getInputValue()), this.$overflowHelper.width() >= b
            }, isCursorAtEnd: function () {
                var a, c, d;
                return a = this.$input.val().length, c = this.$input[0].selectionStart, b.isNumber(c) ? c === a : !document.selection || (d = document.selection.createRange(), d.moveStart("character", -a), a === d.text.length)
            }, destroy: function () {
                this.$hint.off(".tt"), this.$input.off(".tt"), this.$overflowHelper.remove(), this.$hint = this.$input = this.$overflowHelper = a("<div>")
            }
        }), d
    }(), h = function () {
        "use strict";
        function g(c, e) {
            c = c || {}, c.templates = c.templates || {}, c.templates.notFound = c.templates.notFound || c.templates.empty, c.source || a.error("missing source"), c.node || a.error("missing node"), c.name && !j(c.name) && a.error("invalid dataset name: " + c.name), e.mixin(this), this.highlight = !!c.highlight, this.name = c.name || d(), this.limit = c.limit || 5, this.displayFn = h(c.display || c.displayKey), this.templates = i(c.templates, this.displayFn), this.source = c.source.__ttAdapter ? c.source.__ttAdapter() : c.source, this.async = b.isUndefined(c.async) ? this.source.length > 2 : !!c.async, this._resetLastSuggestion(), this.$el = a(c.node).addClass(this.classes.dataset).addClass(this.classes.dataset + "-" + this.name)
        }

        function h(a) {
            function c(b) {
                return b[a]
            }

            return a = a || b.stringify, b.isFunction(a) ? a : c
        }

        function i(c, d) {
            function e(b) {
                return a("<div>").text(d(b))
            }

            return {
                notFound: c.notFound && b.templatify(c.notFound),
                pending: c.pending && b.templatify(c.pending),
                header: c.header && b.templatify(c.header),
                footer: c.footer && b.templatify(c.footer),
                suggestion: c.suggestion || e
            }
        }

        function j(a) {
            return /^[_a-zA-Z0-9-]+$/.test(a)
        }

        var c, d;
        return c = {
            val: "tt-selectable-display",
            obj: "tt-selectable-object"
        }, d = b.getIdGenerator(), g.extractData = function (d) {
            var e = a(d);
            return e.data(c.obj) ? {val: e.data(c.val) || "", obj: e.data(c.obj) || null} : null
        }, b.mixin(g.prototype, e, {
            _overwrite: function (b, c) {
                c = c || [], c.length ? this._renderSuggestions(b, c) : this.async && this.templates.pending ? this._renderPending(b) : !this.async && this.templates.notFound ? this._renderNotFound(b) : this._empty(), this.trigger("rendered", this.name, c, !1)
            }, _append: function (b, c) {
                c = c || [], c.length && this.$lastSuggestion.length ? this._appendSuggestions(b, c) : c.length ? this._renderSuggestions(b, c) : !this.$lastSuggestion.length && this.templates.notFound && this._renderNotFound(b), this.trigger("rendered", this.name, c, !0)
            }, _renderSuggestions: function (b, c) {
                var d;
                d = this._getSuggestionsFragment(b, c), this.$lastSuggestion = d.children().last(), this.$el.html(d).prepend(this._getHeader(b, c)).append(this._getFooter(b, c))
            }, _appendSuggestions: function (b, c) {
                var d, e;
                d = this._getSuggestionsFragment(b, c), e = d.children().last(), this.$lastSuggestion.after(d), this.$lastSuggestion = e
            }, _renderPending: function (b) {
                var c = this.templates.pending;
                this._resetLastSuggestion(), c && this.$el.html(c({query: b, dataset: this.name}))
            }, _renderNotFound: function (b) {
                var c = this.templates.notFound;
                this._resetLastSuggestion(), c && this.$el.html(c({query: b, dataset: this.name}))
            }, _empty: function () {
                this.$el.empty(), this._resetLastSuggestion()
            }, _getSuggestionsFragment: function (e, g) {
                var i, h = this;
                return i = document.createDocumentFragment(), b.each(g, function (d) {
                    var f, g;
                    g = h._injectQuery(e, d), f = a(h.templates.suggestion(g)).data(c.obj, d).data(c.val, h.displayFn(d)).addClass(h.classes.suggestion + " " + h.classes.selectable), i.appendChild(f[0])
                }), this.highlight && f({className: this.classes.highlight, node: i, pattern: e}), a(i)
            }, _getFooter: function (b, c) {
                return this.templates.footer ? this.templates.footer({
                    query: b,
                    suggestions: c,
                    dataset: this.name
                }) : null
            }, _getHeader: function (b, c) {
                return this.templates.header ? this.templates.header({
                    query: b,
                    suggestions: c,
                    dataset: this.name
                }) : null
            }, _resetLastSuggestion: function () {
                this.$lastSuggestion = a()
            }, _injectQuery: function (c, d) {
                return b.isObject(d) ? b.mixin({_query: c}, d) : d
            }, update: function (c) {
                function h(a) {
                    f || (f = !0, a = (a || []).slice(0, d.limit), g = a.length, d._overwrite(c, a), g < d.limit && d.async && d.trigger("asyncRequested", c))
                }

                function i(b) {
                    b = b || [], !e && g < d.limit && (d.cancel = a.noop, g += b.length, d._append(c, b), d.async && d.trigger("asyncReceived", c))
                }

                var d = this, e = !1, f = !1, g = 0;
                this.cancel(), this.cancel = function () {
                    e = !0, d.cancel = a.noop, d.async && d.trigger("asyncCanceled", c)
                }, this.source(c, h, i), !f && h([])
            }, cancel: a.noop, clear: function () {
                this._empty(), this.cancel(), this.trigger("cleared")
            }, isEmpty: function () {
                return this.$el.is(":empty")
            }, destroy: function () {
                this.$el = a("<div>")
            }
        }), g
    }(), i = function () {
        "use strict";
        function c(c, d) {
            function f(b) {
                var c = e.$node.find(b.node).first();
                return b.node = c.length ? c : a("<div>").appendTo(e.$node), new h(b, d)
            }

            var e = this;
            c = c || {}, c.node || a.error("node is required"), d.mixin(this), this.$node = a(c.node), this.query = null, this.datasets = b.map(c.datasets, f)
        }

        return b.mixin(c.prototype, e, {
            _onSelectableClick: function (c) {
                this.trigger("selectableClicked", a(c.currentTarget))
            }, _onRendered: function (b, c, d, e) {
                this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()), this.trigger("datasetRendered", c, d, e)
            }, _onCleared: function () {
                this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()), this.trigger("datasetCleared")
            }, _propagate: function () {
                this.trigger.apply(this, arguments)
            }, _allDatasetsEmpty: function () {
                function c(a) {
                    return a.isEmpty()
                }

                return b.every(this.datasets, c)
            }, _getSelectables: function () {
                return this.$node.find(this.selectors.selectable)
            }, _removeCursor: function () {
                var b = this.getActiveSelectable();
                b && b.removeClass(this.classes.cursor)
            }, _ensureVisible: function (b) {
                var c, d, e, f;
                c = b.position().top, d = c + b.outerHeight(!0), e = this.$node.scrollTop(), f = this.$node.height() + parseInt(this.$node.css("paddingTop"), 10) + parseInt(this.$node.css("paddingBottom"), 10), c < 0 ? this.$node.scrollTop(e + c) : f < d && this.$node.scrollTop(e + (d - f))
            }, bind: function () {
                var c, a = this;
                return c = b.bind(this._onSelectableClick, this), this.$node.on("click.tt", this.selectors.selectable, c), b.each(this.datasets, function (b) {
                    b.onSync("asyncRequested", a._propagate, a).onSync("asyncCanceled", a._propagate, a).onSync("asyncReceived", a._propagate, a).onSync("rendered", a._onRendered, a).onSync("cleared", a._onCleared, a)
                }), this
            }, isOpen: function () {
                return this.$node.hasClass(this.classes.open)
            }, open: function () {
                this.$node.addClass(this.classes.open)
            }, close: function () {
                this.$node.removeClass(this.classes.open), this._removeCursor()
            }, setLanguageDirection: function (b) {
                this.$node.attr("dir", b)
            }, selectableRelativeToCursor: function (b) {
                var c, d, e, f;
                return d = this.getActiveSelectable(), c = this._getSelectables(), e = d ? c.index(d) : -1, f = e + b, f = (f + 1) % (c.length + 1) - 1, f = f < -1 ? c.length - 1 : f, f === -1 ? null : c.eq(f)
            }, setCursor: function (b) {
                this._removeCursor(), (b = b && b.first()) && (b.addClass(this.classes.cursor), this._ensureVisible(b))
            }, getSelectableData: function (b) {
                return b && b.length ? h.extractData(b) : null
            }, getActiveSelectable: function () {
                var b = this._getSelectables().filter(this.selectors.cursor).first();
                return b.length ? b : null
            }, getTopSelectable: function () {
                var b = this._getSelectables().first();
                return b.length ? b : null
            }, update: function (c) {
                function e(a) {
                    a.update(c)
                }

                var d = c !== this.query;
                return d && (this.query = c, b.each(this.datasets, e)), d
            }, empty: function () {
                function c(a) {
                    a.clear()
                }

                b.each(this.datasets, c), this.query = null, this.$node.addClass(this.classes.empty)
            }, destroy: function () {
                function d(a) {
                    a.destroy()
                }

                this.$node.off(".tt"), this.$node = a("<div>"), b.each(this.datasets, d)
            }
        }), c
    }(), j = function () {
        "use strict";
        function c() {
            i.apply(this, [].slice.call(arguments, 0))
        }

        var a = i.prototype;
        return b.mixin(c.prototype, i.prototype, {
            open: function () {
                return !this._allDatasetsEmpty() && this._show(), a.open.apply(this, [].slice.call(arguments, 0))
            }, close: function () {
                return this._hide(), a.close.apply(this, [].slice.call(arguments, 0))
            }, _onRendered: function () {
                return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(), a._onRendered.apply(this, [].slice.call(arguments, 0))
            }, _onCleared: function () {
                return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(), a._onCleared.apply(this, [].slice.call(arguments, 0))
            }, setLanguageDirection: function (c) {
                return this.$node.css("ltr" === c ? this.css.ltr : this.css.rtl), a.setLanguageDirection.apply(this, [].slice.call(arguments, 0))
            }, _hide: function () {
                this.$node.hide()
            }, _show: function () {
                this.$node.css("display", "block")
            }
        }), c
    }(), k = function () {
        "use strict";
        function c(c, e) {
            var f, g, h, i, j, k, l, m, n, o, p;
            c = c || {}, c.input || a.error("missing input"), c.menu || a.error("missing menu"), c.eventBus || a.error("missing event bus"), e.mixin(this), this.eventBus = c.eventBus, this.minLength = b.isNumber(c.minLength) ? c.minLength : 1, this.input = c.input, this.menu = c.menu, this.enabled = !0, this.active = !1, this.input.hasFocus() && this.activate(), this.dir = this.input.getLangDir(), this._hacks(), this.menu.bind().onSync("selectableClicked", this._onSelectableClicked, this).onSync("asyncRequested", this._onAsyncRequested, this).onSync("asyncCanceled", this._onAsyncCanceled, this).onSync("asyncReceived", this._onAsyncReceived, this).onSync("datasetRendered", this._onDatasetRendered, this).onSync("datasetCleared", this._onDatasetCleared, this), f = d(this, "activate", "open", "_onFocused"), g = d(this, "deactivate", "_onBlurred"), h = d(this, "isActive", "isOpen", "_onEnterKeyed"), i = d(this, "isActive", "isOpen", "_onTabKeyed"), j = d(this, "isActive", "_onEscKeyed"), k = d(this, "isActive", "open", "_onUpKeyed"), l = d(this, "isActive", "open", "_onDownKeyed"), m = d(this, "isActive", "isOpen", "_onLeftKeyed"), n = d(this, "isActive", "isOpen", "_onRightKeyed"), o = d(this, "_openIfActive", "_onQueryChanged"), p = d(this, "_openIfActive", "_onWhitespaceChanged"), this.input.bind().onSync("focused", f, this).onSync("blurred", g, this).onSync("enterKeyed", h, this).onSync("tabKeyed", i, this).onSync("escKeyed", j, this).onSync("upKeyed", k, this).onSync("downKeyed", l, this).onSync("leftKeyed", m, this).onSync("rightKeyed", n, this).onSync("queryChanged", o, this).onSync("whitespaceChanged", p, this).onSync("langDirChanged", this._onLangDirChanged, this)
        }

        function d(a) {
            var c = [].slice.call(arguments, 1);
            return function () {
                var d = [].slice.call(arguments);
                b.each(c, function (b) {
                    return a[b].apply(a, d)
                })
            }
        }

        return b.mixin(c.prototype, {
            _hacks: function () {
                var d, e;
                d = this.input.$input || a("<div>"), e = this.menu.$node || a("<div>"), d.on("blur.tt", function (a) {
                    var c, f, g;
                    c = document.activeElement, f = e.is(c), g = e.has(c).length > 0, b.isMsie() && (f || g) && (a.preventDefault(), a.stopImmediatePropagation(), b.defer(function () {
                        d.focus()
                    }))
                }), e.on("mousedown.tt", function (a) {
                    a.preventDefault()
                })
            }, _onSelectableClicked: function (b, c) {
                this.select(c)
            }, _onDatasetCleared: function () {
                this._updateHint()
            }, _onDatasetRendered: function (b, c, d, e) {
                this._updateHint(), this.eventBus.trigger("render", d, e, c)
            }, _onAsyncRequested: function (b, c, d) {
                this.eventBus.trigger("asyncrequest", d, c)
            }, _onAsyncCanceled: function (b, c, d) {
                this.eventBus.trigger("asynccancel", d, c)
            }, _onAsyncReceived: function (b, c, d) {
                this.eventBus.trigger("asyncreceive", d, c)
            }, _onFocused: function () {
                this._minLengthMet() && this.menu.update(this.input.getQuery())
            }, _onBlurred: function () {
                this.input.hasQueryChangedSinceLastFocus() && this.eventBus.trigger("change", this.input.getQuery())
            }, _onEnterKeyed: function (b, c) {
                var d;
                (d = this.menu.getActiveSelectable()) && this.select(d) && c.preventDefault()
            }, _onTabKeyed: function (b, c) {
                var d;
                (d = this.menu.getActiveSelectable()) ? this.select(d) && c.preventDefault() : (d = this.menu.getTopSelectable()) && this.autocomplete(d) && c.preventDefault()
            }, _onEscKeyed: function () {
                this.close()
            }, _onUpKeyed: function () {
                this.moveCursor(-1)
            }, _onDownKeyed: function () {
                this.moveCursor(1)
            }, _onLeftKeyed: function () {
                "rtl" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
            }, _onRightKeyed: function () {
                "ltr" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
            }, _onQueryChanged: function (b, c) {
                this._minLengthMet(c) ? this.menu.update(c) : this.menu.empty()
            }, _onWhitespaceChanged: function () {
                this._updateHint()
            }, _onLangDirChanged: function (b, c) {
                this.dir !== c && (this.dir = c, this.menu.setLanguageDirection(c))
            }, _openIfActive: function () {
                this.isActive() && this.open()
            }, _minLengthMet: function (c) {
                return c = b.isString(c) ? c : this.input.getQuery() || "", c.length >= this.minLength
            }, _updateHint: function () {
                var c, d, e, f, h, i, j;
                c = this.menu.getTopSelectable(), d = this.menu.getSelectableData(c), e = this.input.getInputValue(), !d || b.isBlankString(e) || this.input.hasOverflow() ? this.input.clearHint() : (f = g.normalizeQuery(e), h = b.escapeRegExChars(f), i = new RegExp("^(?:" + h + ")(.+$)", "i"), j = i.exec(d.val), j && this.input.setHint(e + j[1]))
            }, isEnabled: function () {
                return this.enabled
            }, enable: function () {
                this.enabled = !0
            }, disable: function () {
                this.enabled = !1
            }, isActive: function () {
                return this.active
            }, activate: function () {
                return !!this.isActive() || !(!this.isEnabled() || this.eventBus.before("active")) && (this.active = !0, this.eventBus.trigger("active"), !0)
            }, deactivate: function () {
                return !this.isActive() || !this.eventBus.before("idle") && (this.active = !1, this.close(), this.eventBus.trigger("idle"), !0)
            }, isOpen: function () {
                return this.menu.isOpen()
            }, open: function () {
                return this.isOpen() || this.eventBus.before("open") || (this.menu.open(), this._updateHint(), this.eventBus.trigger("open")), this.isOpen()
            }, close: function () {
                return this.isOpen() && !this.eventBus.before("close") && (this.menu.close(), this.input.clearHint(), this.input.resetInputValue(), this.eventBus.trigger("close")), !this.isOpen()
            }, setVal: function (c) {
                this.input.setQuery(b.toStr(c))
            }, getVal: function () {
                return this.input.getQuery()
            }, select: function (b) {
                var c = this.menu.getSelectableData(b);
                return !(!c || this.eventBus.before("select", c.obj)) && (this.input.setQuery(c.val, !0), this.eventBus.trigger("select", c.obj), this.close(), !0)
            }, autocomplete: function (b) {
                var c, d, e;
                return c = this.input.getQuery(), d = this.menu.getSelectableData(b), e = d && c !== d.val, !(!e || this.eventBus.before("autocomplete", d.obj)) && (this.input.setQuery(d.val), this.eventBus.trigger("autocomplete", d.obj), !0)
            }, moveCursor: function (b) {
                var c, d, e, f, g;
                return c = this.input.getQuery(), d = this.menu.selectableRelativeToCursor(b), e = this.menu.getSelectableData(d), f = e ? e.obj : null, g = this._minLengthMet() && this.menu.update(c), !g && !this.eventBus.before("cursorchange", f) && (this.menu.setCursor(d), e ? this.input.setInputValue(e.val) : (this.input.resetInputValue(), this._updateHint()), this.eventBus.trigger("cursorchange", f), !0)
            }, destroy: function () {
                this.input.destroy(), this.menu.destroy()
            }
        }), c
    }();
    !function () {
        "use strict";
        function l(b, c) {
            b.each(function () {
                var d, b = a(this);
                (d = b.data(f.typeahead)) && c(d, b)
            })
        }

        function m(a, b) {
            return a.clone().addClass(b.classes.hint).removeData().css(b.css.hint).css(o(a)).prop("readonly", !0).removeAttr("id name placeholder required").attr({
                autocomplete: "off",
                spellcheck: "false",
                tabindex: -1
            })
        }

        function n(a, b) {
            a.data(f.attrs, {
                dir: a.attr("dir"),
                autocomplete: a.attr("autocomplete"),
                spellcheck: a.attr("spellcheck"),
                style: a.attr("style")
            }), a.addClass(b.classes.input).attr({autocomplete: "off", spellcheck: !1});
            try {
                !a.attr("dir") && a.attr("dir", "auto")
            } catch (a) {
            }
            return a
        }

        function o(a) {
            return {
                backgroundAttachment: a.css("background-attachment"),
                backgroundClip: a.css("background-clip"),
                backgroundColor: a.css("background-color"),
                backgroundImage: a.css("background-image"),
                backgroundOrigin: a.css("background-origin"),
                backgroundPosition: a.css("background-position"),
                backgroundRepeat: a.css("background-repeat"),
                backgroundSize: a.css("background-size")
            }
        }

        function p(a) {
            var c, d;
            c = a.data(f.www), d = a.parent().filter(c.selectors.wrapper), b.each(a.data(f.attrs), function (c, d) {
                b.isUndefined(c) ? a.removeAttr(d) : a.attr(d, c)
            }), a.removeData(f.typeahead).removeData(f.www).removeData(f.attr).removeClass(c.classes.input), d.length && (a.detach().insertAfter(d), d.remove())
        }

        function q(c) {
            var d, e;
            return d = b.isJQuery(c) || b.isElement(c), e = d ? a(c).first() : [], e.length ? e : null
        }

        var e, f, h;
        e = a.fn.typeahead, f = {
            www: "tt-www",
            attrs: "tt-attrs",
            typeahead: "tt-typeahead"
        }, h = {
            initialize: function (h, l) {
                function p() {
                    var c, e, p, r, s, t, u, v, w, x, y;
                    b.each(l, function (a) {
                        a.highlight = !!h.highlight
                    }), c = a(this), e = a(o.html.wrapper), p = q(h.hint), r = q(h.menu), s = h.hint !== !1 && !p, t = h.menu !== !1 && !r, s && (p = m(c, o)), t && (r = a(o.html.menu).css(o.css.menu)), p && p.val(""), c = n(c, o), (s || t) && (e.css(o.css.wrapper), c.css(s ? o.css.input : o.css.inputWithNoHint), c.wrap(e).parent().prepend(s ? p : null).append(t ? r : null)), y = t ? j : i, u = new d({el: c}), v = new g({
                        hint: p,
                        input: c
                    }, o), w = new y({node: r, datasets: l}, o), x = new k({
                        input: v,
                        menu: w,
                        eventBus: u,
                        minLength: h.minLength
                    }, o), c.data(f.www, o), c.data(f.typeahead, x)
                }

                var o;
                return l = b.isArray(l) ? l : [].slice.call(arguments, 1), h = h || {}, o = c(h.classNames), this.each(p)
            }, isEnabled: function () {
                var b;
                return l(this.first(), function (a) {
                    b = a.isEnabled()
                }), b
            }, enable: function () {
                return l(this, function (a) {
                    a.enable()
                }), this
            }, disable: function () {
                return l(this, function (a) {
                    a.disable()
                }), this
            }, isActive: function () {
                var b;
                return l(this.first(), function (a) {
                    b = a.isActive()
                }), b
            }, activate: function () {
                return l(this, function (a) {
                    a.activate()
                }), this
            }, deactivate: function () {
                return l(this, function (a) {
                    a.deactivate()
                }), this
            }, isOpen: function () {
                var b;
                return l(this.first(), function (a) {
                    b = a.isOpen()
                }), b
            }, open: function () {
                return l(this, function (a) {
                    a.open()
                }), this
            }, close: function () {
                return l(this, function (a) {
                    a.close()
                }), this
            }, select: function (c) {
                var d = !1, e = a(c);
                return l(this.first(), function (a) {
                    d = a.select(e)
                }), d
            }, autocomplete: function (c) {
                var d = !1, e = a(c);
                return l(this.first(), function (a) {
                    d = a.autocomplete(e)
                }), d
            }, moveCursor: function (b) {
                var c = !1;
                return l(this.first(), function (a) {
                    c = a.moveCursor(b)
                }), c
            }, val: function (b) {
                var c;
                return arguments.length ? (l(this, function (a) {
                    a.setVal(b)
                }), this) : (l(this.first(), function (a) {
                    c = a.getVal()
                }), c)
            }, destroy: function () {
                return l(this, function (a, b) {
                    p(b), a.destroy()
                }), this
            }
        }, a.fn.typeahead = function (a) {
            return h[a] ? h[a].apply(this, [].slice.call(arguments, 1)) : h.initialize.apply(this, arguments)
        }, a.fn.typeahead.noConflict = function () {
            return a.fn.typeahead = e, this
        }
    }()
});
var HoganTemplate = function () {
    function a(a) {
        this.text = a
    }

    function h(a) {
        var h = String(a === null ? "" : a);
        return g.test(h) ? h.replace(b, "&amp;").replace(c, "&lt;").replace(d, "&gt;").replace(e, "&#39;").replace(f, "&quot;") : h
    }

    a.prototype = {
        r: function (a, b) {
            return ""
        }, v: h, render: function (a, b) {
            return this.r(a, b)
        }, rp: function (a, b, c, d) {
            var e = c[a];
            return e ? e.render(b, c) : ""
        }, rs: function (a, b, c) {
            var d = "", e = a[a.length - 1];
            if (!i(e))return d = c(a, b), d;
            for (var f = 0; f < e.length; f++)a.push(e[f]), d += c(a, b), a.pop();
            return d
        }, s: function (a, b, c, d, e, f) {
            if (i(a) && a.length === 0)return !1;
            !d && typeof a == "function" && (a = this.ls(a, b, c, e, f));
            var g = a === "" || !!a;
            return !d && g && b && b.push(typeof a == "object" ? a : b[b.length - 1]), g
        }, d: function (a, b, c, d) {
            if (a === "." && i(b[b.length - 2]))return b[b.length - 1];
            var e = a.split("."), f = this.f(e[0], b, c, d), g = null;
            for (var h = 1; h < e.length; h++)f && typeof f == "object" && e[h] in f ? (g = f, f = f[e[h]]) : f = "";
            return d && !f ? !1 : (!d && typeof f == "function" && (b.push(g), f = this.lv(f, b, c), b.pop()), f)
        }, f: function (a, b, c, d) {
            var e = !1, f = null, g = !1;
            for (var h = b.length - 1; h >= 0; h--) {
                f = b[h];
                if (f && typeof f == "object" && a in f) {
                    e = f[a], g = !0;
                    break
                }
            }
            return g ? (!d && typeof e == "function" && (e = this.lv(e, b, c)), e) : d ? !1 : ""
        }, ho: function (a, b, c, d) {
            var e = a.call(b, d, function (a) {
                return Hogan.compile(a).render(b)
            }), f = Hogan.compile(e.toString()).render(b, c);
            return this.b = f, !1
        }, b: "", ls: function (a, b, c, d, e) {
            var f = b[b.length - 1];
            if (a.length > 0)return this.ho(a, f, c, this.text.substring(d, e));
            var g = a.call(f);
            return typeof g == "function" ? this.ho(g, f, c, this.text.substring(d, e)) : g
        }, lv: function (a, b, c) {
            var d = b[b.length - 1];
            return Hogan.compile(a.call(d).toString()).render(d, c)
        }
    };
    var b = /&/g, c = /</g, d = />/g, e = /\'/g, f = /\"/g, g = /[&<>\"\']/, i = Array.isArray || function (a) {
            return Object.prototype.toString.call(a) === "[object Array]"
        };
    return a
}(), Hogan = function () {
    function a(a) {
        function s() {
            l.length > 0 && (m.push(new String(l)), l = "")
        }

        function t() {
            var a = !0;
            for (var b = p; b < m.length; b++) {
                a = m[b].tag && d[m[b].tag] < d._v || !m[b].tag && m[b].match(c) == null;
                if (!a)return !1
            }
            return a
        }

        function u(a, b) {
            s();
            if (a && t())for (var c = p; c < m.length; c++)m[c].tag || m.splice(c, 1); else b || m.push({tag: "\n"});
            n = !1, p = m.length
        }

        function v(a, c) {
            var d = "=" + r, e = a.indexOf(d, c), f = b(a.substring(a.indexOf("=", c) + 1, e)).split(" ");
            return q = f[0], r = f[1], e + d.length - 1
        }

        var f = a.length, g = 0, h = 1, i = 2, j = g, k = null, l = "", m = [], n = !1, o = 0, p = 0, q = "{{", r = "}}";
        for (o = 0; o < f; o++)if (j == g) e(q, a, o) ? (--o, s(), j = h) : a[o] == "\n" ? u(n) : l += a[o]; else if (j == h) {
            o += q.length - 1;
            var w = d[a[o + 1]];
            k = w ? a[o + 1] : "_v", n = o, k == "=" ? (o = v(a, o), j = g) : (w && o++, j = i)
        } else e(r, a, o) ? (o += r.length - 1, m.push({
            tag: k,
            n: b(l),
            i: k == "/" ? n - 1 : o + 1
        }), l = "", j = g, k == "{" && o++) : l += a[o];
        return u(n, !0), m
    }

    function b(a) {
        return a.trim ? a.trim() : a.replace(/^\s*|\s*$/g, "")
    }

    function e(a, b, c) {
        if (b[c] != a[0])return !1;
        for (var d = 1, e = a.length; d < e; d++)if (b[c + d] != a[d])return !1;
        return !0
    }

    function f(a, b, c, d) {
        var e = [], i = null, j = null;
        while (a.length > 0) {
            j = a.shift();
            if (j.tag == "#" || j.tag == "^" || g(j, d)) c.push(j), j.nodes = f(a, j.tag, c, d), e.push(j); else {
                if (j.tag == "/") {
                    if (c.length == 0)throw new Error("Closing tag without opener: /" + j.n);
                    i = c.pop();
                    if (j.n != i.n && !h(j.n, i.n, d))throw new Error("Nesting error: " + i.n + " vs. " + j.n);
                    return i.end = j.i, e
                }
                e.push(j)
            }
        }
        if (c.length > 0)throw new Error("missing closing tag: " + c.pop().n);
        return e
    }

    function g(a, b) {
        for (var c = 0, d = b.length; c < d; c++)if (b[c].o == a.n)return a.tag = "#", !0
    }

    function h(a, b, c) {
        for (var d = 0, e = c.length; d < e; d++)if (c[d].c == a && c[d].o == b)return !0
    }

    function i(a, b, c) {
        var d = 'var c = [cx];var b = "";var _ = this;' + p(a) + "return b;";
        if (c.asString)return "function(cx,p){" + d + ";};";
        var e = new HoganTemplate(b);
        return e.r = new Function("cx", "p", d), e
    }

    function n(a) {
        return a.replace(m, "\\\\").replace(j, '\\"').replace(k, "\\n").replace(l, "\\r")
    }

    function o(a) {
        return ~a.indexOf(".") ? "d" : "f"
    }

    function p(a) {
        var b = "";
        for (var c = 0, d = a.length; c < d; c++) {
            var e = a[c].tag;
            e == "#" ? b += q(a[c].nodes, a[c].n, o(a[c].n), a[c].i, a[c].end) : e == "^" ? b += r(a[c].nodes, a[c].n, o(a[c].n)) : e == "<" || e == ">" ? b += s(a[c].n) : e == "{" || e == "&" ? b += t(a[c].n, o(a[c].n)) : e == "\n" ? b += v("\n") : e == "_v" ? b += u(a[c].n, o(a[c].n)) : e === undefined && (b += v(a[c]))
        }
        return b
    }

    function q(a, b, c, d, e) {
        var f = "if(_.s(_." + c + '("' + n(b) + '",c,p,1),';
        return f += "c,p,0," + d + "," + e + ")){", f += "b += _.rs(c,p,", f += 'function(c,p){ var b = "";', f += p(a), f += "return b;});c.pop();}", f += 'else{b += _.b; _.b = ""};', f
    }

    function r(a, b, c) {
        var d = "if (!_.s(_." + c + '("' + n(b) + '",c,p,1),c,p,1,0,0)){';
        return d += p(a), d += "};", d
    }

    function s(a) {
        return 'b += _.rp("' + n(a) + '",c[c.length - 1],p);'
    }

    function t(a, b) {
        return "b += (_." + b + '("' + n(a) + '",c,p,0));'
    }

    function u(a, b) {
        return "b += (_.v(_." + b + '("' + n(a) + '",c,p,0)));'
    }

    function v(a) {
        return 'b += "' + n(a) + '";'
    }

    var c = /\S/, d = {
        "#": 1,
        "^": 2,
        "/": 3,
        "!": 4,
        ">": 5,
        "<": 6,
        "=": 7,
        _v: 8,
        "{": 9,
        "&": 10
    }, j = /\"/g, k = /\n/g, l = /\r/g, m = /\\/g;
    return {
        scan: a, parse: function (a, b) {
            return b = b || {}, f(a, "", [], b.sectionTags || [])
        }, cache: {}, compile: function (b, c) {
            c = c || {};
            var d = this.cache[b];
            return d ? d : (d = i(this.parse(a(b), c), b, c), this.cache[b] = d)
        }
    }
}();
typeof module != "undefined" && module.exports ? (module.exports = Hogan, module.exports.Template = HoganTemplate) : typeof exports != "undefined" && (exports.Hogan = Hogan, exports.HoganTemplate = HoganTemplate);
!function (a) {
    "use strict";
    "function" == typeof define && define.amd ? define(a) : "object" == typeof module ? module.exports = a() : window.EventEmitter = a()
}(function () {
    "use strict";
    var a = function () {
        return this._events = {}, this
    }, b = function (a, b, c) {
        var d = [];
        b || (b = 0), c || (c = a.length);
        for (var e = b; c > e; e++)d.push(a[e]);
        return d
    }, c = a.execListener = function (a, b) {
        return "function" == typeof a ? a.apply(a, b) : "object" == typeof a && "function" == typeof a.handleEvent ? a.handleEvent.apply(a, b) : void 0
    }, d = a.regexps = {}, e = a.eventRegexp = function (a) {
        return d[a] || (d[a] = new RegExp("^" + a.replace("*", ".*") + "$")), d[a]
    };
    a.prototype.emit = a.prototype.fire = a.prototype.trigger = function (a) {
        var d = b(arguments, 1);
        d.push(a);
        var f = e(a);
        a:for (var g in this._events) {
            var h = e(g);
            if (h.test(a) || f.test(g))for (var i = this._events[g], j = 0, k = i.length; k > j; j++) {
                var l = c(i[j], d, a);
                if (l === !1)break a
            }
        }
        return this
    }, a.prototype.on = a.prototype.addListener = a.prototype.addEventListener = function (a, b) {
        return this._events[a] || (this._events[a] = []), this._events[a].push(b), e(a), this.emit("newListener", a, b), this
    }, a.prototype.once = a.prototype.addOnceListener = function (a, b) {
        var d = this, e = function () {
            c(b, arguments), d.removeListener(a, this)
        };
        return this.addListener(a, e), this
    }, a.prototype.many = a.prototype.addManyListener = function (a, b, d) {
        var e = this, f = 0, g = function () {
            c(b, arguments), f++, f === d && e.removeListener(a, this)
        };
        return this.addListener(a, g), this
    }, a.prototype.off = a.prototype.removeListener = a.prototype.removeEventListener = function (a, b, c) {
        var d = e(a);
        if (c) {
            for (var f in this._events)if (d.test(f)) {
                for (var g = this._events[f], h = [], i = 0, j = g.length; j > i; i++)g[i] !== b && h.push(g[i]);
                this._events[f] = h
            }
        } else for (var f in this._events)if (d.test(f)) {
            var k = this._events[f].indexOf(b);
            if (k > -1) {
                this._events[f].splice(k, 1);
                break
            }
        }
        return this
    }, a.prototype.offAll = a.prototype.removeAllListeners = function (a) {
        if (a) {
            var b = e(a);
            for (var c in this._events)b.test(c) && (this._events[c] = [])
        } else this._events = {};
        return this
    }, a.prototype.count = a.prototype.countListeners = function (a) {
        var b = 0;
        if (a) {
            var c = e(a);
            for (var d in this._events) {
                var f = e(d);
                (f.test(a) || c.test(d)) && (b += this._events[d].length)
            }
        } else for (var d in this._events)b += this._events[d].length;
        return b
    }, a.prototype.listeners = a.prototype.getListeners = function (a) {
        var b = [];
        if (a) {
            var c = e(a);
            for (var d in this._events) {
                var f = e(d);
                (f.test(a) || c.test(d)) && b.push.apply(b, this._events[d])
            }
        } else {
            var b = [];
            for (var d in this._events)b.push.apply(b, this._events[d])
        }
        return b
    };
    var f = function g(a, b) {
        var c = this;
        return c.emitter = a, c.scope = b, b += ":", c.emit = function (c) {
            return arguments[0] = b + c, a.emit.apply(a, arguments), this
        }, c.on = c.addListener = c.addEventListener = function (c, d) {
            return a.addListener(b + c, d), this
        }, c.once = c.addOnceListener = function (c, d) {
            return a.addOnceListener(b + c, d), this
        }, c.many = c.addManyListener = function (c, d, e) {
            return a.addManyListener(b + c, d, e), this
        }, c.off = c.removeListener = c.removeEventListener = function (c, d) {
            return a.removeListener(b + c, d), this
        }, c.offAll = c.removeAllListeners = function (c) {
            return a.removeAllListeners(b + (c ? c : "*")), this
        }, c.count = c.countListeners = function (c) {
            return a.countListeners(b + (c ? c : "*"))
        }, c.listeners = c.getListeners = function (c) {
            return a.getListeners(b + (c ? c : "*"))
        }, c.namespace = function (c) {
            return new g(a, b + c)
        }, c
    };
    return a.Namespace = f, a.prototype.namespace = function (a) {
        return new f(this, a)
    }, a
});
var RWebSocket = RWebSocket || new function () {
        this.SERVER = "ws.saavn.com";
        this.PORT = "8080";
        this.connectionObject;
        this.numReconnectAttempt = 0;
        this.maxAllowedReconnectAttempt = 3;
        this.reconnectInterval = 2e3;
        this.heartBeatInterval = 3e4;
        this.heartbeat_interval = null;
        this.missed_heartbeats = 0;
        this.heartbeat_msg = "";
        this.encryptedToken = [];
        this.myEvent = new EventEmitter;
        this.searchTimestamp = "";
        var _socketConnected = false;
        this.getWebSocketURL = function () {
            var url = "ws://" + this.SERVER + ":" + this.PORT;
            return url
        };
        this.isConnected = function () {
            return _socketConnected
        };
        this.resetReconnectInterval = function () {
            this.reconnectInterval = 2e3
        };
        this.setConnected = function (flag) {
            _socketConnected = flag
        };
        this.setMaxReconnectAttempt = function (value) {
            this.maxAllowedReconnectAttempt = value
        };
        this.setNumReconnectAttempt = function (value) {
            this.numReconnectAttempt = value
        }
    };
RWebSocket.myEvent.on("closeHeartbeat", function (e) {
    clearInterval(RWebSocket.heartbeat_interval);
    RWebSocket.heartbeat_interval = null;
    Util.logInConsole("Closing connection. ")
});
RWebSocket.myEvent.on("heartbeat", function () {
    if (RWebSocket.heartbeat_interval === null) {
        RWebSocket.missed_heartbeats = 0;
        RWebSocket.heartbeat_interval = setInterval(function () {
            try {
                RWebSocket.missed_heartbeats++;
                if (RWebSocket.missed_heartbeats >= 2) {
                    throw new Error("Too many missed heartbeats.")
                }
                RWebSocket.connectionObject.send(RWebSocket.heartbeat_msg)
            } catch (e) {
                RWebSocket.connectionObject.close()
            }
        }, RWebSocket.heartBeatInterval)
    }
});
RWebSocket.myEvent.on("exceedMaxTries", function () {
    Util.logInConsole("Max allowed reconnect attempt limit exceeded")
});
RWebSocket.myEvent.on("tryReconnect", function () {
    RWebSocket.reconnectInterval = RWebSocket.reconnectInterval * 2;
    setTimeout(function () {
        RWebSocket.myEvent.emit("connectSocket")
    }, RWebSocket.reconnectInterval)
});
RWebSocket.myEvent.on("parseMessage", function (e) {
    if ("" == e.data) {
        RWebSocket.missed_heartbeats = 0
    } else {
        var data = JSON.parse(e.data);
        if ("search" == data["action"]) {
            if (RWebSocket.encryptedToken["search"] == data["token"]) {
                RWebSocket.myEvent.emit("search", data["resp"]);
                var time = new Date;
                var totalResponseTime = time - RWebSocket.searchTimestamp;
                Analytics.logStats(["ev", "get_autocomplete:call_time", "duration", totalResponseTime])
            }
        }
    }
});
RWebSocket.myEvent.on("connectSocket", function () {
    RWebSocket.connectionObject = new WebSocket(RWebSocket.getWebSocketURL());
    RWebSocket.connectionObject.onopen = function (e) {
        RWebSocket.setConnected(true);
        RWebSocket.resetReconnectInterval();
        RWebSocket.myEvent.emit("heartbeat");
        Util.logInConsole("Connection established!")
    };
    RWebSocket.connectionObject.onclose = function (e) {
        RWebSocket.setConnected(false);
        RWebSocket.myEvent.emit("closeHeartbeat", e);
        if (document.getElementsByClassName("show-spinner")[0] !== "undefined") {
            var a = [];
            var data = {artists: a, topquery: a, albums: a, songs: a, radios: a, playlists: a};
            RWebSocket.myEvent.emit("search", JSON.stringify(data))
        }
        Util.logInConsole("SystemError server closed: ", e ? e : "A unknown error occurred");
        RWebSocket.myEvent.emit("tryReconnect")
    };
    RWebSocket.connectionObject.onmessage = function (e) {
        RWebSocket.myEvent.emit("parseMessage", e)
    };
    RWebSocket.connectionObject.onerror = function (e) {
        RWebSocket.setConnected(false);
        RWebSocket.myEvent.emit("closeHeartbeat", e);
        if (document.getElementsByClassName("show-spinner")[0] !== "undefined") {
            var a = [];
            var data = {artists: a, topquery: a, albums: a, songs: a, radios: a, playlists: a};
            RWebSocket.myEvent.emit("search", JSON.stringify(data))
        }
        Util.logInConsole("SystemError: ", e ? e : "Aunknown error occurred")
    }
});
function StartConnection(host, port, maxReconnectNum) {
    host = host || null;
    port = port || null;
    maxReconnectNum = maxReconnectNum || null;
    if (host) {
        RWebSocket.SERVER = host
    }
    if (port) {
        RWebSocket.PORT = port
    }
    if (maxReconnectNum) {
        RWebSocket.setMaxReconnectAttempt(maxReconnectNum)
    }
    RWebSocket.myEvent.emit("connectSocket")
}
var autoComplete = autoComplete || new function () {
        var KEY_ESC = 27;
        var KEY_ENT = 13;
        var KEY_DOWN = 40;

        function hideAcPane() {
            $(".typeahead").typeahead("close");
            $(".typeahead").blur();
            $(autoComplete.field).removeClass("show-spinner");
            $("body").removeClass("show-ac")
        }

        function isEmpty(el) {
            return !$.trim(el.html())
        }

        function layoutColumns() {
            var colCount = 0;
            $('#home #fac-items div[class^="tt-dataset"]').each(function () {
                if (isEmpty($(this))) {
                    $(this).hide()
                } else {
                    $(this).show();
                    colCount++
                }
            });
            $("#fac-items").removeClass().addClass("cols-" + colCount)
        }

        function executeCall(url, onSuccess, onError) {
            if (RWebSocket.isConnected()) {
                var time = new Date;
                RWebSocket.searchTimestamp = time.getTime();
                $(autoComplete.field).addClass("show-spinner");
                RWebSocket.encryptedToken["search"] = btoa(unescape(encodeURIComponent(url["url"])));
                var message = {url: url["url"], token: RWebSocket.encryptedToken["search"]};
                RWebSocket.connectionObject.send(JSON.stringify(message));
                RWebSocket.myEvent.on("search", function (e) {
                    var def = onSuccess(JSON.parse(e));
                    def.done(function () {
                        $(autoComplete.field).removeClass("show-spinner");
                        if (autoComplete.manualFire) {
                            autoComplete.manualFire = false;
                            return
                        }
                        $("body").addClass("show-fac");
                        if (autoComplete.isHome) layoutColumns()
                    });
                    def.fail(function () {
                        Util.logInConsole("failed def")
                    })
                })
            } else {
                $(autoComplete.field).addClass("show-spinner");
                options = {type: "POST", dataType: "json"};
                $.ajax(url, options).done(done).fail(fail).always(always);
                function done(data, textStatus, request) {
                    $(autoComplete.field).removeClass("show-spinner");
                    var def = onSuccess(data);
                    def.done(function () {
                        if (autoComplete.manualFire) {
                            autoComplete.manualFire = false;
                            return
                        }
                        $("body").addClass("show-fac");
                        if (autoComplete.isHome) layoutColumns()
                    })
                }

                function fail(request, textStatus, errorThrown) {
                    onError(errorThrown)
                }

                function always() {
                }
            }
        }

        this.hide = function () {
            hideAcPane()
        };
        this.fireGenericSearch = function (type) {
            if (type === undefined)var type = "";
            var typeStr = "";
            if (type == "album" || type == "playlist") typeStr = type + "/";
            var q = autoComplete.isHome ? $.trim($("#search").val()) : $.trim($("#q").val());
            if (q.length == 0)return;
            q = q.replace(/\//g, "-");
            q = encodeURIComponent(q);
            url = "/search/" + typeStr + q.replace(/ /gi, "-");
            window.History.pushState({urlPath: url}, "", url);
            hideAcPane()
        };
        this.goToRadio = function () {
            var origin = "";
            if (autoComplete.isHome && Interface.localStorageSupport()) {
                localStorage.radioHomeClick = true;
                origin = "home:"
            }
            Interface.featuredStations = true;
            Util.logAndGoToUrl("site:" + origin + "autocomplete:radio:click", "/radio/" + Util.getLanguage())
        };
        $(function () {
            var server = $("#hdr-search").data("server") == undefined ? $("#home-search").data("server") : $("#hdr-search").data("server");
            StartConnection(server);
            if ($("body").attr("id") == "home") {
                autoComplete.isHome = true;
                autoComplete.field = $("#home-search-field")
            }
            var topQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace(encodeURI("title")),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.topquery.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            var artistQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.artists.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            var albumQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.albums.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            var songQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.songs.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            var radioQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.radios.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            var playlistQueries = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/api.php?__call=autocomplete.get&_marker=0&query=%QUERY", filter: function (response) {
                        return response.playlists.data
                    }, wildcard: "%QUERY", transport: function (url, onSuccess, onError) {
                        executeCall(url, onSuccess, onError)
                    }
                }
            });
            topQueries.initialize();
            artistQueries.initialize();
            albumQueries.initialize();
            songQueries.initialize();
            radioQueries.initialize();
            playlistQueries.initialize();
            var topquery = Hogan.compile(['<div class="fac-item topquery">', '       <div class="fac-img"><img src="{{image}}" alt="" /></div>', '       <div class="fac-info">', '               <p class="small right"></p>', '               <h3 class="ellip">{{{title}}}</h3>', '               <p class="ellip small meta multi-meta">{{{description}}}</p>', "       </div>", "</div>"].join(""));
            var album = Hogan.compile(['<div class="fac-item album">', '	<div class="fac-img"><img src="{{image}}" alt="" /></div>', '	<div class="fac-info">', '		<p class="small right meta-year">{{year}}</p>', '		<h3 class="ellip">{{{title}}}</h3>', '		<p class="ellip small meta">{{{music}}}</p>', "	</div>", "</div>"].join(""));
            var song = Hogan.compile(['<div class="fac-item song">', '	<div class="fac-img"><img src="{{image}}" alt="" /></div>', '	<div class="fac-info">', '		<h3 class="ellip">{{{title}}}</h3>', '		<p class="ellip small meta">{{{album}}}</p>', "	</div>", "</div>"].join(""));
            var artist = Hogan.compile(['<div class="fac-item artist">', '	<div class="fac-img"><img src="{{image}}" alt="" /></div>', '	<div class="fac-info">', '		<p class="small right"></p>', '		<h3 class="ellip">{{{title}}}</h3>', '		<p class="ellip small meta multi-meta">{{{description}}}</p>', "	</div>", "</div>"].join(""));
            var radio = Hogan.compile(['<div class="fac-item radio">', '	<div class="fac-img"><img src="{{image}}" alt="" /></div>', '	<div class="fac-info">', '		<p class="small right"></p>', '		<h3 class="ellip">{{{title}}}</h3>', '		<p class="ellip small meta multi-meta">{{{language}}}</p>', "	</div>", "</div>"].join(""));
            var playlist = Hogan.compile(['<div class="fac-item playlist">', '	<div class="fac-img"><img src="{{image}}" alt="" /></div>', '	<div class="fac-info">', '		<p class="small right"></p>', '		<h3 class="ellip">{{{title}}}</h3>', '		<p class="ellip small meta multi-meta">{{{language}}}</p>', "	</div>", "</div>"].join(""));
            $(".typeahead").typeahead({minLength: 1, highlight: true}, {
                name: "topQueries",
                displayKey: "title",
                source: topQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line left"><strong>Top Result</strong></h4>'].join(""),
                    suggestion: function (data) {
                        return topquery.render(data)
                    }
                }
            }, {
                name: "albumQueries",
                displayKey: "title",
                source: albumQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line with-btn">', "	<strong>Albums</strong>", '	<a class="btn x-small light outline ac-btn" onclick="autoComplete.fireGenericSearch(\'album\');">View All</a>', "</h4>"].join(""),
                    suggestion: function (data) {
                        return album.render(data)
                    }
                }
            }, {
                name: "songQueries",
                displayKey: "title",
                source: songQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line with-btn">', "	<strong>Songs</strong>", '	<a class="btn x-small light outline ac-btn" onclick="autoComplete.fireGenericSearch(\'song\');">View All</a>', "</h4>"].join(""),
                    suggestion: function (data) {
                        return song.render(data)
                    }
                }
            }, {
                name: "artistQueries",
                displayKey: "title",
                source: artistQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line left"><strong>Artists</strong></h4>'].join(""),
                    suggestion: function (data) {
                        return artist.render(data)
                    }
                }
            }, {
                name: "radioQueries",
                displayKey: "title",
                source: radioQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line with-btn">', "	<strong>Radio</strong>", '	<a class="btn x-small light outline ac-btn" onclick="autoComplete.goToRadio();">View All</a>', "</h4>"].join(""),
                    suggestion: function (data) {
                        return radio.render(data)
                    }
                }
            }, {
                name: "playlistQueries",
                displayKey: "title",
                source: playlistQueries.ttAdapter(),
                templates: {
                    header: ['<h4 class="small with-line with-btn">', "	<strong>Playlists</strong>", '	<a class="btn x-small light outline ac-btn" onclick="autoComplete.fireGenericSearch(\'playlist\');">View All</a>', "</h4>"].join(""),
                    suggestion: function (data) {
                        return playlist.render(data)
                    }
                }
            }).on("typeahead:selected", function (evt, item) {
                ev = "site:fac:click";
                type = item.type;
                query = autoComplete.isHome ? $.trim($("#search").val()) : $.trim($("#q").val());
                position = item.position;
                id = item.id;
                data = Array();
                data.push(ev);
                data.push("type");
                data.push(type);
                data.push("query");
                data.push(query);
                data.push("position");
                data.push(position);
                data.push("id");
                data.push(id);
                Analytics.logAndSendEventToGA(data);
                window.History.pushState({urlPath: item.url}, "", item.url);
                hideAcPane()
            }).on("typeahead:opened", function () {
                ev = $.Event("keydown");
                ev.keyCode = ev.which = KEY_DOWN;
                $(this).trigger(ev);
                return true
            });
            if (autoComplete.isHome) {
                $(".tt-menu").wrap('<div id="fac"><div id="fac-wrap"><div id="fac-items">')
            } else $(".tt-menu").wrap('<div id="fac"><div id="fac-wrap"><div class="sCroller" id="fac-scroller"><div class="sCroller-content"><div id="fac-items">');
            $(".typeahead").keypress(function (e) {
                if (e.which == KEY_ENT) {
                    autoComplete.manualFire = true;
                    autoComplete.fireGenericSearch()
                }
                if (e.which == KEY_ESC) $(this).blur()
            }).focus(function () {
                var q = autoComplete.isHome ? $.trim($("#search").val()) : $.trim($("#q").val());
                if (q.length == 0)return;
                $("body").addClass("show-fac")
            }).blur(function () {
                $("body").removeClass("show-fac")
            })
        })
    };
autoComplete.manualFire = false;
autoComplete.isHome = false;
autoComplete.field = "#hdr-search";
var Util = Util || new function () {
        var SONG_DELIMITER = "^";
        var SONG_FIELD_DELIMITER = "~";
        this.getTimestampLabel = function (ts) {
            currentTimeStamp = Math.floor(Date.now() / 1e3);
            diff = currentTimeStamp - ts;
            timeLabel = "";
            if (diff > 86400) {
                timeLabel = Math.floor(diff / 86400);
                timeLabel += timeLabel == 1 ? " day ago" : " days ago"
            } else if (diff > 3600) {
                timeLabel = Math.floor(diff / 3600);
                timeLabel += timeLabel == 1 ? " hour ago" : " hours ago"
            } else if (diff > 60) {
                timeLabel = Math.floor(diff / 60);
                timeLabel += timeLabel == 1 ? " minute ago" : " minutes ago"
            } else {
                timeLabel = "just now"
            }
            return timeLabel
        };
        this.htmlEntityDecode = function (str) {
            str = str.replace(/&quot;/gi, '"');
            str = str.replace(/&amp;#039;/gi, "'");
            str = str.replace(/&#039;/gi, "'");
            return str
        };
        this.htmlEntityDecode = function (str) {
            str = str.replace(/&quot;/gi, '"');
            str = str.replace(/&amp;#039;/gi, "'");
            str = str.replace(/&#039;/gi, "'");
            return str
        };
        this.getCountryCode = function () {
            var geo = Util.getCookie("geo");
            if (geo) {
                if (geo.indexOf(",") == -1) {
                    geo = decodeURIComponent(Util.getCookie("geo"))
                }
                geo = geo.split(",");
                if (geo.length == 5) {
                    countryCode = geo[1];
                    return countryCode
                }
            }
            return "ROW"
        };
        this.removeResourceFromLocalStorage = function (resource) {
            if (localStorage == null) {
                return
            }
            localStorage.removeItem(resource)
        };
        this.setResourceToLocalStorage = function (resource, value) {
            if (localStorage == null) {
                return
            }
            localStorage.setItem(resource, value)
        };
        this.getResourceFromLocalStorage = function (resource, defaultValue) {
            if (localStorage == null) {
                return defaultValue
            }
            var result = localStorage.getItem(resource);
            if (result == "" || result == null) {
                return defaultValue
            }
            return result
        };
        this.secureFormInputArray = function () {
            if (typeof secureFormInputArray.array == "undefined") {
                secureFormInputArray.array = Array()
            }
        };
        this.getValueFromSecureForm = function getValueFromSecureForm(id) {
            return Util.secureFormInputArray[id]
        };
        this.call = function (urlToCall, callbackName, params, isPost) {
            var dataString = "";
            var ctObj = Util.getCSRFToken();
            for (var i in params) {
                dataString += i + "=" + params[i] + "&"
            }
            requestType = "GET";
            if (isPost) {
                requestType = "POST";
                dataString = dataString + "&ct=" + ctObj.csrftoken
            }
            if (requestType == "GET") {
                urlToCall = urlToCall + "&ct=" + ctObj.csrftoken
            }
            $.ajax({
                type: requestType, url: urlToCall, data: dataString, success: function (data) {
                    if (callbackName !== "" && callbackName != "undefined" && callbackName != null) callbackName(data, Util.SUCCESS)
                }, error: function (data) {
                    if (callbackName !== "" && callbackName != "undefined" && callbackName != null) callbackName(data, Util.ERROR)
                }
            })
        };
        this.securecall = function makeSecureAsyncRequest(action, callbackName, postData) {
            var ctObj = Util.getCSRFToken();
            postData.ct = ctObj.csrftoken;
            var id = (new Date).getTime();
            this.secureFormInputArray[id] = postData;
            var urlToCall = "/securify.php?cb=" + callbackName + "&action=" + encodeURIComponent(action) + "&id=" + id;
            document.getElementById("secureframe").src = urlToCall
        };
        this.setCookie = function (cookieName, cookieValue, nDays, isDomainLess) {
            if (nDays === undefined || nDays == null || nDays == 0)var nDays = 30;
            if (isDomainLess === undefined)var isDomainLess = false;
            var today = new Date;
            var expire = new Date;
            expire.setTime(today.getTime() + 36e5 * 24 * nDays);
            if (!isDomainLess) {
                document.cookie = cookieName + "=" + escape(cookieValue) + ";expires=" + expire.toGMTString() + ";path=/;domain=.saavn.com"
            } else {
                document.cookie = cookieName + "=" + escape(cookieValue) + ";expires=" + expire.toGMTString() + ""
            }
        };
        this.setNonPersistentCookie = function (cookieName, cookieValue, isDomainLess) {
            if (isDomainLess === undefined)var isDomainLess = false;
            if (!isDomainLess) {
                document.cookie = cookieName + "=" + escape(cookieValue) + ";path=/;domain=.saavn.com"
            } else {
                document.cookie = cookieName + "=" + escape(cookieValue) + ""
            }
        };
        this.getCookie = function (cookieName) {
            if (document.cookie.length > 0) {
                var cookieNameEq = cookieName + "=";
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i];
                    while (cookie.charAt(0) == " ") {
                        cookie = cookie.substring(1, cookie.length)
                    }
                    if (cookie.indexOf(cookieNameEq) == 0) {
                        return cookie.substring(cookieNameEq.length, cookie.length)
                    }
                }
            }
            return ""
        };
        this.logInConsole = function (s) {
            if (typeof console != "undefined") {
                console.log(s)
            }
        };
        this.getCurrentTime = function () {
            var d = new Date;
            return d.getTime()
        };
        this.getXMLObj = function (text) {
            var xmlDoc = null;
            if (window.ActiveXObject) {
                xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                xmlDoc.async = "false";
                xmlDoc.loadXML(text)
            } else if (document.implementation.createDocument) {
                parser = new DOMParser;
                xmlDoc = parser.parseFromString(text, "text/xml")
            }
            return xmlDoc
        };
        this.logAndGoToUrl = function (ev, url, open) {
            Analytics.logAndSendEventToGA(ev);
            if (typeof Interface != "undefined") {
                Interface.cPanelClose()
            }
            if (open == "new") window.setTimeout(function () {
                window.open(url, "_blank")
            }, 1e3); else {
                if (window.History && typeof window.History.pushState != "undefined") {
                    window.History.pushState({urlPath: url}, "", url)
                } else {
                    window.setTimeout(function () {
                        window.open(url, "_self")
                    }, 1e3)
                }
            }
        };
        this.isIE6 = function () {
            if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
                var version = new Number(RegExp.$1);
                if (version <= 6) {
                    return true
                }
            }
            return false
        };
        this.getBrowser = function () {
            if (navigator.appName == "Microsoft Internet Explorer" || /Trident/gi.exec(navigator.userAgent)) {
                return "ie"
            } else if (/firefox/gi.exec(navigator.userAgent)) {
                return "firefox"
            } else if (/safari/gi.exec(navigator.userAgent)) {
                return "safari"
            }
        };
        this.getFormattedDuration = function (duration) {
            if (duration != "undefined") {
                var hour = 0;
                duration = Math.floor(duration);
                var minutes = duration / 60 | 0;
                if (minutes > 59) {
                    hour = Math.floor(minutes / 60);
                    minutes = minutes % 60;
                    if (minutes < 10) {
                        minutes = "0" + minutes
                    }
                }
                if (hour > 0) {
                    minutes = hour + ":" + minutes
                }
                var seconds = duration % 60;
                if (seconds < 10) {
                    seconds = "0" + seconds
                }
                return minutes + ":" + seconds
            }
        };
        this.generateUniqueIdentifier = function () {
            return UUID.generate()
        };
        this.overloadedTypeOf = function (value) {
            var s = typeof value;
            if (s === "object") {
                if (value) {
                    if (value instanceof Array) {
                        s = "array"
                    }
                } else {
                    s = "null"
                }
            }
            return s
        };
        this.serializeSongs = function (songs) {
            var str = "";
            if (!songs) {
                return ""
            }
            for (i = 0; i < songs.length; i++) {
                var song = songs[i];
                var songStr = "" + SONG_FIELD_DELIMITER + "" + SONG_FIELD_DELIMITER + song.songid;
                if (song.language) songStr += SONG_FIELD_DELIMITER + song.language;
                str += songStr + SONG_DELIMITER
            }
            str = str.substring(0, str.length - 1);
            return str
        };
        this.isRBTEnabled = function () {
            return false;
            var geo = Util.getCookie("geo");
            if (geo) {
                if (geo.indexOf(",") == -1) {
                    geo = decodeURIComponent(Util.getCookie("geo"))
                }
                geo = geo.split(",");
                if (geo.length == 5) {
                    var ip = geo[0];
                    var countryCode = geo[1];
                    var state = geo[2];
                    var city = geo[3];
                    var zip = geo[4];
                    var countryCodes = ["IN"];
                    for (var i = 0; i < countryCodes.length; i++) {
                        if (countryCode == countryCodes[i]) {
                            return true
                        }
                    }
                }
                return false
            }
        };
        this.getIntl = function () {
            var geo = Util.getCookie("geo");
            if (geo) {
                if (geo.indexOf(",") == -1) {
                    geo = decodeURIComponent(Util.getCookie("geo"))
                }
                geo = geo.split(",");
                if (geo.length == 5) {
                    return geo[1]
                }
            }
            return ""
        };
        this.updateBrowserUrl = function (query, autoload) {
            var History = window.History;
            if (History.enabled) {
                History.pushState({urlPath: query}, "", query)
            } else {
                if (query.indexOf("http:") == 0) {
                    query = query.substring(query.indexOf("#!") + 2)
                }
                query = query.replace(/ /gi, "_");
                if (Util.getBrowser() != "ie") {
                    query = "#" + query
                }
                location.hash = "/s/" + query
            }
            State.autoLoadPostContentFetch(autoload)
        };
        this.callFavorites = function (o) {
            if (!State.isUserLoggedIn()) {
                Panel.successCallback = function () {
                    Util.callFavorites(o);
                    Panel.successCallback = null
                };
                Panel.showLoginPanel();
                return
            }
            if (o == undefined) {
                return
            }
            var pid = o["pid"];
            var lang = typeof o["lang"] != "undefined" ? o["lang"] : "";
            var op = o["op"];
            var postParams = {_marker: 0, pid: pid, language: lang};
            var url = "/api.php?__call=favourites." + op + "&t=" + Util.getCurrentTime();
            Util.call(url, function (data, status) {
                if (status == Util.SUCCESS) {
                    var xml = Util.getXMLObj(data);
                    if ($(xml).find("ok").length == 1) {
                        o["success"](data)
                    } else {
                        o["error"](data)
                    }
                } else {
                    o["error"](data)
                }
            }, postParams, true)
        };
        this.getLanguage = function () {
            var language = Util.getCookie("L");
            if (!language) {
                language = "hindi"
            }
            return language
        };
        this.getRandBetween = function (min, max) {
            if (min === undefined)var min = 0;
            if (max === undefined)var max = 10;
            return Math.floor(Math.random() * (max - min + 1)) + min
        };
        this.removeSpecialChars = function (query) {
            query = query.replace(/\<|\>|\"|\'|\%|\;|\(|\)|\&|\+|\-/g, "");
            return query
        };
        this.getProStatus = function () {
            _PCookie = unescape(Util.getCookie("P"));
            _PCookie_array = _PCookie.split(":");
            switch (_PCookie_array[0]) {
                case"trial":
                    return Util.TRIAL;
                    break;
                case"pro":
                    return Util.PRO;
                    break;
                case"expired":
                    return Util.EXPIRED;
                    break;
                default:
                    return Util.FREE;
                    break
            }
        };
        this.validateEml = function (e) {
            var rx = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return rx.test(e)
        };
        $(window).blur(function () {
            Util.inactive = true
        });
        $(window).focus(function () {
            Util.inactive = false;
            document.title = Util.pagetitle
        });
        this.getPath = function () {
            var History = window.History;
            if (History && History.enabled) {
                var HistoryState = History.getState();
                if (typeof HistoryState.data.urlPath == "undefined") {
                    url = location.pathname
                } else {
                    url = HistoryState.data.urlPath
                }
                var l = document.createElement("a");
                l.href = url;
                url = l.pathname + l.search;
                if (Util.getBrowser() == "ie") {
                    url = "/" + url
                }
            } else {
                url = location.pathname
            }
            return url
        };
        this.getHash = function () {
            var History = window.History;
            if (History && History.enabled) {
                var HistoryState = History.getState();
                url = HistoryState.hash
            } else {
                url = location.hash
            }
            return url
        };
        this.stringCheck = function (str) {
            return !str || typeof str !== "string" ? null : str
        };
        this.getCDNUrl = function () {
            return "http://static.saavncdn.com"
        };
        this.getPageType = function () {
            var type = $(".page-wrap").attr("data-type");
            if (type) {
                return type
            }
            var loc = location.pathname;
            type = "";
            if (loc.indexOf("/p/playlist") != -1 || loc.indexOf("/s/playlist") != -1) {
                if (loc.indexOf("Starred_Songs") != -1) {
                    type = "starred_songs"
                } else {
                    type = "playlist"
                }
            } else if (loc.indexOf("/p/song") != -1 || loc.indexOf("/s/song") != -1) {
                type = "song"
            } else if (loc.indexOf("/p/album") != -1 || loc.indexOf("/s/album") != -1) {
                type = "album"
            } else if (loc.indexOf("/radio/") != -1) {
                type = "radio"
            } else if (loc.indexOf("/featured-playlists") != -1 || loc.indexOf("/featured") != -1) {
                type = "featured-playlists"
            }
            return type
        };
        this.getQueryParams = function (key) {
            var locationHash = Util.getHash().split(key + "=");
            var val = "";
            if (locationHash.length > 1) {
                val = locationHash[1].split("&");
                if (typeof val == "object") {
                    val = val[0]
                }
            }
            return val
        };
        this.isRadioUrl = function () {
            var urlArray = Util.getPath().split("/");
            return urlArray[1] == "radio" || urlArray[2] == "radio"
        };
        this.getRadioLanguages = function () {
            var countryCode = Util.getCountryCode();
            var radioLanguages = ["hindi", "tamil", "telugu"];
            if (countryCode === "IN") {
                radioLanguages.push("english")
            }
            return radioLanguages
        };
        this.addEditPasswordHTML = function () {
            if ($("#new_email").val() == "" || $("#new_email").val() === undefined || $("#new_email").val() == null) {
                $("#edit_password_link").addClass("hideoption")
            } else {
                if ($("#username_accnt") == $("#new_email").val()) {
                    $("#edit_password_link").removeClass("hideoption")
                }
            }
        };
        this.validateEmail = function (email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email)
        };
        this.validatePhone = function (phone_number) {
            var checkPhone = $("#phone_number").val();
            if (checkPhone != "" && checkPhone !== undefined && checkPhone != null && phone_number != checkPhone) {
                return false
            }
            var re = /^[+0-9]{11,14}$/;
            return re.test(phone_number)
        };
        this.sanitisePhraseForURL = function (term) {
            var title = term.replace(/&[#a-zA-Z0-9]*;/gi, "");
            title = title.replace(/['\"?]*/gi, "");
            title = title.replace(/[\,%&#()\[\]\/]/gi, "");
            title = title.replace(/ /g, "-");
            return title
        };
        this.getCSRFToken = function () {
            var csrftoken = $("#ct").val();
            csrftoken = Base64.decode(csrftoken) - Util.sharedToken;
            var tokenObj = {csrftoken: csrftoken};
            return tokenObj
        }
    };
Util.SUCCESS = "success";
Util.ERROR = "error";
Util.inactive = false;
Util.pagetitle = document.title;
Util.KEY_ENTER = 13;
Util.readOnlyMessage = "Saavn is currently undergoing maintenance. Some features like signup, radio, and managing playlists may be unavailable. They'll be back shortly!";
Util.MERGE_TYPE_PHONE = "merge_phone";
Util.MERGE_TYPE_EMAIL = "merge_email";
Util.MERGE_TYPE_EMAIL_PHONE = "merge_email_phone";
Util.MERGE_TYPE_NONE = "0";
Util.FREE = 1;
Util.TRIAL = 2;
Util.PRO = 3;
Util.DORMANT = 4;
Util.EXPIRED = 5;
Util.FBID = 0x737e727f0b09;
Util.FB_STATE = "b@jir@0m@$t@n!";
Util.FB_ACCOUNTKIT_VERSION = "v1.0";
Util.FB_PARTIAL_AUTHENTICATED_STATUS = "PARTIALLY_AUTHENTICATED";
Util.FB_NOT_AUTHENTICATED_STATUS = "NOT_AUTHENTICATED";
Util.FB_BAD_PARAMS_STATUS = "BAD_PARAMS";
Util.sharedToken = 24769;
var Base64 = {
    _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (e) {
        var t = "";
        var n, r, i, s, o, u, a;
        var f = 0;
        e = Base64._utf8_encode(e);
        while (f < e.length) {
            n = e.charCodeAt(f++);
            r = e.charCodeAt(f++);
            i = e.charCodeAt(f++);
            s = n >> 2;
            o = (n & 3) << 4 | r >> 4;
            u = (r & 15) << 2 | i >> 6;
            a = i & 63;
            if (isNaN(r)) {
                u = a = 64
            } else if (isNaN(i)) {
                a = 64
            }
            t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
        }
        return t
    }, decode: function (e) {
        var t = "";
        var n, r, i;
        var s, o, u, a;
        var f = 0;
        e = e.replace(/[^A-Za-z0-9+\/=]/g, "");
        while (f < e.length) {
            s = this._keyStr.indexOf(e.charAt(f++));
            o = this._keyStr.indexOf(e.charAt(f++));
            u = this._keyStr.indexOf(e.charAt(f++));
            a = this._keyStr.indexOf(e.charAt(f++));
            n = s << 2 | o >> 4;
            r = (o & 15) << 4 | u >> 2;
            i = (u & 3) << 6 | a;
            t = t + String.fromCharCode(n);
            if (u != 64) {
                t = t + String.fromCharCode(r)
            }
            if (a != 64) {
                t = t + String.fromCharCode(i)
            }
        }
        t = Base64._utf8_decode(t);
        return t
    }, _utf8_encode: function (e) {
        e = e.replace(/rn/g, "n");
        var t = "";
        for (var n = 0; n < e.length; n++) {
            var r = e.charCodeAt(n);
            if (r < 128) {
                t += String.fromCharCode(r)
            } else if (r > 127 && r < 2048) {
                t += String.fromCharCode(r >> 6 | 192);
                t += String.fromCharCode(r & 63 | 128)
            } else {
                t += String.fromCharCode(r >> 12 | 224);
                t += String.fromCharCode(r >> 6 & 63 | 128);
                t += String.fromCharCode(r & 63 | 128)
            }
        }
        return t
    }, _utf8_decode: function (e) {
        var t = "";
        var n = 0;
        var r = c1 = c2 = 0;
        while (n < e.length) {
            r = e.charCodeAt(n);
            if (r < 128) {
                t += String.fromCharCode(r);
                n++
            } else if (r > 191 && r < 224) {
                c2 = e.charCodeAt(n + 1);
                t += String.fromCharCode((r & 31) << 6 | c2 & 63);
                n += 2
            } else {
                c2 = e.charCodeAt(n + 1);
                c3 = e.charCodeAt(n + 2);
                t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
                n += 3
            }
        }
        return t
    }
};
var FBUtil = FBUtil || new function () {
        var _fbUserId = "";
        var _fbAppId = "";
        var _status_obj = null;
        this.setFBAppId = function (appId) {
            _fbAppId = appId
        };
        this.init = function (postLoadCallback) {
            if (_fbAppId == "") {
                Util.logInConsole("fb app id is empty. fb will not be initialized");
                return
            }
            window.fbAsyncInit = function () {
                FB.init({
                    appId: _fbAppId,
                    status: true,
                    cookie: true,
                    xfbml: true,
                    oauth: true,
                    version: "v2.3",
                    music: true
                });
                FB.getLoginStatus(function (response) {
                    FBUtil.initMusicBridge();
                    if (postLoadCallback != undefined) {
                        postLoadCallback()
                    }
                })
            };
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {
                    return
                }
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs)
            })(document, "script", "facebook-jssdk")
        };
        this.publishFacebookFeed = function (share_link) {
            share_link = share_link.replace("/s/#!", "");
            var obj = {method: "feed", name: "Saavn", display: "popup", link: share_link};
            FB.ui(obj, function (o) {
                console.log(o)
            })
        };
        this.clearFBCookies = function () {
            var fbsr_cookie_name = "fbsr_" + this.FB_APP_ID;
            Util.setCookie(fbsr_cookie_name, "", -1, true);
            try {
                FB.Cookie.clear();
                FB.Cookie.clearSignedRequestCookie()
            } catch (e) {
                Util.logInConsole(e)
            }
        };
        this.isUserFBConnected = function () {
            if (State.isUserLoggedIn()) {
                var network = Util.getCookie("network");
                if (network == "fb" || network == "linkedfb") {
                    return true
                }
            }
            return false
        };
        this.isFBUser = function () {
            var network = Util.getCookie("network");
            if (network == "fb") {
                return true
            }
            return false
        };
        function _sendEventToBridge(playing, url, expires) {
            if (_fbUserId == "") {
                FB.getLoginStatus(function (response) {
                    if (response.authResponse) {
                        _fbUserId = response.authResponse.userID;
                        _sendEventToBridge(playing, url, expires)
                    }
                });
                return
            }
            url = _getMassagedUrl(url);
            context = null;
            try {
                context = State.getPlayerContext()
            } catch (e) {
                Util.logInConsole(e)
            }
            var obj = {playing: playing, song: url, user_id: _fbUserId};
            if (context != null) {
                if (context.type == "album") {
                    obj.album = _getMassagedUrl(context.value)
                } else {
                    obj.playlist = _getMassagedUrl(context.value)
                }
            }
            _status_obj = obj;
            obj.expires_in = expires;
            if (FB.Music) {
                FB.Music.send("STATUS", obj)
            }
        }

        var _getMassagedUrl = function (url) {
            url = url.replace(/ /gi, "+");
            return url.replace(/\/s\/#!/gi, "")
        };
        this.publishEventToFB = function (song_obj) {
            FBUtil.postFBPlayEvent(song_obj);
            if (!FBUtil.isFBUser() && !FBUtil.isUserFBConnected())return;
            var private_listening = Util.getCookie("PL");
            if (private_listening == "1") {
                return
            }
            var postUrl = "/api.php?__call=publisher.postSongListen&song=" + _getMassagedUrl(song_obj.perma_url);
            var ev = "ui:fbmusic:post:music.listen";
            var context = State.getPlayerContext();
            if (context != null) {
                postUrl += "&" + context.type + "=" + _getMassagedUrl(context.value);
                ev += ":" + context.type
            }
            var date = new Date;
            var start_time = _getCurrentISO8061Time();
            postUrl += "&start_time=" + start_time + "&expires_in=" + parseInt(song_obj.duration);
            Util.call(postUrl, function (o, status) {
                if (status == Util.SUCCESS) {
                    FBUtil.postFBPlayEvent(song_obj);
                    Analytics.logAndSendEventToGA(ev + ":success")
                } else {
                    Analytics.logAndSendEventToGA(ev + ":fail")
                }
            })
        };
        this.publishPlaylistCreateToFB = function (playlistUrl) {
            if (!FBUtil.isFBUser() && !FBUtil.isUserFBConnected())return;
            var private_listening = Util.getCookie("PL");
            if (private_listening == "1") {
                return
            }
            var postUrl = "/api.php?__call=publisher.postPlaylistCreate&playlist=" + _getMassagedUrl(playlistUrl);
            var ev = "ui:fbmusic:post:music.listen";
            Util.call(postUrl, function (o, status) {
                if (status == Util.SUCCESS) {
                }
            })
        };
        function _getCurrentISO8061Time() {
            var date = new Date;
            var time = date.getUTCFullYear() + "-" + _getTwoDigitDate(date.getUTCMonth() + 1) + "-" + _getTwoDigitDate(date.getUTCDate()) + "T" + _getTwoDigitDate(date.getUTCHours()) + ":" + _getTwoDigitDate(date.getUTCMinutes()) + ":" + _getTwoDigitDate(date.getUTCSeconds());
            return time
        }

        function _getTwoDigitDate(d) {
            return ("0" + d).slice(-2)
        }

        function _hookFBMusicCallbacks() {
            FB.Event.subscribe("fb.music.BRIDGE_READY", function (params) {
                Util.logInConsole("Bridge initialized...");
                FBUtil.fbStatusCallback(null)
            });
            FB.Event.subscribe("fb.music.STATUS", FBUtil.fbStatusCallback);
            FB.Event.subscribe("fb.music.PLAY", FBUtil.playCallback);
            FB.Event.subscribe("fb.music.RESUME", FBUtil.resumeCallback);
            FB.Event.subscribe("fb.music.PAUSE", FBUtil.pauseCallback);
            FB.Event.subscribe("fb.music.ALREADY_CONNECTED", function (params) {
                Util.logInConsole("Already connected...");
                var msg = "Another Saavn window is currently active. Please close that window and refresh this page for the best music experience.";
                Interface.showFixedNotice(msg, false);
                Analytics.logAndSendEventToGA("ui:fbmusic:error:already_connected")
            });
            FB.Event.subscribe("fb.music.USER_MISMATCH", function (params) {
                Util.logInConsole("User mismatch..." + _fbUserId)
            })
        }

        this.onunload = function () {
            FBUtil.postFBPauseEvent(State.getCurrentlyPlayingSong());
            if (FB.Music) {
                FB.Music.send("STATUS", {offline: true, user_id: _fbUserId})
            }
        };
        this.playCallback = function (params) {
            var url = "";
            var url_type = "";
            if (params.song != null) {
                url = params.song;
                url_type = "song"
            } else if (params.playlist != null) {
                url = params.playlist;
                url_type = "playlist"
            } else if (params.album != null) {
                url = params.album;
                url_type = "album"
            }
            if (url == _getMassagedUrl(unescape(window.location.href)) && State.song_progressed_secs <= 10) {
                var song = Player.getCurrentSong();
                FbUtil.postFBPlayEvent(song);
                return
            }
            if (url_type == "song") {
                Util.updateBrowserUrl(_getHashBangUrl(params.song) + "?autostart=1");
                Analytics.logAndSendEventToGA("ui:fbmusic:play:song")
            } else if (url_type == "playlist") {
                Util.updateBrowserUrl(_getHashBangUrl(params.playlist) + "?apl=1");
                Analytics.logAndSendEventToGA("ui:fbmusic:play:playlist")
            } else if (url_type == "album") {
                Util.updateBrowserUrl(_getHashBangUrl(params.album) + "?autostart=1");
                Analytics.logAndSendEventToGA("ui:fbmusic:play:album")
            }
        };
        var _getHashBangUrl = function (permaUrl) {
            var path = $("<a/>").attr("href", permaUrl)[0].pathname;
            if (path.indexOf("/") != 0) {
                path = "/" + path
            }
            return path
        };
        this.resumeCallback = function (params) {
            State.resumeSong();
            Analytics.logAndSendEventToGA("ui:fbmusic:resume")
        };
        this.pauseCallback = function (params) {
            State.pauseSong();
            Analytics.logAndSendEventToGA("ui:fbmusic:pause")
        };
        this.fbStatusCallback = function (params) {
            if (_status_obj == null) {
                var song = State.getCurrentlyPlayingSong();
                var state = Player.getState();
                _status_obj = {playing: true, user_id: _fbUserId};
                if (state == "playing") {
                    _status_obj.song = _getMassagedUrl(song.perma_url)
                }
            }
            if (FB.Music) {
                FB.Music.send("STATUS", _status_obj)
            }
        };
        this.postFBPauseEvent = function (song_obj) {
            _sendEventToBridge(false, song_obj.perma_url, song_obj.duration - State.song_progressed_secs)
        };
        this.postFBResumeEvent = function (song_obj) {
            _sendEventToBridge(true, song_obj.perma_url, song_obj.duration - State.song_progressed_secs)
        };
        this.postFBPlayEvent = function (song_obj) {
            _sendEventToBridge(true, song_obj.perma_url, song_obj.duration - State.song_progressed_secs)
        };
        this.initMusicBridge = function () {
            FB.getLoginStatus(function (response) {
                if (response.authResponse) {
                    _fbUserId = response.authResponse.userID;
                    _hookFBMusicCallbacks()
                }
            })
        };
        this.login = function (callback) {
            FB.login(function (response) {
                if (response.authResponse) {
                    var url = "/api.php?__call=user.fbLogin&signed_request=" + response.authResponse.signedRequest + "&_marker=0";
                    Util.call(url, function (o, status) {
                        if (status == Util.SUCCESS) {
                            Util.logInConsole("FB logged in!");
                            if (typeof callback == "function") {
                                callback(o)
                            }
                        }
                    }, null)
                }
            }, {scope: "public_profile,email,user_friends,publish_actions"})
        };
        this.confirmFBLink = function () {
            var r = confirm("Are you sure you want to merge your current account with Facebook account?");
            if (r == true) {
                this.linkAccounts()
            } else {
                State.showNotification("Your Facebook account is not linked.")
            }
        };
        this.linkAccounts = function () {
            FB.login(function (response) {
                if (response.authResponse) {
                    var url = "/api.php?__call=user.linkfb&_marker=0&signed_request=" + response.authResponse.signedRequest;
                    Util.call(url, function (o, status) {
                        if (status == Util.SUCCESS) {
                            var xml = Util.getXMLObj(o);
                            var error = xml.getElementsByTagName("error");
                            if (error.length) {
                                State.showError(error[0].getAttribute("msg"))
                            } else {
                                var user = xml.getElementsByTagName("user");
                                var userJson = "{" + '   "username":"' + user[0].getAttribute("username") + '",' + '   "uid":"' + user[0].getAttribute("uid") + '",' + '   "email":"' + user[0].getAttribute("email") + '",' + '   "lastname":"' + user[0].getAttribute("lastname") + '",' + '   "firstname":"' + user[0].getAttribute("firstname") + '",' + '   "network":"' + user[0].getAttribute("network") + '",' + '   "fbid":"' + user[0].getAttribute("fbid") + '"' + "}";
                                $("#user-json").html(userJson);
                                State.login();
                                State.showNotification("Your Facebook account is now linked!");
                                State.updatePlaylistView();
                                if (Util.getPageType() == "people" || $(".page-wrap").hasClass("account")) {
                                    setTimeout(function () {
                                        State.refreshContent()
                                    }, 3e3)
                                } else if (Radio.isRadioUrl()) {
                                    Radio.loadUserStations()
                                }
                            }
                        } else {
                            State.showError("Failed to link your Facebook account at this time. Please try again later.")
                        }
                    }, null)
                }
            }, {scope: "public_profile,email,user_friends,publish_actions"})
        };
        this.getInstalledFriends = function (limit, callback) {
            if (limit === undefined)var limit = 10;
            if (typeof FB == "undefined") {
                FBUtil.init(function () {
                    FBUtil.getInstalledFriends(limit, callback)
                });
                return
            }
            FB.getLoginStatus(function (response) {
                if (response.authResponse) {
                    FB.api("/me/friends", {fields: "installed,name,picture"}, function (response) {
                        var data = [];
                        for (var i = 0; i < response.data.length && data.length < limit; i++) {
                            if (typeof response.data[i].installed != "undefined" && response.data[i].installed == true) {
                                data.push(response.data[i])
                            }
                        }
                        callback(data)
                    })
                }
            })
        };
        this.isFacebookRedirect = function () {
            var component = document.referrer.split("/");
            if (component.length >= 3) {
                if (component[2] == "www.facebook.com") {
                    return true
                }
            }
            return false
        };
        this.popFBDialog = function (fbDialogHash) {
            Interface.smoothTo(0, 0);
            var method = fbDialogHash["method"];
            var name = fbDialogHash["name"];
            var link = fbDialogHash["link"];
            var to = fbDialogHash["to"];
            var picture = fbDialogHash["picture"];
            var description = fbDialogHash["description"];
            FB.ui({method: method, name: name, link: link, to: to, picture: picture, description: description})
        };
        this.checkFBReferer = function () {
            var referString = "FBM_REFERER";
            var fbRefer = Util.getCookie(referString);
            if (fbRefer.length != 0) {
                Panel.showLoginPanel();
                Util.setCookie("FBM_REFERER", "", -1, false)
            }
        }
    };
var Analytics = Analytics || new function () {
        this.logStats = function (params) {
            var statsurl = "/stats.php?";
            for (var i = 0; i < params.length; i = i + 2) {
                if (params[i] instanceof Array) {
                    for (var j = 0; j < params[i].length; j = j + 2) {
                        statsurl += params[i][j] + "=" + params[i][j + 1] + "&"
                    }
                } else {
                    statsurl += params[i] + "=" + params[i + 1] + "&"
                }
            }
            var d = new Date;
            var t = d.getTime();
            statsurl += "_t=" + t;
            if (typeof State == "object") {
                if (State.radioMode == true) {
                    var stationHash = Radio.getStationInfo();
                    statsurl += "&stationId=" + stationHash.stationId;
                    statsurl += "&stationName=" + stationHash.stationName;
                    statsurl += "&stationType=" + stationHash.stationType;
                    try {
                        statsurl += "&songid=" + Player.getCurrentSong().songid
                    } catch (err) {
                    }
                }
                if (State.partner && State.partner.length > 0) {
                    statsurl += "&partner=" + State.partner
                }
                if (State.ref && State.ref.length > 0) {
                    statsurl += "&ref=" + State.ref
                }
            }
            Util.call(statsurl, "", "", false)
        };
        this.sendEventToGA = function (pagename) {
            if (document.domain.indexOf("saavn.com") == -1) {
                return
            }
            if (typeof _gaq != "undefined") {
                var status = "";
                var user = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
                if (user == null || user == undefined || user.uid == undefined || user.uid == null || user.uid == "") {
                    status = "logged_out"
                } else {
                    var network = Util.getCookie("network");
                    if (network == "fb" || network == "linkedfb") {
                        status = "fb_logged_in"
                    } else {
                        status = "logged_in"
                    }
                }
                var fbreferer = Util.getCookie("FBM_REFERER");
                if (fbreferer != "") {
                    _gaq.push(["_setReferrerOverride", "https://www.facebook.com"])
                }
                _gaq.push(["_setCustomVar", 1, "user_logged_in_status", status, 3]);
                _gaq.push(["_trackPageview", "/" + pagename]);
                $("#debugging_analytics_textarea").val($("#debugging_analytics_textarea").val() + "user_logged_in_status:" + status + ", " + pagename + "\n")
            }
        };
        this.logAndSendEventToGA = function () {
            var args = [];
            for (var i = 0; i < arguments.length; i++) {
                if (i == 0 && arguments[i] != "ev") {
                    args.push("ev")
                }
                if (arguments[i] instanceof Array) {
                    args = args.concat(arguments[i])
                } else {
                    args.push(arguments[i])
                }
            }
            Analytics.logStats(args);
            Analytics.sendEventToGA(args[1]);
            if (typeof Ads != "undefined") {
                try {
                    var events = args[1].split(";");
                    Ads.rotateSearchPageAds(events[0])
                } catch (e) {
                    Analytics.logStats(["ev", "Ads:LoadFailed", "desc" + e]);
                    Analytics.sendEventToGA("Ads:LoadFailed")
                }
            }
        }
    };
var Header = Header || new function () {
        this.update = function () {
            if (State.isUserLoggedIn()) {
                var data = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
                var user = data.username;
                if (FBUtil.isUserFBConnected()) {
                    user = data.firstname
                }
                var image = "http://s.saavn.com/web/3.0/_i/default-user.png";
                if (FBUtil.isUserFBConnected()) {
                    $("#user-admin").addClass("fb")
                }
                _paintLoginView();
                Header.getPlaylists();
                Header.getRadio()
            } else {
                _paintLogoutView()
            }
        };
        function getWeeklyTopLink(noHash) {
            var language = Util.getLanguage();
            var url = "";
            if (language == "tamil") {
                url = "/s/featured/" + language + "/Weekly_Top_15"
            } else {
                url = "/s/featured/" + language + "/Weekly_Top_Songs"
            }
            return url
        }

        function getCatalogueLink(noHash) {
            var language = Util.getLanguage();
            var url = "/browse/catalogue-full/" + language + "/albums";
            return url
        }

        function getNewReleasesLink(noHash) {
            var language = Util.getLanguage();
            var url = "/new-releases/" + language;
            return url
        }

        function getFeaturedPlaylistLink(noHash) {
            var language = Util.getLanguage();
            var url = "/play/featured-playlists/" + language;
            return url
        }

        function getSurpriseMeLink(noHash) {
            var language = Util.getLanguage();
            var url = "";
            if (language == "hindi") {
                url = "/s/featured/" + language + "/Surprise_Me"
            } else {
                url = "/s/featured/" + language + "/Random_Picks"
            }
            return url
        }

        this.goToWeeklyTopPage = function (noHash) {
            if (noHash === undefined)var noHash = false;
            var url = getWeeklyTopLink(noHash);
            Util.logAndGoToUrl("site:header:browse-weekly-top:click", url)
        };
        this.goToSurpriseMePage = function (noHash) {
            if (noHash === undefined)var noHash = false;
            var url = getSurpriseMeLink(noHash);
            Util.logAndGoToUrl("site:header:browse-surprise-me:click", url)
        };
        this.goToCataloguePage = function (noHash) {
            if (noHash === undefined)var noHash = false;
            var url = getCatalogueLink(noHash);
            Util.logAndGoToUrl("site:header:catalog-link:click", url)
        };
        this.goToNewReleasesPage = function (noHash) {
            if (noHash === undefined)var noHash = false;
            var url = getNewReleasesLink(noHash);
            Util.logAndGoToUrl("site:header:browse-new-releases:click", url)
        };
        this.goToFeaturedPlaylistPage = function (noHash) {
            if (noHash === undefined)var noHash = false;
            var url = getFeaturedPlaylistLink(noHash);
            Util.logAndGoToUrl("site:header:browse-featured-playlists:click", url)
        };
        this.goToPeoplePage = function () {
            Util.logAndGoToUrl("site:header:browse-people:click", "/people")
        };
        this.changeLanguage = function (language) {
            State.setLanguage(language);
            Analytics.logAndSendEventToGA("site:header:language-select:" + language + ":click");
            $("#sod-header-btn").attr("onclick", 'Util.logAndGoToUrl("site:header:browse:song_of_the_day:click", "/song-of-the-day' + language + '")');
            var url = getWeeklyTopLink();
            $("#browse-top-link a").attr("href", url);
            if (Util.getPath().indexOf("Weekly") != -1) {
                window.History.pushState("", "", url)
            }
            url = getSurpriseMeLink();
            $("#browse-surprise-link a").attr("href", url);
            if (Util.getPath().indexOf("Surprise") != -1 || Util.getPath().indexOf("Random") != -1) {
                window.History.pushState("", "", url)
            }
            url = getCatalogueLink();
            $("#catalog-link a").attr("href", url);
            if (Util.getPath().indexOf("catalogue") != -1) {
                window.History.pushState("", "", url)
            }
            url = getNewReleasesLink();
            $("#browse-new-releases a").attr("href", url);
            if (Util.getPath().indexOf("new-releases") != -1) {
                window.History.pushState("", "", url)
            }
            url = getFeaturedPlaylistLink();
            $("#browse-featured-playlists a").attr("href", url);
            if (Util.getPath().indexOf("featured-playlists") != -1) {
                window.History.pushState("", "", url)
            }
            if (location.hash.match("/(new|((play|p)/featured))$")) {
                State.refreshContent()
            }
            if (location.hash.match("/radio$")) {
                State.checkRadioLanguage(language)
            }
            if (location.pathname.match("/radio/.*$") && Radio.availableLanguages.indexOf(language) > -1) {
                Util.logAndGoToUrl("", "/radio/" + language)
            }
            State.refreshContent()
        };
        this.getPlaylists = function () {
            var url = "/api.php?__call=playlist.list&_marker=0&_format=json&all_playlists=true&contents=1&onlypids=true";
            url += "&t=" + Util.getCurrentTime();
            Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    o = jQuery.parseJSON(Util.stringCheck(o));
                    var html = "";
                    var starredSongs = "";
                    var playlistsDropView = "";
                    var saavnSuggests = "";
                    var ownedPlaylists = [];
                    $.each(o, function (key, value) {
                        if (value.is_followed == false) {
                            ownedPlaylists.push(value)
                        }
                        var listname = value.listname;
                        var listid = value.listid;
                        var permaUrl = value.perma_url;
                        if (listname == "Starred Songs") {
                            starredSongs = "<li><a onclick=\"Util.logAndGoToUrl('header:click:playlist:" + listname + ":" + listid + "', '" + permaUrl + '\');return false;" href="' + permaUrl + '">' + listname + "</a></li>"
                        } else if (listname == "Saavn Suggests") {
                            saavnSuggests = "<li><a onclick=\"Util.logAndGoToUrl('header:click:playlist:" + listname + ":" + listid + "', '" + permaUrl + '\');return false;" href="' + permaUrl + '">' + listname + "</a></li>"
                        } else {
                            playlistsDropView += '<li><a class="ellip" onclick="Util.logAndGoToUrl(\'header:click:playlist:' + listname + ":" + listid + "', '" + permaUrl + '\');return false;" href="' + permaUrl + '">' + listname + "</a></li>"
                        }
                    });
                    html = "<ol>" + starredSongs + saavnSuggests + '<li class="drop-scroll"><h5>Playlists</h5><ol>' + playlistsDropView + "</ol></li></ol>";
                    $("#my-music .drop").html(html);
                    $("#my-music .playlists-json").html(JSON.stringify(ownedPlaylists));
                    $("#my-music").unbind("click").removeClass("logged-out").addClass("menu");
                    Interface.initUI($("#main-nav"))
                }
            }, null)
        };
        this.getRadio = function () {
            Radio.loadUserStations()
        };
        this.updateRadioMenu = function () {
            if (Interface.localStorageSupport() && localStorage.stationName) {
                $("#radio-menu .last-station").html('<li><a class="ellip"></a></li>').unbind("click").click(function () {
                    if (typeof Radio != "undefined") {
                        if ($(".page-wrap").hasClass("radio")) {
                            Interface.smoothTo(0)
                        } else {
                            Analytics.logAndSendEventToGA("site:header:radio:last_station:click");
                            Radio.goToCurrentStation(false)
                        }
                    } else {
                        var stationName = localStorage.stationName;
                        var stationId = localStorage.stationId;
                        var stationType = localStorage.stationType;
                        var stationSeed = localStorage.stationSeed;
                        var language = localStorage.stationLanguage;
                        if (stationType == "scratch") {
                            stationId = ""
                        }
                        switch (stationType) {
                            case"user":
                                stationUrl = "/p/radio/user/" + JSON.parse($("#user-json").text()).uid + "/" + stationName + "/" + stationId;
                                break;
                            case"song":
                                stationUrl = "/p/radio/" + language + "-song-station/" + stationName + "/" + stationSeed;
                                break;
                            default:
                                stationUrl = "/p/radio/" + language + "-" + stationType + "-station/" + stationName + "/" + stationId
                        }
                        Util.logAndGoToUrl("site:home:header:radio:last_station:click", stationUrl)
                    }
                });
                var cleanStr = $.trim(localStorage.stationName).split(":");
                cleanStr = cleanStr.length > 1 ? cleanStr[1] : cleanStr[0];
                $("#radio-menu .last-station li a").html(cleanStr.replace(/-/g, " "));
                $("#radio-menu .last-station").closest(".drop-scroll").removeClass("hide");
                $("#radio-menu").unbind("click").addClass("menu");
                Interface.initUI($("#main-nav"));
                if (typeof State != "undefined" && State.radioMode == true) $("#radio-menu .last-station").closest(".drop-scroll").find("h5 #radio-hdr-scratch").html("Current Station"); else $("#radio-menu .last-station").closest(".drop-scroll").find("h5 #radio-hdr-scratch").html("Last Station")
            } else {
                Util.call("/api.php?__call=webradio.getScratchStation&_marker=0&_format=json", function (response) {
                    var json = JSON.parse(response);
                    if (!json.error) {
                        $("#radio-menu .last-station").html('<li><a class="ellip"></a></li>').unbind("click").click(function () {
                            if (typeof Radio != "undefined") {
                                if ($(".page-wrap").hasClass("radio")) {
                                    Interface.smoothTo(0)
                                } else {
                                    Analytics.logAndSendEventToGA("site:header:radio:last_station:click");
                                    Radio.goToCurrentStation()
                                }
                            } else {
                                Util.logAndGoToUrl("site:home:header:radio:last_station:click", "/radio")
                            }
                        });
                        var cleanStr = $.trim(json.query).split(":");
                        cleanStr = cleanStr.length > 1 ? cleanStr[1] : cleanStr[0];
                        $("#radio-menu .last-station li a").html(cleanStr);
                        $("#radio-menu .last-station").closest(".drop-scroll").removeClass("hide");
                        $("#radio-menu").unbind("click").addClass("menu");
                        Interface.initUI($("#main-nav"));
                        if (typeof State != "undefined" && State.radioMode == true) $("#radio-menu .last-station").closest(".drop-scroll").find("h5 #radio-hdr-scratch").html("Current Station"); else $("#radio-menu .last-station").closest(".drop-scroll").find("h5 #radio-hdr-scratch").html("Last Station")
                    } else {
                        $("#radio-menu .last-station").closest(".drop-scroll").addClass("hide");
                        if ($("#radio-menu .saved-stations").length == 0 || $("#radio-menu .saved-stations").closest(".drop-scroll").hasClass("hide")) {
                            $("#radio-menu").unbind("click").click(function () {
                                var origin = $("body").attr("id") == "home" ? "home:" : "";
                                Util.logAndGoToUrl("site:" + origin + "header:radio:click", "/radio/" + Util.getLanguage())
                            })
                        }
                    }
                })
            }
        };
        this.playSavedStation = function (stationId, stationName) {
            localStorage.stationId = stationId;
            localStorage.stationName = stationName;
            localStorage.stationType = "user";
            var stationUrl = "/p/radio/user/" + JSON.parse($("#user-json").text()).uid + "/" + stationName.replace(/ /g, "-") + "/" + stationId;
            Util.logAndGoToUrl(new Array("site:header:radio:saved_station:start_radio:click", "stationId", stationId, "stationName", stationName, "stationType", "user"), stationUrl)
        };
        function _paintLogoutView() {
            $("#user-admin").fadeOut(210, function () {
                $("#account").removeClass("logged-in").addClass("logged-out");
                $("#login-btns").hide().fadeIn(210);
                $("#user-admin").removeClass("fb");
                $("#user-admin .user-img").attr("style", "");
                $("#user-admin .user-name").empty()
            });
            Notifications.stopNotificationsFetch()
        }

        function _paintLoginView() {
            var user = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
            var username = user.firstname ? user.firstname : user.username.split("@")[0];
            var image = user.pic;
            var uid = user.uid;
            if (FBUtil.isUserFBConnected()) {
                image = "http://graph.facebook.com/" + user.fbid + "/picture"
            }
            $("#user-admin .user-name").html(username);
            if (image && image != "") $("#user-admin .key-art").html('<img src="' + image + '" alt="" />');
            var userHref = "/u/" + uid;
            $("#user-admin #user-profile-link a").attr("href", userHref).attr("onclick", "Util.logAndGoToUrl('header:my-profle:click', '" + userHref + "');return false;");
            $("#login-btns").fadeOut(210, function () {
                $("#account").removeClass("logged-out").addClass("logged-in");
                $("#user-admin, #notif-bell").hide().fadeIn(210);
                $("#user-admin, #notif-bell").attr("style", "display: inline-block")
            });
            if (FBUtil.isUserFBConnected()) {
                $("#user-admin").addClass("fb");
                $("#fb-settings-link").show();
                $("#fb-connect-link").hide()
            } else {
                $("#user-admin").removeClass("fb");
                $("#fb-connect-link").show()
            }
            Interface.initUser();
            Notifications.startNotificationsFetch()
        }

        $(function () {
            $("#notif-bell").click(function () {
                Analytics.logAndSendEventToGA(["site:inbox:ui:view"]);
                $("#notify-badge span").text("0");
                $("#notify-badge").addClass("hide");
                $(".notify-nav").removeClass("badged");
                var currentTimeStamp = Math.floor((new Date).getTime() / 1e3);
                Util.setResourceToLocalStorage("lastReadTs", currentTimeStamp);
                if (Util.getPageType() != "owner-profile") {
                    var uid = JSON.parse($("#user-json").text()).uid;
                    Notifications.displayNotifications = true;
                    Util.logAndGoToUrl("", "/me/notifications")
                } else {
                    $("[data-tab='tab-notifications'] a").click()
                }
            });
            $("#radio-hdr-toggle").click(function () {
                Interface.radioHeaderToggle()
            });
            $("#radio-featured-stations").click(function () {
                if ($(".page-wrap").hasClass("radio")) {
                    Interface.smoothTo($("#featured-stations"), 480, null, 100)
                } else {
                    var isHome = $("body").attr("id") == "home";
                    if (isHome && Interface.localStorageSupport()) {
                        localStorage.radioHomeClick = true
                    }
                    var origin = isHome ? "home:" : "";
                    Interface.featuredStations = true;
                    Util.logAndGoToUrl("site:" + origin + "header:radio:featured_stations:start_radio:click", "/radio/" + Util.getLanguage())
                }
                return false
            });
            Header.updateRadioMenu()
        })
    };
var Player = Player || new function () {
        var _lastReportedProgress = 0;
        var _sendProgressFifteen = true;
        var _currentBitrate = 64;
        var _xhr = null;
        this.setVolume = function (v) {
            _setVolume(v)
        };
        this.setBitrate = function (inputBitrate) {
            if (_currentBitrate == inputBitrate)return false;
            $("#bitrate-" + inputBitrate).addClass("loading-bitrate");
            var trackElapsedTotalSeconds = Player.timeElapsed;
            var trackTime = $("#track-time").text().split(":");
            var trackTimeMinutes = parseInt(trackTime[0]);
            var trackTimeSeconds = parseInt(trackTime[1]);
            var trackTimeTotalSeconds = trackTimeMinutes * 60 + trackTimeSeconds;
            var bitrateText = "";
            switch (inputBitrate) {
                case 16:
                    bitrateText = "minimum";
                    break;
                case 32:
                    bitrateText = "fair";
                    break;
                case 64:
                    bitrateText = "good";
                    break;
                case 128:
                    bitrateText = "high";
                    break
            }
            $("#bitrate-display").text(bitrateText);
            if (trackTimeTotalSeconds <= 0)var pct = 0; else var pct = trackElapsedTotalSeconds / trackTimeTotalSeconds * 100;
            var song = Player.getCurrentSong();
            var showMessage = Util.getResourceFromLocalStorage("bitrate-message", false);
            var showPostPlay = false;
            var bitrateStr = "You're now listening at " + bitrateText.toLowerCase() + " quality.";
            if (!showMessage) bitrateStr += '<em>Use the <span class="bitrate">bitrate</span> icon at the bottom right to change your audio settings.</em>';
            if (song) {
                if (Player.getState().state == "playing") {
                    State.showNotification("Updating your bitrate. One moment...");
                    showPostPlay = true
                }
                Player.clearSong(song);
                if ($("#play").hasClass("hide")) Player.playSong(song, inputBitrate);
                Player.postPlayCallback = function () {
                    _seekSong(pct);
                    Player.postPlayCallback = null;
                    if (showPostPlay) {
                        State.showNotification(bitrateStr, false, 1.5);
                        Util.setResourceToLocalStorage("bitrate-message", true)
                    }
                };
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "music_quality:" + inputBitrate + "kbps", "songid", song.songid)
            }
            $("#bitrate-" + inputBitrate).removeClass("loading-bitrate");
            $("#bitrate-" + _currentBitrate).removeClass("current-bitrate");
            $("#bitrate-" + inputBitrate).addClass("current-bitrate");
            _currentBitrate = inputBitrate;
            Util.setResourceToLocalStorage("bitrate", _currentBitrate)
        };
        this.reloadPlayerState = function () {
            var countryCode = Util.getCountryCode();
            var defaultBitrate = parseInt(Util.getResourceFromLocalStorage("bitrate", _getDefaultBitrateFromGeo(countryCode)));
            Player.setBitrate(defaultBitrate);
            var song = Util.getResourceFromLocalStorage("currentSong", null);
            var volume = parseInt(Util.getResourceFromLocalStorage("volume", "75"));
            var radioMode = Util.getResourceFromLocalStorage("radioMode", "false");
            if (song != null && radioMode === "false") {
                var currentIndex = parseInt(Util.getResourceFromLocalStorage("currentIndex", -1));
                var queue = $("#drawer-queue-group").children();
                if (currentIndex >= 0 && currentIndex < queue.length) {
                    $(queue[currentIndex]).addClass("now-playing")
                }
                song = JSON.parse(song);
                Player.paintPlayerUI(song);
                Player.enable();
                State.reloadSidebar()
            }
            var repeatState = parseInt(Util.getResourceFromLocalStorage("repeat", "0"));
            if (repeatState != 0) {
                var repeatClass = "";
                switch (repeatState) {
                    case 1:
                        repeatClass = "on";
                        State.playlistLoop = true;
                        State.singleSongLoop = false;
                        break;
                    case 2:
                        repeatClass = "single";
                        State.playlistLoop = false;
                        State.singleSongLoop = true;
                        break
                }
                if (repeatClass != "") {
                    $("#repeat").addClass(repeatClass)
                }
            }
            var shuffleMode = Util.getResourceFromLocalStorage("shuffle", "false");
            if (shuffleMode == "true") {
                State.shuffleMode = true;
                $("#shuffle").addClass("on")
            }
        };
        this.init = function () {
            State.loadPlayer(Player.reloadPlayerState)
        };
        this.clear = function (logevent) {
            logevent = typeof logevent != "undefined" ? logevent : true;
            try {
                Player.jwplayer.stop();
                Player.disable();
                $("#now-playing .key-art").css("background-image", "none");
                $("#player-track-name").html("");
                var kitsch = Util.getRandBetween(0, Player.kitsch.length);
                $("#player-album-name").html(Player.kitsch[kitsch]);
                $("#track-time, #track-elapsed, #track-remaining").html("0:00");
                $("#progress-bar").css("width", "0%");
                $("#progress-slider").css("left", "0px");
                $("#pause").addClass("hide");
                $("#play").removeClass("hide");
                Util.removeResourceFromLocalStorage("currentSong");
                Util.removeResourceFromLocalStorage("songProgress")
            } catch (e) {
                Util.logInConsole(e)
            }
            if (logevent) {
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "clear")
            }
        };
        this.isPlayerDisabled = function () {
            return $("#player").hasClass("disabled")
        };
        this.debug = function (string) {
            if (Player.dplayer != null) json = Player.dplayer.debug(string)
        };
        function resetTrackingVars() {
            _sendProgressFifteen = true;
            _lastReportedProgress = 0
        }

        this.paintPlayerUI = function (song) {
            var search_url = song.perma_url.replace("/p/song", "/s/song");
            $("#track-time").html(Util.getFormattedDuration(song.duration));
            $("#player-album-name").html("<a onclick=\"Util.logAndGoToUrl('" + Player.PREFIX + Player.DELIMITER + "album-name:click', '" + song.album_url.replace("/p/album", "/s/album") + "');\">" + Util.htmlEntityDecode(song.album) + "</a>");
            $("#player-track-name").html("<a onclick=\"Util.logAndGoToUrl('" + Player.PREFIX + Player.DELIMITER + "track-name:click', '" + search_url + "');\">" + Util.htmlEntityDecode(song.title) + "</a>");
            $("#player-info").unbind("click").click(function () {
                var radio = State.radioMode == true ? "radio:" : "";
                Util.logAndGoToUrl("site:player:" + radio + "info:click", search_url)
            });
            if (song.starred == "true") {
                $("#now-playing-extras .star").addClass("on").html("Starred <em>Remove</em>")
            } else {
                $("#now-playing-extras .star").removeClass("on").html("Star")
            }
            radioLanguages = Util.getRadioLanguages();
            if ($.inArray(song.language, radioLanguages) >= 0) {
                $("#player-radio").css("display", "inline")
            } else {
                $("#player-radio").css("display", "none")
            }
            song.image_url = song.image_url.replace("500x500", "80x80");
            song.image_url = song.image_url.replace("150x150", "80x80");
            song.image_url = song.image_url.replace("-screen", "-thumb");
            $("#player-blur").find("img").fadeOut(120, function () {
                $(this).remove()
            });
            if (song.image_url && $.trim(song.image_url) != "") {
                $("#now-playing .key-art").css("background-image", "url(" + song.image_url + ")");
                $("#player-blur").append('<img src="' + song.image_url + '" />')
            } else {
                $("#now-playing .key-art").css("background-image", "url(" + Util.getCDNUrl() + "/_i/3.0/album-default.png)")
            }
        };
        this.streamSong = function () {
            Player.jwplayer.play(true)
        };
        this.clearSong = function (song) {
            if (Player.isReady && Player.jwplayer.getPlaylistItem()) {
                Player.jwplayer.stop()
            }
            Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediaunload", "songid", song.songid)
        };
        this.playSong = function (song, inputBitrate) {
            if (song) {
                if (Player.jwplayer == undefined || Player.jwplayer == "" || Player.jwplayer == null || Player.isReady == false) {
                    window.setTimeout(function () {
                        resetTrackingVars();
                        Player.playSong(song)
                    }, 100);
                    return true
                }
                try {
                    if (inputBitrate == null || inputBitrate == undefined) {
                        inputBitrate = _currentBitrate
                    }
                    if (!State.radioMode && Util.getResourceFromLocalStorage("radioMode", "false") === "true") {
                        Util.setResourceToLocalStorage("radioMode", false)
                    }
                    Player._onSeekOnce = true;
                    var urlToRequest = song.url;
                    var protocol = $("#jwplayerProtocol").attr("data-protocol_val") === "http" ? "http://" : "https://";
                    var urlToCall = protocol + window.location.hostname + "/api.php";
                    var postData = {
                        url: urlToRequest,
                        ra: Base64.decode(Util.getCookie("ATC")) - Player.sharedToken,
                        __call: "song.generateAuthToken",
                        _marker: "false",
                        _format: "json",
                        bitrate: inputBitrate
                    };
                    var callbackName = function (data, status) {
                        _xhr = null;
                        if (status == Util.SUCCESS) {
                            if (data.status == "success" && data.auth_url != "" && data.auth_url != undefined) {
                                resetTrackingVars();
                                $("body").removeClass("paused").addClass("playing");
                                Interface.checkPlayButtonStates();
                                var url = data.auth_url;
                                var part1 = url.substring(0, url.indexOf("acl=") + 4);
                                var part2 = url.substring(url.indexOf("~hmac"));
                                var replacePart = url.substring(url.indexOf("acl=") + 4, url.indexOf("~hmac"));
                                replacePart.replace("\\", "");
                                url = part1 + replacePart + part2;
                                Player.currentSongType = data.type;
                                Player.currentSongUrl = url;
                                Player.playSongHelper(song)
                            } else if (data.status == "error") {
                                return true
                            } else {
                                State.showNotification(song.title + " could not be loaded.");
                                return true
                            }
                        } else {
                            if (data.status == 0)return true;
                            State.showNotification(song.title + " could not be loaded.");
                            return true
                        }
                    };
                    if (_xhr != null) {
                        _xhr.abort()
                    }
                    _xhr = $.ajax({
                        type: "POST",
                        url: urlToCall,
                        crossDomain: true,
                        dataType: "json",
                        data: postData,
                        xhrFields: {withCredentials: true},
                        success: function (result, status) {
                            callbackName(result, "success")
                        },
                        error: function (result, status) {
                            callbackName(result, "error")
                        }
                    })
                } catch (ex) {
                    Util.logInConsole(ex);
                    return false
                }
                return true
            }
            return false
        };
        this.playSongHelper = function (song) {
            var song_arr = [];
            var song_json = {file: Player.currentSongUrl, description: song, type: Player.currentSongType};
            song_arr.push(song_json);
            try {
                Player.clearSong(song);
                Player.jwplayer.load(song_arr);
                if ($("#player").hasClass("disabled")) Player.enable();
                $("#play").addClass("hide");
                $("#pause").removeClass("hide");
                $("#now-playing").removeClass("disabled");
                Player.paintPlayerUI(song);
                if (song.starred == "true") {
                    $("#now-playing-extras .star").addClass("on").html("Starred <em>Remove</em>")
                } else {
                    $("#now-playing-extras .star").removeClass("on").html("Star")
                }
                if (State.showRBT) {
                    if (song.has_rbt == "true") {
                        $("#get-rbt").removeClass("disabled")
                    } else {
                        $("#get-rbt").addClass("disabled")
                    }
                }
                $("body").removeClass("paused").addClass("playing");
                Interface.checkPlayButtonStates()
            } catch (ex) {
                State.showNotification(song.title + " could not be loaded.")
            }
        };
        this.toggleStarIcon = function (starred) {
            if (starred) {
                $("#now-playing-extras a.star").addClass("on").html("Starred <em>Remove</em>")
            } else {
                $("#now-playing-extras a.star").removeClass("on").html("Star")
            }
        };
        this.pauseSong = function () {
            Player.jwplayer.pause(true);
            $("#pause").addClass("hide");
            $("#play").removeClass("hide");
            $("body").removeClass("playing").addClass("paused")
        };
        this.resumeSong = function () {
            Player.onPlayOnce = true;
            Player._onSeekOnce = true;
            Player.jwplayer.play(true);
            $("#play").addClass("hide");
            $("#pause").removeClass("hide");
            $("body").removeClass("paused").addClass("playing")
        };
        this.isPlayerPaused = function () {
            var stateObj = Player.getState();
            if (stateObj && stateObj.state == "paused")return true;
            return false
        };
        this.isPlayerPlaying = function () {
            var stateObj = Player.getState();
            if (stateObj && stateObj.state == "playing")return true;
            return false
        };
        this.getState = function () {
            var stateObj = null;
            try {
                stateObj = {};
                switch (Player.jwplayer.getState()) {
                    case"IDLE":
                    case"BUFFERING":
                        stateObj.state = "ready";
                        break;
                    case"PLAYING":
                        stateObj.state = "playing";
                        break;
                    case"PAUSED":
                        stateObj.state = "paused";
                        break
                }
                stateObj.volume = Player.jwplayer.getVolume()
            } catch (e) {
            }
            return stateObj
        };
        this.getCurrentSong = function () {
            var currentSong = null;
            if (typeof Player.jwplayer != "undefined") {
                try {
                    currentSong = Player.jwplayer.getPlaylistItem();
                    if (currentSong == null || currentSong == undefined) {
                        currentSong = Util.getResourceFromLocalStorage("currentSong", null);
                        currentSong = JSON.parse(currentSong)
                    } else {
                        currentSong = currentSong.description
                    }
                } catch (e) {
                    currentSong = Util.getResourceFromLocalStorage("currentSong", null);
                    currentSong = JSON.parse(currentSong)
                }
            } else {
                Util.logInConsole("Player.jwplayer still not initialized")
            }
            return currentSong
        };
        this.enable = function () {
            $("#player").removeClass("disabled")
        };
        this.disable = function () {
            $("#player").addClass("disabled");
            $("#player button").removeClass("disabled");
            $("body").removeClass("playing paused")
        };
        this.handleNextPrevButtons = function (button, isOn) {
            if (button == Player.PREVIOUS) {
                if (isOn) $("#rew").removeClass("disabled"); else $("#rew").addClass("disabled")
            }
            if (button == Player.NEXT) {
                if (isOn) $("#fwd").removeClass("disabled"); else $("#fwd").addClass("disabled")
            }
        };
        this.initPlayerUI = function () {
            sliderW = $(".slider").outerWidth();
            if (State.showRBT) $("#player").addClass("show-rbt"); else $("#player").removeClass("show-rbt");
            $("#player-album-name").html(Player.kitsch[Util.getRandBetween(0, Player.kitsch.length)]);
            $("#now-playing .key-art").click(function () {
                var song = Player.getCurrentSong();
                if (song) {
                    var url = song.perma_url;
                    Util.updateBrowserUrl(url, false);
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "artwork:click")
                }
            });
            $("#shuffle").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) $(this).toggleClass("on");
                if (State.shuffleMode) {
                    State.shuffleMode = false;
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "shuffle_unset")
                } else {
                    State.shuffleMode = true;
                    var playerState = Player.getState().state;
                    if (playerState != "end") {
                        var currentSong = Player.getCurrentSong();
                        Sidebar.addSongtoDiscardedPile(currentSong)
                    }
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "shuffle_set")
                }
                Util.setResourceToLocalStorage("shuffle", State.shuffleMode);
                State.getPlayerControlsState()
            });
            $("#repeat").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    if ($(this).hasClass("on")) $(this).removeClass("on").addClass("single"); else if ($(this).hasClass("single")) $(this).removeClass("single"); else $(this).addClass("on")
                }
                var repeatState = 0;
                if ($("#repeat").hasClass("on")) {
                    State.playlistLoop = true;
                    repeatState = 1
                } else {
                    State.playlistLoop = false
                }
                if ($("#repeat").hasClass("single")) {
                    State.singleSongLoop = true;
                    repeatState = 2
                } else {
                    State.singleSongLoop = false
                }
                Util.setResourceToLocalStorage("repeat", repeatState);
                if (State.singleSongLoop || State.playlistLoop) {
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "repeat_set:click");
                    if (State.singleSongLoop) {
                        Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "repeat_one_set:click")
                    }
                    if (State.playlistLoop) {
                        Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "repeat_all_set:click")
                    }
                } else {
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "repeat_unset:click")
                }
                State.getPlayerControlsState()
            });
            $("#volume-slider").draggable({
                axis: "y", containment: "parent", create: function (event, ui) {
                    Player.volume = parseInt(Util.getResourceFromLocalStorage("volume", "75"));
                    _setVolume(Player.volume, true, false);
                    if (Player.volume == 0) $("#volume-wrap").addClass("mute")
                }, drag: function (event, ui) {
                    $("#mute").removeClass("on");
                    previousVolume = Math.round(Player.volume);
                    var vol = 100 * (1 - $(this).position().top / 100);
                    $("#volume-bar").css("height", $("#volume-gutter").innerHeight() * (vol / 100) + "px");
                    Player.volume = Math.round(vol);
                    if (previousVolume != Player.volume) {
                        if (Player.volume < 2) {
                            Player.volume = 0;
                            _setVolume(Player.volume, false, false);
                            $("#mute").parent().addClass("mute")
                        } else {
                            _setVolume(Player.volume, false, false);
                            if ($("#mute").parent().hasClass("mute")) $("#mute").parent().removeClass("mute")
                        }
                    }
                }, stop: function (event, ui) {
                    if (Player.volume < 2) {
                        _setVolume(0);
                        $("#mute").parent().addClass("mute")
                    } else {
                        _setVolume(Player.volume);
                        $("#mute").parent().removeClass("mute")
                    }
                }
            });
            $("#volume-drop").click(function (e) {
                if ($(e.target).attr("id") == "volume-slider")return;
                var mouse = e.pageY - $(this).offset().top;
                var pct = 100 * (1 - mouse / $(this).outerHeight());
                if (pct > Player.volume) {
                    pct = Math.round(pct * 1.1);
                    pct = pct > 100 ? 100 : pct;
                    Player.volume = pct
                } else if (pct < Player.volume) {
                    pct = Math.round(pct * .9);
                    pct = pct < 2 ? 0 : pct;
                    Player.volume = pct
                } else {
                    return
                }
                if (Player.volume < 5) {
                    _setVolume(0);
                    $("#mute").parent().addClass("mute")
                } else {
                    _setVolume(Player.volume);
                    $("#mute").parent().removeClass("mute")
                }
            });
            $("#mute").click(function () {
                if ($(this).parent().hasClass("mute")) {
                    $(this).parent().removeClass("mute");
                    _setVolume(Player.volume)
                } else {
                    $(this).parent().addClass("mute");
                    _setVolume(0)
                }
            });
            $("#progress-slider").draggable({
                axis: "x", containment: "parent", create: function (event, ui) {
                    progressStart = $(this).position().left
                }, drag: function (event, ui) {
                    if ($("#play").hasClass("disabled") || $("#now-playing").hasClass("disabled") || Player.getCurrentSong() == null) {
                        return
                    }
                    Player.playerSeeked = true;
                    pct = ($(this).position().left - progressStart) / ($("#progress-gutter").width() - Player.progressSliderWidth) * 100;
                    $("#progress-bar").css("width", pct + "%")
                }, stop: function (event, ui) {
                    if ($("#play").hasClass("disabled") || $("#player").hasClass("disabled") || Player.getCurrentSong() == null) {
                        $("#progress-slider").css("left", "0px");
                        return
                    }
                    $("#progress-bar").css("width", $("#progress-gutter").width() * (pct / 100) + "px");
                    _seekSong(pct);
                    Player.playerSeeked = false
                }
            });
            $("#progress-gutter").click(function (e) {
                if ($("#play").hasClass("disabled") || $("#player").hasClass("disabled") || $("#now-playing").hasClass("disabled") || Player.getCurrentSong() == null) {
                    return
                }
                var mouse = e.pageX - $(this).offset().left;
                var pct = mouse / $(this).width() * 100;
                var x = ($(this).width() - Player.progressSliderWidth) * (pct / 100);
                $("#progress-slider").animate({left: x + "px"}, 120);
                $("#progress-bar").animate({width: pct + "%"}, 120);
                _seekSong(pct)
            });
            $("#track-elapsed, #track-remaining").click(function () {
                $("#track-elapsed, #track-remaining").toggle()
            });
            $("#play").click(function () {
                if (Player.getCurrentSong() == null) {
                    var currentQueue = Sidebar.nowPlayingData();
                    var currentIndex = parseInt(Util.getResourceFromLocalStorage("currentIndex", 0));
                    var song = currentQueue[currentIndex];
                    if (song != null) {
                        Player.playSong(song)
                    }
                    return
                }
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    $("#play").addClass("hide");
                    $("#pause").removeClass("hide");
                    if (Player.getState().state == "paused") {
                        Player.resumeSong()
                    } else {
                        var song = Player.getCurrentSong();
                        Player.playSong(song)
                    }
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "click_to_play")
                }
            });
            $("#pause").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    Player.pauseSong();
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "click_to_pause")
                }
            });
            $("#fwd").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    if (Radio.LJR) {
                        if (Radio.LJRWhatCount < Radio.LJRWhatMax) {
                            $(Radio.LJRAudio.what[Util.getRandBetween(0, Radio.LJRAudio.what.length - 1)])[0].play();
                            Radio.LJRWhatCount++;
                            return
                        } else {
                            $(Radio.LJRAudio.okay[Util.getRandBetween(0, Radio.LJRAudio.okay.length - 1)])[0].play();
                            Radio.LJRWhatCount = 0;
                            Radio.setWhatMax()
                        }
                    }
                    if (Radio.RJK) {
                        $(Radio.RJKAudio.skip[Util.getRandBetween(0, Radio.RJKAudio.skip.length - 1)])[0].play()
                    }
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "next");
                    State.playNextSong()
                }
            });
            $("#rew").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    if (Player.timeElapsed >= 10) {
                        _seekSong(0)
                    } else {
                        State.playPreviousSong();
                        Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "prev")
                    }
                }
            });
            $("#player-radio").click(function () {
                if (State.radioMode) {
                    Analytics.logAndSendEventToGA("site:player:radio:stop_radio:click");
                    State.stopRadio()
                } else {
                    _startRadioFromCurrentSong("player");
                }
            });
            $("#like").click(function () {
                if ($(this).hasClass("on"))return;
                Radio.likeSong()
            });
            $("#dislike").click(function () {
                Radio.dislikeSong()
            });
            $("#player-add-playlist").click(function () {
                var song = Player.getCurrentSong();
                if (song == null) {
                    song = Util.getResourceFromLocalStorage("currentSong", null);
                    song = JSON.parse(song)
                }
                var addToPlaylistObject = '{"language":"' + song.language + '","songid":"' + song.songid + '"}';
                Analytics.logAndSendEventToGA("site:player:more_menu:add-to-playlist:click");
                Panel.showPlaylistPanel(addToPlaylistObject)
            });
            $("#player-menu-radio").click(function () {
                _startRadioFromCurrentSong("player:more_menu")
            });
            $("#player-share").click(function () {
                if ($("#player").hasClass("disabled"))return;
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "share:click");
                var song = Player.getCurrentSong();
                if (song == null) {
                    var currentQueue = Sidebar.nowPlayingData();
                    var currentIndex = parseInt(Util.getResourceFromLocalStorage("currentIndex", 0));
                    song = currentQueue[currentIndex]
                }
                var message = '#NowPlaying "' + song.title + '" @saavn #OurSoundtrack';
                var params = "?url=" + escape(song.perma_url) + "&amp;text=" + escape(message) + "&amp;related=" + "saavn";
                objectToShare = new Object;
                objectToShare.fbswfparams = song.fb_swf_params;
                objectToShare.fbtitle = song.title;
                objectToShare.fbthumb = song.image_url;
                objectToShare.twitter = "http://twitter.com/share" + params;
                objectToShare.perma_url = song.perma_url;
                objectToShare.thumb = song.image_url;
                objectToShare.album = song.album;
                objectToShare.song = song.title;
                objectToShare.id = song.songid;
                SharePanel.showPanel(objectToShare)
            });
            $("#now-playing-extras .star").click(function () {
                var song = Player.getCurrentSong();
                var op = $(this).hasClass("on") ? "removeSong" : "addSong";
                Util.callFavorites({
                    pid: song.songid, op: op, lang: song.language, success: function (o) {
                        State.songStarToggled(song, op == "addSong" ? true : false);
                        if (op == "addSong") {
                            State.showNotification(song.title + " was added to your Starred Songs.")
                        } else {
                            State.showNotification(song.title + " was removed from your Starred Songs.", "remove")
                        }
                    }, error: function (o) {
                        State.showError("There was a problem starring the song. Please try again later")
                    }
                })
            });
            $("#player-more-album").unbind("click").click(function () {
                var song = Player.getCurrentSong();
                var album_url = song.album_url.replace("/p/", "/s/");
                Util.logAndGoToUrl("site:player:more_menu:more_from_album:click", album_url)
            });
            $("#get-rbt").click(function () {
                if (!$(this).hasClass("disabled") && !$("#player").hasClass("disabled")) {
                    var song = Player.getCurrentSong();
                    Analytics.logAndSendEventToGA("rbt:click:player");
                    Panel.showRingtonesPanel(song.songid, song.title)
                }
            })
        };
        function _startRadioFromCurrentSong(source) {
            Analytics.logAndSendEventToGA("site:" + source + ":start_radio:click");
            var song = Player.getCurrentSong();
            if (song == null) {
                song = Util.getResourceFromLocalStorage("currentSong", null);
                song = JSON.parse(song)
            }
            var title = Util.sanitisePhraseForURL(song.title);
            var url = "/p/radio/" + song.language + "-song-station/" + title + "/" + song.e_songid;
            if (url == window.location.pathname) State.refreshContent(); else Util.updateBrowserUrl(url)
        }

        function _getDefaultBitrateFromGeo(countryCode) {
            if (countryCode == "US") {
                return 128
            }
            return 64
        }

        function _setVolume(volume, updateUI, logEvent) {
            if (updateUI != false) {
                Util.setResourceToLocalStorage("volume", volume);
                var volGutterH = $("#volume-gutter").innerHeight();
                $("#volume-bar").animate({height: volGutterH * (volume / 100) + "px"}, 120);
                $("#volume-slider").animate({top: 100 * (1 - volume / 100) + "px"}, 120)
            }
            var volumePhrase = "volume_dec";
            if (Player.jwplayer != "") {
                if (Player.getState().volume < volume) {
                    volumePhrase = "volume_inc"
                }
                Player.jwplayer.setVolume(volume)
            }
            State.notifyVolumeChange(volume);
            if (logEvent != false) {
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + volumePhrase)
            }
        }

        function _seekSong(pct) {
            var duration = Player.jwplayer.getDuration();
            duration = Math.floor(pct * duration / 100);
            var song = Player.getCurrentSong();
            Player._onSeekOnce = false;
            Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "change_position", "songid", song.songid);
            Player.jwplayer.seek(duration);
            if ($("#pause").hasClass("hide")) {
                $("#play").addClass("hide");
                $("#pause").removeClass("hide");
                $("body").removeClass("paused").addClass("playing")
            }
        }

        this.seekSong = function (pct) {
            _seekSong(pct)
        };
        this.reportProgress = function (progress) {
            var report_progress_interval = 30;
            var time_elapsed = progress % report_progress_interval;
            var progress_to_report = progress - time_elapsed;
            var ev = "progress" + Player.DELIMITER;
            if (progress >= 15 && _sendProgressFifteen) {
                var song = Player.getCurrentSong();
                _sendProgressFifteen = false;
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + ev + "15", "songid", song.songid);
                return
            }
            if (_lastReportedProgress == progress_to_report) {
                return
            }
            if (progress >= report_progress_interval) {
                var song = Player.getCurrentSong();
                ev += progress_to_report;
                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + ev, "songid", song.songid);
                _lastReportedProgress = progress_to_report;
                if (progress_to_report == 30) {
                    State.reportProgressEvents(progress_to_report)
                }
            }
        };
        this.setTimeElapsed = function (timeElapsed) {
            Player.timeElapsed = timeElapsed
        };
        this.radioOn = function () {
            Interface.showRadio();
            $("#player-radio").removeClass("green").addClass("white outline").html("<span></span>Stop Radio");
            $("#fwd").removeClass("disabled");
            $("#shuffle, #repeat").addClass("disabled");
            if (Player.PREFIX.indexOf(":radio") == -1) {
                Player.PREFIX += ":radio"
            }
        };
        this.radioOff = function () {
            Interface.hideRadio();
            Interface.checkPlayButtonStates("", true);
            $("#shuffle, #repeat").removeClass("disabled");
            Player.clear();
            $("#player-radio").removeClass("white outline").addClass("green").html("<span></span>Start Radio");
            Player.PREFIX = Player.PREFIX.replace(":radio", "")
        };
        this.initJWPlayerTracking = function () {
            Player.jwplayer.onTime(function (event) {
                try {
                    event.position = Math.floor(event.position);
                    event.duration = Math.floor(event.duration);
                    var elapsed = event.duration - event.position;
                    $("#track-elapsed").html(Util.getFormattedDuration(event.position));
                    $("#track-remaining").html("&ndash;" + Util.getFormattedDuration(elapsed));
                    var x = parseInt(event.position) * ($("#progress-gutter").width() - Player.progressSliderWidth) / parseInt(event.duration);
                    var pct = x / ($("#progress-gutter").width() - Player.progressSliderWidth) * 100;
                    $("#progress-bar").css("width", pct + "%");
                    $("#progress-slider").css("left", parseInt($("#progress-bar").outerWidth()) - 3 + "px");
                    Player.setTimeElapsed(event.position);
                    Player.reportProgress(event.position);
                    if (event.position > 0 && event.position % 2 == 0) {
                        Util.setResourceToLocalStorage("songProgress", pct)
                    }
                } catch (ex) {
                    Util.logInConsole(ex)
                }
            });
            Player.jwplayer.onComplete(function (event) {
                try {
                    onCompleteOnce = false;
                    var song = Player.getCurrentSong();
                    $("#pause").addClass("hide");
                    $("#play").removeClass("hide");
                    $("#progress-bar").css("width", "0px");
                    $("#progress-slider").css("left", "0px");
                    $("#track-elapsed, #track-remaining").html("0:00");
                    $("#now-playing").addClass("disabled");
                    Player.timeElapsed = 0;
                    $("body").removeClass("playing paused");
                    State.playNextSong();
                    FBUtil.postFBPauseEvent(song);
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediaend", "songid", song.songid)
                } catch (ex) {
                    Util.logInConsole(ex)
                }
            });
            Player.jwplayer.onPause(function (event) {
                try {
                    onPauseOnce = false;
                    var song = Player.getCurrentSong();
                    FBUtil.postFBPauseEvent(song);
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediapaused", "songid", song.songid)
                } catch (ex) {
                    Util.logInConsole(ex)
                }
            });
            Player.jwplayer.onPlay(function (event) {
                if (Player.onPlayOnce && Player._onSeekOnce) {
                    try {
                        Player.onPlayOnce = false;
                        var song = Player.getCurrentSong();
                        if (event.oldstate === "PAUSED") {
                            FBUtil.postFBResumeEvent(song);
                            Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediaresumed", "songid", song.songid)
                        } else if (event.oldstate === "IDLE" || event.oldstate === "BUFFERING") {
                            Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediaopened", "songid", song.songid);
                            Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediabegin", "songid", song.songid);
                            if (song.publish_to_fb) {
                                FBUtil.publishEventToFB(song)
                            }
                            State.song_progressed_secs = 0;
                            if (Player.postPlayCallback) {
                                setTimeout(Player.postPlayCallback, 500)
                            }
                            Util.setResourceToLocalStorage("currentSong", JSON.stringify(Player.getCurrentSong()))
                        } else if (Util.inactive) {
                            var time = 1200;
                            var current_title = Player.getCurrentSong().title;
                            for (var k = 1; k < 8; k = k + 2) {
                                var p = setTimeout('if (Util.inactive) {document.title = "Playing "+ Player.getCurrentSong().title}', k * time);
                                var t = setTimeout("document.title = Util.pagetitle", k * time + time)
                            }
                        }
                    } catch (ex) {
                        Util.logInConsole(ex)
                    }
                } else {
                    Player.onPlayOnce = true
                }
            });
            Player.jwplayer.onPlaylist(function (event) {
                if (!Player.firstPlaylistLoad) {
                    var song = Player.getCurrentSong();
                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "mediaready", "songid", song.songid)
                } else {
                    Player.firstPlaylistLoad = false
                }
            });
            Player.jwplayer.onError(function (event) {
                Util.logInConsole(event);
                State.showNotification("Oops! The song could not be played. Playing the next song in the queue.");
                setTimeout(function () {
                    Player.reloadPlayerState();
                    State.playNextSong()
                }, 1e3)
            })
        }
    };
Player.currentSongUrl = "";
Player.PREVIOUS = "prev";
Player.NEXT = "next";
Player.PREFIX = "site:player";
Player.DELIMITER = ":";
Player.dplayer = "";
Player.volume = getDefaultVolume();
Player.progressSliderWidth = 14;
Player.pct = 0;
Player.playerSeeked = false;
Player.timeElapsed = 0;
Player.postPlayCallback = null;
Player.jwplayer = null;
Player.prevPos = 0;
Player.bitrateFileAppendStr = "";
Player.currentSongType = "";
Player.sharedToken = 42267;
Player._onSeekOnce = true;
Player.firstPlaylistLoad = true;
Player.onPlayOnce = true;
Player.isReady = false;
function getDefaultVolume() {
    var volume = Util.getResourceFromLocalStorage("volume");
    if (volume == "" || volume == null) {
        volume = "75"
    }
    return parseInt(volume)
}
Player.kitsch = ["Hello. Is it me you're looking for...", "All you need is love, love. Love is all you need...", "If we weren't all crazy we would go insane...", "The words of the prophets are written on the subway walls...", "You gotta know when to hold 'em, know when to fold 'em...", "Come together, right now. Over me...", "Just a small town girl, living in a lonely world...", "Imagine all the people, living life in peace...", "Hey, I just met you, and this is crazy...", "If you liked it then you shoulda put a ring on it...", "Give me a sign, hit me baby one more time...", "And I think to myself, what a wonderful world...", "Somewhere over the rainbow, skies are blue...", "You can't hurry love, no you just have to wait...", "Let's stay together, lovin' you whether times are good or bad...", "Mere angne mein tumhara kya kaam hai...", "Akele, akele, kahan ja rahe ho...", "Hum tum ek kaamre bandh ho, aur chaabi kho jaaye...", "Kya hua tera vaada...", "Aaj jaane ki zid na karo...", "Aage bhi jaane na tu...", "Babuji dheere chalna...", "Eena meena deeka, dhaai damanika; makaa nakaa nakaa, chika pika rika...", "Kya yehi pyaar hai...", "Intehaa ho gayi, intezaar ki...", "O o jaane jaana, dhoonde tujhe deewana...", "Aye ajnabi, tu bhi kabhi aawaz de kahin se...", "Saavn ka mahina, pawan kare shor...", "Zindagi kaisi hai paheli, haaye...", "Kahin deep jale, kahin dil...", "Tere jaisa yaar kahaan...", "Pyaar kiya to darna kya...", "Jaane dil mein kab se hai tu..."];
var Panel = Panel || new function () {
        this.showRepliesPanel = function (data) {
            var entity = data.entity;
            var messages = data.messages;
            var guid = data.guid;
            var uids = data.uids;
            var tagMsg = "";
            tagMsg = messages[0];
            tagMsg.user.url = "/u/" + tagMsg.user.id;
            tagMsg.text = tagMsg.text.replace(/\n/g, "<br>").replace(/\\n/g, "<br>");
            var tagImageOnClick = "Util.logAndGoToUrl(['site:inbox:thread:social_head_in_title:click', 'uid', " + tagMsg.user.id + "], '" + tagMsg.user.url + "');return false;";
            var tagNameOnClick = "Util.logAndGoToUrl(['site:inbox:thread:name_in_title:click', 'uid', " + tagMsg.user.id + "], '" + tagMsg.user.url + "');return false;";
            var tagContentOnClick = "Util.logAndGoToUrl(['site:inbox:thread:content:click', 'uid', " + tagMsg.user.id + ", '" + entity.type + "id', '" + entity.id + "'], '" + entity.url + "');return false;";
            panel = '<div id="replies-panel" class="cpanel" data-entity-type="' + entity.type + '" data-entity-id="' + entity.id + '" data-guid="' + guid + '" data-uids="' + uids + '">' + '<header class="cpanel-header">' + "<h3>Replies</h3>" + '<a><div class="close-area"><div class="close"></div></div></a>' + "</header>" + '<div class="cpanel-content full xtra-pad thread">' + '<ol class="msg-thread" id="replies">' + "<li>" + '<div class="user">' + '<div class="user-icon-small"><a onclick="' + tagImageOnClick + '" href="' + tagMsg.user.url + '"><img src="' + tagMsg.user.img + '" height="30px"></a></div>' + "</div>" + '<div class="notify-reply">' + '<a class="reply-author" onclick="' + tagNameOnClick + '" href="' + tagMsg.user.url + '">' + tagMsg.user.text + "</a>" + '<p class="msg-text tag-msg thread">' + tagMsg.text + "</p>" + '<span class="msg-time">' + Util.getTimestampLabel(tagMsg.ts) + "</span>" + "</div>" + "</li>" + '<div class="tagged-content">' + '<div class="tagged-content-art">' + '<div class="art album-art playlist-art">' + '<a href="' + entity.url + '" onclick="' + tagContentOnClick + '">' + '<img src="' + entity.img + '" alt="' + entity.meta + '">';
            if (entity.type != "artist") {
                panel += '<div class="overlay-actions">' + '<div class="overlay-action-buttons">' + '<button class="play" onclick="State.autoLoadPostContentFetch(true);' + tagContentOnClick + '" href="' + entity.url + '">Play Now</button>' + "</div>" + "</div>"
            }
            panel += "</a>" + "</div>" + "</div>" + '<div class="tagged-content-details">' + '<span class="title"><a href="' + entity.url + '" onclick="' + tagContentOnClick + '">' + entity.name + "</a></span>";
            if (entity.type != "artist") {
                panel += "<span>" + entity.meta + "</span>"
            }
            panel += "</div>" + "</div>";
            for (i = 1; i < messages.length; i++) {
                var msg = messages[i];
                msg.user.url = "/u/" + msg.user.id;
                var msgText = msg.text + "";
                var formattedText = msgText.replace(/\\n/g, "<br>").replace(/\n/g, "<br>");
                var userImgOnClick = "Util.logAndGoToUrl(['site:inbox:thread:social_head_in_thread:click', 'uid', '" + msg.user.id + "'], '" + msg.user.url + "');return false;";
                var userNameOnClick = "Util.logAndGoToUrl(['site:inbox:thread:name_in_thread:click', 'uid', '" + msg.user.id + "'], '" + msg.user.url + "');return false;";
                panel += "<li>" + '<div class="user">' + '<div class="user-icon-small"><a href="' + msg.user.url + '" onclick="' + userImgOnClick + '"><img src="' + msg.user.img + '" height="30px"></a></div>' + "</div>" + '<div class="notify-reply">' + '<a class="reply-author" onclick="' + userNameOnClick + '">' + msg.user.text + "</a>" + '<p class="msg-text tag-msg thread">' + formattedText + "</p>" + '<span class="msg-time">' + Util.getTimestampLabel(msg.ts) + "</span>" + "</div>" + "</li>"
            }
            panel += "</ol>" + "</div>" + "<footer>" + '<textarea class="optional-msg thread" placeholder="Add your message" id="replies-message"></textarea>' + '<div class="share-modal-btn-wrap">' + '<h5 id="replyLength">140</h5>' + '<a id="post-reply-button" class="btn green">Post Reply</a>' + "</div>" + "</footer>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#replies-panel");
            Interface.cPanel("#replies-panel", {w: 430});
            $("#replies-message").keyup(function () {
                var textLength = $(this).val().length;
                if (textLength > 140) {
                    $("#replyLength").css("opacity", "1");
                    $("#replyLength").css("color", "red");
                    $("#post-reply-button").css("opacity", "0.2");
                    $("#post-reply-button").css("cursor", "default")
                } else {
                    $("#post-reply-button, #messageLength").css("opacity", "");
                    $("#replyLength").css("color", "");
                    $("#post-reply-button").css("cursor", "")
                }
                $("#replyLength").text(140 - textLength)
            });
            $("#post-reply-button").click(function () {
                var msg = $("#replies-message").val();
                if (!msg.trim() || $("#replyLength").text() < 0) {
                    return
                }
                var loggedInUid = JSON.parse($("#user-json").text()).uid;
                Analytics.logAndSendEventToGA(["site:inbox:thread:send:click", "uid", loggedInUid]);
                var url = "/api.php";
                var postData = {
                    __call: "social.tag",
                    reply_to: $("#replies-panel").attr("data-guid"),
                    uids: $("#replies-panel").attr("data-uids"),
                    type: $("#replies-panel").attr("data-entity-type"),
                    entity_id: $("#replies-panel").attr("data-entity-id"),
                    msg: escape($("#replies-message").val()),
                    _marker: 0,
                    _format: "json"
                };
                var shareCallback = function (data) {
                    data = JSON.parse(data);
                    var message = "Something went wrong! Please try again after sometime";
                    if (data.status == "success") {
                        message = "Replied Successfully";
                        $("#replies-panel .close").click()
                    }
                    State.showNotification(message)
                };
                Util.call(url, shareCallback, postData, true)
            })
        };
        this.showSignupPanel = function (isWalled) {
            if (isWalled === undefined) {
                var isWalled = false
            }
            panel = '   <div id="signup-panel" class="cpanel">' + '      <div class="cpanel-content center">' + "          <h3>Just one click to enjoy all your music, for free!</h3>" + '          <button class="btn fb large">Sign Up via Facebook</button>' + '          <input type="hidden" id="panel_login" value="1"/>' + '          <br/><button class="btn phone_num large" onclick="phone_btn_onclick();" id ="static-phone-signup-btn">Log In with Number</button>' + '			<div class="friends-wrap hide">' + '				<div class="fbpile center">' + "					<p>Your friends already love Saavn!</p>" + '    				<img src="/_i/_t.png" onload="FBUtil.getInstalledFriends(10, Panel.showFacepile); this.parentNode.removeChild(this);"/>' + "			</div>" + "			</div>" + '          <h4 class="small with-line" id="standard-signup"><strong class="btn x-small light outline">Or, Sign up via email.</strong></h4>' + "" + '				<div id="standard-view" class="hide">' + '					<fieldset class="grouped">' + '						<input class="text first autofill" id="register_username" title="Email" type="text" />' + '                  	<span class="pw-wrap"><input class="text autofill" id="register_password" title="Password" type="password" /></span>' + '                  	<span class="pw-wrap"><input class="text last autofill" id="register_confirmpassword" title="Re-enter Password" type="password" /></span>' + "              	</fieldset>" + '              	<p class="small fine-print">By signing up, you confirm you\'ve read and accept Saavn\'s <a href="http://saavn.com/corporate/terms" target="_blank">Terms of Service</a> and <a href="http://saavn.com/corporate/privacy" target="_blank">Privacy Policy</a>.</p>' + '          		<div class="btn-group">' + '						<a class="btn green" id="signup-panel-btn" onclick="Panel.register()">Sign Up</a>' + "					</div>" + "				</div>" + '          <div id="register-status"></div>' + "		</div>" + '  	<button class="outline" id="panel-close">Close</button>' + "  </div>";
            $("body").append(panel);
            Interface.initUI("#signup-panel");
            $("#standard-signup").click(function () {
                $(this).find("strong").removeClass();
                $("#why-signup-btn").removeClass("full").addClass("left");
                $("#signup-panel-btn").removeClass("hide");
                $("#standard-view").slideDown(120, function () {
                    Interface.cPanelPosition($("#signup-panel").parent(), true, 370)
                });
                Analytics.logAndSendEventToGA("panel:create-account:click")
            });
            $("#signup-panel .btn.fb").click(function () {
                FBUtil.login(Panel.loginCallback)
            });
            $("#register_username, #register_password, #register_confirmpassword").bind("keypress", function (e) {
                if (e.keyCode == Util.KEY_ENTER) Panel.register()
            });
            Interface.cPanel("#signup-panel", {w: 408, gaCancelEvent: isWalled})
        };
        this.showLoginPanel = function (isWalled, options) {
            if ($.trim($("#login-panel").html()) != "") {
                return
            }
            Analytics.logAndSendEventToGA("panel:login:view");
            if (isWalled === undefined)var isWalled = false;
            var settings = $.extend({}, {heading: "Log in to start saving and sharing your music!"}, options);
            panel = '   <div id="login-panel" class="cpanel">' + '      <div class="cpanel-content center">' + '          <section id="login-view">' + "              <h3>" + settings.heading + "</h3>" + '              <button class="btn fb large">Log In with Facebook</button>' + '              <input type="hidden" id="panel_login" value="1"/>' + '              <br/><button class="btn phone_num large" id ="static-phone-login-btn">Log In with Number</button>' + '				<div class="friends-wrap hide">' + '					<div class="fbpile center">' + "						<p>Your friends already love Saavn!</p>" + '    					<img src="/_i/_t.png" onload="FBUtil.getInstalledFriends(10, Panel.showFacepile); this.parentNode.removeChild(this);"/>' + "				</div>" + "				</div>" + '              <h4 class="small with-line"><strong>or use your email</strong></h4>' + '              <fieldset class="grouped">' + '                  <input class="text first autofill" id="login_username" title="Email" type="text" />' + '                  <span class="pw-wrap"><input class="text last autofill" id="login_password" title="Password" type="password" /></span>' + "              </fieldset>" + '              <div class="btn-group clr hide">' + '                  <a class="btn green right" id="login-button">Log In</a>' + '                  <a class="btn outline light left" id="forgot-button">Forgot?</a>' + "              </div>" + "			</section>" + "" + '          <section id="forgot-view" class="hide">' + "              <h3>Forgot your password? No problem.</h3>" + '              <input class="text autofill" id="forgotpassEmail" title="Email Address" type="text" />' + '              <div class="btn-group clr">' + '                  <a class="btn green" onclick="Panel.submitForgot();">Send Reminder</a>' + "              </div>" + "			</section>" + "" + '          <div id="login-status"></div>' + "		</div>" + "" + '      <footer class="cpanel-btns center">' + '          <h3 class="light">Don\'t have an account?</h3>' + '          <button class="btn light outline" id="login-signup-switch">Sign Up Free</button>' + "		</footer>" + '  	<button class="outline" id="panel-close">Close</button>' + "  </div>" + '  <iframe id="secureframe" src="" width="0" height="0" class="hidden"></iframe>';
            $("body").append(panel);
            Interface.initUI("#login-panel");
            $("#login-view input[type=text], #login-view input[type=password]").focus(function () {
                $("#login-view .btn-group").stop().slideDown(120, function () {
                    Interface.cPanelPosition($("#login-panel").parent(), true, 420)
                })
            });
            $("#forgot-button").click(function () {
                $("#login-status").html("");
                $("#login-view").hide();
                $("#forgot-view").fadeIn(210);
                Interface.cPanelPosition($("#login-panel").parent(), true, 420)
            });
            $("#back-to-login").click(function () {
                $("#login-status").html("");
                $("#forgot-view").hide();
                $("#login-view").fadeIn(210);
                if ($("#login-panel input[type=text]").hasClass("empty") && $(".pw-wrap").hasClass("empty")) $("#login-view .btn-group").hide(); else $("#login-view .btn-group").show();
                Interface.cPanelPosition($("#login-panel").parent(), true, 420)
            });
            $("#login-button").click(function () {
                Panel.login()
            });
            $("#login-view .btn.fb").click(function () {
                Analytics.logAndSendEventToGA("panel:fblogin:click");
                FBUtil.login(Panel.loginCallback)
            });
            $("#login_username, #login_password").bind("keypress", function (e) {
                if (e.keyCode == Util.KEY_ENTER) {
                    Analytics.logAndSendEventToGA("panel:login:submit");
                    Panel.login()
                }
            });
            $("#login-signup-switch").click(function () {
                Interface.cPanelClose("#login-panel", false, false, function () {
                    Panel.showSignupPanel(isWalled)
                })
            });
            $("#static-phone-login-btn").click(function () {
                phone_btn_onclick()
            });
            $("#static-phone-signup-btn").click(function () {
                phone_btn_onclick()
            });
            Interface.cPanel("#login-panel", {w: 408, gaCancelEvent: isWalled})
        };
        this.showFacepile = function (data) {
            if ($("#login-panel").length > 0)var t = "#login-panel"; else if ($("#signup-panel").length > 0)var t = "#signup-panel"; else return false;
            var max = data.length;
            max = max > 5 && max < 10 ? 5 : max;
            for (var i = 0; i < max; i++) {
                var pictObj = data[i]["picture"];
                $('<img src="' + pictObj["data"]["url"] + '" />').appendTo(t + " .friends-wrap .fbpile")
            }
            $(t + " .friends-wrap").slideDown(120, function () {
                Interface.cPanelPosition($(t).parent(), true, 420)
            })
        };
        this.paintPlaylistPanel = function (playlists, songObject, sourceListId) {
            playlists = typeof playlists == "string" ? JSON.parse(Util.stringCheck(playlists)) : playlists;
            var panel = '  <div id="manage-playlist-panel" class="cpanel">' + '  <header class="cpanel-header">' + "      <h3>Save As...</h3>" + "  </header>" + '     <div class="cpanel-content">' + '         <div class="list-select">' + '             <div class="new-playlist-field">' + '                 <input class="text full autofill list-select-input" id="save-playlist-name" title="Name your new playlist..." type="text" />' + "             </div>" + '             <h4 class="small with-line"><strong>Or add to an existing playlist</strong></h4>' + "             <ol>";
            for (var i = 0; i < playlists.length; i++) {
                if (playlists[i].listname == Panel.STARRED || playlists[i].listname == Panel.SUGGESTS)continue;
                panel += "                 <li>" + '                     <input type="hidden" value="' + playlists[i].listid + '"/>' + '                     <a class="ellip">' + playlists[i].listname + "<em>" + playlists[i].song_count + ' songs</em><span class="check"></span></a>' + "                 </li>"
            }
            panel += "      </ol>" + "  </div>" + '         <p class="form-alert hide"></p>' + "     </div>" + '  <footer class="cpanel-btns">' + '      <a class="btn light outline close">Cancel</a>' + '      <a class="btn green" onclick="Panel.savePlaylist(\'' + songObject + "', '" + sourceListId + '\');" id="save-playlist-btn">Save</a>' + "  </footer>" + " </div>";
            $("body").append(panel);
            $("#save-playlist-name").keydown(function (event) {
                if (event.keyCode == 13) {
                    $("#save-playlist-btn").click()
                }
            });
            var ev = "add-to-playlist:canel";
            if (Sidebar.addToPlaylistEvent) {
                ev = "sidebar:" + ev
            } else {
                ev = "content:" + ev
            }
            Interface.initUI("#manage-playlist-panel");
            Interface.cPanel("#manage-playlist-panel", {w: 408, gaCancelEvent: ev})
        };
        this.showPlaylistPanel = function (songObject, sourceListId) {
            if ($("#cPanel-shade").length > 0) {
                Interface.cPanelClose("", false, false, function () {
                    Panel.showPlaylistPanel(songObject, sourceListId)
                })
            } else {
                Analytics.logAndSendEventToGA("site:inside:add_to_playlist:click");
                if (!State.isUserLoggedIn()) {
                    Panel.successCallback = function () {
                        Panel.showPlaylistPanel(songObject, sourceListId);
                        Panel.successCallback = null
                    };
                    Panel.showLoginPanel();
                    return
                }
                songObject = escape(songObject);
                var playlists = State.playlistsData();
                if (playlists == null) {
                    var url = "/api.php?__call=playlist.listAllMetaData&_marker=0&_format=json&t=" + Util.getCurrentTime();
                    var callback = function (playlists) {
                        playlists = JSON.parse(playlists);
                        $.each(playlists, function (key, value) {
                            value.song_count = value.songcount;
                            delete value.songcount
                        });
                        playlists = JSON.stringify(playlists);
                        Panel.paintPlaylistPanel(playlists, songObject, sourceListId)
                    };
                    Util.call(url, callback, null)
                } else {
                    this.paintPlaylistPanel(playlists, songObject, sourceListId)
                }
            }
        };
        this.savePlaylist = function (songObject, sourceListId) {
            var isNewPlaylist = undefined;
            if (sourceListId == undefined || sourceListId == "undefined") {
                sourceListId = undefined;
                if (songObject != undefined && songObject != "undefined") {
                    var obj = JSON.parse(unescape(songObject));
                    if (obj.length) {
                        var songObjects = obj
                    } else {
                        var songObjects = new Array(obj)
                    }
                } else {
                    var songObjects = State.nowPlayingData()
                }
            }
            var newListName = $("#manage-playlist-panel .list-select input[type=text]").val().trim();
            $("#manage-playlist-panel .form-alert").addClass("hide").html("");
            if (newListName != undefined && newListName.length > 0 && !$("#manage-playlist-panel .list-select input[type=text]").hasClass("empty")) {
                if (newListName.length < 2) {
                    $("#manage-playlist-panel .form-alert").html("Playlist names must be at least 2 characters.").removeClass("hide");
                    Interface.cPanelPosition($("#manage-playlist-panel").parent(), true, 420);
                    return
                }
                isNewPlaylist = true;
                State.createNewPlaylist(newListName, songObjects, sourceListId)
            } else if ($(".list-select li.on").length > 0) {
                isNewPlaylist = false;
                State.addSongsToPlaylist($(".list-select li.on input").val(), songObjects, sourceListId)
            } else {
                if ($(".list-select li").length > 0) $("#manage-playlist-panel .form-alert").html("Please enter a name for your new playlist, or choose an existing playlist to replace.").removeClass("hide"); else $("#manage-playlist-panel .form-alert").html("Please enter a name for your new playlist.").removeClass("hide");
                Interface.cPanelPosition($("#manage-playlist-panel").parent(), true, 420);
                return false
            }
            if (Panel.successCallback) {
                Panel.successCallback()
            }
            var ev = "add-to-playlist-";
            if (Sidebar.addToPlaylistEvent) {
                Sidebar.addToPlaylistEvent = false;
                ev = "sidebar:" + ev
            } else {
                ev = "content:" + ev
            }
            ev += (isNewPlaylist ? "new" : "existing") + "-playlist:save";
            Analytics.logAndSendEventToGA(ev);
            Interface.cPanelClose();
            if (Util.getPageType() == "playlist") {
                State.refreshContent()
            }
        };
        this.loginCallback = function (o) {
            var status = "";
            if (o != "undefined") {
                status = Util.SUCCESS
            } else {
                status = Util.ERROR
            }
            if (status == Util.SUCCESS) {
                var xml = typeof o == "string" ? Util.getXMLObj(o) : o;
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    $("#login-status").html('<p class="form-alert">' + error[0].getAttribute("msg") + "</p>");
                    Analytics.logAndSendEventToGA("ui:login:fail");
                    return
                }
                var user = xml.getElementsByTagName("user");
                if (user.length) {
                    var userJson = '<div id="user-json" class="hide">' + "{" + '	"username":"' + user[0].getAttribute("username") + '",' + '	"uid":"' + user[0].getAttribute("uid") + '",' + '	"email":"' + user[0].getAttribute("email") + '",' + '	"lastname":"' + user[0].getAttribute("lastname") + '",' + '	"firstname":"' + user[0].getAttribute("firstname") + '",' + '	"network":"' + user[0].getAttribute("network") + '",' + '	"fbid":"' + user[0].getAttribute("fbid") + '"' + "}" + "</div>";
                    $("body").append(userJson);
                    State.login();
                    var panelType = $(".cpanel").attr("data-type");
                    if (panelType == "share") {
                        SharePanel.updateShareSubPanel()
                    } else {
                        Interface.cPanelClose("#login-panel", false, false, Panel.successCallback);
                        Interface.cPanelClose("#signup-panel", false, false, Panel.successCallback)
                    }
                    Analytics.logAndSendEventToGA("ui:login:success")
                } else {
                    $("#login-status").html('<p class="form-alert">There has been an error. Please try again later.</p>');
                    Analytics.logAndSendEventToGA("ui:login:fail")
                }
            } else {
                $("#login-status").html('<p class="form-alert">There has been an error. Please try again later.</p>');
                Analytics.logAndSendEventToGA("ui:login:fail")
            }
        };
        this.login = function () {
            $("#login-status").html("");
            if ($("#login_username").hasClass("empty")) {
                $("#login-status").html('<p class="form-alert">Please enter a valid email address.</p>');
                Interface.cPanelPosition($("#login-panel").parent(), true, 420);
                return false
            }
            if ($("#login_password").val() == "") {
                $("#login-status").html('<p class="form-alert">Please enter your password.</p>');
                Interface.cPanelPosition($("#login-panel").parent(), true, 420);
                return false
            }
            var uname = $("#login_username").val();
            var pass = $("#login_password").val();
            if (typeof owner_uid == "undefined") {
                var postData = {username: uname, password: pass}
            } else {
                var postData = {username: uname, password: pass, uid: owner_uid}
            }
            Util.call("/api.php?__call=user.login&_marker=0", Panel.loginCallback, postData, true)
        };
        this.showFacebookSettings = function () {
            var fb = Util.getCookie("PL");
            var fbStream = "";
            if (fb == "" || fb == 0) fbStream = " on";
            Interface.initUI("#fb-settings-panel");
            $(".fb-privacy-toggle").click(function () {
                if ($(this).hasClass("on")) {
                    $("#fb-settings-panel .form-alert").slideUp(120);
                    $(".page-wrap .fb-privacy-toggle").addClass("on")
                } else {
                    $("#fb-settings-panel .form-alert").slideDown(120);
                    $(".page-wrap .fb-privacy-toggle").removeClass("on")
                }
            });
            $("#user-admin").removeClass("active");
            Interface.cPanel("#fb-settings-panel", {
                w: 357,
                modal: false,
                pos: {
                    auto: false,
                    xPos: Interface.elXPos($("#user-admin"), false) - 324,
                    yPos: Interface.elYPos($("#user-admin")) + 42
                }
            });
            if (!$("#fb-settings-panel .fb-privacy-toggle").hasClass("on")) $("#fb-settings-panel .form-alert").slideDown(120)
        };
        this.register = function () {
            Analytics.logAndSendEventToGA("panel:create-account:submit:click");
            $("#register-status").html("");
            if ($("#register_username").hasClass("empty") || $("#register_username").val() == "") {
                $("#register-status").html('<p class="form-alert">Please enter a valid email.</p>');
                Interface.cPanelPosition($("#signup-panel").parent(), true, 370);
                return false
            }
            if ($("#register_password").hasClass("empty") || $("#register_password").val() == "") {
                $("#register-status").html('<p class="form-alert">Please enter your password.</p>');
                Interface.cPanelPosition($("#signup-panel").parent(), true, 370);
                return false
            }
            if ($("#register_confirmpassword").hasClass("empty") || $("#register_confirmpassword").val() == "") {
                $("#register-status").html('<p class="form-alert">Please enter your password again.</p>');
                Interface.cPanelPosition($("#signup-panel").parent(), true, 370);
                return false
            }
            var username = $("#register_username").val();
            var password = $("#register_password").val();
            var confirmPassword = $("#register_confirmpassword").val();
            if (password.length < 6) {
                $("#register-status").html('<p class="form-alert">Password should be at least 6 characters long.</p>');
                Interface.cPanelPosition($("#signup-panel").parent(), true, 370);
                return false
            }
            if (password != confirmPassword) {
                $("#register-status").html('<p class="form-alert">Passwords do not match.</p>');
                Interface.cPanelPosition($("#signup-panel").parent(), true, 370);
                return false
            }
            var postData = {
                username: username,
                email: username, password: password
            };
            Util.call("/api.php?__call=user.createV2&_marker=0", Panel.registerCallback, postData, true)
        };
        this.registerCallback = function (o) {
            var status = "";
            if (o != "undefined") status = Util.SUCCESS; else status = Util.ERROR;
            if (status == Util.SUCCESS) {
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    $("#register-status").html('<p class="form-alert">' + error[0].getAttribute("msg") + "</p>");
                    Analytics.logAndSendEventToGA("ui:create_account:fail");
                    return
                }
                var user = xml.getElementsByTagName("user");
                if (user.length) {
                    var userJson = '<div id="user-json" class="hide">' + "{" + '	"username":"' + user[0].getAttribute("username") + '",' + '	"uid":"' + user[0].getAttribute("uid") + '",' + '	"email":"' + user[0].getAttribute("email") + '",' + '	"lastname":"' + user[0].getAttribute("lastname") + '",' + '	"firstname":"' + user[0].getAttribute("firstname") + '",' + '	"network":"' + user[0].getAttribute("network") + '",' + '	"fbid":"' + user[0].getAttribute("fbid") + '"' + "}" + "</div>";
                    $("body").append(userJson);
                    State.login();
                    Interface.cPanelClose("#signup-panel");
                    Analytics.logAndSendEventToGA("ui:create_account:success")
                } else {
                    $("#register-status").html('<p class="form-alert">There has been an error! Please try again later.</p>');
                    Analytics.logAndSendEventToGA("ui:create_account:fail");
                    return
                }
                return
            } else {
                $("#register-status").html('<p class="form-alert">There has been an error! Please try again later.</p>');
                Analytics.logAndSendEventToGA("ui:create_account:fail")
            }
        };
        this.showPasswordPanel = function () {
            panel = '   <div id="password-panel" class="cpanel">' + '	<header class="cpanel-header">' + "		<h3>Edit Your Password</h3>" + "	</header>" + '	<div class="cpanel-content">' + '          <ul class="grid-form">' + "					<li>" + '						<label class="main">Current Password:</label>' + '                  <div class="grp"><input class="text short full" id="changeOldPassword" title="Old Password" type="password" /></div>' + "					</li>" + "					<li>" + '						<label class="main">New Password:</label>' + '                  <div class="grp"><input class="text short full" id="changeNewPassword" title="New Password" type="password" /></div>' + "					</li>" + "					<li>" + '						<label class="main">Confirm New Password:</label>' + '                  <div class="grp"><input class="text short full" id="changeNewPasswordConfirm" title="Confirm New Password" type="password" /></div>' + "					</li>" + "          </ul>" + '          <div id="changePassword-status"></div>' + "	</div>" + '	<footer class="cpanel-btns">' + '          <a class="btn light outline close">Cancel</a>' + '          <a class="btn green bevel" id="password-save">Save</a>' + "	</footer>" + "  </div>" + '  <iframe id="secureframe" src="" width="0" height="0" class="hidden"></iframe>';
            $("body").append(panel);
            Interface.initUI("#password-panel");
            $("#password-panel #password-save").click(function () {
                Panel.changePassword()
            });
            Interface.cPanel("#password-panel", {w: 500})
        };
        this.changePasswordCallback = function (o) {
            var xml = parent.Util.getXMLObj(o);
            var error = xml.getElementsByTagName("error");
            if (error.length) {
                msg = error[0].getAttribute("msg");
                alert(msg);
                return
            }
            parent.Interface.cPanelClose();
            alert("Your password has been changed")
        };
        this.changePassword = function () {
            $("#changePassword-status").html("");
            if ($("#changeOldPassword").val() == "") {
                $("#changePassword-status").html('<p class="form-alert">Please enter your password.</p>');
                Interface.cPanelPosition($("#password-panel").parent(), true, 420);
                return false
            }
            if ($("#changeNewPassword").val() == "") {
                $("#changePassword-status").html('<p class="form-alert">Please enter your new password.</p>');
                Interface.cPanelPosition($("#password-panel").parent(), true, 420);
                return false
            }
            if ($("#changeNewPasswordConfirm").val() == "") {
                $("#changePassword-status").html('<p class="form-alert">Please enter your new password again.</p>');
                Interface.cPanelPosition($("#password-panel").parent(), true, 420);
                return false
            }
            var oldPassword = $("#changeOldPassword").val();
            var newPassword = $("#changeNewPassword").val();
            var confirmPassword = $("#changeNewPasswordConfirm").val();
            if (newPassword != confirmPassword) {
                $("#changePassword-status").html('<p class="form-alert">Passwords do not match.</p>');
                Interface.cPanelPosition($("#password-panel").parent(), true, 420);
                return false
            }
            var url = "https://" + window.location.hostname + "/api.php?__call=user.changePassword";
            var postData = {_marker: 0, oldpassword: oldPassword, password: newPassword};
            Util.securecall(url, "parent.Panel.changePasswordCallback", postData)
        };
        this.showEmailPanel = function () {
            var label = "Add a Password: ";
            if ($("#old_email").val() != "" && $("#old_email").val() !== undefined && $("#new_email").val() != $("#old_email").val() && $("#email_login").val() != "false") {
                label = "Verify Password: "
            }
            var url = "/api.php?__call=user.emailValidate&_marker=0&_format=json&email=" + $("#new_email").val();
            var pswdVerify = "";
            var merge = "0";
            var shareCallback = function (data) {
                data = JSON.parse(data);
                if (data.status == "success") {
                    if (data.uid != "" && data.uid !== undefined) {
                        merge = "1";
                        $("#label_email").val("This email account already exists, verify the password to merge the two accounts." + "<br/>Note: This action cannot be undone!");
                        pswdVerify = data.password
                    }
                } else {
                    var message = "Something went wrong! Please try again after sometime";
                    State.showNotification(message)
                }
            };
            if ($("#new_email").val() != "") {
                Util.call(url, shareCallback)
            }
            if (merge != "0") {
                label = "This email account already exists, verify the password to merge the two accounts." + "<br/>Note: This action cannot be undone!"
            }
            panel = '   <div id="email-panel" class="cpanel">' + '  <header class="cpanel-header">' + "      <h3>Edit Your Email</h3>" + "  </header>" + '  <div class="cpanel-content">' + '          <ul class="grid-form">' + "                  <li>" + '                      <label class="main" id="label_email">' + label + "</label>" + '                  <div class="grp"><input class="text short full" id="changeOldPassword" title="Old Password" type="password" /></div>' + "                  </li>" + "                  <li>" + "          </ul>" + '          <div id="changeEmail-status"></div>' + "  </div>" + '  <footer class="cpanel-btns">' + '          <a class="btn light outline close" id="email-cancel">Cancel</a>' + '          <a class="btn green bevel" id="email-save">Save</a>' + "  </footer>" + "  </div>" + '  <iframe id="secureframe" src="" width="0" height="0" class="hidden"></iframe>';
            $("body").append(panel);
            Interface.initUI("#email-panel");
            $("#email-panel #email-save").click(function () {
                var success = "";
                Panel.changeEmail(success, pswdVerify);
                if (success == "") {
                    $("#old_email").val($("#new_email").val());
                    Util.addEditPasswordHTML();
                    if ($("#merge").val() == "1") {
                        if (Util.getPageType() == "people" || $(".page-wrap").hasClass("account")) {
                            State.refreshContent()
                        } else if (Radio.isRadioUrl()) {
                            Radio.loadUserStations()
                        }
                        $("#merge").val("0")
                    }
                }
            });
            $("#email-panel #email-cancel").click(function () {
                $("#new_email").val($("#old_email").val())
            });
            Interface.cPanel("#email-panel", {w: 500})
        };
        this.changeEmail = function (success, pswdVerify) {
            $("#changeEmail-status").html("");
            var label = $("#label_email").text();
            if ($("#changeOldPassword").val() == "") {
                $("#changeEmail-status").html('<p class="form-alert">Please enter your password.</p>');
                Interface.cPanelPosition($("#email-panel").parent(), true, 420);
                return false
            }
            if (label == "Add a Password: " && $("#changeOldPassword").val().length < 6) {
                $("#changeEmail-status").html('<p class="form-alert">Password must be at least 6 characters.</p>');
                Interface.cPanelPosition($("#email-panel").parent(), true, 420);
                return false
            }
            gender = $("#gender_u option:selected").val();
            phone_number = $("#edit_phone_number").text();
            if (phone_number === "ADD MOBILE NUMBER") {
                phone_number = ""
            }
            dob = $("#datepicker").val();
            if (dob == null || dob === undefined || dob == "" || dob == "dd/mm/yyyy") {
                dob = "0000-00-00"
            } else {
                var day = dob.substring(0, 2);
                var month = dob.substring(3, 5);
                var year = dob.substring(6);
                dob = year + "-" + month + "-" + day
            }
            var postData = {
                firstname: $("#firstname").val(),
                lastname: $("#lastname").val(),
                dob: dob,
                email: $("#new_email").val(),
                old_email: $("#old_email").val(),
                phone_number: phone_number,
                password: $("#changeOldPassword").val(),
                gender: gender,
                pswdVerify: pswdVerify,
                allow_merge: true
            };
            var apiURL = "https://" + window.location.hostname + "/api.php?__call=user.update";
            Util.securecall(apiURL, function (o) {
                var xml = parent.Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    msg = error[0].getAttribute("msg");
                    success = "false";
                    console.log(msg);
                    alert(msg);
                    return
                }
                parent.Interface.cPanelClose();
                alert("Details updated successfully! ");
                State.updatePlaylistView()
            }, postData);
            if ($("#merge").val() == "1") {
                if (Util.getPageType() == "people" || $(".page-wrap").hasClass("account")) {
                    setTimeout(function () {
                        State.refreshContent()
                    }, 3e3)
                } else if (Radio.isRadioUrl()) {
                    Radio.loadUserStations()
                }
                $("#merge").val("0")
            }
        };
        this.submitForgot = function () {
            $("#login-status").html("");
            if ($("#forgotpassEmail").hasClass("empty")) {
                $("#login-status").html('<p class="form-alert">Please enter a valid email address.</p>');
                Interface.cPanelPosition($("#login-panel").parent(), true, 420);
                return false
            }
            var email = $("#forgotpassEmail").val();
            var postData = {username: email, email: email};
            State.forgotPassword(postData, Panel.forgotpassCallback)
        };
        this.forgotpassCallback = function (o, status) {
            if (status == Util.SUCCESS) {
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    if (error[0].getAttribute("code") == "INSUFFICIENT_INFORMATION") {
                        document.getElementById("forgotpass_username_row").style.display = ""
                    }
                    alert(error[0].getAttribute("msg"));
                    window.scrollTo(0, 0);
                    return
                }
                alert("We have sent you an email with a link to reset your password.");
                window.location.href = "http://" + window.location.hostname
            } else {
                var msg = "There has been an error! Please try again.";
                alert(msg)
            }
        };
        this.showSidebarClearOptions = function (t) {
            var panelPhrase = '<h3 class="solo">What would you like to do with the <span id="bulk-add-count">' + State.nowPlayingData().length + "</span> songs " + (Sidebar.loadFromLocalStorage ? "from your last visit" : "in your queue") + "?</h3>";
            panel = '   <div id="bulk-panel" class="cpanel">' + '      <div class="cpanel-content">' + panelPhrase + "	</div>" + '	<footer class="cpanel-btns">' + '          <button class="btn green full" id="bulk-add">Add</button>' + '          <button class="btn light full" id="bulk-replace">Replace</button>' + '          <button class="btn light full" id="bulk-save-replace">Save &amp; Replace</button>' + '          <a class="btn light full close">Cancel</a>' + "	</footer>" + "  </div>";
            Sidebar.loadFromLocalStorage = false;
            $("body").append(panel);
            Interface.initUI("#bulk-panel");
            $("#bulk-add").click(function () {
                var isCallFromPopup = true;
                Interface.cPanelClose("#bulk-panel", false, false, function () {
                    Content.playAllSongs(t)
                });
                Analytics.logAndSendEventToGA("queuepopup:add-to-queue:click")
            });
            $("#bulk-replace").click(function () {
                Sidebar.clearList(Sidebar.QUEUE);
                Content.playAllSongs(t);
                Interface.cPanelClose("#bulk-panel");
                Analytics.logAndSendEventToGA("queuepopup:replace-queue:click")
            });
            $("#bulk-save-replace").click(function () {
                Interface.cPanelClose("#bulk-panel", false, false, function () {
                    var nowPlayingSongs = State.nowPlayingData();
                    if (nowPlayingSongs && nowPlayingSongs.length > 0) {
                        nowPlayingSongs = JSON.stringify(nowPlayingSongs)
                    }
                    Panel.successCallback = function () {
                        Sidebar.clearList(Sidebar.QUEUE);
                        Content.playAllSongs(t);
                        Panel.successCallback = null
                    };
                    Panel.showPlaylistPanel(nowPlayingSongs)
                });
                Analytics.logAndSendEventToGA("queuepopup:save-and-replace-queue:click")
            });
            $(window).bind("keypress.clearOptions", function (e) {
                if (e.keyCode == Util.KEY_ENTER) {
                    $(window).unbind("keypress.clearOptions");
                    $("#bulk-add").click()
                }
            });
            Interface.cPanel("#bulk-panel", {
                w: 260,
                modal: true,
                pos: {
                    auto: false,
                    tick: true,
                    xPos: Interface.elXPos($(".page-wrap"), false) - 4,
                    yPos: Interface.elYPos($("#drawer-queue-group")) + 10
                },
                gaCancelEvent: "queuepopup:cancel"
            })
        };
        this.clearConfirm = function () {
            panel = '<div id="clear-confirm-panel" class="cpanel">' + '  <div class="cpanel-content">' + '      <h3 class="solo">Are you sure you want to clear your queue?</h3>' + "	</div>" + '  <footer class="cpanel-btns">' + '      <button class="btn green" id="clear-confirm">Yes, Clear It</button>' + '      <button class="btn light close">Cancel</button>' + "  </footer>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#clear-confirm-panel");
            $("#clear-confirm").click(function () {
                $(window).unbind("keypress.clearConfirm");
                Sidebar.clearList(Sidebar.QUEUE);
                Interface.cPanelClose();
                Analytics.logAndSendEventToGA("site:sidebar:clear:yes:click")
            });
            $(window).bind("keypress.clearConfirm", function (e) {
                if (e.keyCode == Util.KEY_ENTER) {
                    $(window).unbind("keypress.clearConfirm");
                    Sidebar.clearList("queue");
                    Interface.cPanelClose();
                    Analytics.logAndSendEventToGA("site:sidebar:clear:yes:click")
                }
            });
            $("body").addClass("force-drawer");
            Interface.cPanel("#clear-confirm-panel", {
                w: 300,
                modal: true,
                pos: {
                    auto: false,
                    tick: true,
                    xPos: Interface.elXPos($("#queue-clear"), true) + 7,
                    yPos: Interface.elYPos($("#queue-clear")) - 7
                }
            })
        };
        this.makePublic = function (objectToShare) {
            panel = '<div id="make-public-panel" class="cpanel">' + '	<header class="cpanel-header">' + "		<h3>Private Playlist</h3>" + "	</header>" + '  <div class="cpanel-content">' + '      <h3 class="solo">You can\'t share private playlists. Would you like to make this playlist public?</h3>' + "	</div>" + '  <footer class="cpanel-btns center">' + '      <button class="btn green" id="make-public">Yes</button>' + '      <button class="btn light close">No</button>' + "  </footer>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#make-public-panel");
            var listId = objectToShare.id;
            var listName = objectToShare.fbtitle;
            $("#make-public").click(function () {
                $(window).unbind("keypress.clearConfirm");
                Interface.cPanelClose();
                objectToShare.isPrivatePlaylist = false;
                Content.togglePlVisibility(listId, listName, 1, function () {
                    SharePanel.showPanel(objectToShare, $(window))
                })
            });
            $(window).bind("keypress.clearConfirm", function (e) {
                if (e.keyCode == Util.KEY_ENTER) {
                    $(window).unbind("keypress.clearConfirm");
                    Interface.cPanelClose();
                    objectToShare.isPrivatePlaylist = false;
                    Content.togglePlVisibility(listId, listName, 1, function () {
                        SharePanel.showPanel(objectToShare, $(window))
                    })
                }
            });
            Interface.cPanel("#make-public-panel", {w: 350, modal: true, pos: {auto: true}})
        };
        this.drawerSongOptions = function (list, tgt) {
            panel = '<div id="drawer-options" class="cpanel menu-style">' + "</div>";
            $("body").append(panel);
            $("#drawer-options").append(list);
            Interface.initUI("#drawer-options");
            $("body").addClass("force-drawer");
            Interface.cPanel("#drawer-options", {
                w: 198,
                modal: false,
                pos: {auto: false, xPos: 255, yPos: Interface.elYPos($(tgt)) - 9}
            })
        };
        this.drawerMoreOptions = function () {
            var removeDupes = State.getSongCountInNowPlayingQueue() == 0 ? ' class = "disabled"' : "";
            var nowPlaying = $("#drawer-queue li.now-playing").length == 0 ? ' class = "disabled"' : "";
            panel = '<div id="queue-more-panel" class="cpanel menu-style">' + '  <div class="mini-drop">' + "      <ul>" + "			<!--<li><a" + removeDupes + ' id="remove-duplicates">Remove Duplicates</a></li>-->' + "			<li><a" + nowPlaying + ' id="show-now-playing">Show Now Playing</a></li>' + "		</ul>" + "	</div>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#queue-more-panel");
            $("#remove-duplicates").click(function () {
                Sidebar.removeDuplicates();
                Interface.cPanelClose();
                Analytics.logAndSendEventToGA("site:sidebar:more:remove_duplicates:click")
            });
            $("#show-now-playing").click(function () {
                Interface.cPanelClose("#queue-more-panel", false, null, function () {
                    Interface.highlightTrack()
                });
                Analytics.logAndSendEventToGA("site:sidebar:more:now_playing:click")
            });
            $("body").addClass("force-drawer");
            Interface.cPanel("#queue-more-panel", {
                w: 200,
                modal: true,
                pos: {
                    auto: false,
                    tick: true,
                    xPos: Interface.elXPos($("#queue-more"), true) + 7,
                    yPos: Interface.elYPos($("#queue-more")) - 7
                }
            })
        };
        this.pillMenu = function (list, tgt, data, right) {
            if (right === undefined)var right = true;
            panel = '	<div id="pill-menu" class="cpanel menu-style">' + '		<div class="song-wrap"></div>' + "	</div>";
            $("body").append(panel);
            $("#pill-menu .song-wrap").append(list);
            $("#pill-menu .song-wrap").append(data);
            Interface.initUI("#pill-menu");
            Interface.cPanel("#pill-menu", {
                w: 148,
                modal: false,
                pos: {
                    auto: false,
                    right: right,
                    xPos: Interface.elXPos($(tgt), true) - (right ? 50 : $(tgt).outerWidth() + 6),
                    yPos: Interface.elYPos($(tgt)) - 9
                }
            });
            var wrap = $("#pill-menu").parent();
            $(wrap).addClass("pill-menu-wrap");
            $("#pill-menu a").click(function () {
                Interface.cPanelClose($("#pill-menu"))
            })
        };
        function _initRBTPreview(rbtPartner) {
            $("#rbt-preview").jPlayer("destroy");
            $("#rbt-preview").jPlayer({
                play: function () {
                    $(this).jPlayer("pauseOthers")
                }, supplied: "wav"
            });
            $("#rbt-preview").bind($.jPlayer.event.playing, function (event) {
                $(".mini-player.loading").removeClass("loading").addClass("playing").attr("title", "")
            });
            $("#rbt-preview").bind($.jPlayer.event.ended, function (event) {
                $(".mini-player.playing").removeClass("playing").attr("title", "Listen")
            });
            $("#rbt-preview").bind($.jPlayer.event.error, function (event) {
                var t = $(".mini-player.loading");
                $(t).attr("title", "").removeClass("loading").addClass("error cTip").append('<span class="cTip-wrap"><span class="cTip-note">Sorry, this preview is unavailable.</span></span>');
                $(t).hover(function () {
                    $(this).addClass("hover")
                }, function () {
                    $(this).removeClass("hover")
                });
                Analytics.logAndSendEventToGA("rbt:click:preview:" + rbtPartner + ":error")
            });
            $(".mini-player").click(function () {
                if (!$(this).hasClass("error")) {
                    State.pauseSong();
                    if (Interface.isIE) {
                        window.open("https://www.airtelhellotunes.in/tone/" + $(this).parent().attr("data-id") + ".wav")
                    } else {
                        if (!$(this).hasClass("playing")) {
                            $(".mini-player").removeClass("playing loading");
                            $("#rbt-preview").jPlayer("stop");
                            $("#rbt-preview").jPlayer("setMedia", {wav: "https://www.airtelhellotunes.in/tone/" + $(this).parent().attr("data-id") + ".wav"});
                            $("#rbt-preview").jPlayer("play");
                            $(this).addClass("loading");
                            Analytics.logAndSendEventToGA("rbt:click:preview:" + rbtPartner + ":play")
                        } else {
                            $(".mini-player").removeClass("playing loading");
                            $("#rbt-preview").jPlayer("stop");
                            Analytics.logAndSendEventToGA("rbt:click:preview:" + rbtPartner + ":stop")
                        }
                    }
                }
            })
        }

        function _rbtSelected() {
            var isSelected = false;
            $("#ringtones-panel .tone").each(function () {
                if ($(this).parent().hasClass("on")) {
                    isSelected = true;
                    return isSelected
                }
            });
            return isSelected
        }

        this.showRingtonesPanel = function (pid, song) {
            var apiCall = "/api.php?__call=rbt.getRBTData&_marker=0&pid=" + pid;
            Util.call(apiCall, function (data) {
                var tones = jQuery.parseJSON(Util.stringCheck(data));
                if (tones) {
                    panel = '<div id="ringtones-panel" class="cpanel">' + '	<header class="cpanel-header">' + "		<h3>Choose Your Carrier</h3>" + "	</header>" + '	<div class="cpanel-content">' + '		<section class="full">' + '			<p style="line-height: 1.4;">Please choose your mobile carrier. If your carrier is disabled or not listed, this ringback tone is not available on your service.</p>' + '			<div class="carrier-btns">' + '              <a class="btn light carrier-btn airtel" data-carrier="airtel">Airtel</a>' + '              <a class="btn light carrier-btn vodafone" data-carrier="vodafone">Vodafone</a>' + "			</div>" + "		</section>" + "	</div>" + '	<footer class="cpanel-btns">' + '      <a class="btn light close">Cancel</a>' + "	</footer>" + "</div>";
                    Analytics.logAndSendEventToGA("rbt:panel:carrier-selection:open");
                    $("body").append(panel);
                    if (tones.airtel === undefined || tones.airtel.length <= 0) {
                        $(".carrier-btn.airtel").addClass("disabled cTip");
                        $(".carrier-btn.airtel").append('<span class="cTip-wrap"><span class="cTip-note">Sorry, ' + song + " is not available as a ringback tone on Airtel.</span></span>")
                    }
                    if (tones.vodafone === undefined || tones.vodafone.length <= 0) {
                        $(".carrier-btn.vodafone").addClass("disabled cTip");
                        $(".carrier-btn.vodafone").append('<span class="cTip-wrap"><span class="cTip-note">Sorry, ' + song + " is not available as a ringback tone on Vodafone.</span></span>")
                    }
                    Interface.initUI("#ringtones-panel");
                    Interface.cPanel("#ringtones-panel", {w: 570, disable: true});
                    $(".carrier-btn").click(function () {
                        if (!$(this).hasClass("disabled")) {
                            var carrier = $(this).attr("data-carrier");
                            Interface.cPanelClose("#ringtones-panel", false, false, function () {
                                switch (carrier) {
                                    case"airtel":
                                        Panel.rbtAirtel(tones.airtel, pid, song);
                                        break;
                                    case"vodafone":
                                        Panel.rbtVodafone(tones.vodafone, pid, song);
                                        break;
                                    default:
                                        break
                                }
                            }, false)
                        }
                    })
                }
            }, "", false)
        };
        this.rbtAirtel = function (airtel, pid, song) {
            var rbtPanelTracker = 1;
            var rbtPartner = "airtel";
            panel = '<div id="ringtones-panel" class="cpanel">' + '	<header class="cpanel-header">' + "		<em>from Airtel Hello Tunes<sup>&trade;</sup></em>" + "		<h3>Set Your Ringback Tone</h3>" + "	</header>" + '	<div class="cpanel-content">' + '		<ul class="form-steps three clr">' + '			<li class="current"><strong class="step">1</strong> Mobile number and HelloTune</li>' + '			<li><strong class="step">2</strong> Confirm your mobile device</li>' + '			<li><strong class="step">3</strong> HelloTune order confirmation</li>' + "		</ul>" + '		<section class="full">' + '			<div class="form-step" id="step-1">' + '					<span class="input-with-icon">' + '                  <input class="text full autofill" id="mobile-number" title="Mobile Number" type="text" />' + '						<span class="icon carriers airtel"></span>' + "              </span>";
            if (airtel.length > 1) {
                panel += '               <div class="list-select">' + '                  <p class="list-select-hdr">Choose your Hello Tune:</p>' + '                  <ol class="left-check with-mini-player">';
                for (var i = 0; i < airtel.length; i++) {
                    var rbt_id = airtel[i].rbt_id;
                    panel += "           <li>" + '              <a class="tone" data-id="' + rbt_id + '">' + '              <span class="check"></span>' + '              <span class="pill play-now mini-player" title="Listen"><span class="spinner"></span></span>' + song + " <em>Tone " + (i + 1) + "</em>" + "          </a>" + "      </li>"
                }
                panel += "				</ol>"
            } else {
                panel += '               <p class="recap list-select">You will be setting your Hello Tune to <span class="on"><strong class="highlight tone" data-id="' + airtel[0].rbt_id + '"><span class="pill play-now mini-player" title="Listen"><span class="spinner"></span></span>' + song + "</strong></span>.</p>"
            }
            panel += "			</div>" + "" + '			<div class="form-step hide" id="step-2">' + '				<div class="ringtones-confirm-grp">' + "					<h3>Check your phone...</h3>" + "					<p>Please enter the 4-digit confirmation code you just received via SMS:</p>" + '					<span class="ringtones-sms-help"></span>' + '					<span class="input-with-icon">' + '						<input type="text" class="autofill med" maxlength="4" title="4-Digit Confirmation Code" id="otp" />' + '						<span class="icon carriers airtel"></span>' + "					</span>" + "				</div>" + '				<p class="recap">You are about to set your HelloTune to <strong class="highlight tone tone-name"></strong>, on your Airtel mobile number <strong class="highlight mobile-num"></strong>.</p>' + '				<p class="fine-print divider">No extra charge for purchasing your HelloTune on Saavn. The charge for each HelloTune RBT is only Rs 15 for 90 days. HelloTunes Subscription charges are Rs 30 per month in all circles, except Rs 35 for Karnataka and Rs 36 for Del, NESA, UPE, UPW, TN, MP, Chhattisgarh, RJ, GJ, Mum.</p>' + "			</div>" + "" + '			<div class="form-step hide" id="step-3">' + '				<div class="receipt-wrap">' + '					<div class="receipt">' + "						<h3>Success!</h3>" + '						<p>You have set your HelloTune to <strong class="highlight tone tone-name"></strong>, on your Airtel mobile number <strong class="highlight mobile-num"></strong>.' + '						<p class="fine-print divider">You should receive a confirmation message from your carrier with final billing information.</p>' + "					</div>" + '					<span class="bevel"></span>' + "				</div>" + "			</div>" + '			<div id="rbt-preview"></div>' + "		</section>" + "	</div>" + '	<footer class="cpanel-btns">' + '		<div id="step-1-btns">' + '			<span class="loader"></span>' + '			<a class="btn green bevel continue right">Continue</a>' + '          <a class="btn light close">Cancel</a>' + '			<span class="fine-print right">You will not be charged until the next step.</span>' + "		</div>" + "" + '		<div class="hide" id="step-2-btns">' + '			<span class="loader"></span>' + '          <a class="btn light close">Cancel</a>' + '			<a class="btn green bevel purchase right">Purchase HelloTune</a>' + '			<span class="fine-print right">By purchasing, you agree to the <a href="https://www.airtelhellotunes.in/terms-and-conditions" target="_blank">terms</a>.</span>' + "		</div>" + "" + '      <div class="hide clr" id="step-3-btns">' + '          <a class="btn green close right">I\'m Finished</a>' + "		</div>" + "	</footer>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#ringtones-panel");
            _initRBTPreview(rbtPartner);
            $(".continue").click(function () {
                if (!$(".cpanel-btns").hasClass("loading")) {
                    $("#ringtones-panel .cpanel-content .form-alert").remove();
                    Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420);
                    if ($("#mobile-number").hasClass("empty")) {
                        $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Please enter a valid mobile number.</p>');
                        Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                    } else if (!_rbtSelected()) {
                        $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Please select your HelloTune from the options above.</p>');
                        Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                    } else {
                        var phone = $("#mobile-number").val();
                        $(".cpanel-btns").addClass("loading");
                        Util.call("/api.php?__call=rbt.requestRBT&_marker=0&partner=airtel&phone=" + phone, function (data) {
                            data = jQuery.parseJSON(Util.stringCheck(data));
                            $(".cpanel-btns").removeClass("loading");
                            if (data.status == "success") {
                                $(".mini-player").removeClass("playing loading");
                                var srcURL = $("#rbt-preview audio").attr("src");
                                if (srcURL && srcURL.length != 0) {
                                    $("#rbt-preview").jPlayer("stop")
                                }
                                $(".form-steps li:nth-child(1)").removeClass("current").addClass("done").find("strong.step").html("&#10004;");
                                $(".form-steps li:nth-child(2)").addClass("current");
                                $(".mobile-num").html($("#mobile-number").val());
                                $(".tone-name").html($(".list-select .on .tone").text());
                                $(".tone-name").attr("data-id", $(".list-select .on .tone").attr("data-id"));
                                $("#step-3 .tone-name .mini-player").remove();
                                $("#step-1, #step-1-btns").hide();
                                $("#step-2-btns").fadeIn(120);
                                $("#step-2").fadeIn(120, function () {
                                });
                                rbtPanelTracker = 2;
                                Analytics.logAndSendEventToGA("rbt:panel:2:" + rbtPartner + ":open");
                                Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                            } else {
                                $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Sorry, your request failed. Please check your mobile number and try again.</p>');
                                Analytics.logAndSendEventToGA("rbt:panel:1:" + rbtPartner + ":failure");
                                Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                            }
                        }, "", false)
                    }
                }
            });
            $(".purchase").click(function () {
                if (!$(".cpanel-btns").hasClass("loading")) {
                    $("#ringtones-panel .cpanel-content .form-alert").remove();
                    Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420);
                    if ($("#otp").hasClass("empty")) {
                        $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Please check your one time password and try again.</p>');
                        Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                    } else {
                        var pass = $("#otp").val();
                        var rbt_id = $(".list-select .on .tone").attr("data-id");
                        var phone = $("#mobile-number").val();
                        $(".cpanel-btns").addClass("loading");
                        Util.call("/api.php?__call=rbt.authenticateRBTRequest&_marker=0&partner=airtel&pass=" + pass + "&rbt_id=" + rbt_id + "&phone=" + phone + "&pid=" + pid + "&song=" + song, function (data) {
                            data = jQuery.parseJSON(Util.stringCheck(data));
                            $(".cpanel-btns").removeClass("loading");
                            if (data.status == "success") {
                                $(".mini-player").removeClass("playing loading");
                                var srcURL = $("#rbt-preview audio").attr("src");
                                if (srcURL && srcURL.length != 0) {
                                    $("#rbt-preview").jPlayer("stop")
                                }
                                $(".form-steps li:nth-child(2)").removeClass("current").addClass("done").find("strong.step").html("&#10004;");
                                $(".form-steps li:nth-child(3)").addClass("current");
                                $("#step-2, #step-2-btns").hide();
                                $("#step-3, #step-3-btns").fadeIn(120);
                                rbtPanelTracker = 3;
                                Analytics.logAndSendEventToGA("rbt:panel:3:" + rbtPartner + ":open");
                                Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                            } else {
                                $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Sorry, your one time password failed. Please check your password and try again.</p>');
                                Analytics.logAndSendEventToGA("rbt:panel:2:" + rbtPartner + ":failure");
                                Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                            }
                        }, "", false)
                    }
                }
            });
            $("#ringtones-panel .close").bind("click.ringtone", function () {
                Analytics.logAndSendEventToGA("rbt:panel:" + rbtPanelTracker + ":" + rbtPartner + ":cancel");
                $(this).unbind("click.ringtone")
            });
            Analytics.logAndSendEventToGA("rbt:panel:1:" + rbtPartner + ":open");
            Interface.cPanel("#ringtones-panel", {w: 570, disable: true})
        };
        this.rbtVodafone = function (vodafone, pid, song) {
            var rbtPanelTracker = 1;
            var rbtPartner = "vodafone";
            panel = '<div id="ringtones-panel" class="cpanel">' + '	<header class="cpanel-header">' + "		<em>from Vodafone<sup>&trade;</sup></em>" + "		<h3>Set Your Callertune</h3>" + "	</header>" + '	<div class="cpanel-content">' + '		<ul class="form-steps two single-line clr">' + '			<li class="current"><strong class="step">1</strong> Mobile Number and Callertune</li>' + '			<li><strong class="step">2</strong> Confirmation SMS</li>' + "		</ul>" + '		<section class="full">' + '			<div class="form-step" id="step-1">' + "				<p>" + '					<span class="input-with-icon">' + '						<input type="text" class="autofill med" title="Mobile Number" id="mobile-number" />' + '						<span class="icon carriers vodafone"></span>' + "					</span>" + "				</p>";
            if (vodafone.length > 1) {
                panel += '				<ol class="list-select">' + '					<li class="note">Choose your Callertune:</li>';
                for (var i = 0; i < vodafone.length; i++) {
                    var rbt_id = vodafone[i].rbt_id;
                    panel += '<li><a class="tone" data-id=\'' + rbt_id + "'>" + song + " &mdash; Tone " + (i + 1) + "</a></li>"
                }
                panel += "				</ol>"
            } else {
                panel += '				<p class="recap list-select">You will be setting your Callertune to <span class="on"><strong class="highlight tone" data-id="' + vodafone[0].rbt_id + '">' + song + "</strong></span>.</p>"
            }
            panel += "			</div>" + "" + '			<div class="form-step hide" id="step-2">' + '				<div class="ringtones-confirm-grp no-img">' + "					<h3>Almost done... check your phone!</h3>" + "					<p>You should receive an SMS shortly from Vodafone with instructions for your new Callertune! Please be patient, this message may take a few minutes to arrive.</p>" + '					<p class="fine-print divider">The charge for each Callertune is only Rs 15 for 90 days. Callertunes Subscription charges are Rs 30 for 30 days.</p>' + "				</div>" + "			</div>" + "		</section>" + "	</div>" + "" + '	<footer class="cpanel-btns">' + '		<div id="step-1-btns">' + '			<span class="loader"></span>' + '          <a class="btn light close">Cancel</a>' + '			<a class="btn green bevel purchase right">Submit Request</a>' + '			<span class="fine-print right">By clicking Submit Request, you agree to these <a href="https://www.vodafone.in/pages/selectcircle.aspx?nc=/pages/terms_conditions.aspx" target="_blank">terms</a>.</span>' + "		</div>" + "" + '		<div class="hide" id="step-2-btns">' + '          <a class="btn green close right">Done</a>' + "		</div>" + "	</footer>" + "</div>";
            $("body").append(panel);
            Interface.initUI("#ringtones-panel");
            $(".purchase").click(function () {
                $("#ringtones-panel .cpanel-content .form-alert").remove();
                Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420);
                if ($("#mobile-number").hasClass("empty")) {
                    $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Please enter a valid mobile number.</p>');
                    Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                } else if (!_rbtSelected()) {
                    $("#ringtones-panel .cpanel-content").append('<p class="form-alert">Please select your Callertune from the options above.</p>');
                    Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                } else {
                    var phone = $("#mobile-number").val();
                    var rbt_id = $(".tone").attr("data-id");
                    song = encodeURIComponent(song);
                    $(".cpanel-btns").addClass("loading");
                    var apiCall = "/api.php?__call=rbt.requestRBT&rbt_id=" + rbt_id + "&phone=" + phone + "&partner=vodafone&_marker=0&pid=" + pid + "&song=" + song;
                    Util.call(apiCall, function (data) {
                        data = jQuery.parseJSON(Util.stringCheck(data));
                        $(".cpanel-btns").removeClass("loading");
                        if (data.status == "success") {
                            $(".form-steps li:nth-child(1)").removeClass("current").addClass("done").find("strong.step").html("&#10004;");
                            $(".form-steps li:nth-child(2)").addClass("current");
                            $("#step-1, #step-1-btns").hide();
                            $("#step-2, #step-2-btns").fadeIn(120);
                            rbtPanelTracker = 2;
                            Analytics.logAndSendEventToGA("rbt:panel:2:" + rbtPartner + ":open");
                            Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                        } else {
                            var reasonMessage = data.reason;
                            if (!data.response) {
                                reasonMessage = "Problem with setting Callertune. Please contact support@saavn.com with your mobile number and Callertune you are trying to set"
                            }
                            $("#ringtones-panel .cpanel-content").append('<p class="form-alert">' + reasonMessage + "</p>");
                            Analytics.logAndSendEventToGA("rbt:panel:1:" + rbtPartner + ":failure");
                            Interface.cPanelPosition($("#ringtones-panel").parent(), true, 420)
                        }
                    }, "", false)
                }
            });
            $("#ringtones-panel .close").bind("click.ringtone", function () {
                Analytics.logAndSendEventToGA("rbt:panel:" + rbtPanelTracker + ":" + rbtPartner + ":cancel");
                $(this).unbind("click.ringtone")
            });
            Analytics.logAndSendEventToGA("rbt:panel:1:" + rbtPartner + ":open");
            Interface.cPanel("#ringtones-panel", {w: 570, disable: true})
        };
        this.showRecommendationsPanel = function () {
            var recoPanel = '<div id="recommendations-panel-wrapper">' + '    <div id="recommendations-panel">' + '        <ul id="recommendations-songs">' + '            <li class="recommendations-songs-label">' + '                <p class="highlight">You might like...</p>' + "                <p>Because you're currently listening to <strong>Khalbali</strong>.</p>" + "            </li>" + '            <li class="art">' + '                <a class="add-to-queue" href="">' + '                    <img src="/_i/recommendations-panel_play.png" width="45px" height="45px"/>' + "                </a>" + '                <a href="">' + "                    <p>Roobaroo</p>" + '                    <div class="gradient"></div>' + '                    <img class="art" src="http://c.saavncdn.com/PPL-SONY-00011-150x150.jpg" width="80" height="80"/>' + "                </a>" + "            </li>" + '            <li class="art">' + '                <a class="add-to-queue" href="">' + '                    <img src="/_i/recommendations-panel_play.png" width="45px" height="45px"/>' + "                </a>" + '                <a href="">' + "                    <p>Guzarish</p>" + '                    <div class="gradient"></div>' + '                    <img class="art" src="http://c.saavncdn.com/SFCD-1-1380-150x150.jpg" width="80" height="80"/>' + "                </a>" + "            </li>" + '            <li class="recommendations-radio-label">' + "                <p>Or launch a radio station based on this song...</p>" + "            </li>" + '            <li class="radio art">' + '                <a href="">' + "                    <p>Start Radio</p>" + '                    <img class="radio-glyph" src="/_i/recommendations-panel_radio-glyph.png" width="45px" height="45px"/>' + '                    <div class="radio gradient"></div>' + '                    <img class="art" src="http://c.saavncdn.com/381/SONY_886444187381-150x150.jpg" width="80" height="80"/>' + "                </a>" + "            </li>" + "        </ul>" + '        <img id="close-panel" src="/_i/recommendations-panel_close.png" width="20" height="20"/>' + "    </div>" + '    <div id="recommendations-panel-options" style="display:none;opacity:0;left:800px">' + "        <ul>" + "            <li>" + '                <div id="options-border-wrap">' + '                    <div id="options-border">' + '                        <span class="options-never"></span>' + "                        <h2>I don't want to see this again</h2>" + "                    </div>" + "                </div>" + "            </li>" + "            <li>" + '                <div id="options-border-wrap">' + '                    <div id="options-border">' + '                        <span class="options-later"></span>' + "                        <h2>Show this to me again later</h2>" + "                    </div>" + "                </div>" + "            </li>" + "        </ul>" + "    </div>" + '    <div id="recommendations-panel-confirm" style="display:none;opacity:0;left:800px">' + "        <p>Thanks! This is what we’ll do when you close the recommendations panel from now on.</p>" + "        <p>If you change your mind, you can change this in your settings.</p>" + "    </div>" + "</div>";
            $("#page #main").append(recoPanel);
            $("#recommendations-panel-wrapper").show();
            $("#recommendations-panel-wrapper").animate({bottom: "90px", opacity: 1}, 250);
            $("#recommendations-panel-wrapper #close-panel").on("click", function () {
                $("#recommendations-panel").animate({left: "-800px", opacity: 0}, 250);
                setTimeout(function () {
                    $("#recommendations-panel").hide()
                }, 200);
                setTimeout(function () {
                    $("#recommendations-panel-options").show()
                }, 200);
                $("#recommendations-panel-options").animate({left: "0", opacity: 1}, 250)
            });
            $("#recommendations-panel-wrapper #recommendations-panel-options").on("click", function () {
                $("#recommendations-panel-options").animate({left: "-800px", opacity: 0}, 250);
                setTimeout(function () {
                    $("#recommendations-panel-options").hide()
                }, 200);
                setTimeout(function () {
                    $("#recommendations-panel-confirm").show()
                }, 200);
                $("#recommendations-panel-confirm").animate({left: "0", opacity: 1}, 250);
                setTimeout(function () {
                    $("#recommendations-panel-wrapper").animate({bottom: "-300px", opacity: 0}, 400);
                    setTimeout(function () {
                        $("#recommendations-panel-wrapper").hide()
                    }, 200)
                }, 2500)
            })
        };
        this.showProPanel = function (didPurchase) {
            if (didPurchase === undefined)var didPurchase = false;
            panel = "" + '<div id="buy-pro-modal" class="cpanel pro-modal-overlay">' + '<div class="cpanel-content modal-wrap">';
            if (!didPurchase) {
                panel += "" + '  <div class="modal-left">' + '    <div class="pro-modal-block">' + '      <div class="pro-slider-viewport">' + '        <div id="slide-wrap" class="pro-slider-wrapper">' + '          <div class="pro-feat">' + '            <img src="/_i/3.0/pro-web/feat-1.png">' + "            <h2>Download music, listen without data.</h2>" + "          </div>" + '          <div class="pro-feat">' + '            <img src="/_i/3.0/pro-web/feat-2.png">' + "            <h2>Say goodbye to ads.</h2>" + "          </div>" + '          <div class="pro-feat">' + '            <img src="/_i/3.0/pro-web/feat-3.png">' + "            <h2>Say hello to HD audio.</h2>" + "          </div>" + "        </div>" + "      </div>" + "    </div>" + '    <div class="pro-modal-block dots">' + '      <div class="pag-dot active"></div><div class="pag-dot"></div><div class="pag-dot"></div>' + "    </div>" + "  </div>" + '  <div class="modal-right">' + '    <div class="pro-modal-block">' + '      <h3 class="modal-title">Upgrade to<br>Saavn Pro</h3>' + "    </div>" + '    <div class="pro-modal-block pro-buy-options">' + '      <span class="buy-now-title">Buy From</span>' + "      <div>" + '<a class="btn probuy amazon" data-store="amazon" href="http://www.amazon.in/dp/B01CU4N5HS" target="_blank"><img src="/_i/3.0/pro-web/amazon-in.png"></a>' + '        <a class="btn probuy snap" data-store="snapdeal" href="http://www.snapdeal.com/search?keyword=saavn&sort=rlvncy" target="_blank"><img src="/_i/3.0/pro-web/snapdeal_w.png"></a>' + '        <a class="btn probuy woohoo" data-store="woohoo" href="https://www.woohoo.in/brands/saavn" target="_blank"><img src="/_i/3.0/pro-web/woohoo_w.png"></a>' + "      </div>" + "    </div>" + '    <div class="pro-modal-block">' + "      <p>Already have a coupon? <a href=\"http://www.saavn.com/redeem\" target=\"_blank\" onclick=\"Util.logAndGoToUrl(['web:go_pro_modal::click', 'listitem', 'redeem'], 'http://www.saavn.com/redeem');\">Redeem Here</a></p>" + "    </div>" + "  </div>"
            } else {
                panel += "" + '<div class="modal-left">' + '  <div class="pro-modal-block">' + '    <div class="sparkle">' + "      <h2>Almost there...</h2>" + "    </div>" + "  </div>" + "</div>" + '<div class="modal-right">' + '  <div class="pro-modal-block">' + '    <h3 class="modal-title">Purchased a code?</h3>' + '    <span class="redeem-info">Click the button below to redeem.</span>' + "  </div>" + '  <div class="pro-modal-block">' + "    <a href=\"http://www.saavn.com/redeem\" class=\"btn green\" target=\"_blank\" onclick=\"Util.logAndGoToUrl(['web:go_pro_modal::click', 'listitem', 'redeem'], 'http://www.saavn.com/redeem');\">Redeem Saavn Pro</a>" + "  </div>" + '  <div class="pro-modal-block">' + '    <p><a id="back-to-purchase">View Purchase Options</a></p>' + "  </div>" + "</div>"
            }
            panel += "" + "</div>" + '<button class="outline" id="panel-close">Close</button>';
            "</div>";
            $("body").append(panel);
            $(".probuy").click(function () {
                Analytics.logAndSendEventToGA("web:go_pro_modal::click", "listitem", $(this).data("store"));
                Interface.cPanelClose("#buy-pro-modal", false, false, function () {
                    Panel.showProPanel(true)
                })
            });
            $("#back-to-purchase").click(function () {
                Analytics.logAndSendEventToGA("web:go_pro_modal::click", "listitem", "viewpurchase");
                Interface.cPanelClose("#buy-pro-modal", false, false, function () {
                    Panel.showProPanel()
                })
            });
            var slider = $("#slide-wrap");
            var currentSlide = 0;
            var totalSlides = $(".pag-dot").length;
            $("#slide-wrap").addClass("slide-0");
            var sliderInterval = setInterval(function () {
                autoSlide()
            }, 4e3);
            $(".pag-dot").each(function (i) {
                $(this).data("index", i);
                $(this).click(function () {
                    currentSlide = $(this).data("index");
                    nextSlide()
                })
            });
            $(".modal-left").hover(function () {
                clearInterval(sliderInterval)
            }, function () {
                sliderInterval = setInterval(function () {
                    autoSlide()
                }, 4e3)
            });
            function autoSlide() {
                currentSlide += 1;
                if (currentSlide >= totalSlides) currentSlide = 0;
                nextSlide(currentSlide)
            }

            function nextSlide() {
                var dot = $(".pag-dot")[currentSlide];
                $(slider).removeClass().addClass("pro-slider-wrapper slide-" + currentSlide);
                $(".pag-dot").removeClass("active");
                $(dot).addClass("active")
            }

            Interface.initUI("#buy-pro-modal");
            Interface.cPanel("#buy-pro-modal", {w: 640});
            Analytics.logAndSendEventToGA("web:go_pro_modal::view")
        }
    };
Panel.LOGIN = "login";
Panel.SIGNUP = "signup";
Panel.PLAYLIST = "playlist";
Panel.STARRED = "Starred Songs";
Panel.SUGGESTS = "Saavn Suggests";
var SharePanel = SharePanel || new function () {
        this.showPanel = function (objectToShare, tgt) {
            if (typeof objectToShare != "object") objectToShare = JSON.parse(objectToShare);
            var isPlaylist = objectToShare.isPlaylist == undefined ? false : true;
            var isPlaylistPage = objectToShare.isPlaylistPage == undefined ? false : true;
            var isAlbum = objectToShare.isAlbum == undefined ? false : true;
            var isSongPage = objectToShare.isSongPage == undefined ? false : true;
            var isArtist = objectToShare.isArtist == undefined ? false : true;
            var title = objectToShare.fbtitle;
            if (isPlaylist || isPlaylistPage) {
                var isPrivatePlaylist = objectToShare.isPrivatePlaylist;
                if (isPrivatePlaylist) {
                    Panel.makePublic(objectToShare);
                    return false
                }
                shareEventString = isPlaylistPage ? "playlist-page" : "playlist";
                snEventString = "playlist"
            } else if (isAlbum) {
                shareEventString = "album";
                snEventString = "album"
            } else if (isArtist) {
                shareEventString = "artist";
                snEventString = "artist";
                title = objectToShare.artistName
            } else {
                shareEventString = isSongPage ? "song-page" : "song";
                snEventString = "song"
            }
            var fbOnClick = "Analytics.logAndSendEventToGA('site:share_modal:" + snEventString + ":facebook:click');SharePanel.popitup('https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(objectToShare.perma_url) + "&t=" + encodeURI(escape(objectToShare.fbtitle)) + "', 'Facebook', '450px', '500px');Interface.cPanelClose('#share-panel');";
            var twOnClick = "Analytics.logAndSendEventToGA('site:share_modal:" + snEventString + ":twitter:click');SharePanel.popitup('" + objectToShare.twitter + "', 'Twitter', '450px','500px');Interface.cPanelClose('#share-panel');";
            var extraCSS = isArtist ? "wide" : "";
            sharePanel = '<div id="share-panel" class="cpanel" data-type="share" data-entity-type="' + snEventString + '" data-entity-id="' + objectToShare.id + '">' + '<header class="cpanel-header">' + "<h3>Share " + snEventString + "</h3>" + '<div class="close-area"><div class="close"></div></div>' + "</header>" + '<div class="cpanel-content full xtrapad">' + "</div>" + "<footer>" + '<div class="social-share">' + "<h4>Or Share via</h4>" + '<div class="share-via-grid">' + '<div class="share-item-box ' + extraCSS + '">' + '<div class="fb" onclick="' + fbOnClick + '">' + '<div class="fb-icon" onclick="' + fbOnClick + '"></div>' + "</div>" + "</div>" + '<div class="share-item-box ' + extraCSS + '">' + '<div class="tw" onclick="' + twOnClick + '">' + '<div class="tw-icon" onclick="' + twOnClick + '"></div>' + "</div>" + "</div>";
            if (!isArtist) {
                sharePanel += '<div class="share-item-box">' + '<div class="emb" id="embed">Embed Link</div>' + "</div>"
            }
            sharePanel += '<div class="copylink-container">' + '<div class="copylink-icon"></div>' + '<input class="text autoselect share" type="text" value="' + objectToShare.perma_url + '">' + "</div>" + "</div>" + "</div>" + "</footer>" + "</div>";
            $("body").append(sharePanel);
            $("#share-panel #embed").click(function () {
                window.open("http://" + window.location.hostname + "/admin/widget/admin.php?l=" + encodeURIComponent(objectToShare.perma_url), "_blank")
            });
            Interface.initUI("#share-panel");
            Interface.cPanel("#share-panel", {w: 430});
            this.updateShareSubPanel();
            Analytics.logAndSendEventToGA("site:share:" + shareEventString + ":click")
        };
        this.updateShareSubPanel = function () {
            var subPanelNonFBUser = '<img src="/_i/3.0/share-friends.png">' + "<h4>Connect to Facebook to share directly with friends already using Saavn!</h4>" + '<a onclick="FBUtil.login(Panel.loginCallback)" id="invite-friends" class="btn fb med"><strong class="ellip">Find Friends on Facebook</strong></a>';
            var subPanelFBUser = '<div class="list-select">' + '<ol class="friends-list " id="taggable-friends">' + "</ol>" + "</div>" + '<textarea class="optional-msg" placeholder="Optional message..." id="share-message"></textarea>' + '<div class="share-modal-btn-wrap">' + '<h5 id="messageLength">140</h5>' + '<a id="share-send-button" class="btn green">Send</a>' + "</div>" + '<p class="form-alert hide">Please select friends you would like to share with.</p>';
            var isFBConnected = false;
            var userJSON = $("#user-json");
            if (userJSON.length != 0) {
                var fbid = JSON.parse(userJSON.text()).fbid;
                var network = Util.getCookie("network");
                isFBConnected = fbid != null && (network === "fb" || network === "linkedfb")
            }
            var html = "";
            var extraCSS = "";
            var subPanelElem = $(".cpanel-content");
            if (isFBConnected) {
                subPanelElem.empty();
                html = '<div id="page-loading" style="display: block;"><div class="loader"></div></div>';
                var url = "/api.php?__call=social.getFBFriends&_format=json&_marker=0";
                var taggableFriendsHTML = "";
                var callback = function (data) {
                    data = JSON.parse(data);
                    if (data.status == "success") {
                        var friends = data.friends;
                        if (friends.length == 0) {
                            var subPanelEmptyFBUser = '<img src="/_i/3.0/share-friends.png">' + "<h4>Hmm...looks like your Facebook friends are not using Saavn. Invite your friends to use Saavn or choose from one of the sharing options below.</h4>" + '<a id="invite-friends" class="btn fb" data-first=""><strong class="ellip">Invite More Friends</strong></a>';
                            var container = $(".cpanel-content");
                            container.addClass("center");
                            container.empty();
                            container.append(subPanelEmptyFBUser);
                            $("#invite-friends").click(function () {
                                $(".cpanel-header").find(".close").click();
                                Interface.inviteFriendsCallback()
                            });
                            return
                        }
                        for (i = 0; i < friends.length; i++) {
                            var friend = friends[i];
                            var name = "";
                            if (friend.firstname) {
                                name = friend.firstname
                            }
                            if (friend.lastname) {
                                name = name ? name + " " + friend.lastname : friend.lastname
                            }
                            if (!name) {
                                name = friend.uid
                            }
                            taggableFriendsHTML += '<li data-uid="' + friend.uid + '">' + '<img src="' + friend.image_url + '">' + '<input type="hidden" value="53559120"><p>' + name + "</p>" + '<span class="selected-check hide"></span>' + "</li>"
                        }
                    }
                    subPanelElem.empty();
                    subPanelElem.removeClass("center xtrapad");
                    subPanelElem.append(subPanelFBUser);
                    $("#taggable-friends").append(taggableFriendsHTML);
                    _initShareUI();
                    if (Interface.isAppPage()) {
                        Interface.initKeyControls()
                    }
                };
                Util.call(url, callback)
            } else {
                html = subPanelNonFBUser;
                subPanelElem.addClass("center")
            }
            subPanelElem.empty();
            subPanelElem.append(html)
        };
        function _initShareUI() {
            $("#taggable-friends li").each(function () {
                $(this).click(function () {
                    $(this).toggleClass("selected");
                    $($(this).find("span")).toggleClass("hide");
                    $(".form-alert").addClass("hide")
                })
            });
            $("#share-send-button").click(function () {
                if ($("#messageLength").text() < 0) {
                    return
                }
                var uids = [];
                var url = "/api.php";
                $("#taggable-friends li.selected").each(function () {
                    uids.push($(this).attr("data-uid"))
                });
                uids = uids.join(";");
                if (uids.length == 0) {
                    $(".form-alert").removeClass("hide");
                    return
                }
                var postData = {
                    __call: "social.tag",
                    uids: uids,
                    type: $("#share-panel").attr("data-entity-type"),
                    entity_id: $("#share-panel").attr("data-entity-id"),
                    msg: escape($("#share-message").val()),
                    _marker: 0,
                    _format: "json"
                };
                var shareCallback = function (data) {
                    data = JSON.parse(data);
                    var message = "Something went wrong! Please try again after sometime";
                    if (data.status == "success") {
                        message = "Shared Successfully";
                        $("#share-panel .close").click()
                    }
                    State.showNotification(message)
                };
                Util.call(url, shareCallback, postData, true)
            });
            $("#share-message").keyup(function () {
                var textLength = $(this).val().length;
                if (textLength > 140) {
                    $("#messageLength").css("opacity", "1");
                    $("#messageLength").css("color", "red");
                    $("#share-send-button").css("opacity", "0.2");
                    $("#share-send-button").css("cursor", "default")
                } else {
                    $("#share-send-button, #messageLength").css("opacity", "");
                    $("#messageLength").css("color", "");
                    $("#share-send-button").css("cursor", "")
                }
                $("#messageLength").text(140 - textLength)
            })
        }

        this.popitup = function (url, name, height, width) {
            var newwindow = window.open(url, name, "height=" + height + ",width=" + width);
            if (newwindow != null && window.focus) {
                newwindow.focus()
            }
            return false
        };
        function _generateQuadArt(isPage, t) {
            var imgList = "";
            if (isPage) {
                var tgt = $(".playlist .page-header");
                if ($(tgt).find(".group-art").length > 0) {
                    $(tgt).find(".group-art img").each(function () {
                        imgList += '<img src="' + $(this).attr("src") + '" />'
                    });
                    return '<div class="art group-art">' + imgList + "</div>"
                }
                if ($(tgt).find(".solo-art").length > 0)return '<div class="art solo-art"><img src="' + $(tgt).find(".solo-art img").attr("src") + '" /></div>'
            } else if (t === undefined) {
            } else {
                var tgt = $(t).closest(".playlist-result");
                if ($(tgt).find(".group-art").length > 0) {
                    $(tgt).find(".group-art img").each(function () {
                        imgList += '<img src="' + $(this).attr("src") + '" />'
                    });
                    return '<div class="art group-art">' + imgList + "</div>"
                }
                if ($(tgt).find(".solo-art").length > 0)return '<div class="art solo-art"><img src="' + $(tgt).find(".solo-art img").attr("src") + '" /></div>'
            }
            return '<div class="art solo-art"><img src="' + Util.getCDNUrl() + '/_i/3.0/album-default.png" /></div>'
        }
    };
var Sidebar = Sidebar || new function () {
        var currentSongs = [];
        var currentIndex = -1;
        var discardPile = [];
        var prefix = "sidebar";
        var delimiter = ":";
        var moveFrom, moveTo;
        var isLoadFromLocalStorage = false;
        var firstSongAfterLocalStorageLoad = false;

        function _storeCurrentIndex() {
            Util.setResourceToLocalStorage("currentIndex", currentIndex)
        }

        function _isAutoPlayAllowed() {
            var currentSong = Util.getResourceFromLocalStorage("currentSong", null);
            var stateObj = Player.getState();
            var isAutoplay = (currentSongs.length == 1 || stateObj != null && stateObj["state"] == "end") && !isLoadFromLocalStorage || firstSongAfterLocalStorageLoad && currentSong == undefined;
            firstSongAfterLocalStorageLoad = false;
            return isAutoplay
        }

        function _createItemUI(item, type, animate) {
            if (type == Sidebar.QUEUE) {
                _createQueueItemUI(item, animate)
            }
        }

        function _createQueueItemUI(item) {
            currentSongs[currentSongs.length] = item;
            _createSongUI(item, Sidebar.QUEUE)
        }

        function _updateNowPlaying() {
            $(".drawer-group li").removeClass("now-playing");
            $("#drawer-queue ol > li:nth-child(" + (currentIndex + 1) + ")").addClass("now-playing");
            Sidebar.handlePreviousNextButtons()
        }

        function _moveSong(from, to) {
            var temp = currentSongs[from];
            if (from < to) {
                for (var i = from; i < to; i++) {
                    currentSongs[i] = currentSongs[i + 1]
                }
            } else {
                for (var i = from; i > to; i--) {
                    currentSongs[i] = currentSongs[i - 1]
                }
            }
            currentSongs[to] = temp;
            if (currentIndex == from) {
                currentIndex = to
            } else {
                if (from >= currentIndex && currentIndex >= to) {
                    currentIndex++;
                    _storeCurrentIndex()
                }
                if (from <= currentIndex && currentIndex <= to) {
                    currentIndex--
                }
            }
            _storeCurrentIndex();
            Sidebar.handlePreviousNextButtons();
            Sidebar.storeQueue();
            State.setUnsavedQueue(true)
        }

        function _reindexQueue() {
            $("#drawer-queue ol > li").each(function (i) {
                $(this).find(".index").html(i + 1)
            })
        }

        function _checkForDupes(song) {
            var result = 0;
            $("#drawer-queue-group > li").each(function (i) {
                if ($(this).attr("data-song") == song) result++
            });
            return result
        }

        function _songClickEvent(tgt, song, type, clickElement) {
            $(tgt).removeClass("active");
            var c = $(clickElement.target).attr("class");
            var n = clickElement.target.nodeName;
            if (c != "meta" && c != "key-art" && c != "key-bg-cover" && $(clickElement.target).parent().attr("class") != "meta" && n != "LI" && n != "SPAN")return;
            if (!Sidebar.reordered && type == "queue") {
                var currentSongInPlayer = State.getCurrentlyPlayingSong();
                var clickedSongInSidebar = $("#" + song.id).data("json");
                if (!Player.isPlayerDisabled() && currentSongInPlayer && clickedSongInSidebar && currentSongInPlayer.id == clickedSongInSidebar.id) {
                    if (Player.getState().state == "paused") {
                        State.resumeSong();
                        Analytics.logAndSendEventToGA("site:sidebar:song:play:click")
                    } else {
                        State.pauseSong();
                        Analytics.logAndSendEventToGA("site:sidebar:song:pause:click")
                    }
                    return
                }
                currentIndex = $($("#" + song.id)).index();
                _storeCurrentIndex();
                _updateNowPlaying();
                discardPile = [];
                State.playSong($("#" + song.id).data("json"))
            } else if (type == "starred") {
                if (typeof song.disabled != "undefined" && song.disabled == "true") {
                    State.showError(song.title + " is currently unavailable.");
                    return
                }
                Sidebar.addItem(song, Sidebar.QUEUE)
            }
            Sidebar.reordered = false;
            var params = ["songid", song.songid];
            Analytics.logAndSendEventToGA(prefix + delimiter + "click_on_song" + delimiter + type, params)
        }

        function _createSongUI(song, type, animate) {
            if (type == Sidebar.QUEUE) {
                divId = "drawer-queue";
                scrollTgt = "queue"
            }
            song.title = !song.title ? song.song : song.title.replace("&#39;", "'");
            if (!song.image_url) song.image_url = song.image;
            var image = song.image_url == undefined || song.image_url.length == 0 || $.trim(song.image_url) == "" ? Util.getCDNUrl() + "/_i/3.0/album-default.png" : song.image_url;
            image = image.replace("150x150", "80x80");
            if (!song.album) song.album = song.album.replace("&#39;", "'");
            var duration = Util.getFormattedDuration(song.duration);
            var addToPlaylistObject = '{"language":"' + song.language + '","songid":"' + song.songid + '"}';
            var message = '#NowPlaying "' + song.title + '" @saavn #OurSoundtrack';
            var params = "?url=" + escape(song.tiny_url) + "&amp;text=" + escape(message) + "&amp;related=" + "saavn";
            var isSongDisabled = false;
            if (typeof song.disabled != "undefined" && song.disabled == "true") {
                isSongDisabled = true
            }
            var rbtCheck = State.showRBT;
            var divider = rbtCheck ? "" : " divider";
            var count = $("#" + divId + " ol > li").length + 1;
            var html = '<li id="' + song.id + '" data-song="' + song.songid + '"' + (isSongDisabled ? 'class = "disabled"' : "") + ">" + '<div class="index">' + count + "</div>" + '<div class="key-art" style="background-image: url(' + image + ');">' + '	<img class="key-bg-cover" src="' + image + '" alt="' + song.title + " &ndash; " + song.album + '" />' + '	<span class="icon"></span>' + "</div>" + '<div class="meta">' + "<h4>" + song.title + "</h4>" + "<h5>" + song.album + "</h5>" + '<p class="meta">' + (isSongDisabled ? "Track currently unavailable" : duration) + "</p>" + "</div>" + '<a class="remove actions"><strong>Remove</strong></a>' + '<a class="options actions"><strong>Details</strong></a>' + '<div class="mini-drop">' + "<ul>";
            if (State.isReadOnly) html += '<li class="note top"><strong>Read Only Mode</strong> Some features are undergoing maintenance... we\'ll be right back!</li>';
            if (State.isReadOnly) html += '<li class="disabled"><a>Playlists Not Available</a></li>'; else html += '<li class="playlist-add"><a>Add to a Playlist</a></li>';
            var checkLang = true;
            var songLanguage = "";
            if (Util.getCookie("L") === undefined) {
                checkLang = false
            } else {
                songLanguage = Util.getCookie("L")
            }
            if (song.language !== undefined) {
                songLanguage = song.language
            }
            if (State.isReadOnly || checkLang && $.inArray(songLanguage, Util.getRadioLanguages()) < 0) {
                html += '<li class="divider disabled"><a>Radio Not Available</a></li>'
            } else {
                html += '<li class="divider start-radio"><a>Start Radio</a></li>'
            }
            if (State.isReadOnly) html += '<li class="disabled"><a>Starring Not Available</a>'; else html += '<li><a class="star' + (song.starred == "true" ? " on" : "") + '">' + (song.starred == "true" ? "Starred <em>Remove</em>" : "Star") + "</a></li>";
            html += '<li class="icon share' + divider + '"><a>Share</a></li>';
            if (rbtCheck) {
                if (song.has_rbt == "true") {
                    html += '<li class="icon rbt divider"><a>Set Ring Back Tone</a></li>'
                } else {
                    html += '<li class="icon rbt disabled divider"><a>Set Ring Back Tone</a></li>'
                }
            }
            html += '	<li class="info-lyrics"><a>Info, Lyrics, and more...</a></li>' + '	<li class="more-album"><a>More from this album...</a></li>' + "</ul>" + "</div>" + "</li>";
            $("#" + divId + " ol").append(function () {
                var element = $(html);
                element.data("json", song);
                return element
            });
            var tgt = $("#" + song.id);
            if (animate) {
                $(tgt).hide().slideDown(120, function () {
                })
            }
            $("#" + divId + " .count").html(count + 1);
            $(tgt).hover(function () {
                $(this).addClass("hover")
            }, function () {
                $(this).removeClass("hover")
            });
            $(tgt).mousedown(function (e) {
                var c = $(e.target).attr("class");
                if ($(this).parent().parent().hasClass("mini-drop"))return;
                if (c != "meta" && c != "key-art" && $(e.target).parent().attr("class") != "meta" && e.target.nodeName != "LI")return;
                $(this).addClass("active")
            });
            $(tgt).mouseup(function (e) {
                var s = _getSongFromId(this.id);
                _songClickEvent($(this), song, type, e)
            });
            $(tgt).find(".playlist-add a").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:add-to-playlist:click");
                Sidebar.addToPlaylistEvent = true;
                Panel.showPlaylistPanel(addToPlaylistObject);
                return false
            });
            $(tgt).find(".info-lyrics a").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:info-and-lyrics:click");
                var url = $(tgt).data("json").perma_url;
                Util.updateBrowserUrl(url, false);
                Interface.cPanelClose();
                return false
            });
            $(tgt).find(".more-album a").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:more-from-album:click");
                var url = $(tgt).data("json").album_url;
                url = url.replace("/p/", "/s/");
                Util.updateBrowserUrl(url, false);
                Interface.cPanelClose();
                return false
            });
            $(tgt).find(".start-radio a").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:start_radio:click");
                var song = $(tgt).data("json");
                var title = Util.sanitisePhraseForURL(song.title);
                var url = "/p/radio/" + song.language + "-song-station/" + title + "/" + song.e_songid;
                Util.updateBrowserUrl(url, false);
                Interface.cPanelClose();
                return false
            });
            $(tgt).find(".share a").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:share:click");
                objectToShare = new Object;
                objectToShare.fbswfparams = "";
                objectToShare.fbtitle = song.title;
                objectToShare.fbthumb = song.image_url;
                objectToShare.twitter = "http://twitter.com/share" + params;
                objectToShare.perma_url = song.perma_url;
                objectToShare.thumb = song.image_url;
                objectToShare.album = song.album;
                objectToShare.song = song.title;
                objectToShare.id = song.songid;
                SharePanel.showPanel(objectToShare)
            });
            $(tgt).find(".remove").click(function () {
                var t = $(this).parent().find(".mini-drop");
                if ($(t).hasClass("showing")) {
                    $(".drawer-group .options").removeClass("active");
                    $(t).removeClass("showing").slideUp(90)
                } else {
                    var item = $("#" + song.id).data("json");
                    if (type == Sidebar.STARRED) {
                        Util.callFavorites({
                            pid: item.songid,
                            op: "removeSong",
                            lang: item.language,
                            success: function (o) {
                                State.songStarToggled(item, false)
                            },
                            error: function (o) {
                            }
                        });
                        Sidebar.updatePlaylists()
                    } else {
                        Sidebar.removeItem(item, type)
                    }
                }
                if (type == Sidebar.QUEUE) {
                    Sidebar.storeQueue()
                }
            });
            $(tgt).find(".star").click(function (event) {
                var pid = $(tgt).data().json.songid;
                var starred = $(tgt).data().json.starred;
                var op = starred.toString() == "true" ? "removeSong" : "addSong";
                Util.callFavorites({
                    pid: song.songid, op: op, lang: song.language, success: function (o) {
                        if (op == "removeSong") {
                            var item = $(tgt).data("json");
                            State.songStarToggled(item, false);
                            Analytics.logAndSendEventToGA("site:sidebar:song:menu:unstar:click")
                        } else {
                            var item = $(tgt).data("json");
                            State.songStarToggled(item, true);
                            Analytics.logAndSendEventToGA("site:sidebar:song:menu:star:click")
                        }
                    }, error: function (o) {
                    }
                });
                if (State.isUserLoggedIn()) {
                    Interface.cPanelClose()
                }
            });
            $(tgt).find(".options").click(function () {
                var t = $(this).parent().find(".mini-drop").clone(true);
                $(this).parent().addClass("flyout");
                Panel.drawerSongOptions(t, $(this));
                $("body").removeClass("drawer-hover");
                Analytics.logAndSendEventToGA("site:sidebar:song:menu:click")
            });
            $(tgt).find(".rbt a").click(function () {
                if (!$(this).parent().hasClass("disabled")) {
                    Analytics.logAndSendEventToGA("rbt:click:sidebar");
                    Panel.showRingtonesPanel(song.songid, song.title)
                }
            })
        }

        function _getSongFromId(elemId) {
            for (var i = 0; i < currentSongs.length; i++) {
                if (currentSongs[i].id == elemId) {
                    return currentSongs[i]
                }
            }
            return null
        }

        function _getNextShuffledSong() {
            if (currentSongs.length == 0) {
                return
            }
            var diff = [];
            var aIndex = 0;
            current_songs_loop:for (var i = 0; i < currentSongs.length; i++) {
                shuffled_songs_loop:for (var j = 0; j < discardPile.length; j++) {
                    if (discardPile[j].id == currentSongs[i].id) {
                        continue current_songs_loop
                    }
                }
                diff[aIndex++] = currentSongs[i]
            }
            if (diff.length == 0) {
                if (State.playlistLoop) {
                    discardPile = [];
                    return _getNextShuffledSong()
                } else {
                    return
                }
            }
            var index = Math.floor(Math.random() * diff.length);
            var shuffledSong = diff[index];
            discardPile.push(shuffledSong);
            Util.logInConsole("shuffled after:");
            Util.logInConsole(discardPile);
            return shuffledSong
        }

        function _isPrevEnabled() {
            if (currentSongs.length == 0) {
                return false
            }
            if (State.playlistLoop || State.singleSongLoop) {
                return true
            }
            if (State.shuffleMode && discardPile.length > 1) {
                return true
            }
            if (currentIndex == 0) {
                return false
            }
            return true
        }

        function _isNextEnabled() {
            if (currentSongs.length == 0) {
                return false
            }
            if (State.playlistLoop || State.singleSongLoop) {
                return true
            } else {
                if (State.shuffleMode && discardPile.length == currentSongs.length) {
                    return false
                } else if (!State.shuffleMode && currentIndex == currentSongs.length - 1) {
                    return false
                } else {
                    return true
                }
            }
        }

        this.addSongtoDiscardedPile = function (song) {
            if (!song) {
                return
            }
            discardPile.push(song)
        };
        this.addItem = function (json, type, autoplay) {
            var item = "";
            if (typeof json != "object") item = JSON.parse(unescape(json)); else item = json;
            if (autoplay == 1) item.autoplay = 1;
            var jsonArr = new Array;
            jsonArr[0] = item;
            this.addItems(jsonArr, type);
            if (State.isSingleAddOp) {
                Analytics.logAndSendEventToGA(prefix + delimiter + "add" + delimiter + type, ["songid", item.songid]);
                Sidebar.storeQueue()
            }
        };
        function _setQueueStarredState(song, starred) {
            $('#drawer-queue-group > li[data-song="' + song.songid + '"] .mini-drop > ul > li').each(function (o) {
                if ($(this).hasClass("star")) {
                    if (!starred) {
                        $(this).removeClass("on");
                        $(this).children("a").text("Star");
                        $("#drawer-options .star").removeClass("on");
                        $("#drawer-options .star a").text("Star")
                    } else {
                        $(this).addClass("on");
                        $(this).children("a").text("Unstar");
                        $("#drawer-options .star").addClass("on");
                        $("#drawer-options .star a").text("Unstar")
                    }
                }
            });
            $('#drawer-queue-group > li[data-song="' + song.songid + '"]').each(function (o) {
                if (!starred) {
                    $(this).data("json").starred = "false"
                } else {
                    $(this).data("json").starred = "true"
                }
            })
        }

        this.addItems = function (jsonArray, type) {
            if (type == Sidebar.QUEUE) {
                divId = "drawer-queue";
                scrollTgt = "queue"
            }
            if ($("#" + divId + " ol > li").length <= 0) {
                $("#" + divId + " .drawer-scroll .empty").slideUp(210, function () {
                    $(this).hide()
                });
                $("#" + divId + " .queue-actions .btn").removeClass("disabled");
                if (type == Sidebar.QUEUE) $("body").addClass("live-queue")
            }
            var animate = false;
            if (jsonArray.length == 1) {
                animate = true
            }
            document.body.style.cursor = "wait";
            for (var i = 0; i < jsonArray.length; i++) {
                var item = jQuery.extend(true, {}, jsonArray[i]);
                item.id = Util.generateUniqueIdentifier();
                _createItemUI(item, type, animate);
                var isAutoplayEnabled = false;
                var playerState = Player.getState();
                if (item.autoplay == "true" || item.autoplay == 1 || item.autoplay == true || playerState != null && playerState["state"] == "end") {
                    isAutoplayEnabled = true
                }
                if (type == Sidebar.QUEUE && isAutoplayEnabled) {
                    currentIndex = currentSongs.length - 2;
                    _storeCurrentIndex();
                    if (isAutoplayEnabled) {
                        if (State.radioMode) {
                            State.stopRadio()
                        }
                        this.playNextSong(true);
                        State.enablePlayer()
                    }
                    item.autoplay = 0
                }
                if (type == Sidebar.QUEUE && _isAutoPlayAllowed()) {
                    if (!State.radioMode) {
                        this.playNextSong(isAutoplayEnabled);
                        State.enablePlayer()
                    }
                }
            }
            document.body.style.cursor = "default";
            if (type == Sidebar.QUEUE) {
                this.handlePreviousNextButtons()
            }
            if (!Sidebar.loadFromLocalStorage || State.UNSAVED) State.setUnsavedQueue(true)
        };
        this.handlePreviousNextButtons = function () {
            State.updatePlayerControls(Player.PREVIOUS, _isPrevEnabled());
            State.updatePlayerControls(Player.NEXT, _isNextEnabled())
        };
        this.clearList = function (type) {
            if (type == Sidebar.QUEUE) {
                var divId = "#drawer-queue"
            }
            $(divId).find(".count").html("0");
            $(divId).find(".drawer-group > li").remove();
            $(divId).find(".empty").slideDown(210);
            $(divId).find(".queue-actions a.btn#queue-clear").addClass("disabled");
            if (type == Sidebar.QUEUE) {
                State.playerReset();
                $("body").removeClass("live-queue");
                currentSongs = [];
                currentIndex = -1;
                _storeCurrentIndex();
                discardPile = [];
                State.currentPlaylistName = "";
                State.currentPlaylistUrl = "";
                State.currentPlaylist = State.NO_PLAYLIST;
                Sidebar.storeQueue();
                State.setUnsavedQueue(false);
                Analytics.logAndSendEventToGA(prefix + delimiter + "clear" + delimiter + type)
            }
        };
        this.removeItem = function (item, type) {
            var divId = "";
            var i = 0;
            switch (type) {
                case Sidebar.QUEUE:
                    _removeItemUI(type, item.id);
                    for (i = 0; i < currentSongs.length; i++) {
                        if (currentSongs[i].id == item.id) {
                            break
                        }
                    }
                    currentSongs.splice(i, 1);
                    if (currentSongs.length == 0) {
                        Sidebar.clearList(Sidebar.QUEUE)
                    } else {
                        State.setUnsavedQueue(true);
                        if (i < currentIndex) {
                            currentIndex--;
                            _storeCurrentIndex()
                        } else if (i == currentIndex) {
                            if (i != currentSongs.length) {
                                _playSong(currentIndex)
                            } else if (i == currentSongs.length && State.playlistLoop) {
                                _playSong(0)
                            } else {
                                State.playerReset()
                            }
                        }
                        if (State.shuffleMode) {
                            for (i = 0; i < discardPile.length; i++) {
                                if (discardPile[i].id == item.id) {
                                    break
                                }
                            }
                            discardPile.splice(i, 1)
                        }
                    }
                    break
            }
            Analytics.logAndSendEventToGA(["site:sidebar:song:delete:click", "songid", item.songid])
        };
        function _removeItemUI(type, itemId) {
            var c = 0;
            var divId = "";
            if (type == Sidebar.QUEUE) {
                divId = "drawer-queue";
                c = $("#" + divId + " ol > li").length
            }
            $("#" + divId + " .count").html(c - 1);
            $("#" + itemId).slideUp(120, function () {
                $(this).remove();
                _updateNowPlaying();
                _reindexQueue()
            });
            if (c == 0) {
                $("#" + divId + " .empty").slideDown(210);
                $("#" + divId + " .queue-actions .btn#queue-clear").addClass("disabled");
                $("body").removeClass("live-queue")
            }
        }

        function _storeState() {
            var data = "";
            if (currentSongs.length) {
                data = jQuery.serialize(currentSongs)
            }
            Util.setCookie("SQ", data, 30, true)
        }

        function _playSong(index) {
            if (index > currentSongs.length || index < 0) {
                return
            }
            var song = currentSongs[index];
            State.playSong(song);
            currentIndex = index;
            _storeCurrentIndex();
            _updateNowPlaying();
            Sidebar.handlePreviousNextButtons()
        }

        this.playNextSong = function (autoplayEnabled) {
            var index = 0;
            if (!autoplayEnabled) {
                var song = _getNextShuffledSong();
                if (song == undefined)return;
                for (var i = 0; i < currentSongs.length; i++) {
                    if (currentSongs[i].id == song.id) {
                        index = i
                    }
                }
            } else {
                if (currentIndex < currentSongs.length - 1) {
                    index = currentIndex + 1
                } else {
                    if (State.playlistLoop) {
                        index = 0
                    } else {
                        Analytics.logAndSendEventToGA(prefix + delimiter + "playlistend");
                        return
                    }
                }
            }
            _playSong(index)
        };
        this.playPreviousSong = function () {
            var index = currentIndex;
            if (State.shuffleMode && discardPile.length > 0) {
                var song = discardPile.pop();
                song = discardPile[discardPile.length - 1];
                for (var i = 0; i < currentSongs.length; i++) {
                    if (currentSongs[i].id == song.id) {
                        index = i
                    }
                }
            } else {
                if (index == 0) {
                    if (State.playlistLoop) {
                        index = currentSongs.length - 1
                    }
                } else {
                    index = currentIndex - 1
                }
            }
            _playSong(index)
        };
        this.nowPlayingData = function () {
            return currentSongs
        };
        this.paintFBFriends = function (data) {
            var max = data.length;
            max = max > 5 && max < 10 ? 5 : max;
            for (var i = 0; i < max; i++) {
                var pictObj = data[i]["picture"];
                $('<img src="' + pictObj["data"]["url"] + '" />').appendTo("#drawer-login .fbpile")
            }
            $("#drawer-login").addClass("showing").fadeIn(120)
        };
        this.storeQueue = function () {
            if (!localStorage)return;
            var queue = Sidebar.nowPlayingData();
            if (queue) {
                if (queue.length > 1e3) {
                    queue = queue.splice(1e3, queue.length - 1e3)
                }
                queue = JSON.stringify(queue)
            } else {
                queue = undefined
            }
            localStorage.setItem(State.NOW_PLAYING_QUEUE, queue);
            if (State.UNSAVED) localStorage.setItem(State.NOW_PLAYING_UNSAVED, "1"); else localStorage.removeItem(State.NOW_PLAYING_UNSAVED)
        };
        this.populateQueueFromLocalStorage = function () {
            if (!localStorage)return;
            var queue = localStorage.getItem(State.NOW_PLAYING_QUEUE);
            isLoadFromLocalStorage = true;
            var unsavedState = localStorage.getItem(State.NOW_PLAYING_UNSAVED);
            if (unsavedState) State.UNSAVED = true;
            Sidebar.loadFromLocalStorage = true;
            if (queue) {
                queue = JSON.parse(queue);
                State.isSingleAddOp = false;
                State.disableNotifications();
                for (var i = 0; i < queue.length; i++) {
                    queue[i]["album_url"] = queue[i]["album_url"].replace("s/#!/", "");
                    queue[i]["perma_url"] = queue[i]["perma_url"].replace("s/#!/", "");
                    State.addSong(queue[i], Sidebar.QUEUE)
                }
                State.enableNotifications();
                State.isSingleAddOp = true
            }
            isLoadFromLocalStorage = false;
            Sidebar.loadFromLocalStorage = false;
            firstSongAfterLocalStorageLoad = true;
            currentIndex = State.getSongCountInNowPlayingQueue() - 1
        };
        this.reloadCurrentIndex = function () {
            currentIndex = parseInt(localStorage.getItem("currentIndex"))
        };
        this.removeDuplicates = function () {
            var rra = [];
            var dupeCount = 0;
            $("#drawer-queue-group > li").each(function (i) {
                var pid = $(this).attr("data-song");
                if (rra.indexOf(pid) > -1) {
                    $(this).find(".remove").click();
                    dupeCount++
                } else rra.push(pid)
            });
            if (dupeCount > 0) {
                var str = dupeCount == 1 ? "song" : "songs";
                State.showNotification(dupeCount + " duplicate " + str + " removed from your queue!")
            } else State.showNotification("No duplicates found... happy listening!")
        };
        this.setReadOnly = function () {
            $("#queue-save").removeClass("green").addClass("light disabled").css("pointer-events", "auto")
        };
        this.init = function () {
            if (!State.isUserLoggedIn()) {
                FBUtil.getInstalledFriends(10, Sidebar.paintFBFriends);
                $("#drawer-login button").bind("click", function () {
                    FBUtil.login(function (o) {
                        Panel.loginCallback(o)
                    })
                })
            }
            if (currentSongs.length == 0) {
                $("#drawer-queue").find(".queue-actions a.btn#queue-clear").addClass("disabled")
            }
            $("#queue-clear").click(function () {
                if (!$(this).hasClass("disabled")) {
                    Analytics.logAndSendEventToGA("site:sidebar:clear:click");
                    Panel.clearConfirm()
                }
            });
            $("#queue-save").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:save:click");
                if (!$(this).hasClass("disabled")) {
                    State.POST_SAVE_CLEAR_QUEUE = true;
                    State.showPlaylistPanel()
                } else if (State.isReadOnly) {
                    alert(Util.readOnlyMessage)
                }
            });
            $("#queue-more").click(function () {
                if (!$(this).hasClass("disabled")) {
                    Analytics.logAndSendEventToGA("site:sidebar:more:click");
                    Panel.drawerMoreOptions()
                }
            });
            $("#drawer-queue .drawer-group").sortable({
                axis: "y",
                containment: "parent",
                opacity: .8,
                tolerance: "pointer",
                start: function (event, ui) {
                    $("body").addClass("force-drawer");
                    Sidebar.reordered = true;
                    moveFrom = ui.item.index()
                },
                stop: function (event, ui) {
                    $(this).find("li").removeClass("active");
                    moveTo = ui.item.index();
                    _moveSong(moveFrom, moveTo);
                    _reindexQueue();
                    $("body").removeClass("force-drawer")
                }
            });
            Sidebar.populateQueueFromLocalStorage()
        }
    };
Sidebar.QUEUE = "queue";
Sidebar.reordered = false;
Sidebar.loadFromLocalStorage = false;
Sidebar.addToPlaylistEvent = false;
var State = State || new function () {
        var _enableNotifications = true;
        var _disablePlayer = false;
        var _autoLoadPostContentFetch = false;
        this.partner = null;
        this.adPartner = null;
        this.ref = null;
        this.logOut = function () {
            Player.clear(false);
            var url = "/api.php?__call=user.logout&t=" + Util.getCurrentTime();
            Util.call(url, this.logoutCallBack, "", false)
        };
        this.logoutCallBack = function (data, status) {
            if (status == Util.SUCCESS) {
                try {
                    FB.Cookie.clear();
                    FB.Cookie.clearSignedRequestCookie()
                } catch (e) {
                    Util.logInConsole(e)
                }
                $("#user-json").remove();
                FBUtil.clearFBCookies();
                Radio.clearStationInfo();
                window.location.href = "/";
                return
            } else {
                var xml = Util.getXMLObj(data);
                var error = xml.getElementsByTagName("error");
                var msg = "Unable to log out";
                if (error.length) {
                    msg = error[0].getAttribute("msg")
                }
                alert(msg);
                return
            }
        };
        this.isUserLoggedIn = function () {
            var user = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
            if (user == null || user == undefined || user.uid == undefined || user.uid == null || user.uid == "") {
                return false
            }
            return true
        };
        this.isUserPro = function () {
            var proCookie = decodeURIComponent(Util.getCookie("P"));
            var tokens = proCookie.split(":");
            if (tokens.length > 0 && (tokens[0] == "trial" || tokens[0] == "pro")) {
                return true
            }
            return false
        };
        this.forgotPassword = function (postData, forgotPasswordCallback) {
            Util.call("/api.php?__call=user.forgotPassword&_marker=0", forgotPasswordCallback, postData, true)
        };
        var loginOrRegisterCB = "";
        this.showLogin = function (tracking) {
            if (tracking === undefined || tracking == "")var tracking = "site:login:unknown";
            Panel.showLoginPanel();
            Analytics.logAndSendEventToGA(tracking)
        };
        this.login = function () {
            Header.update();
            $("#drawer-login").fadeOut(120, function () {
                $(this).removeClass("showing")
            });
            if (Util.getPageType() == "artist" || Util.getPageType() == "people" || $(".page-wrap").hasClass("account")) {
                State.refreshContent()
            } else if (Radio.isRadioUrl()) {
                Radio.loadUserStations()
            }
            AdRotation.init()
        };
        this.register = function (postData, registerUserCallback) {
            var isSecure = document.location.protocol == "https:" ? true : false;
            if (isSecure) {
                var url = "/api.php?__call=user.createV2";
                Util.call(url, registerUserCallback, postData, true)
            } else {
                var url = "http://" + window.location.hostname + "/api.php?__call=user.createV2";
                loginOrRegisterCB = registerUserCallback;
                Util.securecall(url, "State.updateUserState", postData)
            }
        };
        this.updateUserState = function (o) {
            var status = "";
            if (o != "undefined") {
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    loginCB(o);
                    return
                }
                var user = xml.getElementsByTagName("user");
                if (user.length) {
                    if (user[0].hasAttribute("fbid")) {
                        FBUtil.fb_publisher_id = user[0].getAttribute("fbid")
                    }
                    loginOrRegisterCB(o)
                }
            }
        };
        this.getUserData = function (key) {
            var user = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
            if (user == null || user == undefined || user.uid == undefined || user.uid == null || user.uid == "") {
                return null
            }
            return user[key]
        };
        this.updateUserData = function (postData, updateUserCallback) {
            var url = "https://" + window.location.hostname + "/api.php?__call=user.update";
            Util.call(url, updateUserCallback, postData, true)
        };
        this.setLanguage = function (language) {
            var prevLanguage = Util.getCookie("L");
            if (prevLanguage == "" || prevLanguage == null) prevLanguage = "hindi";
            State.prevLanguage = prevLanguage;
            if (language == null || language == undefined || language == "") {
                language = prevLanguage
            }
            Util.setCookie("L", language);
            $("body").removeClass("hindi tamil").addClass(language);
            var current_language = language.charAt(0).toUpperCase() + language.slice(1);
            $("#currentLanguage").html(current_language);
            var current = '<em class="current">current</em>';
            $("#language ol li em.current").remove();
            $("#language ol li").removeClass("current");
            $("#language ol li").each(function (i) {
                if ($(this).find("a").html() == current_language) {
                    $(this).addClass("current");
                    $(this).find("a").append(current)
                }
            })
        };
        this.getLanguage = function () {
            return Util.getCookie("L")
        };
        this.notifyVolumeChange = function (volume) {
            AdRotation.setAudioVolume(volume)
        };
        this.addSong = function (song, type, autoplay) {
            if (song === undefined) {
                return
            }
            if (typeof song != "object") song = JSON.parse(song);
            Sidebar.addItem(song, type, autoplay);
            if (!autoplay) State.showNotification(song.title + " was added to your queue." + (State.radioMode ? '<em><strong class="radio">Note:</strong> You\'re in Radio Mode. Stop radio any time to listen to your queue.</em>' : ""), "status", State.radioMode);
            State.playerState = State.PLAYER_DIRTY
        };
        this.stopRadio = function () {
            State.radioMode = false;
            State.showNotification('<strong class="radio">Radio is now off.</strong> <em>Hope you enjoyed your station!</em>');
            Radio.stopRadio();
            Player.radioOff();
            Header.updateRadioMenu();
            if (Util.getPageType() == "radio") {
                Interface.smoothTo($("#featured-stations"), 480, null, 100)
            }
            Analytics.logAndSendEventToGA("site:radio:radioMode:stopRadio")
        };
        this.startRadio = function (songid, query) {
            Radio.playAlreadyLoadedStation()
        };
        this.startScratchStation = function (songid, query) {
            Analytics.logAndSendEventToGA("site:radio:radioMode:startRadio");
            Radio.startScratchStation(songid, query)
        };
        this.checkRadioLanguage = function (lang) {
            lang = lang.toLowerCase();
            if (lang != "hindi" && lang != "english") Radio.showLanguageAlert(); else Radio.hideLanguageAlert()
        };
        this.removeSong = function (song, type) {
            if (typeof song != "object") song = JSON.parse(unescape(song));
            Sidebar.removeItem(song, type);
            State.playerState = State.PLAYER_DIRTY
        };
        this.detectFlash = function () {
            var isFlashPresent = false;
            if (FlashDetect.installed && FlashDetect.versionAtLeast(9, 0, 115)) {
                isFlashPresent = true
            }
            return isFlashPresent
        };
        this.loadPlayer = function (callback) {
            try {
                if (Player.jwplayer == undefined || Player.jwplayer == null) {
                    var initSong = Util.getResourceFromLocalStorage("currentSong", "");
                    if (initSong != "") initSong = JSON.parse(initSong);
                    var initUrl = "http://example.com/myVideo.mp4";
                    jwplayer("jwplayerSaavn").setup({
                        file: initUrl,
                        type: "mp4",
                        height: 1,
                        width: 1,
                        description: initSong,
                        autostart: false
                    });
                    Player.jwplayer = jwplayer("jwplayerSaavn");
                    Player.jwplayer.onReady(function () {
                        Player.initJWPlayerTracking();
                        Player.isReady = true
                    })
                }
                Player.initPlayerUI();
                if (State.loadPlayer.callback != undefined) {
                    callback = State.loadPlayer.callback;
                    State.loadPlayer.callback = ""
                }
                if (callback != undefined && typeof callback == "function") {
                    callback()
                }
            } catch (e) {
                if (callback != undefined) {
                    State.loadPlayer.callback = callback
                }
                window.setTimeout(State.loadPlayer, 1e3)
            }
        };
        this.playSong = function (song) {
            return Player.playSong(song)
        };
        this.pauseSong = function (song) {
            Player.pauseSong()
        };
        this.resumeSong = function (song) {
            Player.resumeSong()
        };
        this.playNextSong = function () {
            if (_disablePlayer) {
                return
            }
            if (State.radioMode) {
                Radio.getSong(true)
            } else {
                if (State.singleSongLoop) {
                    Player.playSong(Player.getCurrentSong())
                } else {
                    var autoplayEnabled = !State.shuffleMode;
                    Sidebar.playNextSong(autoplayEnabled)
                }
            }
            Interface.checkPlayButtonStates()
        };
        this.playPreviousSong = function () {
            if (_disablePlayer) {
                return
            }
            if (State.singleSongLoop) {
                Player.playSong(Player.getCurrentSong())
            } else {
                Sidebar.playPreviousSong()
            }
        };
        this.playerReset = function () {
            var song = State.getCurrentlyPlayingSong();
            if (song) {
                FBUtil.postFBPauseEvent(song)
            }
            Player.clear();
            State.playerState = State.PLAYER_CLEAN;
            $("body").removeClass("playing paused");
            Interface.checkPlayButtonStates("", true)
        };
        this.enablePlayer = function () {
            Player.enable()
        };
        this.playlistLoaded = function () {
            Analytics.logAndSendEventToGA("playlist-ajax")
        };
        this.songStarToggled = function (song, starred) {
            if (starred) {
                State.showNotification(song.title + " was added to your Starred Songs.", false);
                Interface.myMusicNotify({note: "1", notePrefix: "+"})
            } else {
                State.showNotification(song.title + " was removed from your Starred Songs.", "remove");
                Interface.myMusicNotify({note: "1", notePrefix: "-"})
            }
            if (Panel.successCallback) {
                State.refreshContent()
            } else {
                if (Util.getPageType() == "starred_songs") State.refreshContent();
                Content.receiveChangeFavouriteStateCall(song.songid, starred)
            }
            var currentSong = Player.getCurrentSong();
            if (currentSong && song.songid == currentSong.songid) {
                Player.toggleStarIcon(starred)
            }
            Analytics.logAndSendEventToGA("songstar-ajax")
        };
        this.enableNotifications = function () {
            _enableNotifications = true
        };
        this.disableNotifications = function () {
            _enableNotifications = false
        };
        this.showNotification = function (text, styleClass, longer) {
            if (!_enableNotifications)return;
            if (styleClass === undefined || !styleClass)var styleClass = "status";
            if (longer === undefined)var longer = 1; else if (typeof longer === "boolean") longer = 2;
            clearInterval(State.notificationInt);
            $("#notify").removeClass().addClass(styleClass).html(text);
            $("#notify").click(function () {
                clearInterval(State.notificationInt);
                State.hideNotification(styleClass)
            });
            $("#notify").addClass("show");
            State.notificationInt = setInterval(function () {
                clearInterval(State.notificationInt);
                State.hideNotification(styleClass)
            }, State.noteDuration * longer)
        };
        this.hideNotification = function (styleClass) {
            clearInterval(State.notificationInt);
            $("#notify").removeClass("show");
            State.enableNotifications()
        };
        this.showError = function (msg, type) {
            State.showNotification(msg, type, false)
        };
        this.updatePlayerControls = function (buttonType, isOn) {
            Player.handleNextPrevButtons(buttonType, isOn)
        };
        this.getPlayerControlsState = function () {
            Sidebar.handlePreviousNextButtons()
        };
        this.showPreloader = function () {
            if ($("#preloader").length <= 0) $("body").append('<div id="preloader" class="off-screen"><img src="/_i/preloader.gif" alt="Loading..." /></div>');
            $("#preloader").removeClass("off-screen").fadeIn(120)
        };
        this.hidePreloader = function (f) {
            $("#preloader").fadeOut(210, function () {
                $(this).addClass("off-screen").find("span").remove();
                if (typeof f == "function") f()
            })
        };
        this.renamePlaylist = function (listname, listid) {
            Playlist.renamePlaylist(listname, listid)
        };
        this.playlistsData = function () {
            var playlistJson = $("#my-music .playlists-json").text();
            return jQuery.parseJSON(Util.stringCheck(playlistJson))
        };
        this.getPlayerContext = function () {
            var song = null;
            try {
                song = Player.getCurrentSong()
            } catch (e) {
                Util.logInConsole(e)
            }
            var obj = null;
            if (song.pass_album_ctx == "true") {
                obj = {type: "album", value: song.album_url}
            }
            if (State.currentPlaylistName != "" && State.playerState != State.PLAYER_DIRTY) {
                obj = {};
                obj.type = "playlist";
                obj.value = State.currentPlaylistUrl
            }
            if (State.radioMode == true) {
                obj = {};
                obj.type = "radio_station";
                obj.value = Radio.getCurrentStationUrl(true)
            }
            return obj
        };
        this.sendPageViewEvent = function () {
            Analytics.logAndSendEventToGA("site:page:view:content_reload")
        };
        this.getAdContext = function () {
            var song = null;
            var searchQuery = null;
            var playlist = null;
            try {
                song = Player.getCurrentSong()
            } catch (e) {
                Util.logInConsole(e)
            }
            searchQuery = $("#q").val();
            playlist = $("#ads-title").text();
            var returnValue = {song: song, searchQuery: searchQuery, playlist: playlist};
            return returnValue
        };
        this.pauseForAd = function () {
            try {
                Player.pauseSong()
            } catch (e) {
            }
            Player.disable();
            _disablePlayer = true
        };
        this.isPausedForAd = function () {
            return _disablePlayer == true
        };
        this.continueAfterAd = function () {
            try {
                if (Player.isPlayerPaused()) {
                    Player.resumeSong()
                }
            } catch (e) {
            }
            _disablePlayer = false;
            Player.enable()
        };
        this.playAudioAd = function (imageURL) {
            $("#audio-ad-banner .key-art").css("background-image", "url(" + imageURL + ")");
            $("#player").addClass("audio-ad");
            $("body").append('<div id="ad-click-block"><div id="click-block-admin"></div></div>')
        };
        this.removeAudioAdVeil = function () {
            $("#player").removeClass("audio-ad");
            $("#audio-ad-countdown").html("0 seconds...");
            $("#ad-click-block").remove()
        };
        this.playVideoAd = function (withCompanion) {
            if (withCompanion === undefined || !withCompanion)var modalW = 480; else if (withCompanion == true)var modalW = 828;
            Interface.hideAdCol();
            Interface.cPanel("#video-ad-panel", {w: modalW, h: 294, disable: true, media: true})
        };
        this.endingVideoAd = function () {
            Interface.cPanelClose("#video-ad-panel");
            Interface.showAdCol();
            State.continueAfterAd()
        };
        this.showIdleUnit = function (markup) {
            var KEY_ESC = 27;
            var idleWin = '<div id="idle-unit-curtain">' + '    <div id="idle-unit-container">' + '        <div id="idle-unit-window">' + '            <p class="small">This Saavn session brought to you by</p>' + '            <div id="idle-unit">' + "               <div>" + "               <!-- begin idle screen ad tag -->" + markup + "               <!-- end idle screen ad tag -->" + "               </div>" + "            </div>" + '            <button class="btn green" id="idle-unit-dismiss">Dismiss</button>' + '            <p class="small">or press esc key to continue</p>' + "        </div>" + "    </div>" + "</div>";
            $("html").addClass("idle");
            $("body").prepend(idleWin);
            $("#idle-unit-dismiss").click(function () {
                State.removeIdleUnit();
                Analytics.logAndSendEventToGA("idlescreen:dismiss:click")
            });
            $(document).unbind("keyup.idle").bind("keyup.idle", function (e) {
                if (e.keyCode == KEY_ESC) {
                    State.removeIdleUnit();
                    Ads.adRotationDataReset(AdConstants.AdUnitIdleScreenAd);
                    Ads.getAdRotationData()[AdConstants.TimeOfInactivity] = Util.getCurrentTime();
                    Ads.getAdRotationData()[AdConstants.TimeOfInactivity] = Util.getCurrentTime()
                }
            })
        };
        this.removeIdleUnit = function () {
            $(document).unbind("keyup.idle");
            if ($("#idle-unit-curtain").length > 0) {
                $("#idle-unit-curtain").fadeOut(340, function () {
                    $("html").removeClass("idle");
                    $(this).remove()
                })
            } else {
                $("html").removeClass("idle")
            }
        };
        this.playClick = function (tgt, autoplay, trackingEvent, extraTrackings) {
            if (State.isSingleAddOp) {
                var t = $(tgt).closest(".song-wrap");
                if ($(t).hasClass("current-song") && autoplay) {
                    if ($("body").hasClass("playing")) State.pauseSong(); else if ($("body").hasClass("paused")) State.resumeSong();
                    return
                }
                var songJson = $(t).find(".song-json").text();
                Analytics.logAndSendEventToGA(trackingEvent, extraTrackings)
            }
            State.addSong(songJson, Sidebar.QUEUE, autoplay)
        };
        this.refreshContent = function (refreshView) {
            if (refreshView === undefined) {
                var refreshView = true
            }
            _interpretPath("", refreshView)
        };
        function _interpretPath(callback, refreshView) {
            var url = Util.getPath();
            if (url === "/") {
                window.open(url, "_self");
                return
            }
            var getPageCb = null;
            if (callback) {
                getPageCb = function () {
                    callback();
                    State.sendPageViewEvent()
                }
            } else {
                getPageCb = function () {
                    State.sendPageViewEvent()
                };
                var tokens = url.split("/");
                switch (tokens[1]) {
                    case"me":
                        if (tokens[2] == "notifications") {
                            getPageCb = function () {
                                $("#notif-bell").click()
                            }
                        }
                        break;
                    case"search":
                    case"s":
                        var queryStr = tokens[2].replace(/\+|_|-/gi, " ");
                        if (tokens.length > 3) {
                            queryStr += ":" + tokens[3].replace(/\+|_-|-/gi, " ")
                        }
                        if (queryStr.indexOf("?") != -1) {
                            queryStr = queryStr.substring(0, queryStr.indexOf("?"))
                        }
                        if (tokens[2] == "album" && tokens.length == 6) {
                            var albumWithYear = tokens[4];
                            albumWithYear = albumWithYear.replace(/\+|_/gi, " ");
                            var dashIndex = albumWithYear.lastIndexOf("-");
                            var album = albumWithYear.substring(0, dashIndex);
                            var year = albumWithYear.substring(++dashIndex);
                            album = album.replace(/-/g, " ")
                        } else if (tokens[2] == "artist" && tokens.length == 5) {
                            var artistNameWithType = tokens[3];
                            artistNameWithType = artistNameWithType.replace(/\+|_/gi, " ");
                            var dashIndex = artistNameWithType.lastIndexOf("-");
                            var artistName = artistNameWithType.substring(0, dashIndex).replace(/-/g, " ")
                        } else if (tokens[2] == "playlist" && tokens.length > 5) {
                        } else {
                            if (tokens[2] != "song" && tokens[2] != "radio") {
                            }
                        }
                        getPageCb = function () {
                            if (_autoLoadPostContentFetch) {
                                Content.playAllSongs(null, true);
                                _autoLoadPostContentFetch = false
                            }
                            State.sendPageViewEvent()
                        };
                        State.setPageTitle(document.getElementById("q").value + " : Saavn.com - Listen to Indian Music for free");
                        break;
                    case"play":
                    case"p":
                        if (tokens[2] == "radio") {
                            if (!Interface.featuredStations) {
                                getPageCb = function () {
                                    Radio.radioSongCB();
                                    State.sendPageViewEvent();
                                    Header.updateRadioMenu();
                                    State.setPageTitle("Saavn Radio: " + Radio.getStationInfo().stationName.replace(/-/g, " "))
                                }
                            }
                        } else {
                            getPageCb = function () {
                                if (_autoLoadPostContentFetch || Util.getQueryParams("autostart") == 1) {
                                    Content.playAllSongs(null, true);
                                    _autoLoadPostContentFetch = false
                                }
                                State.sendPageViewEvent()
                            };
                            State.setPageTitle(document.getElementById("q").value + " : Saavn.com - Listen to Indian Music for free")
                        }
                        break
                }
            }
            Content.getPage(url, getPageCb, refreshView)
        }

        this.setPageTitle = function (title) {
            document.title = Util.pagetitle = title
        };
        function _init() {
            var isWalled = false;
            Sidebar.init();
            var path = Util.getPath();
            if (path.length != 0) {
                var tokens = path.split("/");
                if (tokens[1] == "play" || tokens[1] == "p" || tokens[1] == "song-of-the-day" || tokens[1] == "t") {
                    if (tokens[2] == "featured" || tokens[2] == "playlist") {
                        State.currentPlaylistName = tokens[4];
                        State.currentPlaylistUrl = location.protocol + "//" + location.hostname + path
                    }
                    if (!isWalled) {
                        if (Radio.isRadioUrl()) {
                            var effectType = Util.getQueryParams("rd_effects");
                            switch (effectType) {
                                case"rajni":
                                    Radio.toggleRJK(true);
                                    break;
                                case"liljon":
                                    Radio.toggleLJR(true);
                                    break
                            }
                            Radio.playAlreadyLoadedStation()
                        } else {
                            Content.playAllSongs(null, true)
                        }
                    }
                } else if (tokens[1] == "me" && tokens[2] == "notifications") {
                    $(".notify-icon").click()
                }
                if ($(".page-wrap").hasClass("radio")) {
                    var patt = /^\/(p|s)\/radio\/[A-Za-z]*-featured-stations$/;
                    if (patt.test(location.pathname)) {
                        localStorage.radioHomeClick = true
                    }
                }
                State.playerState = State.PLAYER_CLEAN
            }
            State.setLanguage(State.prevLanguage);
            if (!State.partner || State.partner == "undefined") {
                var locationHash = Util.getHash().split("partner=");
                if (locationHash.length > 1) {
                    locationHash = locationHash[1].split("&");
                    State.partner = locationHash[0];
                    if (State.partner.indexOf("SAAVNWidget") == -1) {
                        State.adPartner = State.partner = "SAAVNWidget" + State.partner
                    }
                    if (!State.isSponsoredPlaylist()) {
                        RemoteServer.setPartner(State.adPartner)
                    }
                }
            }
            State.setRef();
            if (isWalled) {
                Panel.showLoginPanel(isWalled)
            }
            if (!State.isUserLoggedIn()) {
                FBUtil.checkFBReferer()
            }
            Radio.loadUserStations();
            var patt = /^\/s\/artist/;
            if (patt.test(location.pathname)) {
                Analytics.logAndSendEventToGA("inner:content:artist_pages:ui")
            }
            patt = /^\/label\//;
            if (patt.test(location.pathname)) {
                Analytics.logAndSendEventToGA("inner:content:label_pages:ui", "label_name", location.pathname.split("/")[2])
            }
            Analytics.logAndSendEventToGA("content:app-init:internal");
            Content.init()
        }

        $(function () {
            State.showRBT = Util.isRBTEnabled();
            State.isReadOnly = $("body").hasClass("read-only");
            var History = window.History;
            if (History.enabled) {
                HistoryState = History.getState();
                if (HistoryState.data && typeof HistoryState.data.urlPath != "undefined" && HistoryState.data.urlPath != window.location) {
                    History.pushState({urlPath: window.location.pathname}, $("title").text(), "")
                }
                History.Adapter.bind(window, "statechange", function () {
                    _interpretPath(null)
                });
                _init()
            } else {
                Util.logInConsole("History is disabled")
            }
            Player.init();
            try {
                AdRotation.init()
            } catch (err) {
                Ads.adBlockDetected = true;
                Interface.showSiteNotice("You seem to have Adblock installed. Please disable it to enjoy your music without interruption.")
            }
            var campaign = unescape(unescape(Util.getCookie("saavn_campaign")));
            if (campaign) {
                var msg = "You are browsing in the <strong>" + campaign + "</strong> environment. Please clear your cookies to point to the production environment.";
                Interface.showSiteNotice(msg, false)
            }
            if (State.isReadOnly) {
                var readonly = Util.readOnlyMessage;
                Interface.showFixedNotice(readonly, true);
                Sidebar.setReadOnly()
            }
            Notifications.startNotificationsFetch()
        });
        $(window).load(function () {
            FBUtil.init();
            State.initThirdPartyTracking()
        });
        window.onbeforeunload = function () {
            if (!Player.isPlayerPlaying()) {
                return
            }
            var queryString = location.search.substring(1);
            if (queryString.indexOf("utm_medium=SOKCPC") == -1 && queryString.indexOf("utm_medium=sokcpc") == -1) {
                return
            }
            FBUtil.onunload();
            return "Closing or reloading the tab will stop music playback."
        };
        this.initThirdPartyTracking = function () {
            var _comscore = _comscore || [];
            _comscore.push({c1: "2", c2: "10002439"});
            var s = document.createElement("script"), el = document.getElementsByTagName("script")[0];
            s.async = true;
            s.src = (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js";
            el.parentNode.insertBefore(s, el);
            var a = document.createElement("script");
            a.type = "text/javascript";
            a.async = true;
            a.src = ("https:" == document.location.protocol ? "https://" : "http://cdn.") + "chuknu.sokrati.com/579/tracker.js";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(a, s)
        };
        this.autoLoadPostContentFetch = function (bool) {
            if (bool) {
                _autoLoadPostContentFetch = true
            } else {
                _autoLoadPostContentFetch = false
            }
        };
        this.nowPlayingData = function () {
            return Sidebar.nowPlayingData()
        };
        this.showPlaylistPanel = function (songObject) {
            Panel.showPlaylistPanel(songObject)
        };
        this.addSongsToPlaylist = function (listid, songObject, sourceListId) {
            Playlist.addToPlaylist(listid, Util.serializeSongs(songObject), sourceListId)
        };
        this.createNewPlaylist = function (listname, songObject, sourceListId, destinationListId) {
            Playlist.createPlaylist(listname, Util.serializeSongs(songObject), sourceListId)
        };
        this.updatePlaylistView = function () {
            Header.getPlaylists()
        };
        this.getCurrentlyPlayingSong = function () {
            return Player.getCurrentSong()
        };
        this.getSongCountInNowPlayingQueue = function () {
            return Sidebar.nowPlayingData().length
        };
        this.showSidebarClearOptions = function () {
            Panel.showSidebarClearOptions()
        };
        this.storeSidebarQueue = function () {
            Sidebar.storeQueue()
        };
        this.reloadSidebar = function () {
            Sidebar.reloadCurrentIndex()
        };
        this.setUnsavedQueue = function (unsaved) {
            State.UNSAVED = unsaved;
            if (unsaved) {
                localStorage.setItem(State.NOW_PLAYING_UNSAVED, "1");
                $("body").addClass("dirty-queue");
                if (!State.isReadOnly) $("#queue-save").removeClass("outline")
            } else {
                localStorage.removeItem(State.NOW_PLAYING_UNSAVED);
                $("body").removeClass("dirty-queue");
                if (!State.isReadOnly) $("#queue-save").addClass("outline")
            }
        };
        this.isSponsoredPlaylist = function () {
            return "yes" == $(".meta-info .sponsoredpl").text()
        };
        this.reportProgressEvents = function (time) {
            if (!State.progressPanelShown && !State.isUserLoggedIn()) {
                State.progressPanelShown = true;
                Panel.showLoginPanel()
            }
        };
        this.setRef = function () {
            var locationHash = Util.getHash().split("ref=");
            if (locationHash.length > 1) {
                locationHash = locationHash[1].split("&");
                State.ref = locationHash[0]
            }
        }
    };
State.PLAYER_CLEAN = "clean";
State.PLAYER_DIRTY = "dirty";
State.playerState = State.PLAYER_CLEAN;
State.reloadPrevSong = true;
State.POST_SAVE_CLEAR_QUEUE = false;
State.playlistLoop = false;
State.shuffleMode = false;
State.singleSongLoop = false;
State.MODE_SEARCH = "search";
State.MODE_PLAYLIST = "playlist";
State.MODE_FEATURED_PLAYLIST = "featured_playlist";
State.MODE_RECENT = "recent";
State.mode = State.MODE_SEARCH;
State.volumePercentage = 50;
State.NO_PLAYLIST = -1;
State.currentPlaylist = State.NO_PLAYLIST;
State.currentPlaylistName = "";
State.currentPlaylistUrl = "";
State.POST_LOGIN_SHOW_NOTHING = "";
State.POST_LOGIN_SHOW_PLAYLIST = "playlist";
State.POST_LOGIN_MARK_FAVOURITE = "favourite";
State.postLogin = "";
State.SEARCH_TYPE_USER_INPUT = "1";
State.SEARCH_TYPE_USER_CLICK = "2";
State.SEARCH_TYPE_SUGGESTION = "4";
State.SEARCH_TYPE_CORRECTION = "5";
State.SEARCH_TYPE_CORRECTION_EXACT = "6";
State.SEARCH_TYPE_DISAMBIGUATION = "7";
State.SEARCH_TYPE_ALBUMLEVEL_SUGGESTION = "8";
State.currentLink = "";
State.browser = Util.getBrowser();
State.currentPagenum = 1;
State.currentSearchType = State.SEARCH_TYPE_USER_INPUT;
State.song_progressed_secs = 0;
State.prevLanguage = State.getLanguage();
State.currentQueryLanguage = State.prevLanguage;
State.notificationInt;
State.noteDuration = 4e3;
State.isSingleAddOp = true;
State.showRBT = false;
State.NOW_PLAYING_QUEUE = "nowPlayingQueue";
State.NOW_PLAYING_UNSAVED = "unsavedQueue";
State.UNSAVED = false;
State.radioMode = false;
State.progressPanelShown = false;
State.isReadOnly = false;
var AdConstants = AdConstants || new function () {
        this.AdUnitMedRec = 100;
        this.AdUnitSkin = 102;
        this.AdUnitHalfPage = 103;
        this.AdUnitCustomUnit = 104;
        this.AdUnitConfigLoad = 105;
        this.AdUnitNone = 106;
        this.AdUnitRichMediaAd = 107;
        this.AdUnitIdleScreenAd = 108;
        this.AdUnitVastAd = 109;
        this.TimeOfSession = 1;
        this.TimePlayed = 2;
        this.NumberOfSongs = 3;
        this.TimeLastRotation = 4;
        this.NumberOfSongsSinceRotn = 5;
        this.TimeOfPlayStart = 6;
        this.TimeOfInactivity = 7;
        this.TimeOfInitialDurationStart = 8;
        this.TimeOfConsumptionStart = 9;
        this.SlotTimeConsumed = 10;
        this.Count = 11;
        this.TYPE_CONTENT_CHANGE = 1;
        this.TYPE_PLAYER_CHANGE = 2;
        this.TYPE_MEDIA_CHANGE = 3;
        this.TYPE_MEDIA_PROGRESS = 4;
        this.TYPE_USER_ACTION = 5;
        this.TYPE_PAGE_ACTION = 6;
        this.TYPE_ADMEDIA_CHANGE = 7;
        this.TYPE_RADIO_PLAYER = 8;
        this.TYPE_USAGE_GROUP = 9;
        this.Operator = {OR: 1, AND: 2};
        this.adLocation = {TOP: 1, BOTTOM: 2, HALF_PAGE: 3, NONE: 4, NO_CUSTOM_UNIT: 5};
        this.adConditionType = {COUNTER: 1, FNCTN: 2};
        this.adState = {
            INITIAL_LOAD: 1,
            INITIAL_DURATION: 2,
            INITIAL_SPILLAGE: 3,
            RICH_MEDIA_PLAYING: 4,
            IN_SLOT: 5,
            IN_SPILLAGE: 6
        };
        var eventGroups = new Array;
        var player_change = this.TYPE_PLAYER_CHANGE;
        var content_change = this.TYPE_CONTENT_CHANGE;
        var media_change = this.TYPE_MEDIA_CHANGE;
        var media_progress = this.TYPE_MEDIA_PROGRESS;
        var user_action = this.TYPE_USER_ACTION;
        var page_action = this.TYPE_PAGE_ACTION;
        var admedia_change = this.TYPE_ADMEDIA_CHANGE;
        var radio_player = this.TYPE_RADIO_PLAYER;
        var usage_group = this.TYPE_USAGE_GROUP;
        eventGroups["site:player:add"] = player_change;
        eventGroups["site:player:change_position"] = player_change;
        eventGroups["site:player:change_volume"] = player_change;
        eventGroups["site:player:clear"] = player_change;
        eventGroups["site:player:click_on_song"] = player_change;
        eventGroups["site:player:click_to_pause"] = player_change;
        eventGroups["site:player:click_to_play"] = player_change;
        eventGroups["site:player:mediaresumed"] = player_change;
        eventGroups["site:player:mediapaused"] = player_change;
        eventGroups["site:player:delete"] = player_change;
        eventGroups["site:player:moveSong"] = player_change;
        eventGroups["site:player:next"] = player_change;
        eventGroups["site:player:prev"] = player_change;
        eventGroups["site:player:repeat_set:click"] = player_change;
        eventGroups["site:player:repeat_unset:click"] = player_change;
        eventGroups["site:player:shuffle_set"] = player_change;
        eventGroups["site:player:shuffle_unset"] = player_change;
        eventGroups["site:player:volume"] = player_change;
        eventGroups["sidebar:click_on_song:queue"] = player_change;
        eventGroups["site:player:radio:add"] = player_change;
        eventGroups["site:player:radio:change_position"] = player_change;
        eventGroups["site:player:radio:change_volume"] = player_change;
        eventGroups["site:player:radio:clear"] = player_change;
        eventGroups["site:player:radio:click_on_song"] = player_change;
        eventGroups["site:player:radio:click_to_pause"] = player_change;
        eventGroups["site:player:radio:click_to_play"] = player_change;
        eventGroups["site:player:radio:delete"] = player_change;
        eventGroups["site:player:radio:moveSong"] = player_change;
        eventGroups["site:player:radio:next"] = player_change;
        eventGroups["site:player:radio:prev"] = player_change;
        eventGroups["site:player:radio:repeat_set:click"] = player_change;
        eventGroups["site:player:radio:repeat_unset:click"] = player_change;
        eventGroups["site:player:radio:shuffle_set"] = player_change;
        eventGroups["site:player:radio:shuffle_unset"] = player_change;
        eventGroups["site:player:radio:volume"] = player_change;
        eventGroups["sidebar:add:queue"] = player_change;
        eventGroups["sidebar:add:starred"] = player_change;
        eventGroups["sidebar:add:mp"] = player_change;
        eventGroups["site:sidebar:song:delete:click"] = player_change;
        eventGroups["sidebar:delete:starred"] = player_change;
        eventGroups["sidebar:delete:mp"] = player_change;
        eventGroups["sidebar:playlistend"] = player_change;
        eventGroups["site:sidebar:clear:click"] = player_change;
        eventGroups["rename-playlist"] = content_change;
        eventGroups["playlists-ajax"] = content_change;
        eventGroups["profile-ajax"] = content_change;
        eventGroups["site:search:song"] = content_change;
        eventGroups["site:searchplaylist_suggestion"] = content_change;
        eventGroups["search:disambiguation"] = content_change;
        eventGroups["search:correction"] = content_change;
        eventGroups["search:correction_exact"] = content_change;
        eventGroups["search:albumlevel_suggestion"] = content_change;
        eventGroups["site:search:song:similar_search:top:click"] = content_change;
        eventGroups["site:search:song:similar_search:bottom:click"] = content_change;
        eventGroups["playlist-ajax"] = content_change;
        eventGroups["sotd-ajax"] = content_change;
        eventGroups["site:page:view:content_reload"] = content_change;
        eventGroups["site:radio:radioMode:startRadio"] = radio_player;
        eventGroups["site:radio:radioMode:stopRadio"] = radio_player;
        eventGroups["site:player:mediaready"] = media_change;
        eventGroups["site:player:mediaopened"] = media_change;
        eventGroups["site:player:mediaend"] = media_change;
        eventGroups["site:player:mediaunload"] = media_change;
        eventGroups["site:player:radio:mediaready"] = media_change;
        eventGroups["site:player:radio:mediaopened"] = media_change;
        eventGroups["site:player:radio:mediaend"] = media_change;
        eventGroups["site:player:radio:mediaunload"] = media_change;
        eventGroups["site:player:progress"] = media_progress;
        eventGroups["site:player:progress:30"] = media_progress;
        eventGroups["site:player:progress:60"] = media_progress;
        eventGroups["site:player:progress:90"] = media_progress;
        eventGroups["site:player:progress:120"] = media_progress;
        eventGroups["site:player:progress:150"] = media_progress;
        eventGroups["site:player:progress:180"] = media_progress;
        eventGroups["site:player:progress:210"] = media_progress;
        eventGroups["site:player:progress:240"] = media_progress;
        eventGroups["site:player:progress:270"] = media_progress;
        eventGroups["site:player:progress:300"] = media_progress;
        eventGroups["site:player:progress:330"] = media_progress;
        eventGroups["site:player:progress:360"] = media_progress;
        eventGroups["site:player:radio:progress"] = media_progress;
        eventGroups["site:player:radio:progress:30"] = media_progress;
        eventGroups["site:player:radio:progress:60"] = media_progress;
        eventGroups["site:player:radio:progress:90"] = media_progress;
        eventGroups["site:player:radio:progress:120"] = media_progress;
        eventGroups["site:player:radio:progress:150"] = media_progress;
        eventGroups["site:player:radio:progress:180"] = media_progress;
        eventGroups["site:player:radio:progress:210"] = media_progress;
        eventGroups["site:player:radio:progress:240"] = media_progress;
        eventGroups["site:player:radio:progress:270"] = media_progress;
        eventGroups["site:player:radio:progress:300"] = media_progress;
        eventGroups["site:player:radio:progress:330"] = media_progress;
        eventGroups["site:player:radio:progress:360"] = media_progress;
        eventGroups["songstar-ajax"] = user_action;
        eventGroups["page:load"] = page_action;
        eventGroups["adplayer:mediaend"] = admedia_change;
        eventGroups["page:timerevent"] = usage_group;
        eventGroups["page:idlescreenevent:0"] = usage_group;
        eventGroups["page:idlescreenevent:3"] = usage_group;
        eventGroups["page:idlescreenevent:6"] = usage_group;
        eventGroups["page:idlescreenevent:9"] = usage_group;
        eventGroups["page:idlescreenevent:12"] = usage_group;
        eventGroups["page:idlescreenevent:15"] = usage_group;
        eventGroups["page:idlescreenevent:18"] = usage_group;
        eventGroups["page:idlescreenevent:21"] = usage_group;
        eventGroups["page:idlescreenevent:24"] = usage_group;
        eventGroups["page:idlescreenevent:27"] = usage_group;
        eventGroups["page:idlescreenevent:30"] = usage_group;
        eventGroups["page:idlescreenevent:33"] = usage_group;
        eventGroups["page:idlescreenevent:36"] = usage_group;
        eventGroups["page:idlescreenevent:39"] = usage_group;
        eventGroups["page:idlescreenevent:42"] = usage_group;
        eventGroups["page:idlescreenevent:45"] = usage_group;
        eventGroups["page:idlescreenevent:48"] = usage_group;
        eventGroups["page:idlescreenevent:51"] = usage_group;
        eventGroups["page:idlescreenevent:54"] = usage_group;
        eventGroups["page:idlescreenevent:57"] = usage_group;
        eventGroups["page:idlescreenevent:60"] = usage_group;
        eventGroups["page:idlescreenevent:63"] = usage_group;
        eventGroups["page:idlescreenevent:66"] = usage_group;
        eventGroups["page:idlescreenevent:69"] = usage_group;
        eventGroups["page:idlescreenevent:72"] = usage_group;
        eventGroups["page:idlescreenevent:75"] = usage_group;
        eventGroups["page:idlescreenevent:78"] = usage_group;
        eventGroups["page:idlescreenevent:81"] = usage_group;
        eventGroups["page:idlescreenevent:84"] = usage_group;
        eventGroups["page:idlescreenevent:87"] = usage_group;
        eventGroups["page:idlescreenevent:90"] = usage_group;
        eventGroups["page:idlescreenevent:93"] = usage_group;
        eventGroups["page:idlescreenevent:96"] = usage_group;
        eventGroups["page:idlescreenevent:99"] = usage_group;
        eventGroups["page:idlescreenevent:102"] = usage_group;
        eventGroups["page:idlescreenevent:105"] = usage_group;
        eventGroups["page:idlescreenevent:108"] = usage_group;
        eventGroups["page:idlescreenevent:111"] = usage_group;
        eventGroups["page:idlescreenevent:114"] = usage_group;
        eventGroups["page:idlescreenevent:117"] = usage_group;
        eventGroups["page:idlescreenevent:120"] = usage_group;
        this.getEventGroup = function (eventType) {
            return eventGroups[eventType]
        }
    };
AdConfig = new function () {
    this.configUnitQueryString = "pos=slot;dcopt=ist;sz=1x1;tile=1";
    this.customUnitQueryString = "pos=right;sz=234x60;tile=1";
    this.medRecQueryString = "pos=right;sz=300x250;tile=1";
    this.halfPageQueryString = "pos=right;sz=300x600;tile=1";
    this.skinQueryString = "";
    this.audioAdQueryString = "pos=audio;dcopt=ist;sz=1x1;tile=1";
    this.videoAdQueryString = "pos=video;dcopt=ist;sz=1x1;tile=1";
    this.innerQueryString = "pos=inner;dcopt=ist;sz=1x1;tile=1";
    this.idleScreenQueryString = "pos=idle;dcopt=ist;sz=1x1;tile=1";
    this.showCreative = AdConstants.AdUnitNone;
    this.creativePosition = AdConstants.adLocation.NONE;
    this.adRotationTime = 3e4;
    this.slotDuration = 3e4;
    this.initialDuration = 3e4;
    this.idleScreenTime = 48e4
};
var AdUtil = AdUtil || new function () {
        this.getTargetQueryStr = function (songDetails) {
            var targetingStr = "";
            var queryStr = "";
            if (songDetails != null) {
                if (songDetails.song != null) {
                    targetingStr += ";song=" + replaceNonAlphaNumeric(songDetails.song.title);
                    targetingStr += ";album=" + replaceNonAlphaNumeric(songDetails.song.album);
                    targetingStr += ";singers=" + replaceNonAlphaNumeric(songDetails.song.singers);
                    targetingStr += ";starring=" + replaceNonAlphaNumeric(songDetails.song.starring);
                    targetingStr += ";referrer_type=" + replaceNonAlphaNumeric(songDetails.song.origin);
                    targetingStr += ";referrer_id=" + replaceNonAlphaNumeric(songDetails.song.origin_val);
                    targetingStr += ";songLanguage=" + replaceNonAlphaNumeric(State.currentQueryLanguage)
                }
                targetingStr += ";search_query=" + replaceNonAlphaNumeric(songDetails.searchQuery);
                targetingStr += ";playlist=" + replaceNonAlphaNumeric(songDetails.playlist);
                if (songDetails.song == null) {
                    if (songDetails.searchQuery != "") {
                        targetingStr += ";referrer_type=search";
                        targetingStr += ";referrer_id=" + replaceNonAlphaNumeric(songDetails.searchQuery)
                    } else if (songDetails.playlist != "") {
                        targetingStr += ";referrer_type=playlist";
                        targetingStr += ";referrer_id=" + replaceNonAlphaNumeric(songDetails.playlist)
                    }
                }
            }
            targetingStr += ";language=" + Util.getCookie("L");
            if (typeof State != "undefined" && State) {
                if (State.radioMode == true) {
                    var stationHash = Radio.getStationInfo();
                    var stationId = replaceNonAlphaNumeric(stationHash.stationId);
                    var stationType = replaceNonAlphaNumeric(stationHash.stationType);
                    var stationName = replaceNonAlphaNumeric(stationHash.stationName);
                    targetingStr += ";mode=radio;stationName=" + stationName + ";stationType=" + stationType + ";stationId=" + stationId
                } else {
                    targetingStr += ";mode=interactive"
                }
            }
            var user = jQuery.parseJSON(Util.stringCheck($("#user-json").text()));
            if (user != undefined && user != null && user.uid != "" && user.uid != null && user.uid != undefined) {
                targetingStr += ";gender=" + user["gender"]
            } else {
                targetingStr += ";gender=" + "u"
            }
            targetingStr += AdUtil.getPartner();
            return targetingStr
        };
        this.getPartner = function () {
            var partner = "";
            if (typeof State != "undefined" && State) {
                if (State.adPartner && State.adPartner.length > 0 && !State.isSponsoredPlaylist()) {
                    partner = "&partner=" + State.adPartner
                }
            }
            return partner
        };
        this.getCampaignStr = function () {
            var campaignStr = "";
            var path = window.location.search;
            if (path.indexOf("?") != -1) {
                queryStr = path.substring(path.indexOf("?") + 1);
                adinfoindex = queryStr.indexOf("adinfo=");
                if (adinfoindex != -1) {
                    nextAnd = queryStr.indexOf("&", adinfoindex);
                    if (nextAnd == -1) {
                        campaignStr = queryStr.substring(adinfoindex + 7)
                    } else {
                        campaignStr = queryStr.substring(adinfoindex + 7, nextAnd)
                    }
                    Util.setNonPersistentCookie("saavn_campaign", campaignStr)
                }
                if (campaignStr == "") {
                    catindex = queryStr.indexOf("cat=");
                    if (catindex != -1) {
                        nextAnd = queryStr.indexOf("&", catindex);
                        if (nextAnd == -1) {
                            campaignStr = queryStr.substring(catindex)
                        } else {
                            campaignStr = queryStr.substring(catindex, nextAnd)
                        }
                        Util.setNonPersistentCookie("saavn_campaign", campaignStr)
                    } else {
                        campaignStr = unescape(Util.getCookie("saavn_campaign"))
                    }
                }
            } else {
                campaignStr = unescape(Util.getCookie("saavn_campaign"))
            }
            if (campaignStr == "") {
                campaignStr = "env=web-prod"
            }
            return campaignStr + ";"
        };
        function replaceNonAlphaNumeric(str) {
            if (str == undefined) {
                return
            }
            return str.replace(/[^a-zA-Z 0-9\-]+/g, "")
        }
    };
var AdRotation = AdRotation || new function () {
        var currentSkin = 0;
        var page_initialized = false;
        var jPlayer_volume = 80;
        this.fireLocked = {halfpage: false, drawer: false, idlescreen: false};
        this.idleAjaxObj = null;
        this.skinConfig = null;
        this.audioAdConfig = null;
        this.videoAdConfig = null;
        this.campaignId = null;
        this.hotzone = false;
        this.pin_bottom = false;
        this.audioad_enable = false;
        this.videoad_enable = false;
        this.campaignId = false;
        this.audioAdQueryString = false;
        this.videoAdQueryString = false;
        this.richMediaTargeting = false;
        this.slotDuration = AdConfig.slotDuration;
        this.adRotationTime = AdConfig.adRotationTime;
        this.customUnitQueryString = AdConfig.customUnitQueryString;
        this.drawer_enable = true;
        this.creative_position = "half_page";
        this.halfPageQueryString = AdConfig.halfPageQueryString;
        this.idleScreenQueryString = AdConfig.idleScreenQueryString;
        this.idle_screen = true;
        this.initialDuration = AdConfig.initialDuration;
        this.adUnitRotate = function (eventName, adUnit, adUnitQueryString) {
            if (!navigator.onLine || Ads.adBlockDetected) {
                return
            }
            var query_str = adUnitQueryString;
            var songDetails = State.getAdContext();
            var targetQueryStr = AdUtil.getTargetQueryStr(songDetails);
            if (typeof targetQueryStr != "undefined") query_str += targetQueryStr;
            switch (adUnit) {
                case AdConstants.AdUnitMedRec:
                    $(".ad.half-page").addClass("hide");
                    $("#searchpage_adiframe")[0].contentWindow.location.replace("/searchpage_ad.php?" + AdUtil.getCampaignStr() + query_str);
                    break;
                case AdConstants.AdUnitHalfPage:
                    if (AdRotation.creative_position == "half_page") {
                        if (!this.fireLocked.halfpage) {
                            AdRotation.adLocation(eventName, AdConstants.adLocation.HALF_PAGE);
                            $("#searchhalfpage_adiframe")[0].contentWindow.location.replace("/searchhalfpage_ad.php?" + AdUtil.getCampaignStr() + query_str);
                            this.fireLocked.halfpage = true
                        }
                    }
                    break;
                case AdConstants.AdUnitSkin:
                    if (AdRotation.creative_position == "skin_only") {
                        AdRotation.adLocation(eventName, AdConstants.adLocation.NONE)
                    }
                    if (AdRotation.skinConfig) {
                        _setSkin(AdRotation.skinConfig.skin_url, AdRotation.skinConfig.bg_color, AdRotation.skinConfig.bg_image, AdRotation.pin_bottom);
                        _setHotzone(AdRotation.hotzone);
                        Ads.adRotationDataReset(AdConstants.AdUnitSkin)
                    }
                    break;
                case AdConstants.AdUnitRichMediaAd:
                    if (AdRotation.audioad_enable) {
                        Ads.continuePlayback = false;
                        _fetchAudioConfig(AdUtil.getCampaignStr() + query_str)
                    }
                    if (AdRotation.videoad_enable) {
                        Ads.continuePlayback = false;
                        _fetchVastConfig(AdUtil.getCampaignStr() + query_str)
                    }
                    break;
                case AdConstants.AdUnitIdleScreenAd:
                    if (AdRotation.idle_screen) {
                        if (!this.fireLocked.idlescreen) {
                            if ($("#idle-unit-curtain").length < 1) {
                                _fetchIdleScreenMarkup(AdUtil.getCampaignStr() + query_str);
                                this.fireLocked.idlescreen = true
                            }
                        }
                    }
                    break;
                case AdConstants.AdUnitCustomUnit:
                    if (AdRotation.drawer_enable) {
                        if (!this.fireLocked.drawer) {
                            this.fireLocked.drawer = true;
                            $("#searchpage_custom_adiframe")[0].contentWindow.location.replace("/searchpage_custom_ad.php?" + AdUtil.getCampaignStr() + query_str)
                        }
                    } else {
                        AdRotation.adLocation(eventName, AdConstants.adLocation.NO_CUSTOM_UNIT)
                    }
                    break;
                case AdConstants.AdUnitConfigLoad:
                    _unsetSkin();
                    _fetchConfig(AdUtil.getCampaignStr() + query_str);
                    break;
                case AdConstants.AdUnitNone:
                    Ads.adRotationDataReset(AdConstants.AdUnitNone);
                    break
            }
        };
        this.adLocation = function (eventName, loc) {
            switch (loc) {
                case AdConstants.adLocation.HALF_PAGE:
                    $("body").removeClass("media-btm");
                    break;
                case AdConstants.adLocation.NONE:
                    break;
                case AdConstants.adLocation.NO_CUSTOM_UNIT:
                    $(".ad.media").addClass("hide");
                    $(".ad.half-page").addClass("hide");
                    break
            }
            $(".ad.media").addClass("hide");
            $(".ad.half-page").addClass("hide")
        };
        this.setAudioVolume = function (volume) {
            jPlayer_volume = volume;
            if ($("#jwplayer_1").length != 0) {
                jwplayer("#jwplayer_1").setVolume(volume)
            }
            if ($("#jwplayer_2").length != 0) {
                jwplayer("#jwplayer_2").setVolume(volume)
            }
        };
        this.sizeAdFrame = function (tgt) {
            var h = 250;
            if ($(tgt).contents().find("[height]").length > 0) {
                $(tgt).contents().find("[height]").each(function (i) {
                    if ($(this).attr("height") > 250) {
                        h = $(this).attr("height")
                    }
                })
            }
            var styles = {};
            $(tgt).contents().find("[style*='height']").each(function (j) {
                var styleStr = $(this).attr("style").split(";");
                var property = "";
                for (var x = 0, l = styleStr.length; x < l; x++) {
                    property = styleStr[x].split(":");
                    styles[$.trim(property[0])] = $.trim(property[1])
                }
                if (styles["height"]) {
                    var inlineH = parseInt(styles["height"].replace("px", ""));
                    if (inlineH > 250) {
                        h = inlineH
                    }
                }
            });
            $(tgt).css("height", h + "px");
            if (h > 250) {
                $("#brand-col").addClass("half-page");
                _unsetHotzone()
            } else {
                $("#brand-col").removeClass("half-page");
                _setHotzone(AdRotation.hotzone)
            }
        };
        function _setSkin(skin_url, bg_color, bg_image, pin_bottom) {
            var newSkin = skin_url.split("saavncdn.com")[1];
            var oldSkin = $("#skin-img").css("background-image").split("saavncdn.com")[1];
            if (oldSkin) oldSkin = oldSkin.replace(")", "");
            if ((newSkin || oldSkin) && newSkin == oldSkin) {
                $("#hot-zone").show();
                return
            }
            if (bg_image === undefined || !bg_image)var bgPattern = "none"; else var bgPattern = "url(" + bg_image + ")";
            $("#skin-img").fadeOut(120, function () {
                $("#skin-img").css("background-image", "none");
                if (skin_url && bg_color) {
                    $("<img />").attr("src", skin_url).load(function () {
                        $("#skin-wrap").css({"background-color": bg_color, "background-image": bgPattern});
                        if (pin_bottom) $("#skin-wrap").addClass("pin-bottom"); else $("#skin-wrap").removeClass("pin-bottom");
                        $("#skin-img").css({"background-image": "url(" + skin_url + ")"}).delay(120).fadeIn(430)
                    })
                } else if (bg_color) {
                    $("#skin-wrap").css("background-color", bg_color)
                } else {
                    $("#skin-wrap").css({background: "transparent"})
                }
            })
        }

        function _setHotzone(hotzone) {
            if (hotzone) {
                $("#hot-zone").css({
                    top: hotzone.top + "px",
                    right: hotzone.right + "px",
                    width: hotzone.width + "px",
                    height: hotzone.height + "px"
                }).show();
                $("#hot-zone").unbind("click").click(function () {
                    if (hotzone["click-url"].search(/saavn.com\//i) != -1) {
                        var vars = [], hash;
                        var hashes = hotzone["click-url"].slice(hotzone["click-url"].indexOf("?") + 1).split("&");
                        for (var i = 0; i < hashes.length; i++) {
                            hash = hashes[i].split("=");
                            vars.push(hash[0]);
                            vars[hash[0]] = hash[1]
                        }
                        Util.updateBrowserUrl(vars["adurl"], true)
                    } else {
                        window.open(hotzone["click-url"])
                    }
                })
            } else {
                _unsetHotzone()
            }
        }

        function _unsetHotzone() {
            $("#hot-zone").hide()
        }

        function _unsetSkin() {
            $("body").css("background-color", "F3F3F3");
            $("#page").css("background-image", 'url("")');
            $("#skin-wrap").css("background-image", 'url("")');
            $("#hot-zone").hide()
        }

        function _fetchAudioConfig(query_str) {
            query_str = decodeURIComponent(query_str);
            query_str = query_str.replace(/;/g, "&");
            var base_url = "http://pubads.g.doubleclick.net/gampad/adx?iu=/6714/212.saavn";
            var targetting = "&t=" + encodeURIComponent(query_str);
            var ad_unit_qs = "&sz=1x1&tile=1&c=" + Math.random() * 1e16;
            var dfp_url = base_url + targetting + ad_unit_qs;
            $.ajax({
                url: dfp_url,
                dataType: "html",
                headers: {"Accept-Language": "en-US,en;q=0.8", Accept: "*/*"},
                success: function (response, text_Status, _jqxhr) {
                    $("#search_audio_config_adiframe")[0].contentWindow.config = JSON.parse(response);
                    _processAudioConfig()
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    Util.logInConsole("ERROR");
                    Util.logInConsole("Error while loading config script.");
                    Util.logInConsole("error thrown. " + errorThrown);
                    Util.logInConsole("status. " + textStatus)
                }
            })
        }

        function _fetchVastConfig(query_str) {
            query_str = decodeURIComponent(query_str);
            query_str = query_str.replace(/;/g, "&");
            var base_url = "http://pubads.g.doubleclick.net/gampad/adx?iu=/6714/212.saavn";
            var targetting = "&t=" + encodeURIComponent(query_str);
            var ad_unit_qs = "&sz=1x1&tile=1&c=" + Math.random() * 1e16;
            var dfp_url = base_url + targetting + ad_unit_qs;
            $.ajax({
                url: dfp_url,
                dataType: "html",
                headers: {"Accept-Language": "en-US,en;q=0.8", Accept: "*/*"},
                success: function (response, text_Status, _jqxhr) {
                    $("#search_vast_config_adiframe")[0].contentWindow.config = JSON.parse(response);
                    _processVideoConfig()
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    Util.logInConsole("ERROR");
                    Util.logInConsole("Error while loading config script.");
                    Util.logInConsole("error thrown. " + errorThrown);
                    Util.logInConsole("status. " + textStatus)
                }
            })
        }

        function _fetchConfig(query_str) {
            query_str = decodeURIComponent(query_str);
            query_str = query_str.replace(/;/g, "&");
            var base_url = "http://pubads.g.doubleclick.net/gampad/adx?iu=/6714/212.saavn";
            var targetting = "&t=" + encodeURIComponent(query_str);
            var ad_unit_qs = "&sz=1x1&tile=1&c=" + Math.random() * 1e16;
            var dfp_url = base_url + targetting + ad_unit_qs;
            if (Util.getProStatus() == Util.PRO || Util.getProStatus() == Util.TRIAL) {
                $("#search_config_adiframe")[0].contentWindow.config = {
                    "slot-config": {
                        "campaign-id": "saavn-pro",
                        duration: 9999999999,
                        "display-config": {"rotation-time": 9999999999},
                        "skin-config": {
                            "skin-url": "http://s.saavn.com/ads/2014/pro/pro-static-mural.png",
                            "bg-color": "#f6f6f6"
                        },
                        "richmedia-config": {
                            enabled: "false",
                            "initial-duration": 9999999999,
                            type: "audio",
                            targeting: {cat: "saavn-pro"}
                        }
                    }
                };
                _processConfigIFrame("#search_config_adiframe")
            } else {
                $.ajax({
                    url: dfp_url,
                    dataType: "html",
                    headers: {"Accept-Language": "en-US,en;q=0.8", Accept: "*/*"},
                    success: function (response, text_Status, _jqxhr) {
                        $("#search_config_adiframe")[0].contentWindow.config = JSON.parse(response);
                        _processConfigIFrame("#search_config_adiframe")
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        Util.logInConsole("ERROR");
                        Util.logInConsole("Error while loading config script.");
                        Util.logInConsole("error thrown. " + errorThrown);
                        Util.logInConsole("status. " + textStatus)
                    }
                })
            }
        }

        function _fetchIdleScreenMarkup(qry_str) {
            qry_str = decodeURIComponent(qry_str);
            qry_str = qry_str.replace(/;/g, "&");
            var base_url = "http://pubads.g.doubleclick.net/gampad/adx?iu=/6714/212.saavn";
            var targetting = "&t=" + encodeURIComponent(qry_str);
            var ad_unit_qs = "&sz=1x1&tile=1&c=" + Math.random() * 1e16;
            var dfp_url = base_url + targetting + ad_unit_qs;
            this.idleAjaxObj = $.ajax({
                url: dfp_url,
                dataType: "html",
                headers: {"Accept-Language": "en-US,en;q=0.8", Accept: "*/*"},
                success: function (response, text_Status, _jqxhr) {
                    State.showIdleUnit(response);
                    Ads.adRotationDataReset(AdConstants.AdUnitIdleScreenAd);
                    AdRotation.fireLocked.idlescreen = false;
                    this.idleAjaxObj = null
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    Util.logInConsole("ERROR");
                    Util.logInConsole("Error while loading config script.");
                    Util.logInConsole("error thrown. " + errorThrown);
                    Util.logInConsole("status. " + textStatus);
                    Ads.adRotationDataReset(AdConstants.AdUnitIdleScreenAd);
                    Analytics.logAndSendEventToGA("ads:error_loading_idle_screen_markup");
                    AdRotation.fireLocked.idlescreen = false;
                    this.idleAjaxObj = null
                }
            })
        }

        this.killSlotRequests = function () {
            if (this.idleAjaxObj) {
                this.idleAjaxObj.abort()
            }
        };
        this.fireTimerEvent = function () {
            Ads.rotateSearchPageAds("page:timerevent")
        };
        function _processConfigIFrame(iFrameElementID) {
            if ($(iFrameElementID).get(0).contentWindow.config) {
                var configJsonObj = $(iFrameElementID).get(0).contentWindow.config;
                if (configJsonObj["slot-config"]) {
                    var attribute = "";
                    if (configJsonObj["slot-config"]["campaign-id"]) {
                        AdRotation.campaignId = configJsonObj["slot-config"]["campaign-id"]
                    }
                    if (configJsonObj["slot-config"]["duration"]) {
                        AdRotation.slotDuration = 1e3 * configJsonObj["slot-config"]["duration"]
                    } else {
                        AdRotation.slotDuration = AdConfig.slotDuration
                    }
                    if (configJsonObj["slot-config"]["display-config"]) {
                        if (configJsonObj["slot-config"]["display-config"]["rotation-time"]) {
                            AdRotation.adRotationTime = 1e3 * configJsonObj["slot-config"]["display-config"]["rotation-time"]
                        } else {
                            AdRotation.adRotationTime = AdConfig.adRotationTime
                        }
                        if (configJsonObj["slot-config"]["display-config"]["drawer-targeting"]) {
                            var drawer = configJsonObj["slot-config"]["display-config"]["drawer-targeting"];
                            AdRotation.customUnitQueryString = "";
                            for (attribute in drawer) {
                                AdRotation.customUnitQueryString += attribute + "=" + drawer[attribute] + ";"
                            }
                            AdRotation.customUnitQueryString += AdConfig.customUnitQueryString;
                            AdRotation.drawer_enable = true
                        } else {
                            AdRotation.drawer_enable = false
                        }
                        if (configJsonObj["slot-config"]["display-config"]["display-targeting"]) {
                            AdRotation.creative_position = "half_page";
                            var display = configJsonObj["slot-config"]["display-config"]["display-targeting"];
                            AdRotation.halfPageQueryString = "";
                            for (attribute in display) {
                                AdRotation.halfPageQueryString += attribute + "=" + display[attribute] + ";"
                            }
                            AdRotation.halfPageQueryString += AdConfig.halfPageQueryString
                        } else {
                            AdRotation.creative_position = "skin_only"
                        }
                        if (configJsonObj["slot-config"]["display-config"]["idle-targeting"]) {
                            var idle = configJsonObj["slot-config"]["display-config"]["idle-targeting"];
                            AdRotation.idleScreenQueryString = "";
                            for (attribute in idle) {
                                AdRotation.idleScreenQueryString += attribute + "=" + idle[attribute] + ";"
                            }
                            AdRotation.idleScreenQueryString += AdConfig.idleScreenQueryString;
                            AdRotation.idle_screen = true
                        } else {
                            AdRotation.idle_screen = false;
                            AdRotation.idleScreenQueryString = ""
                        }
                    }
                    if (configJsonObj["slot-config"]["skin-config"]) {
                        if (configJsonObj["slot-config"]["skin-config"]["skin-url"] && configJsonObj["slot-config"]["skin-config"]["bg-color"]) {
                            AdRotation.skinConfig = {
                                skin_url: configJsonObj["slot-config"]["skin-config"]["skin-url"],
                                bg_color: configJsonObj["slot-config"]["skin-config"]["bg-color"]
                            }
                        }
                        if (configJsonObj["slot-config"]["skin-config"].hotzone) {
                            if (configJsonObj["slot-config"]["skin-config"].hotzone.enabled) {
                                AdRotation.hotzone = configJsonObj["slot-config"]["skin-config"].hotzone
                            } else {
                                AdRotation.hotzone = false
                            }
                        } else {
                            AdRotation.hotzone = false
                        }
                        AdRotation.pin_bottom = false;
                        if (configJsonObj["slot-config"]["skin-config"]["pin-bottom"]) {
                            AdRotation.pin_bottom = configJsonObj["slot-config"]["skin-config"]["pin-bottom"]
                        }
                    }
                    AdRotation.audioad_enable = false;
                    AdRotation.videoad_enable = false;
                    if (configJsonObj["slot-config"]["richmedia-config"]) {
                        var richMediaConfig = configJsonObj["slot-config"]["richmedia-config"];
                        if (richMediaConfig.enabled && richMediaConfig.type) {
                            if (richMediaConfig["initial-duration"]) {
                                AdRotation.initialDuration = 1e3 * richMediaConfig["initial-duration"]
                            } else {
                                AdRotation.initialDuration = 12e4
                            }
                            var richmedia = richMediaConfig.targeting;
                            AdRotation.richMediaTargeting = "";
                            for (attribute in richmedia) {
                                AdRotation.richMediaTargeting += attribute + "=" + richmedia[attribute] + ";"
                            }
                            switch (richMediaConfig.type) {
                                case"audio":
                                    AdRotation.audioad_enable = true;
                                    if (richMediaConfig.targeting) {
                                        AdRotation.audioAdQueryString = AdRotation.richMediaTargeting + AdConfig.audioAdQueryString
                                    } else {
                                        AdRotation.audioAdQueryString = AdConfig.audioAdQueryString
                                    }
                                    break;
                                case"video":
                                    AdRotation.videoad_enable = true;
                                    if (richMediaConfig.targeting) {
                                        AdRotation.videoAdQueryString = AdRotation.richMediaTargeting + AdConfig.videoAdQueryString
                                    } else {
                                        AdRotation.videoAdQueryString = AdConfig.videoAdQueryString
                                    }
                                    break
                            }
                        }
                    }
                }
            } else {
                AdRotation.slotDuration = AdConfig.slotDuration;
                AdRotation.initialDuration = AdConfig.initialDuration;
                AdRotation.adRotationTime = AdConfig.adRotationTime;
                AdRotation.customUnitQueryString = AdConfig.customUnitQueryString;
                AdRotation.drawer_enable = true;
                AdRotation.creative_position = "half_page";
                AdRotation.halfPageQueryString = AdConfig.halfPageQueryString;
                AdRotation.idleScreenQueryString = AdConfig.idleScreenQueryString;
                AdRotation.idle_screen = true
            }
            Ads.adRotationDataReset(AdConstants.AdUnitConfigLoad);
            Ads.rotateSearchPageAds("page:load")
        }

        function _processAudioConfig() {
            if ($("#search_audio_config_adiframe").get(0).contentWindow.config) {
                AdRotation.audioAdConfig = $("#search_audio_config_adiframe").get(0).contentWindow.config;
                var adURL = AdRotation.audioAdConfig.url;
                var imageURL = AdRotation.audioAdConfig.albumArt;
                var mediaType = AdRotation.audioAdConfig.type;
                var trackUrl = AdRotation.audioAdConfig["track-url"];
                var trackType = AdRotation.audioAdConfig["track-type"];
                var trackSize = AdRotation.audioAdConfig["track-size"];
                if (trackUrl !== undefined) {
                    $("#search_track_adiframe")[0].contentWindow.location.replace(trackUrl)
                }
                var audioAdCompanionTargeting = "";
                if (AdRotation.audioAdConfig.companionAd) {
                    for (attribute in AdRotation.audioAdConfig.companionAd) {
                        audioAdCompanionTargeting += attribute + "=" + AdRotation.audioAdConfig.companionAd[attribute] + ";"
                    }
                    Ads.initializeDisplayCreatives("", audioAdCompanionTargeting)
                }
                var audio_ad_panel = '<div id="jwplayer_1" class="jp-player"></div>';
                $("#av-ad").append(audio_ad_panel);
                State.playAudioAd(imageURL);
                Analytics.logStats(["ev", "media_ad_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                document.getElementById("jwplayer_1").style.display = "none";
                jwplayer("jwplayer_1").setup({
                    file: adURL,
                    flashplayer: "http://static.saavncdn.com/jwplayer/jwplayer.flash.swf",
                    primary: "html5",
                    type: mediaType,
                    controls: false,
                    height: 0,
                    width: 0,
                    events: {
                        onComplete: function () {
                            State.removeAudioAdVeil();
                            jwplayer("jwplayer_1").remove();
                            $("#av-ad").empty();
                            Analytics.logAndSendEventToGA("adplayer:mediaend");
                            Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                        }, onError: function () {
                            State.removeAudioAdVeil();
                            jwplayer("jwplayer_1").remove();
                            $("#av-ad").empty();
                            Analytics.logAndSendEventToGA("adplayer:mediaend");
                            Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                        }, onTime: function (event) {
                            currentTime = Math.floor(event.position);
                            duration = Math.floor(event.duration);
                            $("#audio-ad-countdown").html(" " + (duration - currentTime) + " seconds...")
                        }
                    }
                });
                jwplayer("jwplayer_1").setVolume(jPlayer_volume);
                jwplayer("jwplayer_1").play();
                Ads.adRotationDataReset(AdConstants.AdUnitRichMediaAd)
            } else {
                State.removeAudioAdVeil();
                Analytics.logAndSendEventToGA("adplayer:mediaend")
            }
        }

        function _processVideoConfig() {
            if ($("#search_vast_config_adiframe").get(0).contentWindow.config) {
                AdRotation.videoAdConfig = $("#search_vast_config_adiframe").get(0).contentWindow.config;
                var vast_tag = AdRotation.videoAdConfig.url;
                var video_ad_panel = '<div id="video-ad-panel" class="cpanel">' + '	<div class="cpanel-content center video-ad companion-ad clr">' + '		<div class="av-ad-2">' + '			<div class="av-ad-wrap">' + '				<div id="jwplayer_2" class="jp-jplayer"></div>' + "			</div>" + "		</div>" + '		<div id="av-ad-companion">' + '			<p id="av-ad-fill">This Saavn session brought to you by</p>' + "		</div>" + "	</div>" + '  <button id="panel-close" class="hide">Close</button>' + "</div>";
                var ad_obj = null;
                if (typeof AdRotation.videoAdConfig["skip-enabled"] != "undefined" && AdRotation.videoAdConfig["skip-enabled"]) {
                    var skip_after = null;
                    if (typeof AdRotation.videoAdConfig["skip-duration"] != "undefined" && AdRotation.videoAdConfig["skip-duration"]) {
                        skip_after = AdRotation.videoAdConfig["skip-duration"]
                    } else {
                        skip_after = 15
                    }
                    ad_obj = {
                        client: "vast",
                        tag: vast_tag,
                        companiondiv: {id: "av-ad-companion", width: 300, height: 250},
                        admessage: "Your music will continue in XX seconds.",
                        skipoffset: skip_after
                    }
                } else {
                    ad_obj = {
                        client: "vast",
                        tag: vast_tag,
                        admessage: "Your music will continue in XX seconds.",
                        companiondiv: {id: "av-ad-companion", width: 300, height: 250}
                    }
                }
                State.removeIdleUnit();
                Analytics.logStats(["ev", "media_ad_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                $("body").append(video_ad_panel);
                State.playVideoAd(true);
                var close_after = 15;
                if (typeof AdRotation.videoAdConfig["skip-enabled"] != "undefined" && AdRotation.videoAdConfig["skip-enabled"]) {
                    if (typeof AdRotation.videoAdConfig["skip-duration"] != "undefined" && AdRotation.videoAdConfig["skip-duration"]) {
                        close_after = AdRotation.videoAdConfig["skip-duration"]
                    }
                }
                setTimeout(function () {
                    Util.logInConsole("Close timeout fired");
                    $("#panel-close").removeClass("hide");
                    $("#panel-close").addClass("show");
                    $("#panel-close").bind("click", function () {
                        if (jwplayer("jwplayer_2").remove) {
                            Util.logInConsole("OnComplete fired");
                            jwplayer("jwplayer_2").remove();
                            State.endingVideoAd();
                            $("#video-ad-panel").remove();
                            Analytics.logAndSendEventToGA("adplayer:mediaend");
                            Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                        }
                    })
                }, close_after * 1e3);
                jwplayer("jwplayer_2").setup({
                    file: "http://s.saavn.com/ads/SaavnBump.mp4",
                    flashplayer: "http://static.saavncdn.com/jwplayer/jwplayer.flash.swf",
                    primary: "flash",
                    controls: true,
                    autostart: true,
                    advertising: ad_obj,
                    events: {
                        onComplete: function () {
                            if (jwplayer("jwplayer_2").remove) {
                                Util.logInConsole("OnComplete fired");
                                jwplayer("jwplayer_2").remove();
                                State.endingVideoAd();
                                $("#video-ad-panel").remove();
                                Analytics.logAndSendEventToGA("adplayer:mediaend");
                                Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }
                        }, onAdComplete: function (obj) {
                            setTimeout(function () {
                                if (jwplayer("jwplayer_2").remove) {
                                    Util.logInConsole("AdComplete fired");
                                    jwplayer("jwplayer_2").remove();
                                    State.endingVideoAd();
                                    $("#video-ad-panel").remove();
                                    Analytics.logAndSendEventToGA("adplayer:mediaend");
                                    Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                }
                            }, 3e3)
                        }, onError: function () {
                            Util.logInConsole("OnError fired");
                            if (jwplayer("jwplayer_2").remove) {
                                jwplayer("jwplayer_2").remove();
                                State.endingVideoAd();
                                $("#video-ad-panel").remove();
                                Analytics.logAndSendEventToGA("adplayer:mediaend");
                                Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }
                        }
                    }
                });
                jwplayer("jwplayer_2").setVolume(jPlayer_volume);
                Ads.adRotationDataReset(AdConstants.AdUnitRichMediaAd)
            } else {
                State.endingVideoAd();
                Analytics.logAndSendEventToGA("adplayer:mediaend")
            }
        }

        this.init = function () {
            $("#search_config_adiframe").unbind("load");
            $("#search_config_adiframe").bind("load", function () {
                _processConfigIFrame("#search_config_adiframe")
            });
            var search_audio_config_fn = function () {
                if ($("#search_audio_config_adiframe")[0].contentWindow.location.href == "about:blank") {
                    return
                }
                if ($("#search_audio_config_adiframe").get(0).contentWindow.config) {
                    AdRotation.audioAdConfig = $("#search_audio_config_adiframe").get(0).contentWindow.config;
                    var adURL = AdRotation.audioAdConfig.url;
                    var imageURL = AdRotation.audioAdConfig.albumArt;
                    var mediaType = AdRotation.audioAdConfig.type;
                    var trackUrl = AdRotation.audioAdConfig["track-url"];
                    var trackType = AdRotation.audioAdConfig["track-type"];
                    var trackSize = AdRotation.audioAdConfig["track-size"];
                    if (trackUrl !== undefined) {
                        $("#search_track_adiframe")[0].contentWindow.location.replace(trackUrl)
                    }
                    var audioAdCompanionTargeting = "";
                    if (AdRotation.audioAdConfig.companionAd) {
                        for (attribute in AdRotation.audioAdConfig.companionAd) {
                            audioAdCompanionTargeting += attribute + "=" + AdRotation.audioAdConfig.companionAd[attribute] + ";"
                        }
                        Ads.initializeDisplayCreatives("", audioAdCompanionTargeting)
                    }
                    var audio_ad_panel = '<div id="jwplayer_1" class="jp-player"></div>';
                    $("#av-ad").append(audio_ad_panel);
                    State.playAudioAd(imageURL);
                    Analytics.logStats(["ev", "media_ad_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                    document.getElementById("jwplayer_1").style.display = "none";
                    jwplayer("jwplayer_1").setup({
                        file: adURL,
                        flashplayer: "http://static.saavncdn.com/jwplayer/jwplayer.flash.swf",
                        primary: "html5",
                        type: mediaType,
                        controls: false,
                        height: 0,
                        width: 0,
                        events: {
                            onComplete: function () {
                                State.removeAudioAdVeil();
                                jwplayer("jwplayer_1").remove();
                                $("#av-ad").empty();
                                Analytics.logAndSendEventToGA("adplayer:mediaend");
                                Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }, onError: function () {
                                State.removeAudioAdVeil();
                                jwplayer("jwplayer_1").remove();
                                $("#av-ad").empty();
                                Analytics.logAndSendEventToGA("adplayer:mediaend");
                                Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }, onTime: function (event) {
                                currentTime = Math.floor(event.position);
                                duration = Math.floor(event.duration);
                                $("#audio-ad-countdown").html(" " + (duration - currentTime) + " seconds...")
                            }
                        }
                    });
                    jwplayer("jwplayer_1").setVolume(jPlayer_volume);
                    jwplayer("jwplayer_1").play();
                    Ads.adRotationDataReset(AdConstants.AdUnitRichMediaAd)
                } else {
                    State.removeAudioAdVeil();
                    Analytics.logAndSendEventToGA("adplayer:mediaend")
                }
            };
            $("#search_audio_config_adiframe").unbind("load");
            $("#search_audio_config_adiframe").bind("load", search_audio_config_fn);
            $("#search_vast_config_adiframe").unbind("load");
            $("#search_vast_config_adiframe").bind("load", function () {
                if ($("#search_vast_config_adiframe")[0].contentWindow.location.href == "about:blank") {
                    return
                }
                if ($("#search_vast_config_adiframe").get(0).contentWindow.config) {
                    AdRotation.videoAdConfig = $("#search_vast_config_adiframe").get(0).contentWindow.config;
                    var vast_tag = AdRotation.videoAdConfig.url;
                    var video_ad_panel = '<div id="video-ad-panel" class="cpanel">' + '	<div class="cpanel-content center video-ad companion-ad clr">' + '		<div class="av-ad-2">' + '			<div class="av-ad-wrap">' + '				<div id="jwplayer_2" class="jp-jplayer"></div>' + "			</div>" + "		</div>" + '		<div id="av-ad-companion">' + '			<p id="av-ad-fill">This Saavn session brought to you by</p>' + "		</div>" + "	</div>" + '  <button id="panel-close" class="hide">Close</button>' + "</div>";
                    var ad_obj = null;
                    if (typeof AdRotation.videoAdConfig["skip-enabled"] != "undefined" && AdRotation.videoAdConfig["skip-enabled"]) {
                        var skip_after = null;
                        if (typeof AdRotation.videoAdConfig["skip-duration"] != "undefined" && AdRotation.videoAdConfig["skip-duration"]) {
                            skip_after = AdRotation.videoAdConfig["skip-duration"]
                        } else {
                            skip_after = 15
                        }
                        ad_obj = {
                            client: "vast",
                            tag: vast_tag,
                            companiondiv: {id: "av-ad-companion", width: 300, height: 250},
                            admessage: "Your music will continue in XX seconds.",
                            skipoffset: skip_after
                        }
                    } else {
                        ad_obj = {
                            client: "vast",
                            tag: vast_tag,
                            admessage: "Your music will continue in XX seconds.",
                            companiondiv: {id: "av-ad-companion", width: 300, height: 250}
                        }
                    }
                    State.removeIdleUnit();
                    Analytics.logStats(["ev", "media_ad_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                    $("body").append(video_ad_panel);
                    State.playVideoAd(true);
                    var close_after = 15;
                    if (typeof AdRotation.videoAdConfig["skip-enabled"] != "undefined" && AdRotation.videoAdConfig["skip-enabled"]) {
                        if (typeof AdRotation.videoAdConfig["skip-duration"] != "undefined" && AdRotation.videoAdConfig["skip-duration"]) {
                            close_after = AdRotation.videoAdConfig["skip-duration"]
                        }
                    }
                    setTimeout(function () {
                        Util.logInConsole("Close timeout fired");
                        $("#panel-close").removeClass("hide");
                        $("#panel-close").addClass("show");
                        $("#panel-close").bind("click", function () {
                            if (jwplayer("jwplayer_2").remove) {
                                Util.logInConsole("OnComplete fired");
                                jwplayer("jwplayer_2").remove();
                                State.endingVideoAd();
                                $("#video-ad-panel").remove();
                                Analytics.logAndSendEventToGA("adplayer:mediaend");
                                Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }
                        })
                    }, close_after * 1e3);
                    jwplayer("jwplayer_2").setup({
                        file: "http://s.saavn.com/ads/SaavnBump.mp4",
                        flashplayer: "http://static.saavncdn.com/jwplayer/jwplayer.flash.swf",
                        primary: "flash",
                        controls: true,
                        autostart: true,
                        advertising: ad_obj,
                        events: {
                            onComplete: function () {
                                if (jwplayer("jwplayer_2").remove) {
                                    Util.logInConsole("OnComplete fired");
                                    jwplayer("jwplayer_2").remove();
                                    State.endingVideoAd();
                                    $("#video-ad-panel").remove();
                                    Analytics.logAndSendEventToGA("adplayer:mediaend");
                                    Analytics.logStats(["ev", "media_ad_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                }
                            }, onAdComplete: function (obj) {
                                setTimeout(function () {
                                    if (jwplayer("jwplayer_2").remove) {
                                        Util.logInConsole("AdComplete fired");
                                        jwplayer("jwplayer_2").remove();
                                        State.endingVideoAd();
                                        $("#video-ad-panel").remove();
                                        Analytics.logAndSendEventToGA("adplayer:mediaend");
                                        Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                    }
                                }, 3e3)
                            }, onError: function () {
                                Util.logInConsole("OnError fired");
                                if (jwplayer("jwplayer_2").remove) {
                                    jwplayer("jwplayer_2").remove();
                                    State.endingVideoAd();
                                    $("#video-ad-panel").remove();
                                    Analytics.logAndSendEventToGA("adplayer:mediaend");
                                    Analytics.logStats(["ev", "media_ad_error", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                }
                            }
                        }
                    });
                    jwplayer("jwplayer_2").setVolume(jPlayer_volume);
                    Ads.adRotationDataReset(AdConstants.AdUnitRichMediaAd)
                } else {
                    State.endingVideoAd();
                    Analytics.logAndSendEventToGA("adplayer:mediaend")
                }
            });
            $("#searchpage_adiframe").unbind("load");
            $("#searchpage_adiframe").bind("load", function () {
                if (Ads.getAdRotationData()[AdConstants.AdUnitMedRec][AdConstants.TimeLastRotation] >= Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.TimeLastRotation]) {
                    $(".ad.media").removeClass("hide");
                    AdRotation.sizeAdFrame($("#searchpage_adiframe"));
                    Ads.adRotationDataReset(AdConstants.AdUnitMedRec)
                }
            });
            $("#searchhalfpage_adiframe").unbind("load");
            $("#searchhalfpage_adiframe").bind("load", function () {
                if (Ads.getAdRotationData()[AdConstants.AdUnitHalfPage][AdConstants.TimeLastRotation] >= Ads.getAdRotationData()[AdConstants.AdUnitConfigLoad][AdConstants.TimeLastRotation]) {
                    $(".ad.half-page").removeClass("hide");
                    AdRotation.sizeAdFrame($("#searchhalfpage_adiframe"));
                    Ads.adRotationDataReset(AdConstants.AdUnitHalfPage)
                }
                AdRotation.fireLocked.halfpage = false
            });
            $("#searchpage_custom_adiframe").unbind("load");
            $("#searchpage_custom_adiframe").bind("load", function () {
                Ads.adRotationDataReset(AdConstants.AdUnitCustomUnit);
                AdRotation.fireLocked.drawer = false
            });
            page_initialized = true;
            var songDetails = State.getAdContext();
            var tqStr = AdUtil.getTargetQueryStr(songDetails);
            var campaignStr = AdUtil.getCampaignStr();
            _fetchConfig(campaignStr + AdConfig.configUnitQueryString + tqStr);
            $("body").unbind("click").click(function (e) {
                Ads.getAdRotationData()[AdConstants.TimeOfInactivity] = Util.getCurrentTime()
            });
            $("body").unbind("keypress").keypress(function (e) {
                Ads.getAdRotationData()[AdConstants.TimeOfInactivity] = Util.getCurrentTime()
            });
            AdRotation.timerInterval = setInterval(function () {
                AdRotation.fireTimerEvent()
            }, 1e3)
        }
    };
var Ads = Ads || new function () {
        var adrotationData = new Array;
        var current_time = Util.getCurrentTime();
        adrotationData[AdConstants.TimePlayed] = 0;
        adrotationData[AdConstants.NumberOfSongs] = 0;
        adrotationData[AdConstants.SlotTimeConsumed] = 0;
        adrotationData[AdConstants.TimeOfPlayStart] = current_time;
        adrotationData[AdConstants.TimeOfPlayStop] = current_time;
        adrotationData[AdConstants.TimeOfInactivity] = current_time;
        adrotationData[AdConstants.TimeOfInitialDurationStart] = current_time;
        adrotationData[AdConstants.TimeOfConsumptionStart] = current_time;
        adrotationData[AdConstants.AdUnitConfigLoad] = new Array;
        adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count] = 0;
        adrotationData[AdConstants.AdUnitMedRec] = new Array;
        adrotationData[AdConstants.AdUnitMedRec][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitMedRec][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitSkin] = new Array;
        adrotationData[AdConstants.AdUnitSkin][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitSkin][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitHalfPage] = new Array;
        adrotationData[AdConstants.AdUnitHalfPage][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitHalfPage][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitCustomUnit] = new Array;
        adrotationData[AdConstants.AdUnitCustomUnit][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitCustomUnit][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitRichMediaAd] = new Array;
        adrotationData[AdConstants.AdUnitRichMediaAd][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitRichMediaAd][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitIdleScreenAd] = new Array;
        adrotationData[AdConstants.AdUnitIdleScreenAd][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitIdleScreenAd][AdConstants.NumberOfSongsSinceRotn] = 0;
        adrotationData[AdConstants.AdUnitNone] = new Array;
        adrotationData[AdConstants.AdUnitNone][AdConstants.TimeLastRotation] = current_time;
        adrotationData[AdConstants.AdUnitNone][AdConstants.NumberOfSongsSinceRotn] = 0;
        this.adState = AdConstants.adState.INITIAL_LOAD;
        this.accumulateFlag = false;
        this.adBlockDetected = false;
        this.rotateSearchPageAds = function (eventName, params) {
            if (typeof AdConstants.getEventGroup(eventName) == "undefined") {
                return
            }
            if (this.adBlockDetected) {
                Interface.showSiteNotice("You seem to have Adblock installed. Please disable it to enjoy your music without interruption.")
            }
            this.adRotationDataUpdate(eventName);
            var group = AdConstants.getEventGroup(eventName);
            var current_time = Util.getCurrentTime();
            switch (this.adState) {
                case AdConstants.adState.INITIAL_LOAD:
                    switch (group) {
                        case AdConstants.TYPE_PAGE_ACTION:
                            this.initializeDisplayCreatives(eventName);
                            Analytics.logStats(["ev", "slot_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                            break;
                        case AdConstants.TYPE_PLAYER_CHANGE:
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            if (this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            if (eventName == "site:player:mediaready" || eventName == "site:player:radio:mediaready") {
                                if (this.adBlockDetected) {
                                    break
                                }
                                if ($("#search_config_adiframe").get(0).contentWindow.config) {
                                    if (AdRotation.audioad_enable || AdRotation.videoad_enable) {
                                        this.adState = AdConstants.adState.INITIAL_DURATION;
                                        adrotationData[AdConstants.TimeOfInitialDurationStart] = current_time;
                                        Analytics.logStats(["ev", "initial_duration_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                    } else {
                                        this.adState = AdConstants.adState.IN_SLOT;
                                        adrotationData[AdConstants.TimeOfConsumptionStart] = current_time;
                                        adrotationData[AdConstants.TimeOfInitialDurationStart] = -1;
                                        Analytics.logStats(["ev", "slot_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                    }
                                } else {
                                    this.adState = AdConstants.adState.INITIAL_DURATION;
                                    adrotationData[AdConstants.TimeOfInitialDurationStart] = current_time
                                }
                                Player.streamSong()
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            if (this.idleTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitIdleScreenAd, AdRotation.idleScreenQueryString)
                            }
                            break
                    }
                    break;
                case AdConstants.adState.INITIAL_DURATION:
                    switch (group) {
                        case AdConstants.TYPE_PLAYER_CHANGE:
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            if (!Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            if (eventName == "site:player:mediaready" || eventName == "site:player:radio:mediaready") {
                                Player.streamSong()
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_PAGE_ACTION:
                            this.initializeDisplayCreatives(eventName);
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            if (Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            if (this.idleTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitIdleScreenAd, AdRotation.idleScreenQueryString)
                            }
                            if (this.initialDurationExpired(current_time)) {
                                this.adState = AdConstants.adState.INITIAL_SPILLAGE;
                                Analytics.logStats(["ev", "initial_duration_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }
                            break
                    }
                    break;
                case AdConstants.adState.INITIAL_SPILLAGE:
                    switch (group) {
                        case AdConstants.TYPE_PLAYER_CHANGE:
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            if (!Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            if (eventName == "site:player:mediaready" || eventName == "site:player:radio:mediaready") {
                                if (this.idleTimerExpired(current_time)) {
                                    State.removeIdleUnit()
                                }
                                if (AdRotation.audioad_enable) {
                                    this.adState = AdConstants.adState.RICH_MEDIA_PLAYING;
                                    AdRotation.adUnitRotate(eventName, AdConstants.AdUnitRichMediaAd, AdRotation.audioAdQueryString)
                                } else if (AdRotation.videoad_enable) {
                                    this.adState = AdConstants.adState.RICH_MEDIA_PLAYING;
                                    AdRotation.adUnitRotate(eventName, AdConstants.AdUnitRichMediaAd, AdRotation.videoAdQueryString)
                                } else {
                                    if (this.idleTimerExpired(current_time)) {
                                        State.removeIdleUnit()
                                    }
                                    AdRotation.killSlotRequests();
                                    AdRotation.adUnitRotate(eventName, AdConstants.AdUnitConfigLoad, AdConfig.configUnitQueryString)
                                }
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_PAGE_ACTION:
                            this.initializeDisplayCreatives(eventName);
                            if (!$("#search_config_adiframe").get(0).contentWindow.config) {
                                this.adState = AdConstants.adState.IN_SLOT;
                                Analytics.logStats(["ev", "slot_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                                adrotationData[AdConstants.SlotTimeConsumed] = 0;
                                Player.streamSong()
                            }
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            if (this.idleTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitIdleScreenAd, AdRotation.idleScreenQueryString)
                            }
                            if (Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break
                    }
                    break;
                case AdConstants.adState.RICH_MEDIA_PLAYING:
                    switch (group) {
                        case AdConstants.TYPE_PLAYER_CHANGE:
                            break;
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_PAGE_ACTION:
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            adrotationData[AdConstants.SlotTimeConsumed] = 0;
                            this.adState = AdConstants.adState.IN_SLOT;
                            if (adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.NumberOfSongsSinceRotn] == 0) {
                                adrotationData[AdConstants.TimeOfConsumptionStart] = current_time;
                                if (adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count] != 1) {
                                    Analytics.logStats(["ev", "slot_begin", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                                }
                            }
                            Player.streamSong();
                            this.initializeDisplayCreatives(eventName);
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            break
                    }
                    break;
                case AdConstants.adState.IN_SLOT:
                    switch (group) {
                        case AdConstants.TYPE_PLAYER_CHANGE:
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            if (!Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            if (eventName == "site:player:mediaready" || eventName == "site:player:radio:mediaready") {
                                Player.streamSong()
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_PAGE_ACTION:
                            this.initializeDisplayCreatives(eventName);
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            if (Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            if (this.consumptionClockExpired(current_time)) {
                                this.adState = AdConstants.adState.IN_SPILLAGE;
                                Analytics.logStats(["ev", "consumption_clock_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]])
                            }
                            if (this.idleTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitIdleScreenAd, AdRotation.idleScreenQueryString)
                            }
                            break
                    }
                    break;
                case AdConstants.adState.IN_SPILLAGE:
                    switch (group) {
                        case AdConstants.TYPE_PLAYER_CHANGE:
                        case AdConstants.TYPE_CONTENT_CHANGE:
                            if (!Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_CHANGE:
                            if (eventName == "site:player:mediaready" || eventName == "site:player:radio:mediaready") {
                                if (this.idleTimerExpired(current_time)) {
                                    State.removeIdleUnit()
                                }
                                Analytics.logStats(["ev", "slot_end", "CAT_ID", AdRotation.campaignId, "Consumption_Duration", AdRotation.slotDuration, "Initial_Duration", AdRotation.initialDuration, "Slot_Seq_Num", adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count]]);
                                AdRotation.killSlotRequests();
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitConfigLoad, AdConfig.configUnitQueryString)
                            }
                            break;
                        case AdConstants.TYPE_MEDIA_PROGRESS:
                            break;
                        case AdConstants.TYPE_USER_ACTION:
                            break;
                        case AdConstants.TYPE_PAGE_ACTION:
                            if (AdRotation.audioad_enable) {
                                this.adState = AdConstants.adState.RICH_MEDIA_PLAYING;
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitRichMediaAd, AdRotation.audioAdQueryString)
                            } else if (AdRotation.videoad_enable) {
                                this.adState = AdConstants.adState.RICH_MEDIA_PLAYING;
                                this.initializeDisplayCreatives(eventName);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitRichMediaAd, AdRotation.videoAdQueryString)
                            } else {
                                this.adState = AdConstants.adState.IN_SLOT;
                                adrotationData[AdConstants.SlotTimeConsumed] = 0;
                                this.initializeDisplayCreatives(eventName);
                                Player.streamSong()
                            }
                            break;
                        case AdConstants.TYPE_ADMEDIA_CHANGE:
                            break;
                        case AdConstants.TYPE_RADIO_PLAYER:
                            break;
                        case AdConstants.TYPE_USAGE_GROUP:
                            if (Player.isPlayerPlaying() && this.refreshTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
                            }
                            if (this.idleTimerExpired(current_time)) {
                                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitIdleScreenAd, AdRotation.idleScreenQueryString)
                            }
                            break
                    }
                    break
            }
        };
        this.accumulateStreamingTime = function (current_time) {
            adrotationData[AdConstants.TimePlayed] += current_time - adrotationData[AdConstants.TimeOfPlayStart];
            adrotationData[AdConstants.SlotTimeConsumed] += current_time - adrotationData[AdConstants.TimeOfPlayStart]
        };
        this.initializeDisplayCreatives = function (eventName, displayTargeting) {
            AdRotation.fireLocked.halfpage = false;
            AdRotation.fireLocked.drawer = false;
            adrotationData[AdConstants.AdUnitHalfPage][AdConstants.TimeLastRotation] = current_time;
            adrotationData[AdConstants.AdUnitCustomUnit][AdConstants.TimeLastRotation] = current_time;
            adrotationData[AdConstants.AdUnitSkin][AdConstants.TimeLastRotation] = current_time;
            if (displayTargeting) {
                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, displayTargeting + AdConfig.halfPageQueryString);
                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, displayTargeting + AdConfig.customUnitQueryString)
            } else {
                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitHalfPage, AdRotation.halfPageQueryString);
                AdRotation.adUnitRotate(eventName, AdConstants.AdUnitCustomUnit, AdRotation.customUnitQueryString)
            }
            AdRotation.adUnitRotate(eventName, AdConstants.AdUnitSkin)
        };
        this.adRotationDataUpdate = function (eventName) {
            current_time = Util.getCurrentTime();
            switch (eventName) {
                case"site:player:mediaend":
                case"site:player:radio:mediaend":
                case"site:player:mediaunload":
                case"site:player:radio:mediaunload":
                    adrotationData[AdConstants.NumberOfSongs] += 1;
                    adrotationData[AdConstants.AdUnitCustomUnit][AdConstants.NumberOfSongsSinceRotn] += 1;
                    adrotationData[AdConstants.AdUnitHalfPage][AdConstants.NumberOfSongsSinceRotn] += 1;
                    adrotationData[AdConstants.AdUnitMedRec][AdConstants.NumberOfSongsSinceRotn] += 1;
                    adrotationData[AdConstants.AdUnitSkin][AdConstants.NumberOfSongsSinceRotn] += 1;
                    adrotationData[AdConstants.AdUnitIdleScreenAd][AdConstants.NumberOfSongsSinceRotn] += 1;
                    adrotationData[AdConstants.AdUnitRichMediaAd][AdConstants.NumberOfSongsSinceRotn] += 1;
                    if (this.accumulateFlag) {
                        this.accumulateStreamingTime(current_time);
                        this.accumulateFlag = false;
                        adrotationData[AdConstants.TimeOfPlayStop] = current_time
                    }
                    break;
                case"site:player:mediapaused":
                case"site:player:radio:mediapaused":
                    if (this.accumulateFlag) {
                        this.accumulateStreamingTime(current_time);
                        this.accumulateFlag = false;
                        adrotationData[AdConstants.TimeOfPlayStop] = current_time
                    }
                    break;
                case"site:player:mediaresumed":
                case"site:player:radio:mediaresumed":
                case"site:player:mediaopened":
                case"site:player:radio:mediaopened":
                    adrotationData[AdConstants.TimeOfPlayStart] = current_time;
                    this.accumulateFlag = true;
                    break;
                case"page:load":
                    adrotationData[AdConstants.AdUnitConfigLoad][AdConstants.Count] += 1;
                    break
            }
        };
        this.idleTimerExpired = function (current_time) {
            return current_time - adrotationData[AdConstants.TimeOfInactivity] > AdConfig.idleScreenTime
        };
        this.consumptionClockExpired = function (current_time) {
            if (this.adState == AdConstants.adState.IN_SLOT) {
                if (adrotationData[AdConstants.TimeOfPlayStart] > adrotationData[AdConstants.TimeOfConsumptionStart]) {
                    var playerState = Player.getState().state;
                    if (playerState == "ready" || playerState == "paused" || playerState == "end" || Player.isPlayerDisabled() || adrotationData[AdConstants.TimeOfPlayStart] < adrotationData[AdConstants.TimeOfPlayStop]) {
                        return adrotationData[AdConstants.SlotTimeConsumed] > AdRotation.slotDuration
                    } else {
                        return adrotationData[AdConstants.SlotTimeConsumed] + (current_time - adrotationData[AdConstants.TimeOfPlayStart]) > AdRotation.slotDuration
                    }
                } else {
                    return false
                }
            } else {
                return true
            }
        };
        this.initialDurationExpired = function (current_time) {
            if (this.adState == AdConstants.adState.INITIAL_DURATION) {
                if (adrotationData[AdConstants.TimeOfPlayStart] > adrotationData[AdConstants.TimeOfInitialDurationStart]) {
                    var playerState = Player.getState().state;
                    if (playerState == "ready" || playerState == "paused" || playerState == "end" || Player.isPlayerDisabled() || adrotationData[AdConstants.TimeOfPlayStart] < adrotationData[AdConstants.TimeOfPlayStop]) {
                        return adrotationData[AdConstants.SlotTimeConsumed] > AdRotation.initialDuration
                    } else {
                        return adrotationData[AdConstants.SlotTimeConsumed] + (current_time - adrotationData[AdConstants.TimeOfPlayStart]) > AdRotation.initialDuration
                    }
                } else {
                    return false
                }
            } else {
                return true
            }
        };
        this.refreshTimerExpired = function (current_time) {
            return current_time - adrotationData[AdConstants.AdUnitCustomUnit][AdConstants.TimeLastRotation] > AdRotation.adRotationTime
        };
        this.adRotationDataReset = function (adUnit) {
            var current_time = Util.getCurrentTime();
            adrotationData[adUnit][AdConstants.TimeLastRotation] = current_time;
            adrotationData[adUnit][AdConstants.NumberOfSongsSinceRotn] = 0
        };
        this.checkForAdBlock = function () {
            try {
                var checkAdBlock = typeof $("#search_config_adiframe").get(0).contentWindow.config
            } catch (err) {
                if (err.code == 18) {
                    this.adBlockDetected = true
                }
            }
        };
        this.adSetCookie = function (eventName, params) {
            var current_ts = (new Date).getTime();
            var campaignsPlayTime = unescape(Util.getCookie(params[0]));
            var previous_play_ts = "";
            delimiter = "";
            found = false;
            if (campaignsPlayTime != "") {
                cpt_array = campaignsPlayTime.split("|");
                campaignsPlayTime = "";
                for (var i = 0; i < cpt_array.length; i++) {
                    campaign_details = cpt_array[i].split(":");
                    if (campaign_details[0] == params[1]) {
                        campaignsPlayTime += delimiter + campaign_details[0] + ":" + current_ts;
                        found = true
                    } else {
                        campaignsPlayTime = campaignsPlayTime + delimiter + cpt_array[i]
                    }
                    delimiter = "|"
                }
            }
            if (!found) {
                campaignsPlayTime += delimiter + params[1] + ":" + current_ts
            }
            Util.setCookie(params[0], campaignsPlayTime)
        };
        this.adCheckCookie = function (eventName, params) {
            var campaignsPlayTime = unescape(Util.getCookie(params[0]));
            var previous_play_ts = "";
            cpt_array = campaignsPlayTime.split("|");
            for (var i = 0; i < cpt_array.length; i++) {
                campaign_details = cpt_array[i].split(":");
                if (campaign_details[0] == params[1]) {
                    previous_play_ts = campaign_details[1];
                    break
                }
            }
            previous_play_ts = previous_play_ts == "" ? 0 : parseInt(previous_play_ts);
            var play_time = new Date(previous_play_ts);
            var startOfDay = new Date;
            startOfDay.setHours(0, 0, 0, 0);
            if (play_time < startOfDay) {
                return true
            }
            return false
        };
        this.adJSVar = function (eventName, params) {
            var retValue = window[params[0]];
            var i = 1;
            for (i = 1; i < params.length - 1; i++) {
                retValue = retValue[params[i]]
            }
            return retValue == params[i]
        };
        this.getAdRotationData = function () {
            return adrotationData
        }
    };
var Playlist = Playlist || new function () {
        this.getPlaylistElement = function (data) {
            var html = "";
            var listid = $(data).find("listid").text();
            var encryptedListId = $(data).find("encryptedListId").text();
            var listname = $(data).find("listname").text();
            var sanitizedListName = listname.replace(" ", "_");
            var imageUrl = $(data).find("image").text();
            var count = $(data).find("numsongs").text();
            var language = $(data).find("language").text();
            var albumURL = "/s/featured-playlists/" + language + "/" + sanitizedListName + "/" + encryptedListId;
            var albumPlayURL = "/p/featured-playlists/" + language + "/" + sanitizedListName + "/" + encryptedListId;
            var logEvent = "['content:featured-playlists:view:" + listname + "','listid','" + listid + "']";
            var playOnClick = "State.autoLoadPostContentFetch(true);Util.logAndGoToUrl(['content:featured-playlists:click:$name','listid','" + listid + "'], '" + albumPlayURL + "');return false;";
            var html = '<div class="art album-art playlist-art">' + '<a href="' + albumURL + "\" onclick=\"Util.logAndGoToUrl('','" + albumURL + "');return false;\">" + '<img src="' + imageUrl + '" alt="' + listname + '">' + '<div class="overlay-actions">' + '<div class="overlay-action-buttons">' + '<button class="play" onclick="' + playOnClick + '" href="' + albumPlayURL + '">Play Now</button>' + "</div>" + "</div>" + "</a>" + "</div>" + '<h3 class="title ellip"><a href="' + albumURL + '" onclick="Util.logAndGoToUrl(' + logEvent + ",'" + albumURL + "');return false;\">" + listname + "</a></h3>" + '<p class="meta">' + count + " songs</p>";
            return html
        };
        this.overwrite_playlist = function (e) {
            if (State.currentPlaylist == State.NO_PLAYLIST) {
                alert("No playlist has been selected");
                return
            }
            var playlist = escape(serialize_current_songs());
            var url = "/api.php?__call=playlist.save";
            var postData = {_marker: 0, listid: State.currentPlaylist, contents: playlist};
            Util.call(url, this.savePlaylistCallback, postData, true)
        };
        this.addToPlaylist = function (listid, songString, sourceListId) {
            Analytics.logAndSendEventToGA("playlist:existing:save");
            if (sourceListId != undefined) {
                var url = "/api.php?__call=playlist.copyPlaylist";
                var postData = {_marker: 0, destListId: listid, srcListId: sourceListId}
            } else {
                var url = "/api.php?__call=playlist.add";
                var postData = {_marker: 0, listid: listid, contents: songString}
            }
            Util.call(url, this.savePlaylistCallback, postData, true)
        };
        this.addToPlaylistCallback = function (o, status) {
            if (status == Util.SUCCESS) {
                if (State.POST_SAVE_CLEAR_QUEUE == true) {
                    State.playerState = State.PLAYER_CLEAN;
                    State.POST_SAVE_CLEAR_QUEUE = false;
                    State.setUnsavedQueue(false)
                }
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    State.showError(error[0].getAttribute("msg"))
                } else {
                    State.showNotification("The song was added to the playlist.")
                }
            } else {
                State.showError("The song could not be added to the playlist. Please try again later...")
            }
            State.updatePlaylistView()
        };
        this.savePlaylistCallback = function (o, status) {
            if (status == Util.SUCCESS) {
                if (State.POST_SAVE_CLEAR_QUEUE == true) {
                    State.playerState = State.PLAYER_CLEAN;
                    State.POST_SAVE_CLEAR_QUEUE = false;
                    State.setUnsavedQueue(false)
                }
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                if (error.length) {
                    State.showError(error[0].getAttribute("msg"))
                } else {
                    State.showNotification("Playlist saved.")
                }
            } else {
                State.showError("Playlist could not be saved. Please try again later...")
            }
            State.updatePlaylistView()
        };
        this.renamePlaylist = function (listname, listid) {
            var url = "/api.php?__call=playlist.rename";
            var postData = {_marker: 0, listid: listid, listname: encodeURIComponent(listname)};
            Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    var xml = Util.getXMLObj(o);
                    var error = xml.getElementsByTagName("error");
                    if (error.length) {
                        State.showError(error[0].getAttribute("msg"));
                        return
                    }
                    State.updatePlaylistView();
                    Analytics.logAndSendEventToGA("rename-playlist")
                } else {
                    State.showError("Playlist could not be renamed. Please try again later.")
                }
            }, postData, true)
        };
        this.createPlaylist = function (listname, songString, sourceListId) {
            Analytics.logAndSendEventToGA("playlist:new:save");
            if (listname == "") {
                alert("Please enter a name for your playlist.");
                return
            }
            var isOverride = false;
            var playlists = State.playlistsData();
            for (var i = 0; i < playlists.length; ++i) {
                var existingListname = playlists[i].listname;
                if (existingListname == listname) {
                    isOverride = true;
                    break
                }
            }
            if (isOverride == true) {
                var agree = confirm("Overwrite existing playlist '" + listname + "'?");
                if (!agree) {
                    return
                }
            }
            if (sourceListId != undefined) {
                var url = "/api.php?__call=playlist.copyPlaylist";
                var postData = {_marker: 0, destListName: encodeURIComponent(listname), srcListId: sourceListId}
            } else {
                if (isOverride == true) {
                    var url = "/api.php?__call=playlist.save";
                    var postData = {_marker: 0, listid: playlists[i].listid, contents: songString};
                    Util.call(url, this.savePlaylistCallback, postData, true);
                    return
                } else {
                    var url = "/api.php?__call=playlist.create";
                    var postData = {
                        _marker: 0,
                        listname: encodeURIComponent(listname),
                        share: "true",
                        contents: songString
                    }
                }
            }
            Util.call(url, this.createPlaylistCallback, postData, true)
        };
        this.createPlaylistCallback = function (o, status) {
            if (status == Util.SUCCESS) {
                var xml = Util.getXMLObj(o);
                var error = xml.getElementsByTagName("error");
                Util.logInConsole(error);
                if (error.length) {
                    State.showError(error[0].getAttribute("msg"));
                    return
                }
                if (State.POST_SAVE_CLEAR_QUEUE == true) {
                    State.playerState = State.PLAYER_CLEAN;
                    State.POST_SAVE_CLEAR_QUEUE = false
                }
                State.mode = State.MODE_PLAYLIST;
                var pl = xml.getElementsByTagName("playlist");
                State.currentPlaylist = pl[0].getAttribute("listid");
                State.currentPlaylistName = pl[0].getAttribute("listname");
                State.currentPlaylistUrl = pl[0].getAttribute("perma_url");
                FBUtil.publishPlaylistCreateToFB(State.currentPlaylistUrl);
                State.showNotification(State.currentPlaylistName + " has been created.");
                Interface.myMusicNotify({note: "1", notePrefix: "+"});
                State.setUnsavedQueue(false)
            } else {
                State.showError("Playlist could not be created. Please try again later.")
            }
            State.updatePlaylistView()
        };
        this.deletePlaylist = function (listid) {
            Analytics.logAndSendEventToGA("content:playlist:delete");
            var agree = confirm("Are you sure you wish to delete this playlist?");
            if (!agree) {
                return false
            }
            var el = document.getElementById("pl_" + listid + "_id");
            if (el) {
                el.style.display = "none"
            }
            var url = "/api.php?__call=playlist.delete";
            var postData = {_marker: 0, listid: listid};
            Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    Playlist.clear_and_get_playlists();
                    Interface.myMusicNotify({note: "1", notePrefix: "-"});
                    Interface.initUI("#main");
                    Util.logAndGoToUrl("playlist:delete", "/u/" + $.parseJSON($("#user-json").text()).uid)
                }
            }, postData, true)
        };
        this.empty_playlist = function (listid) {
            var agree = confirm("Are you sure you wish to empty this playlist?");
            if (!agree) {
                return false
            }
            var url = "playlist.php?qt=a&mode=all&action=empty&listid=" + listid;
            url += "&t=" + Util.getCurrentTime();
            var transaction = Util.call(url, this.empty_playlist_callback, null)
        };
        this.empty_playlist_callback = function (o, status) {
            if (status == Util.SUCCESS) {
                document.getElementById("searchresults").innerHTML = o;
                window.scrollTo(0, 0);
                Playlist.clear_and_get_playlists()
            } else {
            }
        };
        this.load_playlist = function (listid, listname, playlist_mode) {
            State.mode = playlist_mode;
            var url = "playlist.php?bl=no&listid=" + listid + "&mode=" + playlist_mode;
            State.currentPlaylist = listid;
            State.currentPlaylistName = listname;
            url += "&qt=a";
            State.currentLink = url;
            url += "&t=" + Util.getCurrentTime();
            var transaction = Util.call(url, this.load_playlist_callback, null)
        };
        this.load_public_playlist = function (listid, listname, username, referrer) {
            listname = listname.replace(" ", "+");
            var url = "/play/playlist/" + username + "/" + listname + "?listid=" + listid;
            if (referrer != null) {
                url += "&ref=" + referrer
            }
            url += "&qt=a";
            State.currentLink = url;
            State.currentPlaylist = State.NO_PLAYLIST;
            url += "&t=" + Util.getCurrentTime();
            var transaction = Util.call(url, this.load_playlist_callback, null)
        };
        this.load_playlist_callback = function (o, status) {
            if (status == Util.SUCCESS) {
                document.getElementById("main").innerHTML = o;
                Interface.initUI("#main");
                window.scrollTo(0, 0);
                var elems = document.getElementsByTagName("input");
                for (var i = 0; i < elems.length; i++) {
                    if (elems[i].id && elems[i].id.indexOf("tb_") != -1) {
                        State.currentPlaylistUrl = elems[i].value
                    }
                }
                Content.playAllSongs();
                Analytics.logAndSendEventToGA("playlist-ajax");
                Content.loadImages();
                FB.XFBML.parse();
                State.playlistLoaded()
            } else {
            }
        };
        this.show_all_playlists = function () {
            var url = "playlist.php?qt=a&mode=all";
            url += "&t=" + Util.getCurrentTime();
            var transaction = Util.call(url, this.show_all_playlists_callback, null)
        };
        this.show_all_playlists_callback = function (o, status) {
            if (status == Util.SUCCESS) {
                document.getElementById("main").innerHTML = o;
                window.scrollTo(0, 0);
                Analytics.logAndSendEventToGA("playlists-ajax")
            } else {
            }
        };
        this.getPlaylistsHtml = function (playlists, mode) {
            playlist_html = "<table style='line-height:1.7em' width='96%' cellspacing='0px'><tr>";
            if (mode == State.MODE_PLAYLIST) {
                onclick = "this.show_all_playlists();hide_popup();";
                playlist_html += "<td class='playlist-popup-tab' valign='center' style='border-bottom:1px solid #CCCCCC' onclick='" + onclick + "'><a class='uline_on_hover blue_link' style='font-style:italic;' href='#'>All my Playlists</a></td>";
                playlist_html += "</tr><tr>"
            }
            for (var i = 0; i < playlists.length; ++i) {
                var listid = playlists[i].listid;
                var listname = playlists[i].listname;
                var url = playlists[i].perma_url;
                var onclick = 'this.load_playlist("' + listid + '","' + listname.replace(/(["'])/g, "") + '","' + mode + '","' + url + '");hide_popup();';
                playlist_html += "<td class='playlist-popup-tab' valign='center' style='border-bottom:1px solid #CCCCCC' onclick='" + onclick + "'><a class='uline_on_hover blue_link'>" + listname + "</a></td>";
                playlist_html += "</tr><tr>"
            }
            playlist_html += "</tr></table>";
            return playlist_html
        };
        this.paint_playlist_popup = function (text) {
            var my_playlist_html = "";
            if (typeof Sidebar.playlists.my != "undefined" && Sidebar.playlists.my.length > 0) {
                my_playlist_html = this.getPlaylistsHtml(Sidebar.playlists.my, State.MODE_PLAYLIST)
            } else {
                var username = $("span.user-name").text();
                if (username == "") {
                    my_playlist_html = "<span style='padding-top:10px;padding-right:5px;'>You must be <a href='#' class='uline_on_hover blue_link' onclick='hide_popup(); YAHOO.phulki.container.loginpanel.show();' >logged in</a> to access your playlists!</span>"
                } else {
                    my_playlist_html = "You have not created any playlists. Start by adding songs to the player and saving it as a new playlist"
                }
            }
            var ftd_playlist_html = this.getPlaylistsHtml(Sidebar.playlists.featured, State.MODE_FEATURED_PLAYLIST);
            var body = "<div id='playlist_tabs' class='yui-navset'>             <ul class='yui-nav' style='width:150px;top:10px;'>             <li class='selected'><a href='#tab1'><em>Featured Playlists</em></a></li>             <li><a href='#tab2'><em>My Playlists</em></a></li>             </ul>             <div class='yui-content' style = 'margin-left:75px;height:220px;overflow:hidden;width:230px;'>             <div id='tab1' class='playlist-tab-content'><p>" + ftd_playlist_html + "</p></div>             <div id='tab2' class='playlist-tab-content'><p>" + my_playlist_html + "</p></div>             </div>             </div>";
            show_popup("Playlists", body, 400, 264);
            new YAHOO.widget.TabView("playlist_tabs", {orientation: "left"})
        };
        this.clear_and_get_playlists = function () {
            State.updatePlaylistView()
        };
        this.clear_playlists = function () {
            Sidebar.playlists = null
        };
        this.get_playlists = function () {
            var url = "/api.php?__call=playlist.listAllMetaData&_marker=0";
            url += "&t=" + Util.getCurrentTime();
            Util.call(url, this.get_playlists_callback, null)
        };
        this.get_playlists_callback = function (o, status) {
            if (status == Util.SUCCESS) {
                var xml = Util.getXMLObj(o);
                var xml_my_playlists = xml.getElementsByTagName("playlist");
                var my_playlists = new Array;
                for (var i = 0; i < xml_my_playlists.length; ++i) {
                    my_playlists[i] = {
                        listid: xml_my_playlists[i].getAttribute("listid"),
                        listname: xml_my_playlists[i].getAttribute("listname")
                    }
                }
                var xml_featured_playlists = xml.getElementsByTagName("featuredplaylist");
                var featured_playlists = new Array;
                for (var i = 0; i < xml_featured_playlists.length; ++i) {
                    featured_playlists[i] = {
                        listid: xml_featured_playlists[i].getAttribute("listid"),
                        listname: xml_featured_playlists[i].getAttribute("listname")
                    }
                }
                Sidebar.playlists = {my: my_playlists, featured: featured_playlists}
            } else {
            }
        };
        this.onloadfeaturedplaylist = function (listid, listname) {
            State.mode = State.MODE_FEATURED_PLAYLIST;
            var url = "playlist.php?bl=no&listid=" + listid + "&mode=" + State.mode;
            State.currentPlaylistName = listname;
            State.currentPlaylistUrl = document.getElementById("tb_" + listid).value;
            url += "&qt=a";
            State.currentLink = url;
            invokePostLoadRoutines()
        };
        this.onloadplaylist = function (listid, listname) {
            State.mode = State.MODE_PLAYLIST;
            State.currentPlaylist = listid;
            State.currentPlaylistName = listname;
            var url = "playlist.php?bl=no&listid=" + listid + "&mode=" + State.mode;
            State.currentPlaylistUrl = document.getElementById("tb_" + listid).value;
            url += "&qt=a";
            State.currentLink = url;
            invokePostLoadRoutines()
        };
        this.make_editable_playlist = function (id) {
            var input = document.getElementById(id);
            input.style.border = "1px solid black";
            input.select()
        };
        this.blur_playlist_name = function (input) {
            input.style.border = "0px solid black";
            input.size = input.value.length - 2;
            input.style.clip = "clip:rect(auto auto auto 0px)"
        };
        this.removeSong = function (listid, pid, n) {
            Analytics.logAndSendEventToGA("content:playlist:remove-song");
            var url = "/api.php?__call=playlist.remove&listid=" + listid + "&pid=" + pid;
            Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    $(".track-list li:nth-child(" + n + ")").slideUp(120, function () {
                        $(this).remove()
                    });
                    Playlist.clear_and_get_playlists();
                    State.refreshContent(false)
                } else {
                    State.showError("Playlist could not be modified. Please try again later.")
                }
            })
        };
        this.grabPlaylistFromContent = function (listid) {
            Panel.showPlaylistPanel(null, listid)
        }
    };
var Content = Content || new function () {
        this.init = function () {
            _bindLoadMoreEvents()
        };
        this.confirmUserDetailsUpdate = function () {
            var action_confirm = window.confirm("Are you sure you want to update the details of your account?");
            if (action_confirm) {
                this.updateUserDetails()
            } else {
            }
        };
        this.isEventBound = function (target, type) {
            var data = $._data(target, "events")[type];
            if (data === undefined || data.length === 0) {
                return false
            }
            return true
        };
        this.checkIsMerge = function () {
            email = $("#new_email").val();
            email = email === undefined ? "" : email;
            old_email = $("#old_email").val();
            non_email = $("#non_email").val();
            email_login = $("#email_login").val();
            network = $("#network").val();
            phone_number = $("#edit_phone_number").text();
            if (phone_number === "ADD MOBILE NUMBER") {
                phone_number = ""
            }
            if (phone_number != "" && !Util.validatePhone(phone_number)) {
                State.showNotification("Phone number invalid!");
                return false
            }
            var callback = function (data) {
                data = jQuery.parseJSON(data);
                if (data.hasOwnProperty("error") == false) {
                    if (data.mergeType !== undefined) {
                        if (data.mergeType == Util.MERGE_TYPE_NONE) {
                            if (email != null && email !== undefined && email != old_email) {
                                if (email != "" && !Util.validateEmail(email)) {
                                    $("#new_email").addClass("error-email");
                                    return false
                                }
                                if (email != old_email && email != "" || email_login == "true" && non_email == "true" && email != old_email) {
                                    Panel.showEmailPanel();
                                    return true
                                }
                            }
                            Content.updateUserDetails();
                            return
                        }
                        if (data.mergeType == Util.MERGE_TYPE_PHONE) {
                            var accntB = phone_number
                        }
                        if (data.mergeType == Util.MERGE_TYPE_EMAIL) {
                            var accntB = $("#new_email").val()
                        }
                        if (data.mergeType == Util.MERGE_TYPE_EMAIL_PHONE) {
                            var accntB = phone_number + " & " + $("#new_email").val()
                        }
                        var user_json = jQuery.parseJSON($("#user-json").html());
                        var accntA = user_json.username;
                        if (user_json.username == user_json.fbid) {
                            accntA = "Facebook"
                        }
                        var r = confirm("Accounts " + accntA + " & " + accntB + " will be merged, are you sure?");
                        if (r == true) {
                            $("#merge").val("1");
                            if (email != null && email !== undefined && email != old_email) {
                                if (email != "" && !Util.validateEmail(email)) {
                                    $("#new_email").addClass("error-email");
                                    return false
                                }
                                if (phone_number != "" && !Util.validatePhone(phone_number)) {
                                    State.showNotification("Phone number invalid!");
                                    return false
                                }
                                if (email != old_email && email != "" || email_login == "true" && non_email == "true" && email != old_email) {
                                    Panel.showEmailPanel();
                                    return true
                                }
                            }
                            Content.updateUserDetails()
                        } else {
                            if (phone_number != "") {
                                Content.deleteHTMLPhone()
                            }
                            State.showNotification("Accounts " + accntA + " & " + accntB + " will not be merged, update details & Save again!")
                        }
                        return
                    }
                } else {
                    if (old_email && data.error.msg == "Phone number, email & FB details cannot be empty! ") {
                        $("#new_email").val(old_email)
                    }
                    if (data.error.msg == "This phone number is already associated with another Saavn account!") {
                        Content.deleteHTMLPhone()
                    }
                    State.showNotification(data.error.msg)
                }
            };
            var apiURL = "/api.php?__call=user.isUserMerge&_marker&_format=json&email=" + email + "&phone_number=" + encodeURIComponent(phone_number);
            Util.call(apiURL, callback)
        };
        this.updateUserDetails = function () {
            firstname = $("#firstname").val();
            old_firstname = $("#old_firstname").val();
            lastname = $("#lastname").val();
            dob = $("#datepicker").val();
            if (dob == null || dob === undefined || dob == "" || dob == "dd/mm/yyyy") {
                dob = "0000-00-00"
            } else {
                var day = dob.substring(0, 2);
                var month = dob.substring(3, 5);
                var year = dob.substring(6);
                dob = year + "-" + month + "-" + day
            }
            email = $("#new_email").val();
            old_email = $("#old_email").val();
            non_email = $("#non_email").val();
            email_login = $("#email_login").val();
            email = email === undefined ? "" : email;
            gender = $("#gender_u option:selected").val();
            var phonefbid = $("#phonefbid").val();
            var phonefbtoken = $("#phonefbtoken").val();
            phone_number = $("#edit_phone_number").text();
            if (phone_number === "ADD MOBILE NUMBER") {
                phone_number = ""
            }
            var callbackUpdate = function (data) {
                data = jQuery.parseJSON(data);
                if (data.hasOwnProperty("error") == false) {
                    if (firstname || lastname) $(".page-title").text(firstname + " " + lastname);
                    Util.addEditPasswordHTML();
                    if (old_firstname != firstname && firstname == "") {
                        $("#firstname").val(old_firstname);
                        State.showNotification("Firstname can't be empty!")
                    } else {
                        State.showNotification("Details updated successfully!");
                        State.updatePlaylistView()
                    }
                } else {
                    if (old_email && data.error.msg == "Phone number, email & FB details cannot be empty! ") $("#new_email").val(old_email);
                    State.showNotification(data.error.msg)
                }
            };
            var apiURL = "/api.php?__call=user.update&_marker&_format=json&firstname=" + firstname + "&lastname=" + lastname + "&gender=" + gender + "&dob=" + dob + "&email=" + email + "&phonefbid=" + phonefbid + "&phonefbtoken=" + phonefbtoken + "&phone_number=" + encodeURIComponent(phone_number);
            Util.call(apiURL, callbackUpdate);
            if ($("#merge").val() == "1") {
                if (Util.getPageType() == "people" || $(".page-wrap").hasClass("account")) {
                    setTimeout(function () {
                        State.refreshContent()
                    }, 3e3)
                } else if (Radio.isRadioUrl()) {
                    Radio.loadUserStations()
                }
                $("#merge").val("0")
            }
        };
        this.deleteHTMLPhone = function (forceDel) {
            var old_phone = $("#phone_number_del").val();
            if (old_phone != "" && old_phone != "undefined" && old_phone !== undefined) {
                var htmlDel = "<a class='btn green' id ='edit_phone_number'>" + old_phone + "</a>" + "<input type='button' class='btn-profile outline push-left' id='edit_phone' onclick='Content.edit_phone_btn_onclick()' name='Edit' value='Edit'>" + "<input type='button' class='btn-profile outline push-left' id='del_phone' name='Delete' value='Delete' onclick='Content.delete_phone_btn_onclick()'>"
            } else {
                var htmlDel = '<a class="btn green " id ="edit_phone_number" onclick="Content.edit_phone_btn_onclick()">' + "ADD MOBILE NUMBER" + "</a>"
            }
            if (forceDel === true) {
                var htmlDel = '<a class="btn green " id ="edit_phone_number" onclick="Content.edit_phone_btn_onclick()">' + "ADD MOBILE NUMBER" + "</a>"
            }
            $("#phone_profile").html(htmlDel)
        };
        this.emailValidate = function (email) {
            if (!Util.validateEmail(email)) {
                $("#new_email").addClass("error-email")
            } else {
                $("#new_email").removeClass("error-email")
            }
        };
        function editMobileCallback(response) {
            if (response.status === Util.FB_PARTIAL_AUTHENTICATED_STATUS) {
                if (response.state === Util.FB_STATE) {
                    var url = "/api.php?__call=user.appAccountsLogin&code=" + response.code + "&api_version=4&_format=json&from=user.update&_marker=0";
                    var callback = function (data) {
                        data = jQuery.parseJSON(data);
                        if (data.status == "success") {
                            var html = "";
                            if ($("#edit_phone").val() != "Edit") {
                                html = "<input type='button' id='edit_phone' class= 'btn-profile outline push-left' name='Edit' value='Edit' onclick='Content.edit_phone_btn_onclick()'>" + "<input type='button' id='del_phone' class='btn-profile outline push-left' name='Delete'  value='Delete' onclick='Content.delete_phone_btn_onclick()'>"
                            }
                            $("#edit_phone_number").text(data.phone_number);
                            $("#phone_profile").html($("#phone_profile").html() + html);
                            $("#edit_phone_number").attr("onclick", "(function() { return false; })");
                            $("#phone_number").val(data.phone_number);
                            $("#phonefbid").val(data.phonefbid);
                            $("#phonefbtoken").val(data.phonefbtoken);
                            Content.checkIsMerge()
                        } else {
                            State.showNotification("Sorry, this phone number is already associated to another Saavn Account!")
                        }
                    };
                    Util.call(url, callback)
                } else {
                    Util.logInConsole(" STATE NOT SAME ");
                    alert("Something went wrong, please try again")
                }
            } else if (response.status === Util.FB_NOT_AUTHENTICATED_STATUS) {
                Util.logInConsole(Util.FB_NOT_AUTHENTICATED_STATUS)
            } else if (response.status === Util.FB_BAD_PARAMS_STATUS) {
                Util.logInConsole(Util.FB_BAD_PARAMS_STATUS);
                alert("Something went wrong, please try again")
            }
        }

        this.edit_phone_btn_onclick = function () {
            var countryCodeNum = $("#countryCodeNum").val();
            AccountKit.login("PHONE", {countryCode: countryCodeNum}, editMobileCallback)
        };
        this.delete_phone_btn_onclick = function () {
            var firstname = $("#firstname").val();
            var lastname = $("#lastname").val();
            var user_json = jQuery.parseJSON($("#user-json").html());
            if (($("#new_email").val() == "" || $("#new_email").val() == undefined) && (user_json.fbid == "" || user_json.fbid == undefined)) {
                State.showNotification("Phone, FB & Email cannot be empty!")
            } else {
                var r = confirm("Are you sure you want to Delete your phone number?");
                if (r == true) {
                    Content.deleteHTMLPhone(true);
                    Content.checkIsMerge();
                    $(".page-title").text(firstname + " " + lastname)
                } else {
                }
            }
        };
        function _bindLoadMoreEvents() {
            _loadMoreContent();
            var target = $(document);
            if ($("html").hasClass("ie8")) {
                target = $(window)
            }
            target.bind("scroll", function () {
                _loadMoreContent()
            });
            target.bind("resize", function () {
                _loadMoreContent()
            });
            if (window.location.pathname == "/me/account") {
                if ($("#edit_phone_number").text() != "ADD MOBILE NUMBER") {
                    $("#phone_number").val($("#edit_phone_number").text())
                }
            }
        }

        this.datepick = function (target, year, month, day) {
            if (!this.isEventBound(target, "click")) {
                $(target).bind("click", this.bindDatePicker(target, year, month, day))
            }
        };
        this.bindDatePicker = function (target, year, month, day) {
            $(target).pickadate({
                format: "dd/mm/yyyy",
                today: "",
                clear: "",
                close: "",
                selectYears: 75,
                selectMonths: true,
                min: [1900, 1, 1],
                max: true,
                select: [year, month, day]
            })
        };
        function _loadMoreContent() {
            var pageType = Util.getPageType();
            switch (pageType) {
                case"featured-playlists":
                    loadMoreButton = $("#featuredPlaylists-more-playlists");
                    break;
                case"artist":
                case"label":
                    currentTab = $(".quick-tabs").find(".current");
                    category = currentTab.find("a").text().toLowerCase();
                    loadMoreButton = $("#artist-more-" + category);
                    break;
                case"people":
                    var currentTab = $(".quick-tabs li.current a").text();
                    if (currentTab == "Friends") {
                        loadMoreButton = $("#load-more-friends")
                    } else if (currentTab == "Following") {
                        var subTab = $("ul.sub-tabs li.active a").text();
                        loadMoreButton = $("#load-more-following-" + subTab.toLowerCase())
                    } else {
                        return
                    }
                    break;
                case"profile":
                case"owner-profile":
                    var currentTab = $(".quick-tabs li.current a").text();
                    if (currentTab == "Following") {
                        var subTab = $("ul.sub-tabs li.active a").text();
                        loadMoreButton = $("#load-more-following-" + subTab.toLowerCase())
                    } else if (currentTab == "Followers") {
                        loadMoreButton = $("#load-more-followers")
                    } else {
                        return
                    }
                    break;
                default:
                    return
            }
            if (loadMoreButton.length > 0 && !loadMoreButton.hasClass("show-spinner") && !loadMoreButton.hasClass("disabled")) {
                var loadMoreButtonPosition = loadMoreButton.offset().top;
                var playerPosition = $("#player").offset().top;
                if (loadMoreButtonPosition < playerPosition) {
                    loadMoreButton.click()
                }
            }
        }

        this.follow = function (elem) {
            if (!State.isUserLoggedIn()) {
                Panel.successCallback = function () {
                    Content.follow(elem);
                    Panel.successCallback = null
                };
                Panel.showLoginPanel(false, {heading: "Login to start following"});
                return
            }
            var id = $(elem).attr("data-id");
            var type = $(elem).attr("data-type");
            var apiURL = "/api.php?__call=social.follow&_format=json&_marker=0&entity_id=" + id + "&type=" + type;
            var callback = function (data) {
                data = jQuery.parseJSON(data);
                if (data.status == "success") {
                    _updateUI(elem, true);
                    if (type == "playlist") State.updatePlaylistView()
                } else {
                    if (data.error_code == 5) {
                        State.showNotification("You are already following this " + type);
                        $(elem).text("following");
                        $(elem).addClass("outline");
                        $(elem).attr("onclick", "Content.unfollow(this)")
                    } else {
                        State.showNotification("Sorry, could not complete the operation. Please Try again Later")
                    }
                }
            };
            Util.call(apiURL, callback)
        };
        function _updatePageSubtitle(elem, is_follow) {
            var pageType = Util.getPageType();
            var context = $(elem).attr("data-context");
            if (pageType == "owner-profile" || pageType == "profile" && context == "profile-header") {
                var subtitle_elem = pageType == "owner-profile" ? $("#page-subtitle-following") : $("#page-subtitle-followers");
                var count = parseInt(subtitle_elem.attr("data-count"));
                count += is_follow ? 1 : -1;
                var displayText = pageType == "owner-profile" ? count + " Following" : count + " Followers";
                subtitle_elem.attr("data-count", count);
                subtitle_elem.text(displayText)
            }
        }

        function _updateEntities(elem, is_follow) {
            var id = $(elem).attr("data-id");
            var context = $(elem).attr("data-context");
            var currentPage = Util.getPageType().toLowerCase();
            var trackingEvent = "site:";
            switch (currentPage) {
                case"artist":
                    trackingEvent += "artist_detail:";
                    break;
                default:
                    if (context == "profile-header") {
                        trackingEvent += currentPage + ":"
                    } else {
                        var currentTab = $(".quick-tabs").find("li.current a").text().toLowerCase();
                        var subTab = $(".sub-tabs").find("li.active a").text().toLowerCase();
                        if (currentPage == "owner-profile") {
                            currentPage = "profile";
                            if (currentTab == "notifications") {
                                trackingEvent += "inbox:";
                                break
                            }
                        }
                        trackingEvent += currentPage + ":" + currentTab + ":";
                        if (subTab) {
                            trackingEvent += subTab + ":"
                        }
                    }
                    break
            }
            trackingEvent += is_follow ? "follow:click" : "unfollow:click";
            Analytics.logAndSendEventToGA([trackingEvent, "id", id]);
            var label = is_follow ? "following" : "follow";
            var onclick = is_follow ? "Content.unfollow(this)" : "Content.follow(this)";
            $("[data-id='" + id + "']").each(function () {
                $(this).text(label);
                is_follow ? $(this).addClass("outline") : $(this).removeClass("outline");
                $(this).attr("onclick", onclick);
                var parent_elem = $(this).closest("li");
                var follower_count = parseInt($(parent_elem).find(".meta").attr("data-followers"));
                follower_count += is_follow ? 1 : -1;
                $(parent_elem).find(".meta").attr("data-followers", follower_count);
                $(parent_elem).find(".meta").text(follower_count + " Followers")
            })
        }

        this.unfollow = function (elem) {
            var id = $(elem).attr("data-id");
            var type = $(elem).attr("data-type");
            var apiURL = "/api.php?__call=social.unfollow&_format=json&_marker=0&entity_id=" + id + "&type=" + type;
            var callback = function (data) {
                data = jQuery.parseJSON(data);
                if (data.status == "success") {
                    _updateUI(elem, false);
                    if (type == "playlist") State.updatePlaylistView()
                } else {
                    State.showNotification("Sorry, could not complete the operation. Please Try again Later")
                }
            };
            Util.call(apiURL, callback)
        };
        function _updateUI(elem, is_follow) {
            var context = $(elem).attr("data-context");
            var currentTab = $(".quick-tabs li.current").attr("data-tab");
            _updateEntities(elem, is_follow);
            _updatePageSubtitle(elem, is_follow);
            if (currentTab == "tab-3" && context == "profile-header") {
                var loggedInUid = JSON.parse($("#user-json").text()).uid;
                if ($("#followers").find("[data-id='" + loggedInUid + "']").length || is_follow) {
                    $("#followers").empty();
                    $(".tab-3 .empty-state").addClass("hide");
                    var loadMoreButton = $(".tab-3 a.with-spinner");
                    loadMoreButton.attr("data-currentPage", 0);
                    loadMoreButton.attr("style", "");
                    loadMoreButton.click()
                }
            }
        }

        this.loadImages = function () {
            var songImages = $("body").find(".song_img, .img");
            if (songImages.length > 0)for (var i = 0; i < songImages.length; i++) {
                var url_node = songImages[i].getAttributeNode("url");
                if (url_node) {
                    songImages[i].src = url_node.value
                }
            }
        };
        this.newSearchPage = function (searchType, logStr) {
            if (typeof searchType == "undefined") {
                searchType = State.SEARCH_TYPE_USER_INPUT
            }
            if (typeof logStr == "undefined") {
                logStr = ""
            }
            var query = document.getElementById("q").value;
            query = Util.removeSpecialChars(query);
            if (query) {
                document.title = query + " - Saavn Hindi Music Search"
            } else {
                return
            }
            query = query.replace(/ /g, "_");
            State.currentSearchType = searchType;
            Util.updateBrowserUrl("/search/" + query.replace(/:/, "/"));
            State.currentPagenum = 1
        };
        this.newAjaxLangQuery = function (lang) {
            var query = document.getElementById("q").value;
            if (query) {
                document.title = query + " - Saavn Hindi Music Search"
            } else {
                document.title = "Saavn Hindi Music Search"
            }
            Util.updateBrowserUrl("/search/" + query.replace(/:/, "/"));
            State.currentPagenum = 1
        };
        this.newPlaylistPage = function (playlistType, playlistName, username, listid) {
            document.title = playlistName + " playlist - Saavn Hindi Music Search";
            var link = "/play/" + playlistType + "/";
            if (playlistType != "featured" && typeof username != "undefined") {
                link += username + "/"
            }
            link += playlistName.replace(/ /gi, "+") + "/";
            if (typeof listid != "undefined") {
                link += "?listid=" + listid
            }
            Util.updateBrowserUrl(link)
        };
        var _updateBrowserUrl = function (query) {
            location.hash = "#!" + query.replace(/ /gi, "+")
        };
        this.getPage = function (link, postLoadCallback, refreshView) {
            State.currentLink = link;
            var qsAppend = "?";
            if (link.indexOf("?") != -1) qsAppend = "&";
            link += qsAppend + "qt=a" + "&st=" + State.currentSearchType + "&t=" + Util.getCurrentTime();
            if (State.partner && State.partner != "undefined") {
                link += "&partner=" + State.partner;
                link += "&widgetId=" + State.widgetId;
                link += "&apl=1&start=0&autostart=1";
                State.widgetId = null
            }
            if (refreshView === undefined)var refreshView = true;
            if (refreshView) Interface.showLoading();
            Util.call(link, function (o, status) {
                Interface.hideLoading();
                if (status == Util.SUCCESS) {
                    if (o.charAt(0) == "{" && typeof jQuery.parseJSON(Util.stringCheck(o)) == "object") {
                        o = jQuery.parseJSON(Util.stringCheck(o));
                        if (o.error_code == "LOGIN_REQUIRED") {
                            Panel.successCallback = function () {
                                location.reload();
                                Panel.successCallback = null
                            };
                            Panel.showLoginPanel(true)
                        }
                    } else {
                        Interface.clearExtras();
                        document.getElementById("main").innerHTML = o;
                        Interface.initUI("#main");
                        _decideAndLogEvent();
                        Content.loadImages();
                        if (typeof postLoadCallback == "function") {
                            postLoadCallback()
                        }
                        if (!(typeof FB === "undefined")) {
                            FB.XFBML.parse()
                        }
                    }
                    if (State.partner && State.partner != "undefined" && !State.isSponsoredPlaylist()) {
                        RemoteServer.setPartner(State.partner)
                    } else {
                        Interface.hideCoBrand()
                    }
                } else {
                }
            }, null);
            State.currentSearchType = State.SEARCH_TYPE_USER_INPUT
        };
        function _decideAndLogEvent() {
            var tokens = Util.getPath().split("/");
            var evname = "site:search:song";
            var statename = State.MODE_SEARCH;
            if (tokens[2] == "artist") {
                evname = "inner:content:artist_pages:ui"
            }
            if (tokens[1] == "song-of-the-day") {
                evname = "sotd-ajax"
            }
            if (tokens[2] == "featured" || tokens[2] == "playlist" && tokens.length > 4) {
                evname = "playlist-ajax"
            }
            if (tokens.length >= 4 && (tokens[3] == "playlist" || tokens[3].indexOf("playlist") !== -1)) {
                evname = "site:search:playlist"
            }
            Analytics.logAndSendEventToGA(evname);
            State.mode = statename
        }

        this.getSimilarSongs = function (pid, song) {
            var url = "search.php?mode=reco&pid=" + pid + "&song=" + escape(song) + "&lang=" + State.currentQueryLanguage + "&_marker=0&qt=a&t=" + Util.getCurrentTime();
            Analytics.logStats("ev", "suggestions:click", "songid", pid, "song", escape(song));
            Analytics.sendEventToGA("search:recommendations_click");
            var transaction = Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    $("body").append(o);
                    $("#track-details-panel .close").click(function () {
                        Interface.cPanelClose("#track-details-panel")
                    });
                    Interface.cPanel("#track-details-panel", {w: 840})
                } else {
                }
            }, null)
        };
        this.getProfile = function (uid, noback) {
            document.title = uid + " - Saavn Hindi Music Search";
            link = "/u/" + uid;
            Util.updateBrowserUrl(link)
        };
        this.getBackLink = function () {
            var link = "search.php?qt=a&st=3&q=" + encodeURIComponent(document.getElementById("q").value) + "&p=" + State.currentPagenum;
            return link
        };
        this.togglePlVisibility = function (listid, listname, share, callback) {
            var str = "Public";
            if (share != 1) {
                str = "Private";
                Analytics.logAndSendEventToGA("content:playlist:private")
            } else {
                Analytics.logAndSendEventToGA("content:playlist:public")
            }
            var url = "/api.php?__call=playlist.make" + str + "&listid=" + listid + "&listname=" + listname + "&t=" + Util.getCurrentTime();
            Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    var xml = Util.getXMLObj(o);
                    var success = xml.getElementsByTagName("success")[0];
                    if (str == "Public") {
                        Interface.updateToggle("#share-toggle", "")
                    } else {
                        Interface.updateToggle("#share-toggle", "checked")
                    }
                    if (callback !== undefined) {
                        callback()
                    }
                    for (var i = 0; i < success.childNodes.length; i++) {
                        if (success.childNodes[i].tagName == "perma_url") {
                            if (location.href == success.childNodes[i].textContent) {
                                State.refreshContent()
                            } else {
                                Util.updateBrowserUrl(success.childNodes[i].textContent, false)
                            }
                            break
                        }
                    }
                    State.updatePlaylistView();
                    State.showNotification("This playlist is now " + str + ".")
                } else {
                }
            }, null)
        };
        this.onMouseOutFavourites = function (o) {
            var _class = o.className;
            if (_class == "fav_rev" || _class == "fav_hover") {
                o.className = "fav"
            }
            if (_class == "not_fav_rev" || _class == "not_fav_hover") {
                o.className = "not_fav"
            }
        };
        this.fireExplicitSearch = function () {
            State.currentQueryLanguage = State.getLanguage();
            this.newSearchPage(State.SEARCH_TYPE_USER_INPUT)
        };
        this.fireDisambiguation = function (query) {
            document.getElementById("q").value = query;
            this.newSearchPage(State.SEARCH_TYPE_DISAMBIGUATION);
            Analytics.logAndSendEventToGA("search:disambiguation")
        };
        this.fireCorrection = function (query) {
            document.getElementById("q").value = query;
            this.newSearchPage(State.SEARCH_TYPE_CORRECTION);
            Analytics.logAndSendEventToGA("search:correction")
        };
        this.fireCorrectionExact = function (query) {
            document.getElementById("q").value = '"' + query + '"';
            this.newSearchPage(State.SEARCH_TYPE_CORRECTION_EXACT);
            Analytics.logAndSendEventToGA("search:correction_exact")
        };
        this.fireAlbumlevelSuggestion = function (query) {
            document.getElementById("q").value = query;
            this.newSearchPage(State.SEARCH_TYPE_ALBUMLEVEL_SUGGESTION);
            Analytics.logAndSendEventToGA("search:albumlevel_suggestion")
        };
        this.newSuggestionQuery = function (query, pos) {
            document.getElementById("q").value = query;
            this.newSearchPage(State.SEARCH_TYPE_SUGGESTION, "pos:" + pos);
            if (query.indexOf("playlist") != -1) {
                Analytics.logAndSendEventToGA("site:searchplaylist_suggestion")
            }
        };
        this.queryResultsByOrder = function (order) {
            var q = document.getElementById("q").value;
            document.getElementById("q").value = q.replace(/ ?order:\w* ?/gi, " ").replace(/^\s+|\s+$/g, "");
            if (typeof order != "undefined") {
                document.getElementById("q").value += " order:" + order
            }
            this.newSearchPage(State.SEARCH_TYPE_USER_CLICK)
        };
        this.newQuery = function (type, srchQuery) {
            if (typeof srchQuery == "undefined") {
                srchQuery = $("#q").val()
            }
            var delim = ": ";
            if (typeof type == "undefined" || type == "album= " || type == "") {
                delim = "";
                type = ""
            }
            if (type == "playlist") {
                srchQuery = $.trim(srchQuery);
                var prefixes = ["year", "playlist", "album", "starring", "order", "year", "album", "music", "singers", "director", "song"];
                for (var i = 0; i < prefixes.length; i++) {
                    srchQuery = srchQuery.replace(prefixes[i], "")
                }
                var specialCharacters = [":", "=", "+"];
                for (var i = 0; i < specialCharacters.length; i++) {
                    srchQuery = srchQuery.replace(specialCharacters[i], " ")
                }
                var suffixes = ["latest", "oldest"];
                for (var i = 0; i < suffixes.length; i++) {
                    srchQuery = srchQuery.replace(suffixes[i], "")
                }
            }
            $("#q").val(type + delim + $.trim(srchQuery));
            this.newSearchPage(State.SEARCH_TYPE_USER_CLICK)
        };
        this.getSongDetails = function (pid, song) {
            State.showPreloader();
            Interface.cPanelClose();
            var url = "search.php?mode=reco&pid=" + pid + "&lang=" + State.currentQueryLanguage + "&song=" + escape(song) + "&_marker=0&qt=a&display=popup&t=" + Util.getCurrentTime();
            var transaction = Util.call(url, function (o, status) {
                if (status == Util.SUCCESS) {
                    State.hidePreloader(function () {
                        $("body").append(o);
                        $("#track-details-panel .close").click(function () {
                            Interface.cPanelClose("#track-details-panel")
                        });
                        Interface.initUI("#track-details-panel");
                        Interface.cPanel("#track-details-panel", {w: 840})
                    })
                } else {
                }
            }, null)
        };
        this.profileCallback = function (o, status) {
            if (status == Util.SUCCESS) {
                document.getElementById("main").innerHTML = o;
                Interface.smoothTo();
                Analytics.logAndSendEventToGA("profile-ajax")
            } else {
            }
        };
        this.onMouseOutVisibility = function (o) {
            var _class = o.className;
            if (_class == "pl_private" || _class == "pl_private_hover") {
                o.className = "pl_private"
            }
            if (_class == "pl_public" || _class == "pl_public_hover") {
                o.className = "pl_public"
            }
        };
        this.onMouseOverVisibility = function (o) {
            var _class = o.className;
            if (_class == "pl_private_hover" || _class == "pl_public_hover") {
                return
            }
            o.className = o.className + "_hover"
        };
        this.toggleFavourites = function (pid, language, o, song) {
            var isStarred = $(o).hasClass("on");
            var op = isStarred ? "removeSong" : "addSong";
            song = JSON.parse(song);
            Util.callFavorites({
                pid: song.songid, op: op, lang: song.language, success: function (data) {
                    if (op == "addSong") {
                        State.songStarToggled(song, true);
                        $(o).addClass("on");
                        if (!$(o).hasClass("star-btn")) $(o).html("Starred <em>Remove</em>");
                        $(o).attr("title", "Remove from Starred Songs");
                        State.showNotification(Util.htmlEntityDecode(song.title) + " was added to your Starred Songs.");
                        if (State.radioMode) {
                            Analytics.logAndSendEventToGA("site:radio:star:click")
                        } else {
                            Analytics.logAndSendEventToGA("site:star:click");
                        }
                    } else {
                        State.songStarToggled(song, false);
                        $(o).removeClass("on");
                        if (!$(o).hasClass("star-btn")) $(o).html("Star");
                        $(o).attr("title", "Add to Starred Songs");
                        State.showNotification(Util.htmlEntityDecode(song.title) + " was removed from your Starred Songs.", "remove");
                        if (State.radioMode) {
                            Analytics.logAndSendEventToGA("site:radio:unstar:click")
                        } else {
                            Analytics.logAndSendEventToGA("site:unstar:click")
                        }
                    }
                }, error: function (data) {
                    State.showError("There was a problem starring the song. Please try again later...")
                }
            })
        };
        this.onMouseOverFavourites = function (o) {
            var _class = o.className;
            if (_class == "fav_rev" || _class == "not_fav_rev") {
                return
            }
            o.className = o.className + "_hover"
        };
        this.playParsedSongs = function (songs, playNow) {
            if (songs.length > 1) {
                State.disableNotifications();
                var count = 0;
                State.isSingleAddOp = false;
                for (var i = 0; i < songs.length; i++) {
                    if (playNow && i == 0) {
                        State.addSong(songs[i], Sidebar.QUEUE, 1)
                    } else {
                        State.addSong(songs[i], Sidebar.QUEUE)
                    }
                    count++
                }
                if (!State.isSingleAddOp) State.storeSidebarQueue();
                State.isSingleAddOp = true;
                State.enableNotifications();
                State.showNotification(count + " songs were added to your queue.")
            } else {
                State.enableNotifications();
                if (playNow) {
                    State.addSong(songs[0], Sidebar.QUEUE, 1)
                } else {
                    State.addSong(songs[0], Sidebar.QUEUE)
                }
            }
        };
        this.playAllSongs = function (t, playNow) {
            var songs = [];
            var isSongObject = true;
            if (!t)if ($(".page-wrap.playlist").length > 0)var t = $(".page-wrap.playlist .full");
            if ($(".page-wrap.album-view").length > 0)var t = $(".page-wrap.album-view");
            if ($(".page-wrap.song-detail").length > 0) songs[0] = $(".page-header .meta-info .song-json").text();
            if (t) {
                $(t).find(".track-list .song-wrap").each(function (i) {
                    if ($(this).hasClass("disabled") == false) {
                        songs.push($(this).find(".song-json").text())
                    }
                })
            }
            if (!songs || !songs[0])return false;
            Content.playParsedSongs(songs, playNow)
        };
        this.receiveChangeFavouriteStateCall = function (pid, state) {
            $("body").find(".song-wrap").each(function () {
                if ($(this).attr("data-songid") == pid) {
                    var songJson = $(this).find(".song-json").text();
                    var t = $(this).find(".star");
                    if (state) {
                        $(t).addClass("on");
                        if (!$(t).hasClass("star-btn")) $(t).html("Starred <em>Remove</em>");
                        songJson = songJson.replace('"starred":"false"', '"starred":"true"');
                        $(this).find(".song-json").text(songJson)
                    } else {
                        $(t).removeClass("on");
                        if (!$(t).hasClass("star-btn")) $(t).html("Star");
                        songJson = songJson.replace('"starred":"true"', '"starred":"false"');
                        $(this).find(".song-json").text(songJson)
                    }
                }
            });
            $("#drawer-queue-group > li").each(function () {
                if ($(this).attr("data-song") == pid) {
                    if (state) {
                        $(this).data().json.starred = "true".toString();
                        $(this).find(".mini-drop .star").addClass("on").html("Starred <em>Remove</em>")
                    } else {
                        $(this).data().json.starred = "false".toString();
                        $(this).find(".mini-drop .star").removeClass("on").html("Star")
                    }
                }
            });
            State.storeSidebarQueue()
        };
        this.loadRBTs = function () {
            var songs = $(".add-to-queue");
            var pidsString = "";
            for (var i = 0; i < songs.length; i++) {
                if ($(songs[i]).attr("onclick") != "return false;") pidsString += $(songs[i]).attr("onclick").split('"songid":"')[1].split('"')[0] + "^^**^^"
            }
            Util.call("/api.php?__call=rbt.getRBTs&pids=" + pidsString + "&_format=json&_marker=0", function (data) {
                data = jQuery.parseJSON(Util.stringCheck(data));
                for (d in data) {
                    var songs = $(".add-to-queue");
                    for (var i = 0; i < songs.length; i++) {
                        if ($(songs[i]).attr("onclick") != "return false;")if (d == $(songs[i]).attr("onclick").split('"songid":"')[1].split('"')[0]) $(songs[i]).parent().append('<a style="color=red;" href="return false;" onclick="alert(\'' + data[d]["rbt_id"] + "')\">airtel</a>")
                    }
                }
            }, "", false)
        };
        this.authenticateRBTRequest = function (phone, pass, rbt_id, partner, pid, song) {
            Util.call("/api.php?__call=rbt.authenticateRBTRequest&_marker=0&partner=" + partner + "&pass=" + pass + "&rbt_id=" + rbt_id + "&phone=" + phone + "&pid=" + pid + "&song=" + song, function (data) {
                data = jQuery.parseJSON(Util.stringCheck(data));
                if (data.status == "success") {
                    alert("Authentication Request sent")
                } else {
                    alert("Authentication Request was failed")
                }
            }, "", false)
        };
        this.addSongToPlaylist = function (escaped) {
            Analytics.logAndSendEventToGA("content:add-to-playlist:click");
            Panel.showPlaylistPanel(escaped)
        };
        this.paintNonConnectedFBFacepile = function (data) {
            var max = data.length;
            $(".friends .facepile").hide().html('<h2 class="page-subtitle">Your friends already love Saavn!</h2>');
            for (var i = 0; i < max; i++) {
                var pictObj = data[i]["picture"];
                $('<span class="fb-usr"><img src="' + pictObj["data"]["url"] + '" /></span>').appendTo(".friends .facepile")
            }
            $(".friends .facepile").slideDown(340)
        };
        this.showMoreFriends = function (ele) {
            var currPage = parseInt($(ele).attr("data-currentPage"));
            var totPages = parseInt($(ele).attr("data-pages"));
            var pageToGet = currPage + 1;
            var url = "/friends.php";
            var params = new Array;
            params["p"] = pageToGet;
            params["qt"] = "a";
            var callback = function (response, status) {
                if (status === Util.SUCCESS) {
                    $(".invite-pager").hide();
                    $(".invite-pager").before(response);
                    $(ele).attr("data-currentPage", pageToGet);
                    if (totPages > pageToGet) {
                        $(".invite-pager").show()
                    }
                } else {
                    alert("Something went wrong, please try again")
                }
            };
            Util.call(url, callback, params, false)
        }
    };
var RemoteServer = RemoteServer || new function () {
        this.flashToJS = function (msg) {
            var json = jQuery.parseJSON(msg);
            var action = json.action;
            var status = json.status;
            var reason = json.reason;
            var url = json.url;
            var partner = json.partner;
            var widgetId = json.widgetId;
            var songWidgetId = "";
            var currentSongWithWidget = false;
            try {
                songWidgetId = Player.getCurrentSong().widgetId;
                if ((widgetId == songWidgetId || widgetId == Player.getCurrentSong().e_songid) && Sidebar.nowPlayingData().length > 0) {
                    currentSongWithWidget = true
                }
            } catch (ex) {
            }
            status = status ? status : "default";
            switch (status) {
                case"error":
                    Util.logInConsole("server intialization : failed");
                    break;
                case"connected":
                    Util.logInConsole("server intialization : success");
                    break;
                case"default":
                    switch (action) {
                        case"ping":
                            return;
                            break;
                        case"open":
                        case"play":
                            if (currentSongWithWidget == true && Player.getState().state == "paused") {
                                Player.resumeSong()
                            } else {
                                State.widgetId = widgetId;
                                State.autoLoadPostContentFetch(true);
                                if (location.href == url) {
                                    State.refreshContent()
                                } else {
                                    Util.updateBrowserUrl(url, true)
                                }
                                if (action == "open") {
                                    AdRotation.init()
                                }
                            }
                            break;
                        case"pause":
                            if (currentSongWithWidget == true) {
                                Player.pauseSong()
                            }
                            break
                    }
                    break
            }
        };
        this.sendMsgViaBridge = function (state) {
            var json = {};
            var song = Player.getCurrentSong();
            if (song != null) {
                song["title"] = song["title"].replace(/"/g, "&quot;");
                json["song"] = song;
                json["state"] = state;
                msg = JSON.stringify(json);
                try {
                    document["ServerPlayer"].msgFromJS(msg)
                } catch (exception) {
                }
            }
        }
    };
if (window.addEventListener) {
    window.addEventListener("beforeunload", function (e) {
        try {
            document["ServerPlayer"].msgFromJS("")
        } catch (exception) {
        }
    })
} else if (window.attachEvent) {
    window.attachEvent("beforeunload", function (e) {
        try {
            document["ServerPlayer"].msgFromJS("")
        } catch (exception) {
        }
    })
}
RemoteServer.setPartner = function (partner) {
    var partnerID = "partner=" + partner;
    $("#partner_config_banneriframe")[0].contentWindow.location.replace("/ads/search_config_banner.php?" + partnerID);
    $("#partner_config_banneriframe").unbind("load");
    $("#partner_config_banneriframe").bind("load", function () {
        var partnerData = $("#partner_config_banneriframe").get(0).contentWindow.SAAVNPartnerStrip;
        if (partnerData != null && (partnerData.siteName != "" || partnerData.logo != "" || partnerData.logoWidth != "" || partnerData.bg != "" || partnerData.textColor != "")) {
            Interface.showCoBrand(partnerData)
        }
    })
};
var Radio = Radio || new function () {
        this.getSong = function (getNext) {
            var stationInfo = Radio.getStationInfo();
            var stationId = stationInfo.stationId;
            var type = stationInfo.stationType;
            var getSongUrl = "/api.php?__call=webradio.getSong&_marker=0&_format=json&stationid=" + stationId + "&t=" + (new Date).getTime();
            if (type != "user") {
                getSongUrl += "&type=scratch"
            }
            if (getNext) {
                getSongUrl += "&next=1"
            }
            Util.call(getSongUrl, function (response) {
                response = JSON.parse(response);
                var song = response.song;
                if ($("#radio-mast").length > 0) {
                    $("#radio-mast .song-json").text(JSON.stringify(song));
                    _paintRadioSong(response);
                    Radio.radioSongCB()
                } else {
                    Player.playSong(song);
                    _updateLikeState(song)
                }
            }, null, false)
        };
        this.startScratchStation = function (songId, query) {
            query = query.replace(/ /gi, "-");
            var url = "/p/radio/" + Util.getCookie("L") + "-query-station/" + query;
            Util.updateBrowserUrl(url);
            return
        };
        this.startArtistScratchStation = function (songId, query, enryptedId) {
            query = query.replace(/ /gi, "-");
            var url = "/p/radio/" + Util.getCookie("L") + "-artist-station/" + query + "/" + enryptedId;
            Util.updateBrowserUrl(url);
            return
        };
        this.playAlreadyLoadedStation = function () {
            Radio.radioSongCB();
            Analytics.logAndSendEventToGA("site:radio:radioMode:startRadio");
            var to = setTimeout(function () {
                clearTimeout(to);
                $("#radio-description").slideUp(340, function () {
                    to = setTimeout(function () {
                        clearTimeout(to);
                        $("#radio-mast header").slideDown(340, function () {
                            $(this).removeClass("hide")
                        })
                    }, 340);
                    $(this).remove()
                })
            }, 340)
        };
        this.renderRadioInPlayMode = function () {
            State.radioMode = true;
            Util.setResourceToLocalStorage("radioMode", true);
            Player.radioOn();
            Header.updateRadioMenu();
            State.showNotification('<strong class="radio">Radio mode on.</strong> <em>Use thumbs up and thumbs down to tell us what you like. The more you tell us, the better your station will get!', "status", 2.5)
        };
        this.radioSongCB = function () {
            try {
                var song = $("#radio-mast .song-json").text();
                song = jQuery.parseJSON(Util.stringCheck(song));
                song.title = $("<div/>").html(song.title).text();
                if (!State.radioMode) {
                    Radio.renderRadioInPlayMode()
                }
                var currentSongId = "";
                try {
                    currentSongId = Player.getCurrentSong().songid;
                    if (Player.isPlayerDisabled()) {
                        currentSongId = ""
                    }
                } catch (err) {
                }
                if (currentSongId != song.songid) {
                    Player.playSong(song)
                }
                _updateLikeState(song);
                if (Radio.isRadioUrl()) {
                    var stationInfo = new Array;
                    stationInfo.stationId = $("#station").attr("data-id");
                    stationInfo.stationName = $("#station").attr("data-name");
                    stationInfo.stationType = $("#station").attr("data-type");
                    stationInfo.stationSeed = $("#station").attr("data-seed");
                    stationInfo.stationLanguage = $("#station").attr("data-language");
                    _setStationInfo(stationInfo)
                }
                Header.updateRadioMenu()
            } catch (err) {
            }
        };
        this.saveStation = function (name) {
            Analytics.logAndSendEventToGA("site:radio:save_station:click");
            if (!State.isUserLoggedIn()) {
                Panel.successCallback = function () {
                    Radio.saveStation(name);
                    Panel.successCallback = null
                };
                Panel.showLoginPanel(false, {heading: "Log in to start saving your radio stations!"});
                return
            }
            if (!$("#saved-stations").hasClass("hide")) Interface.showLoading($("#saved-stations"));
            var saveStationUrl = "/api.php?_format=json&_marker=0&__call=webradio.saveStation&name=" + name + "&t=" + (new Date).getTime();
            var stationHash = new Array;
            stationHash.stationName = name;
            stationHash.stationType = "user";
            Util.call(saveStationUrl, function (response) {
                response = JSON.parse(response);
                stationHash.stationId = response.stationid;
                _setStationInfo(stationHash);
                Radio.loadUserStations();
                $("#save-station").fadeOut(340, function () {
                    $(this).remove()
                });
                $("#station-info h3").html('<strong class="saved"><span class="ellip">' + name + "</span></strong></h3>");
                $("#station-form .cancel").click()
            }, null, false)
        };
        this.getCurrentStationUrl = function (autoplay) {
            var stationHash = Radio.getStationInfo();
            var stationName = stationHash.stationName;
            var stationId = stationHash.stationId;
            var stationType = stationHash.stationType;
            var stationSeed = stationHash.stationSeed;
            var autoplayPhrase = "s";
            var language = stationHash.stationLanguage;
            if (autoplay) {
                autoplayPhrase = "p"
            }
            switch (stationType) {
                case"user":
                    stationUrl = "/" + autoplayPhrase + "/radio/user/" + JSON.parse($("#user-json").text()).uid + "/" + stationName + "/" + stationId;
                    break;
                case"song":
                    stationUrl = "/" + autoplayPhrase + "/radio/" + language + "-song-station/" + stationName + "/" + stationSeed;
                    break;
                default:
                    stationUrl = "/" + autoplayPhrase + "/radio/" + language + "-" + stationType + "-station/" + stationName + "/" + stationId
            }
            return window.location.protocol + "//" + window.location.hostname + stationUrl
        };
        this.goToCurrentStation = function (autoplay) {
            var stationUrl = this.getCurrentStationUrl(autoplay);
            Util.updateBrowserUrl(stationUrl)
        };
        this.stopRadio = function () {
            Util.setResourceToLocalStorage("radioMode", false);
            Header.updateRadioMenu()
        };
        this.loadUserStations = function () {
            Interface.showLoading($("#saved-stations"));
            Util.call("/api.php?__call=webradio.list&_marker=0&_format=json&t=" + (new Date).getTime(), function (response) {
                Radio.userStations = JSON.parse(response);
                $("#saved-stations .station-list, #radio-menu .saved-stations").empty();
                var months = new Array("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec");
                var i = 0;
                for (i = 0; i < Radio.userStations.length; i++) {
                    var station = Radio.userStations[i];
                    var name = station.name.replace(/ /g, "-");
                    var stationid = station.stationid;
                    var stationName = station.name;
                    var creation_date = station.creation_date;
                    creation_date = creation_date.replace(/-/g, "/");
                    var formattedDate = new Date(creation_date);
                    var datePhrase = months[formattedDate.getMonth()] + " " + formattedDate.getDate().toString().substring("0", "2") + ", '" + formattedDate.getYear().toString().substring("1", "3");
                    var uid = JSON.parse($("#user-json").text()).uid;
                    var href = "/p/radio/user/" + uid + "/" + name + "/" + stationid;
                    var hideClass = i > 2 ? ' class="hide"' : "";
                    var html = "<li" + hideClass + ">" + '	<div class="info">' + "       <button class=\"play\" onclick=\"Util.logAndGoToUrl(new Array('site:radio:saved_stations:click', 'stationId', '" + stationid + "', 'stationName', '" + stationName + "', 'stationType', 'user'), '" + href + "'); return false;\"></button>" + "		<a onclick=\"Util.logAndGoToUrl(new Array('site:radio:saved_stations:click', 'stationId', '" + stationid + "', 'stationName', '" + stationName + "', 'stationType', 'user'), '" + href + '\'); return false;" href="' + href + '">' + '			<h3 class="title ellip">' + stationName + "</h3>" + '			<p class="small fine-print ellip">Created ' + datePhrase + "</p>" + "		</a>" + "	</div>" + '	<a class="delete" onclick="Radio.deleteStation(\'' + stationid + "', $(this))\">Delete</a>" + "</li>";
                    $("#saved-stations .station-list").append(html);
                    var onclick = "Util.logAndGoToUrl(new Array('site:header:radio:saved_station:start_radio:click', 'stationId', ''+stationid+'', 'stationName',''+ name+'', 'stationType', 'user'), ''+href+''); return false;";
                    $("#radio-menu .saved-stations").append('<li><a class="ellip" onclick=' + onclick + ' href="' + href + '">' + stationName + "</a></li>")
                }
                $("#saved-stations #more-stations").remove();
                if (Radio.userStations.length > 3) {
                    $("#saved-stations").append('<a class="btn light outline white-fill x-small" id="more-stations">Show All ' + Radio.userStations.length + "</a>");
                    $("#more-stations").unbind("click").click(function () {
                        $(this).fadeOut(120, function () {
                            $(this).remove();
                            $("#saved-stations li.hide").css("display", "inline-block").hide().fadeIn(210, function () {
                                $(this).css("display", "inline-block")
                            })
                        })
                    })
                }
                Interface.hideLoading($("#saved-stations"), true);
                if (Radio.userStations.length > 0) {
                    $("#saved-stations").removeClass("hide");
                    $("#radio-menu .saved-stations").closest(".drop-scroll").removeClass("hide");
                    $("#radio-menu").unbind("click").addClass("menu");
                    Interface.initUI($("#main-nav"))
                } else {
                    $("#saved-stations").addClass("hide");
                    $("#radio-menu .saved-stations").closest(".drop-scroll").addClass("hide")
                }
                Header.updateRadioMenu()
            })
        };
        this.deleteStation = function (stationId, el) {
            Analytics.logAndSendEventToGA("site:radio:saved_stations:delete:click");
            Interface.showLoading($("#saved-stations"));
            Util.call("/api.php?__call=webradio.deleteStation&_marker=0&_format=json&stationid=" + stationId + "&t=" + (new Date).getTime(), function (response) {
                Radio.loadUserStations()
            })
        };
        this.likeSong = function () {
            Analytics.logAndSendEventToGA("site:radio:thumbs_up:click");
            if (!State.isUserLoggedIn()) {
                Panel.successCallback = function () {
                    Radio.likeSong();
                    Panel.successCallback = null
                };
                Panel.showLoginPanel(false, {heading: "Log in to start tuning your radio station! Thumb up songs you like, thumb down the ones you don't."});
                return
            }
            if (Radio.LJR) {
                if ($("#like").hasClass("on")) {
                    $(Radio.LJRAudio.okay[Util.getRandBetween(0, Radio.LJRAudio.okay.length - 1)])[0].play();
                    Radio.logoShimmy()
                } else {
                    $(Radio.LJRAudio.yea[Util.getRandBetween(0, Radio.LJRAudio.yea.length - 1)])[0].play();
                    Radio.logoShimmy()
                }
            }
            if (Radio.RJK) {
                $(Radio.RJKAudio.up[Util.getRandBetween(0, Radio.RJKAudio.up.length - 1)])[0].play();
                Radio.logoShimmy()
            }
            var stationInfo = Radio.getStationInfo();
            var stationId = stationInfo.stationId;
            var type = stationInfo.stationType;
            var song = Player.getCurrentSong();
            var songId = song.songid;
            var likeSongUrl = "/api.php?__call=webradio.likeSong&_marker=0&_format=json&stationid=" + stationId + "&pid=" + songId + "&t=" + (new Date).getTime();
            if (type != "user") {
                likeSongUrl += "&type=scratch"
            }
            $("#like-big").toggleClass("on");
            $("#like").toggleClass("on");
            State.showNotification('<strong class="radio">Improving your station...</strong> <em>New music, on the way!</em>', "status", 2.5);
            Util.call(likeSongUrl, function () {
                State.showNotification('<strong class="radio">We love this song too!</strong> <em>We think you will love what\'s coming up!', "status", 1.5)
            }, null, false)
        };
        this.dislikeSong = function () {
            Analytics.logAndSendEventToGA("site:radio:thumbs_down:click");
            if (!State.isUserLoggedIn()) {
                Panel.successCallback = function () {
                    Radio.dislikeSong();
                    Panel.successCallback = null
                };
                Panel.showLoginPanel(false, {heading: "Log in to start tuning your radio station! Thumb up songs you like, thumb down the ones you don't."});
                return
            }
            if (Radio.LJR) {
                if (Radio.LJRWhatCount < Radio.LJRWhatMax) {
                    $(Radio.LJRAudio.what[Util.getRandBetween(0, Radio.LJRAudio.what.length - 1)])[0].play();
                    Radio.logoShimmy();
                    Radio.LJRWhatCount++;
                    return
                } else {
                    $(Radio.LJRAudio.okay[Util.getRandBetween(0, Radio.LJRAudio.okay.length - 1)])[0].play();
                    Radio.logoShimmy();
                    Radio.LJRWhatCount = 0;
                    Radio.setWhatMax()
                }
            }
            if (Radio.RJK) {
                $(Radio.RJKAudio.down[Util.getRandBetween(0, Radio.RJKAudio.down.length - 1)])[0].play();
                Radio.logoShimmy()
            }
            var stationInfo = Radio.getStationInfo();
            var stationId = stationInfo.stationId;
            var type = stationInfo.stationType;
            var song = Player.getCurrentSong();
            var songId = song.songid;
            var dislikeSongUrl = "/api.php?__call=webradio.dislikeSong&_marker=0&_format=json&stationid=" + stationId + "&pid=" + songId + "&t=" + (new Date).getTime();
            if (type != "user") {
                dislikeSongUrl += "&type=scratch"
            }
            State.showNotification('<strong class="radio">Improving your station...</strong> <em>New music, on the way!</em>', "status", 2.5);
            Util.call(dislikeSongUrl, function (response) {
                response = JSON.parse(response);
                var song = response.song;
                if ($("#radio-mast").length > 0) {
                    $("#radio-mast .song-json").text(JSON.stringify(song));
                    _paintRadioSong(response);
                    Radio.radioSongCB()
                } else {
                    Player.playSong(song);
                    _updateLikeState(song)
                }
                State.showNotification('<strong class="radio">Okay, we hear you!</strong> <em>We\'re using your feedback to improve and personalize your station.', "status", 1.5)
            }, null, false)
        };
        this.starRadioSong = function () {
            var song = jQuery.parseJSON(Util.stringCheck($("#radio-mast .song-json").text()));
            Content.toggleFavourites(song.songid, song.language, "#radio-star", $("#radio-mast .song-json").text())
        };
        this.shareRadioSong = function () {
            Analytics.logAndSendEventToGA("site:radio:share:click");
            var song = jQuery.parseJSON(Util.stringCheck($("#radio-mast .song-json").text()));
            song.fbtitle = song.title;
            song.fbthumb = song.image_url;
            song.twitter = song.twitter_url;
            song.thumb = song.image_url;
            song.song = song.title;
            song.id = song.songid;
            SharePanel.showPanel(song)
        };
        this.addRadioSongToQueue = function () {
            Analytics.logAndSendEventToGA("site:radio:add_to_queue:click");
            var song = jQuery.parseJSON(Util.stringCheck($("#radio-mast .song-json").text()));
            if (State.radioMode) {
                song.autoplay = false;
                State.addSong(song, Sidebar.QUEUE, 0)
            } else {
                State.addSong(song, Sidebar.QUEUE)
            }
            $("#fwd").removeClass("disabled")
        };
        this.addRadioSongToPlaylist = function () {
            Analytics.logAndSendEventToGA("site:radio:add_to_playlist:click");
            Panel.showPlaylistPanel($("#radio-mast .song-json").text())
        };
        function _updateLikeState(song) {
            if (song.liked == "true") {
                $("#like-big").addClass("on");
                $("#like").addClass("on")
            } else {
                $("#like-big").removeClass("on");
                $("#like").removeClass("on")
            }
        }

        function _paintRadioSong(response) {
            var song = response.song;
            var songImg = Util.getCDNUrl() + "/_i/3.0/album-default.png";
            if (typeof song.image_url != "undefined" && $.trim(song.image_url).length > 0) songImg = song.image_url;
            Interface.rotateRadioImage(songImg);
            song.title = $("<div/>").html(song.title).text();
            song.album = $("<div/>").html(song.album).text();
            var map = song.map;
            map = map.split("^~^");
            var artist_name_id = new Object;
            for (var i = 0; i < map.length; i = i + 2) {
                artist_name_id[map[i]] = map[i + 1]
            }
            $(".page-title").html(song.title.replace("/p/song", "/s/song") + '&nbsp;<a id="radio-star" class="star star-btn"></a>');
            $(".page-subtitle .album-name").html(song.album).attr("href", song.album_url.replace("/p/album", "/s/album"));
            var albumOnclick = "Util.logAndGoToUrl('site:radio:album:click:" + song.album + "', '" + song.album_url.replace("/p/album", "/s/album") + "');return false;";
            $(".page-subtitle .album-name").attr("onclick", albumOnclick);
            if (song.year.length > 0) {
                var yearsHref = "/search/" + song.language + "/year/" + song.year;
                var yearsATag = '<a title="Find more music from ' + song.year + '" class="small" href="' + yearsHref + "\" onclick=\"Util.logAndGoToUrl('site:radio:songs:meta_data:click:year', '" + yearsHref + "');return false;\">" + song.year + "</a>";
                var labelATag = " <a onclick=\"Util.logAndGoToUrl('', '" + song.label_url + '\'); return false;" href="' + song.label_url + '">' + song.label + "</a>";
                $("#radio-year").html("&copy; " + yearsATag + labelATag)
            }
            if (song.music.length > 0) {
                $(".page-subtitle .artist-name").html("by ");
                $.map(song.music.split(","), function (val, i) {
                    val = $("<div/>").html(val).text();
                    var searchString = val.trim();
                    val = val.trim();
                    var musicHref = artist_name_id[val];
                    var musicATag = '<a title="Find more songs by ' + val + '" href="' + musicHref + "\" onclick=\"Util.logAndGoToUrl('site:radio:songs:meta_data:click:music', '" + musicHref + "');return false;\">" + searchString + "</a>";
                    $(".page-subtitle .artist-name").append(musicATag);
                    if (i + 1 < song.music.split(",").length) {
                        $(".page-subtitle .artist-name").append(", ")
                    }
                })
            } else {
                $(".page-subtitle .artist-name").empty()
            }
            if (song.starred == true) $("#radio-star").addClass("on"); else $("#radio-star").removeClass("on");
            $("#radio-star").unbind("click").click(function () {
                Radio.starRadioSong()
            });
            if (song.starring.length > 0) {
                $("#radio-starring p").empty();
                $.map(song.starring.split(","), function (val, i) {
                    val = $("<div/>").html(val).text();
                    var searchString = val.trim();
                    val = val.trim();
                    var starringHref = artist_name_id[val];
                    var starringATag = '<a title="Find films with ' + val + '" href="' + starringHref + "\" onclick=\"Util.logAndGoToUrl('site:radio:songs:meta_data:click:starring', '" + starringHref + "');return false;\">" + searchString + "</a>";
                    $("#radio-starring p").append(starringATag);
                    if (i + 1 < song.starring.split(",").length) {
                        $("#radio-starring p").append(", ")
                    }
                });
                $("#radio-starring").removeClass("hide")
            } else {
                $("#radio-starring").addClass("hide")
            }
            if (song.singers.length > 0) {
                $("#radio-singers p").empty();
                $.map(song.singers.split(","), function (val, i) {
                    val = $("<div/>").html(val).text();
                    var searchString = val.trim();
                    val = val.trim();
                    var singersHref = artist_name_id[val];
                    var singersATag = '<a title="Find music performed by ' + val + '" class="" href="' + singersHref + "\" onclick=\"Util.logAndGoToUrl('site:radio:songs:meta_data:click:singers', '" + singersHref + "');return false;\">" + searchString + "</a>";
                    $("#radio-singers p").append(singersATag);
                    if (i + 1 < song.singers.split(",").length) {
                        $("#radio-singers p").append(", ")
                    }
                });
                $("#radio-singers").removeClass("hide")
            } else {
                $("#radio-singers").addClass("hide")
            }
            if (response.twitter_requests) {
                var user = response.twitter_requests.username;
                var img = response.twitter_requests.twitter_img;
                var total = parseInt(response.twitter_requests.total);
                $("#twitter-radio-img img").fadeOut(340, function () {
                    $("#twitter-radio-img").html('<a href="http://www.twitter.com/' + user + '" target="_blank"><img src="' + img + '" alt="" /></a>');
                    $("#twitter-radio-img img").hide().fadeIn(340)
                });
                var userStr = "@" + user;
                if (total > 1) userStr += " and " + total + " more...";
                $("#twitter-radio-users").html(userStr);
                var sourceStr = response.twitter_requests.type == "shared" ? "shared" : "requested";
                $("#twitter-via").html(sourceStr + " by")
            }
        }

        this.isRadioUrl = function () {
            var urlArray = location.pathname.split("/");
            return urlArray[1] == "radio" || urlArray[2] == "radio"
        };
        this.isScratchUrl = function () {
            return location.pathname == "/radio/scratch"
        };
        this.showLanguageAlert = function () {
            if ($(".radio-error.lang-alert").length < 1) {
                var alert = '<span class="lang-alert"><span class="icon"></span>Radio is currently only available in Hindi and English.</span>';
                $("#mood-stations h2.page-subtitle").prepend(alert);
                $(".lang-alert").hide()
            }
            setTimeout(function () {
                $(".lang-alert").stop(true).fadeIn(210)
            }, 480)
        };
        this.hideLanguageAlert = function () {
            $(".lang-alert").stop(true).fadeOut(210, function () {
                $(this).remove()
            })
        };
        function _setStationInfo(stationHash) {
            localStorage.stationId = stationHash.stationId;
            localStorage.stationName = stationHash.stationName.replace(/ /g, "-");
            localStorage.stationType = stationHash.stationType;
            localStorage.stationSeed = stationHash.stationSeed;
            localStorage.stationLanguage = stationHash.stationLanguage
        }

        this.getStationInfo = function () {
            var stationHash = new Array;
            stationHash.stationName = localStorage.stationName;
            stationHash.stationId = localStorage.stationId;
            stationHash.stationType = localStorage.stationType;
            stationHash.stationSeed = localStorage.stationSeed;
            stationHash.stationLanguage = localStorage.stationLanguage;
            return stationHash
        };
        this.clearStationInfo = function () {
            localStorage.removeItem("stationId");
            localStorage.removeItem("stationName");
            localStorage.removeItem("stationType");
            localStorage.removeItem("stationSeed")
        };
        this.logoShimmy = function () {
            if (Radio.LJR) {
                clearTimeout(Radio.LJRTimeout);
                $("#ljr-logo").addClass("tada");
                Radio.LJRTimeout = setTimeout(function () {
                    $("#ljr-logo").removeClass("tada");
                    clearTimeout(Radio.LJRTimeout)
                }, 750)
            }
            if (Radio.RJK) {
                clearTimeout(Radio.RJKTimeout);
                $("#rjk-logo").addClass("tada");
                Radio.RJKTimeout = setTimeout(function () {
                    $("#rjk-logo").removeClass("tada");
                    clearTimeout(Radio.RJKTimeout)
                }, 750)
            }
        };
        this.initLJR = function () {
            var ljrAudio = "<!-- LJR -->" + '<div id="ljr">' + '	<audio id="what-0">' + '		<source src="/ljr/what-0.ogg" type="audio/ogg" />' + '		<source src="/ljr/what-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="what-1">' + '		<source src="/ljr/what-1.ogg" type="audio/ogg" />' + '		<source src="/ljr/what-1.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="what-2">' + '		<source src="/ljr/what-2.ogg" type="audio/ogg" />' + '		<source src="/ljr/what-2.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="what-3">' + '		<source src="/ljr/what-3.ogg" type="audio/ogg" />' + '		<source src="/ljr/what-3.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="yea-0">' + '		<source src="/ljr/yea-0.ogg" type="audio/ogg" />' + '		<source src="/ljr/yea-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="yea-1">' + '		<source src="/ljr/yea-1.ogg" type="audio/ogg" />' + '		<source src="/ljr/yea-1.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="yea-2">' + '		<source src="/ljr/yea-2.ogg" type="audio/ogg" />' + '		<source src="/ljr/yea-2.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="yea-3">' + '		<source src="/ljr/yea-3.ogg" type="audio/ogg" />' + '		<source src="/ljr/yea-3.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="okay-0">' + '		<source src="/ljr/okay-0.ogg" type="audio/ogg" />' + '		<source src="/ljr/okay-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="okay-1">' + '		<source src="/ljr/okay-1.ogg" type="audio/ogg" />' + '		<source src="/ljr/okay-1.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="okay-2">' + '		<source src="/ljr/okay-2.ogg" type="audio/ogg" />' + '		<source src="/ljr/okay-2.mp3" type="audio/mpeg" />' + "	</audio>" + "</div>";
            $("#player .wrap").append(ljrAudio);
            $("#ljr audio").each(function () {
                var t = $(this).attr("id").split("-")[0];
                var i = $(this).attr("id").split("-")[1];
                Radio.LJRAudio[t][i] = "#" + $(this).attr("id")
            });
            Radio.LJRReady = true
        };
        this.toggleLJR = function (toggleOn, viaBeta) {
            if (viaBeta === undefined) Radio.toggleRJK(false, true);
            if (toggleOn) {
                if (!Radio.LJRReady) Radio.initLJR();
                $("#ljr-toggle").addClass("on");
                $("#logo").addClass("ljr");
                clearTimeout(Radio.LJRTimeout);
                Radio.LJRTimeout = setTimeout(function () {
                    Radio.logoShimmy()
                }, 210);
                Radio.setWhatMax();
                Radio.LJR = true;
                if (!State.radioMode) {
                    if ($("#radio-start-big").length > 0) Radio.playAlreadyLoadedStation(); else Radio.goToCurrentStation();
                    var stationInfo = Radio.getStationInfo();
                    var stationId = stationInfo.stationId;
                    var stationType = stationInfo.stationType;
                    var stationName = stationInfo.stationName;
                    Analytics.logAndSendEventToGA("site:header:radio:liljon:start_radio:click", "stationId", stationId, "stationName", stationName, "stationType", stationType)
                }
            } else {
                $("#ljr-toggle").removeClass("on");
                $("#logo").removeClass("ljr");
                Radio.LJR = false
            }
        };
        this.setWhatMax = function () {
            Radio.LJRWhatMax = Util.getRandBetween(0, 4)
        };
        this.initRJK = function () {
            var ljrAudio = "<!-- RJK -->" + '<div id="rjk">' + '	<audio id="down-0">' + '		<source src="/rjk/down-0.ogg" type="audio/ogg" />' + '		<source src="/rjk/down-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="down-1">' + '		<source src="/rjk/down-1.ogg" type="audio/ogg" />' + '		<source src="/rjk/down-1.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="skip-0">' + '		<source src="/rjk/skip-0.ogg" type="audio/ogg" />' + '		<source src="/rjk/skip-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="up-0">' + '		<source src="/rjk/up-0.ogg" type="audio/ogg" />' + '		<source src="/rjk/up-0.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="up-1">' + '		<source src="/rjk/up-1.ogg" type="audio/ogg" />' + '		<source src="/rjk/up-1.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="up-2">' + '		<source src="/rjk/up-2.ogg" type="audio/ogg" />' + '		<source src="/rjk/up-2.mp3" type="audio/mpeg" />' + "	</audio>" + '	<audio id="up-3">' + '		<source src="/rjk/up-3.ogg" type="audio/ogg" />' + '		<source src="/rjk/up-3.mp3" type="audio/mpeg" />' + "	</audio>" + "</div>";
            $("#player .wrap").append(ljrAudio);
            $("#rjk audio").each(function () {
                var t = $(this).attr("id").split("-")[0];
                var i = $(this).attr("id").split("-")[1];
                Radio.RJKAudio[t][i] = "#" + $(this).attr("id")
            });
            Radio.RJKReady = true
        };
        this.toggleRJK = function (toggleOn, viaBeta) {
            if (viaBeta === undefined) Radio.toggleLJR(false, true);
            if (toggleOn) {
                if (!Radio.RJKReady) Radio.initRJK();
                $("#rjk-toggle").addClass("on");
                $("#logo").addClass("rjk");
                clearTimeout(Radio.RJKTimeout);
                Radio.RJKTimeout = setTimeout(function () {
                    Radio.logoShimmy()
                }, 210);
                Radio.RJK = true;
                if (!State.radioMode) {
                    if ($("#radio-start-big").length > 0) Radio.playAlreadyLoadedStation(); else Radio.goToCurrentStation();
                    var stationInfo = Radio.getStationInfo();
                    var stationId = stationInfo.stationId;
                    var stationType = stationInfo.stationType;
                    var stationName = stationInfo.stationName;
                    Analytics.logAndSendEventToGA("site:header:radio:rjk:start_radio:click", "stationId", stationId, "stationName", stationName, "stationType", stationType)
                }
            } else {
                $("#rjk-toggle").removeClass("on");
                $("#logo").removeClass("rjk");
                Radio.RJK = false
            }
        };
        $(function () {
            $("#logo a").append('<div id="ljr-logo"></div><div id="rjk-logo"></div>');
            $("#ljr-toggle").click(function () {
                var toggle = $(this).hasClass("on");
                Radio.toggleLJR(!toggle)
            });
            $("#rjk-toggle").click(function () {
                var toggle = $(this).hasClass("on");
                Radio.toggleRJK(!toggle)
            })
        })
    };
Radio.userStations = null;
Radio.acRateManager;
Radio.acRateLimit = 300;
Radio.acReady = true;
Radio.acQueued = Radio.acFetched = "";
Radio.acResults = [];
Radio.LJRReady = false;
Radio.LJR = false;
Radio.LJRWhatCount = Radio.LJRWhatMax = 0;
Radio.LJRAudio = {what: [], yea: [], okay: []};
Radio.LJRTimeout;
Radio.RJKReady = false;
Radio.RJK = false;
Radio.RJKAudio = {down: [], up: [], skip: []};
Radio.RJKTimeout;
Radio.availableLanguages = ["english", "hindi", "tamil", "telugu"];
var Interface = Interface || new function () {
        var intHide, intResize;
        var KEY_ESC = 27;
        var KEY_ENT = 13;
        var KEY_PREV = 37;
        var KEY_NEXT = 39;
        var KEY_SPACE = 32;
        var KEY_CTRL = 17;
        var KEY_CMND = 91;
        this.smoothTo = function (t, s, callback, offset, container) {
            if (s === undefined) {
                var s = 420
            }
            if (t === undefined || t == 0) {
                var targetOffset = 0
            } else {
                if (offset === undefined)var offset = 12;
                var targetOffset = $(t).offset().top - offset
            }
            if (container === undefined)var container = "html, body";
            var cbCount = 0;
            $(container).animate({scrollTop: targetOffset}, s, function () {
                if (typeof callback == "function" && cbCount < 1) {
                    callback();
                    cbCount++
                }
            });
            return false
        };
        this.inviteFriendsCallback = function () {
            var name = $(this).attr("data-first");
            var description = (name == "" ? "I'm" : name + " is") + " listening to the best music on Saavn, for free. Get Saavn to check out " + (name == "" ? "my" : name + "'s") + " mix, search and play your favorites, and make your own playlists.";
            FBUtil.popFBDialog({
                method: "send",
                name: "Join me on Saavn!",
                link: "http://www.saavn.com",
                picture: "http://corporate.saavn.com/_i/_corp/saavn-icon.png",
                description: description
            });
            Analytics.logAndSendEventToGA("content:friend-view:invite:click")
        };
        this.updateLanguageDisplay = function (lang) {
            lang = lang.toLowerCase().replace(/\b[a-z]/g, function (letter) {
                return letter.toUpperCase()
            });
            $("#currentLanguage").html(lang);
            var current = '<em class="current">current</em>';
            $("#language ol li em").remove();
            $("#language ol li").each(function (i) {
                if ($(this).find("a").html() == lang) {
                    $(this).find("a").append(current);
                    return false
                }
            })
        };
        this.isAppPage = function () {
            return $("body").attr("id") != "home" && $("body").attr("id") != "signup" && $("body").attr("id") != "login" && $("body").attr("id") != "forgot" && $("body").attr("class") != "signup-login"
        };
        this.localStorageSupport = function () {
            try {
                return "localStorage" in window && window["localStorage"] !== null
            } catch (e) {
                return false
            }
        };
        this.isToggle = function (e) {
            if ($(e.target).hasClass("tiny-toggle") || $(e.target).parent().hasClass("tiny-toggle") || $(e.target).parent().hasClass("gutter") || $(e.target).parent().hasClass("handle"))return true; else return false
        };
        function _menuCheck(e) {
            var winTop = $(window).scrollTop();
            var winBtm = winTop + $(window).height();
            var eTop = $(e).offset().top;
            var eBtm = eTop + $(e).outerHeight();
            return winBtm - eBtm - $("#player").outerHeight()
        }

        function preventDefault(e) {
            e = e || window.event;
            if (e.preventDefault) e.preventDefault();
            e.returnValue = false
        }

        function _mouseWheel(e) {
            preventDefault(e)
        }

        function _disableScroll() {
            $("body").addClass("block-scroll");
            if (window.addEventListener) {
                window.addEventListener("DOMMouseScroll", _mouseWheel, false)
            }
            window.onmousewheel = document.onmousewheel = _mouseWheel
        }

        function _enableScroll() {
            $("body").removeClass("block-scroll");
            if (window.removeEventListener) {
                window.removeEventListener("DOMMouseScroll", _mouseWheel, false)
            }
            window.onmousewheel = document.onmousewheel = null
        }

        this.initUI = function (t) {
            if (t === undefined)var t = $("body");
            $(".ac_results").fadeOut(120);
            $(t).find(".menu").each(function (i) {
                if ($(this).hasClass("disabled"))return;
                if (!$(this).hasClass("click")) {
                    $(this).unbind("hover").hover(function () {
                        $(this).addClass("active")
                    }, function () {
                        $(this).removeClass("active")
                    })
                } else {
                    $(this).unbind("click").click(function (e) {
                        if ($(this).attr("id") == "now-playing-extras") {
                            var t = $(this);
                            if ($(t).hasClass("active")) {
                                $(t).removeClass("active");
                                $("#menu-shade").remove()
                            } else {
                                $(t).addClass("active");
                                $(t).parent().append('<div id="menu-shade"></div>');
                                $("#menu-shade").click(function () {
                                    $(t).removeClass("active");
                                    $(this).remove()
                                })
                            }
                        } else {
                            var t = $(this).find(".drop").clone(true);
                            var d = $(this).closest(".song-wrap").find(".song-json").clone();
                            Panel.pillMenu(t, $(this), d, $(this).hasClass("right"))
                        }
                        if ($(this).hasClass("cTip")) $(this).removeClass("hover")
                    })
                }
                if ($(this).hasClass("clickable")) {
                    $(this).mousedown(function (e) {
                        if (!$(e.target).hasClass("clickable") && !$(e.target).parent().hasClass("clickable")) {
                            e.stopPropagation();
                            $(this).addClass("sub-clicked")
                        }
                    });
                    $(this).mouseup(function (e) {
                        $(this).removeClass("sub-clicked")
                    });
                    $(this).mouseover(function (e) {
                        $(this).removeClass("sub-clicked")
                    })
                }
            });
            $(t).find("#rename-playlist").click(function () {
                var title = $(".editable-fields input[type=text]").val($(".editable-label").text());
                $(".editable-label, .meta-info .editable + .page-subtitle, .meta-info .page-subtitle + p.meta").hide();
                $(".editable-fields").show().css("display", "block")
            });
            $(t).find(".editable-fields .cancel").click(function () {
                $(".editable-fields").hide().find("input[type=text]").val("");
                $(".editable-label, .meta-info .editable + .page-subtitle, .meta-info .page-subtitle + p.meta").show()
            });
            $(t).find(".editable-fields .save").click(function () {
                var listname = $(".editable-fields input[type=text]").val().trim();
                var listid = $(".editable-fields input[type=hidden]").val();
                if (listname == "") {
                    alert("Please enter a name for your playlist.");
                    return
                }
                if (listname.length < 2) {
                    alert("Playlist names must be at least 2 characters.");
                    return
                }
                var playlists = State.playlistsData();
                if (playlists != undefined) {
                    for (var i = 0; i < playlists.length; ++i) {
                        var existingListname = playlists[i].listname;
                        var existingListId = playlists[i].listid;
                        if (existingListname == listname && listid != existingListId) {
                            alert("A playlist with that name already exists!");
                            return false
                        }
                    }
                    State.renamePlaylist(listname, listid)
                }
                $(".editable-fields").hide().find("input[type=text]").val("");
                $(".editable-label").text(listname);
                $(".editable-label, .meta-info .editable + .page-subtitle, .meta-info .page-subtitle + p.meta").show()
            });
            $(t).find("#change-password").click(function () {
                $(t).find("#old-pass").hide();
                $(t).find("#new-pass").fadeIn(120)
            });
            $(t).find("#change-email").click(function () {
                $(t).find("#old-pass").hide();
                $(t).find("#new-email").hide()
            });
            $(t).find(".more-link").click(function () {
                $(this).parent().addClass("show-more")
            });
            $(t).find(".less-link").click(function () {
                $(this).parent().parent().removeClass("show-more")
            });
            $(t).find("li.show-more a").click(function () {
                if ($(this).parent().hasClass("close")) {
                    var t = $(this);
                    if ($(this).parent().parent().find(".hide:not(.song-json)").length < 26) {
                        $(this).parent().parent().find(".show-more").show();
                        $(this).parent().parent().find(".hide:not(.song-json)").slideUp(120, function () {
                            $(t).parent().hide()
                        })
                    } else {
                        $(this).parent().parent().find(".show-more").show();
                        $(this).parent().parent().find(".hide:not(.song-json)").hide();
                        $(t).parent().hide()
                    }
                    $(this).parent().parent().removeClass("showing-all")
                } else {
                    if ($(this).parent().parent().find(".hide:not(.song-json)").length < 26) {
                        $(this).parent().parent().find(".hide:not(.song-json)").slideDown(120)
                    } else {
                        $(this).parent().parent().find(".hide:not(.song-json)").show()
                    }
                    $(this).parent().hide();
                    $(this).parent().parent().addClass("showing-all")
                }
                Analytics.logAndSendEventToGA("site:playlist:songs:show_all_songs:click")
            });
            $(t).find(".toggle").click(function () {
                if ($(this).hasClass("on")) $(this).removeClass("on"); else $(this).addClass("on")
            });
            $(t).find("#user-social-settings .toggle").click(function () {
                Interface.updateSocialPref($(this))
            });
            $(t).find("#user-email-settings .toggle").click(function () {
                Interface.updateEmailPref($(this))
            });
            $(t).find("input[type=text].autofill").each(function () {
                var orig = $(this).attr("title");
                $(this).attr("title", "");
                if ($(this).val().replace(/ /g, "") == "") {
                    $(this).val(orig);
                    $(this).addClass("empty")
                }
                $(this).bind("focus.autofill", function () {
                    if ($(this).val() == orig) {
                        $(this).val("")
                    }
                    $(this).removeClass("empty")
                });
                $(this).bind("blur.autofill", function () {
                    if ($(this).val().replace(/ /g, "") == "") {
                        $(this).val(orig);
                        $(this).addClass("empty")
                    }
                })
            });
            $(t).find("input[type=password].autofill").each(function () {
                var lbl = '<label class="pw-label">' + $(this).attr("title") + "</label>";
                $(this).attr("title", "");
                $(this).parent().css("position", "relative").addClass("empty");
                $(this).parent().append(lbl);
                var t = $(this).parent().find(".pw-label");
                $(t).click(function () {
                    $(this).parent().find("input[type=password]").focus();
                    $(this).fadeOut(120)
                });
                if ($(this).val().replace(/ /g, "") == "") {
                    $(t).fadeIn(120)
                }
                $(this).focus(function () {
                    $(this).parent().removeClass("empty");
                    $(t).fadeOut(120)
                });
                $(this).blur(function () {
                    if ($(this).val().replace(/ /g, "") == "") {
                        $(this).parent().addClass("empty");
                        $(t).fadeIn(120)
                    }
                })
            });
            $(t).find(".autoselect").focus(function () {
                $(this).select().mouseup(function (e) {
                    e.preventDefault();
                    $(this).unbind("mouseup")
                });
                $(this).select()
            });
            $(t).find(".list-select li a").click(function () {
                $(".list-select li").removeClass("on");
                $(this).parent().addClass("on");
                $(this).parent().parent().find(".list-select-input").val("");
                $(this).parent().parent().find(".list-select-input").blur()
            });
            $(t).find(".list-select .list-select-input").focus(function () {
                $(".list-select li").removeClass("on")
            });
            $(t).find(".tab-group").each(function () {
                var g = $(this);
                var t = $(this).find(".quick-tabs li");
                if ($(t).length > 0) {
                    $(t).find("a").each(function () {
                        $(this).click(function () {
                            var tabToClear = $(g).find("li.current").attr("data-tab");
                            $(t).removeClass("current");
                            $(this).parent().addClass("current");
                            $(g).find(".quick-tab").hide();
                            var displayTab = $(g).find(".quick-tab." + $(this).parent().attr("data-tab"));
                            if (displayTab.hasClass("dynamic")) {
                                displayTab.find("ol").empty();
                                displayTab.find("a.with-spinner").attr("data-currentPage", 0);
                                displayTab.find("a.with-spinner").attr("style", "");
                                displayTab.find(".empty-state").addClass("hide")
                            }
                            displayTab.show();
                            if (displayTab.find("ul").length) {
                                displayTab.find("li.active").click()
                            } else {
                                displayTab.find("a.with-spinner").click()
                            }
                            var currentPage = Util.getPageType().toLowerCase();
                            if (currentPage == "owner-profile") {
                                currentPage = "profile"
                            }
                            var currentTab = $(".quick-tabs").find("li.current a").text().toLowerCase() + "_tab";
                            var trackingEvent = "site:" + currentPage + ":" + currentTab + ":click";
                            Analytics.logAndSendEventToGA([trackingEvent])
                        })
                    })
                }
            });
            $(t).find(".sub-tabs").children().each(function () {
                $(this).click(function () {
                    var currentPage = Util.getPageType().toLowerCase();
                    if (currentPage == "owner-profile") {
                        currentPage = "profile"
                    }
                    var currentTab = "." + $(".sub-tabs").find(".active").attr("data-tab");
                    var displayTab = "." + $(this).attr("data-tab");
                    var loadMore = $(displayTab + " a.with-spinner");
                    if (currentTab == displayTab && $(currentTab + " ol").children().length) {
                        return
                    }
                    $(displayTab + " ol").empty();
                    loadMore.removeClass("disabled");
                    loadMore.attr("style", "");
                    loadMore.attr("data-currentpage", "0");
                    $(".sub-tabs").children().removeClass("active");
                    $(this).addClass("active");
                    $(currentTab).attr("style", "display:none");
                    $(currentTab).removeClass("active");
                    $(currentTab).find(".empty-state").addClass("hide");
                    $(displayTab).attr("style", "");
                    $(displayTab).addClass("active");
                    $(displayTab).removeClass("hide");
                    var parentTabName = $(".quick-tabs").find("li.current a").text().toLowerCase() + "_tab";
                    var subTabName = $(".sub-tabs").find("li.active a").text().toLowerCase();
                    var trackingEvent = "site:" + currentPage + ":" + parentTabName + ":" + subTabName + ":click";
                    Analytics.logAndSendEventToGA([trackingEvent]);
                    loadMore.click()
                })
            });
            if ($(".language-prompt").length > 0) {
                var langIntCount = 0;
                $("#language-tabs").addClass("animate");
                var langInt = setInterval(function () {
                    langIntCount++;
                    if (langIntCount == 1 || langIntCount == 3) {
                        $("#language-tabs").addClass("pulse")
                    } else if (langIntCount == 2 || langIntCount == 4) {
                        $("#language-tabs").removeClass("pulse")
                    } else {
                        $("#language-tabs").removeClass("animate");
                        clearInterval(langInt)
                    }
                }, 570)
            }
            $(t).find(".change-password").unbind("click").click(function () {
                Panel.showPasswordPanel()
            });
            $(t).find(".change-email").unbind("click").click(function () {
                Panel.showEmailPanel()
            });
            $(t).find(".fb-privacy-toggle").click(function () {
                if ($(this).hasClass("on")) {
                    Util.setCookie("PL", 0);
                    Analytics.logAndSendEventToGA("site:facebook_settings:share_to_facebook:off:click")
                } else {
                    Analytics.logAndSendEventToGA("site:facebook_settings:share_to_facebook:on:click");
                    Util.setCookie("PL", 1)
                }
            });
            if ($("#friends").length > 0) {
                $(t).find("#invite-friends").click(function () {
                    Interface.inviteFriendsCallback()
                })
            }
            $(t).find(".cTip").each(function () {
                $(this).find(".cTip-wrap").append('<span class="cTip-marker"></span>');
                $(this).hover(function () {
                    $(this).addClass("hover")
                }, function () {
                    $(this).removeClass("hover")
                })
            });
            $(t).find(".more-suggestions").click(function () {
                Interface.smoothTo($(".suggestions"))
            });
            $(t).find("#filter-btn").click(function () {
                if ($(".page-wrap.search").hasClass("open")) {
                    $(".page-wrap.search").removeClass("open");
                    $(this).removeClass("green").text("Filter");
                    $("#filter-cols").slideUp(120)
                } else {
                    $(".page-wrap.search").addClass("open");
                    $(this).text("Close").addClass("green");
                    $("#filter-cols").slideDown(120)
                }
            });
            $(t).find(".overlay-action-buttons button").each(function () {
                $(this).click(function (e) {
                    e.stopPropagation()
                })
            });
            $(t).find("#artist-more-songs").click(function (url) {
                $(this).addClass("show-spinner");
                var nextPage = $("#artist-more-songs").attr("data-pages");
                nextPage = parseInt(nextPage) + 1;
                var sortOrder = "";
                var currentTab = $("#artist-sort-tabs").find("li.active");
                if (currentTab.hasClass("sortable")) {
                    sortOrder = currentTab.find("abbr").hasClass("asc") ? "asc" : "desc"
                }
                criteria = {nextPage: nextPage, sortOrder: sortOrder};
                _loadContentTab(criteria, "songs", true);
                var artistName = $($("div.profile-image").find("img")).attr("alt");
                var pageType = $(".page-wrap").attr("data-type");
                Analytics.logAndSendEventToGA(["inner:content:" + pageType + "_pages:songs_tab:load_more:click", pageType + "_name", artistName])
            });
            $(t).find("#artist-more-albums").click(function (url) {
                $(this).addClass("show-spinner");
                var nextPage = $("#artist-more-albums").attr("data-pages");
                nextPage = parseInt(nextPage) + 1;
                var sortOrder = "";
                var currentTab = $("#artist-sort-tabs").find("li.active");
                if (currentTab.hasClass("sortable")) {
                    sortOrder = currentTab.find("abbr").hasClass("asc") ? "asc" : "desc"
                }
                criteria = {nextPage: nextPage, sortOrder: sortOrder};
                _loadContentTab(criteria, "albums", true);
                var artistName = $($("div.profile-image").find("img")).attr("alt");
                var pageType = $(".page-wrap").attr("data-type");
                Analytics.logAndSendEventToGA(["inner:content:" + pageType + "_pages:albums_tab:load_more:click", pageType + "_name", artistName])
            });
            $(t).find("#featuredPlaylists-more-playlists").click(function () {
                var loadingLabel = $("#featuredPlaylists-more-playlists");
                loadingLabel.addClass("show-spinner disabled");
                var offset = $(".grid-list").find("li").size() + 1;
                var size = 10;
                var lang = $("#language-tabs").find(".current").children().text().toLowerCase();
                var url = "/api.php?__call=playlist.getFeaturedPlaylists&_marker=false&language=" + lang + "&offset=" + offset + "&size=" + size;
                var callback = function (data) {
                    $xml = $(Util.getXMLObj(data));
                    $playlists = $xml.find("playlist");
                    if ($playlists.size() == 0) {
                        loadingLabel.css("display", "none");
                        return
                    }
                    $playlists.each(function () {
                        var html = "<li>" + Playlist.getPlaylistElement(this) + "</li>";
                        $(".grid-list").append(html);
                        loadingLabel.removeClass("show-spinner disabled")
                    })
                };
                Util.call(url, callback)
            });
            $(t).find("#load-more-following-all, #load-more-following-artists, #load-more-following-users, #load-more-followers").click(function () {
                var loadingLabel = $(this);
                loadingLabel.addClass("show-spinner disabled");
                var currentPage = loadingLabel.attr("data-currentPage");
                var type = loadingLabel.attr("data-type");
                var appendTo = loadingLabel.attr("data-appendTo");
                currentPage++;
                var url = window.location.pathname + "?qt=a&_marker=0&type=" + type + "&p=" + currentPage;
                var callback = function (data) {
                    if (!data.trim()) {
                        var entitiesDisplayed = $("#" + appendTo).children().length;
                        if (entitiesDisplayed == 0) {
                            loadingLabel.parent().siblings(".empty-state").removeClass("hide");
                            var trackingEvent = "site:";
                            var pageType = Util.getPageType();
                            if (pageType == "owner-profile") {
                                pageType = "profile"
                            }
                            var currentTab = $(".quick-tabs").find("li.current a").text().toLowerCase() + "_tab";
                            var subTab = "";
                            if (currentTab == "following_tab") {
                                subTab = $(".sub-tabs").find("li.active a").text().toLowerCase()
                            }
                            trackingEvent += pageType + ":" + currentTab + ":";
                            if (subTab) {
                                trackingEvent += subTab + ":"
                            }
                            trackingEvent += "empty_no_data:ui:view";
                            Analytics.logAndSendEventToGA([trackingEvent])
                        }
                        loadingLabel.css("display", "none");
                        return
                    }
                    loadingLabel.attr("data-currentPage", currentPage);
                    $("#" + appendTo).append(data);
                    loadingLabel.removeClass("show-spinner disabled");
                    var windowBottom = $(window).scrollTop() + $(window).height();
                    var loadingLabelBottom = loadingLabel.offset().top + loadingLabel.height();
                    if (loadingLabelBottom < windowBottom) {
                        loadingLabel.click()
                    }
                };
                Util.call(url, callback)
            });
            $(t).find("#load-more-friends").click(function () {
                var loadingLabel = $("#load-more-friends");
                loadingLabel.addClass("show-spinner disabled");
                var totalPages = loadingLabel.attr("data-totalPages");
                var currentPage = loadingLabel.attr("data-currentPage");
                if (currentPage == totalPages) {
                    return
                }
                currentPage++;
                var url = "/people.php?qt=a&_marker=0&type=friends&p=" + currentPage;
                var callback = function (data) {
                    loadingLabel.attr("data-currentPage", currentPage);
                    if (currentPage == totalPages) {
                        loadingLabel.css("display", "none")
                    }
                    $("#friends").append(data);
                    loadingLabel.removeClass("show-spinner disabled")
                };
                Util.call(url, callback)
            });
            if (Interface.isAppPage()) Interface.initKeyControls();
            if ($(t).find(".radio").length > 0) Interface.initRadioUI();
            Interface.checkPlayButtonStates($(t));
            if ($(t).find(".fb-comments").length > 0) $(".fb-comments").attr("data-width", $(".fb-comments").parent().width());
            Interface.checkIE8()
        };
        this.checkPlayButtonStates = function (t, forceClear) {
            if (t === undefined || t == "")var t = $(".page-wrap");
            if ($(t).length == 0)return;
            if (forceClear) {
                $(t).find(".song-wrap").removeClass("current-song");
                return
            }
            if (typeof Player == "undefined")return;
            var state = Player.getState();
            if (!state || state === undefined || state === null)return;
            var currentSong = Player.getCurrentSong();
            if (!currentSong || currentSong === undefined || currentSong === null)return;
            currentSong = currentSong.songid;
            $(t).find(".song-wrap").each(function (i) {
                if ($(this).attr("data-songid") == currentSong) $(this).addClass("current-song"); else $(this).removeClass("current-song")
            })
        };
        function _loadContentTab(criteria, informationType, isAppend) {
            var loadMoreButton = "#artist-more-" + informationType;
            $(loadMoreButton).addClass("disabled show-spinner");
            var url = $("#artist-content").attr("data-url");
            var nextPage = 0;
            if (criteria && criteria.nextPage) nextPage = criteria.nextPage;
            var sortBy = $("#artist-sort-tabs .active").attr("data-sort-by").toLowerCase();
            var language = $("#current-artist-language").text();
            if (language == "All Languages") {
                language = ""
            }
            var sortOrder = "";
            if (criteria && criteria.sortOrder) sortOrder = criteria.sortOrder;
            url = url + "?page=" + nextPage + "&category=" + sortBy + "&type=" + informationType + "&language=" + language + "&sort_order=" + sortOrder;
            if (isAppend == false) {
                Util.logAndGoToUrl("", url)
            } else {
                url = url + "&qt=a&more=1&_marker=0";
                Util.call(url, function (data) {
                    if (informationType == "songs") {
                        $(".artist-view .track-list, .label-view .track-list").append(data);
                        Interface.initUI($(".artist-view .track-list, .label-view .track-list"))
                    } else if (informationType == "albums") {
                        $(".artist-view .grid-list.albums, .label-view .grid-list.albums").append(data);
                        Interface.initUI($(".grid-list.albums"))
                    }
                    var next = 0;
                    try {
                        var nextElement = $.grep($(data), function (e) {
                            return e.id == "next"
                        });
                        next = $(nextElement).text();
                        $(nextElement).remove()
                    } catch (ex) {
                    }
                    if (next == 1) {
                        $(loadMoreButton).removeClass("disabled show-spinner");
                        var currentPage = parseInt($(loadMoreButton).attr("data-pages"));
                        $(loadMoreButton).attr("data-pages", currentPage + 1)
                    } else {
                        $(loadMoreButton).fadeOut(120)
                    }
                }, null, false)
            }
        }

        this.sortContentTab = function (params) {
            var sourceEl = params[0];
            var tabType = params[1];
            var category = params[2];
            var artistName = params[3];
            if ($(sourceEl).hasClass("active") && !$(sourceEl).hasClass("sortable"))return;
            var sortOrder = "";
            var sortType = $(sourceEl).attr("data-sort-type");
            var descDisplay = "&darr;";
            var ascDisplay = "&uarr;";
            switch (sortType) {
                case"alpha":
                    descDisplay = "&uarr;";
                    ascDisplay = "&darr;";
                    break;
                default:
                    descDisplay = "&darr;";
                    ascDisplay = "&uarr;"
            }
            if (!$(sourceEl).hasClass("active")) {
                $("#artist-sort-tabs li").removeClass("active");
                $("#artist-sort-tabs abbr.sort").remove();
                $(sourceEl).addClass("active");
                if ($(sourceEl).hasClass("sortable")) {
                    if ($(sourceEl).attr("data-sort-default") == "asc") {
                        $(sourceEl).find("a").append('<abbr class="sort asc">' + ascDisplay + "</abbr>");
                        sortOrder = "asc"
                    } else {
                        $(sourceEl).find("a").append('<abbr class="sort desc">' + descDisplay + "</abbr>");
                        sortOrder = "desc"
                    }
                }
            } else if ($(sourceEl).hasClass("sortable")) {
                var s = $(sourceEl).find(".sort");
                if ($(s).hasClass("desc")) {
                    $(s).removeClass("desc").addClass("asc").html(ascDisplay);
                    sortOrder = "asc"
                } else {
                    $(s).removeClass("asc").addClass("desc").html(descDisplay);
                    sortOrder = "desc"
                }
            }
            if (tabType == "songs") {
                $(".track-list.with-meta.with-art").empty()
            } else if (tabType == "albums") {
                $(".grid-list.albums").empty()
            }
            $("#artist-more-" + tabType).attr("data-pages", 0);
            _loadContentTab({sortOrder: sortOrder}, tabType, false);
            var pageType = $(".page-wrap").attr("data-type");
            Analytics.logAndSendEventToGA(["inner:content:" + pageType + "_pages:" + tabType + "_tab:sort_by:" + category, pageType + "_name", artistName])
        };
        this.filterContentByLanguage = function (trackingParams) {
            var language = trackingParams[0];
            var tabType = trackingParams[1];
            var artistName = trackingParams[2];
            if (language == "all") {
                language = "All Languages"
            } else {
                language = language.charAt(0).toUpperCase() + language.slice(1)
            }
            if ($("#current-artist-language").text() == language) {
                return
            }
            $("#current-artist-language").text(language);
            if (tabType == "songs") {
                $(".track-list.with-meta.with-art").empty()
            } else if (tabType == "albums") {
                $(".grid-list.albums").empty()
            }
            $("#artist-more-" + tabType).attr("data-pages", 0);
            _loadContentTab({}, tabType, false);
            var pageType = $(".page-wrap").attr("data-type");
            Analytics.logAndSendEventToGA(["inner:content:" + pageType + "_pages:" + tabType + "_tab:language_filter:" + language + ":click", pageType + "_name", artistName])
        };
        function _loadMoreFriends(p) {
            $("#more-friends").unbind("click").addClass("show-spinner disabled");
            Util.call("/friends.php?_marker=0&p=" + p + "&qt=a", function (data) {
                Interface.updateFriends(data, p)
            }, null, false)
        }

        function _inviteLazyLoad() {
            if ($("#invite-scroller li:not(.loaded)").length > 0) {
                var scrollPos = $("#invite-scroller .sCroll-wrap").outerHeight() + 120;
                $("#invite-scroller li:not(.loaded)").each(function (i) {
                    if (scrollPos > $(this).offset().top) {
                        $(this).find("img.friend").attr("src", $(this).find("img.friend").attr("data-src"));
                        $(this).addClass("loaded")
                    }
                })
            } else {
                $("#invite-scroller .sCroll-wrap").unbind("scroll.invites");
                $(window).unbind("resize.invites")
            }
        }

        this.updateFriends = function (data, p) {
            $(data).insertBefore(".invite-pager");
            if (p < $("#more-friends").attr("data-pages")) {
                $("#more-friends").unbind("click").click(function () {
                    if (!$(this).hasClass("disabled")) _loadMoreFriends(p + 1)
                });
                $("#more-friends").removeClass("show-spinner disabled")
            } else {
                $(".invite-pager").remove()
            }
        };
        this.updateToggle = function (t, changeto) {
            var tgt = $(t).find("a");
            if (changeto == "checked" || status == true) {
                $(tgt).removeClass("left-on").addClass("right-on")
            } else {
                $(tgt).removeClass("right-on").addClass("left-on")
            }
        };
        this.showLoading = function (t) {
            var isPage = false;
            if (t === undefined) {
                var t = $("#main");
                isPage = true
            }
            if ($(t).find("#page-loading").length > 0)return;
            if (isPage) $("body").addClass("loading"); else $(t).addClass("quick-loading");
            $(t).append('<div id="page-loading"><div class="loader"></div></div>');
            $("#page-loading").hide().fadeIn(210);
            if (isPage) {
                Interface.smoothTo(0, 0);
                autoComplete.hide()
            }
        };
        this.hideLoading = function (t, fade) {
            if (t === undefined) {
                var t = $("body");
                Interface.clearTimers()
            }
            if (fade === undefined)var fade = false;
            if (fade) $("#page-loading").fadeOut(340, function () {
                $(t).removeClass("loading quick-loading");
                $(this).remove()
            }); else {
                $("#page-loading").hide();
                $(t).removeClass("loading quick-loading")
            }
        };
        this.clearTimers = function () {
            _clearTwitterRadioHelp()
        };
        this.cPanel = function (tgt, options) {
            if (tgt === undefined || $(tgt).length == 0)return;
            $("#cPanel-shade").remove();
            $(".cPanel-wrap").each(function () {
                if (!$(this).find(".cpanel").hasClass("keep")) $(this).remove();
                $("#drawer-queue-group > li").removeClass("flyout")
            });
            var settings = $.extend({}, {
                disable: false,
                gaCancelEvent: false,
                keep: false,
                media: false,
                modal: true,
                pos: {auto: true, pinRight: false, right: false, tick: false, xPos: 0, yPos: 0},
                w: 620,
                h: "auto"
            }, options);
            $(tgt).find(".close, #panel-close").unbind("click.panel").bind("click.panel", function () {
                Interface.cPanelClose("", settings.keep, settings.gaCancelEvent)
            });
            $("body").append('<div id="cPanel-shade"' + (settings.media ? 'class="dark"' : "") + "></div>");
            $(tgt).wrap('<div class="cPanel-wrap' + (settings.media ? " with-media" : "") + '"></div>');
            if (settings.pos.tick) {
                $(".cPanel-wrap").addClass("ticked").append('<div class="cPanel-tick"></div>');
                if (settings.pos.pinRight) $(".cPanel-tick").addClass("ticked-right")
            }
            $("#cPanel-shade").click(function () {
                if (!settings.disable) Interface.cPanelClose("", settings.keep, settings.gaCancelEvent)
            });
            $(tgt).parent().css("width", settings.w + "px");
            if (settings.h != "auto") $(tgt).parent().css({"min-height": settings.h + "px"});
            $(tgt).show();
            _enableScroll();
            if (settings.modal) $("body").addClass("modal-cPanel"); else _disableScroll();
            var overlay = $(tgt).parent();
            if (settings.pos.auto) {
                Interface.cPanelPosition(overlay);
                $(window).bind("resize.panel", function () {
                    Interface.cPanelPosition(overlay)
                })
            } else {
                if (settings.pos.pinRight) {
                    $(overlay).css({
                        left: "auto",
                        position: "fixed",
                        right: settings.pos.xPos + "px",
                        top: settings.pos.yPos + "px"
                    })
                } else if (settings.pos.right) {
                    $(overlay).css({
                        left: "auto",
                        position: "fixed",
                        right: $(window).width() - settings.pos.xPos + "px",
                        top: settings.pos.yPos + "px"
                    })
                } else {
                    $(overlay).css({left: settings.pos.xPos + "px", position: "fixed", top: settings.pos.yPos + "px"})
                }
                var winBtm = parseInt($(window).scrollTop()) + parseInt($(window).height());
                var eBtm = parseInt($(overlay).offset().top) + parseInt($(overlay).outerHeight());
                if (winBtm - eBtm < 0) {
                    $(overlay).css("margin-top", winBtm - eBtm - 5 + "px");
                    $(".cPanel-tick").css("margin-top", (winBtm - eBtm - 5) * -1 + "px")
                }
            }
            $(overlay).fadeIn(120, function () {
                if (!settings.disable) {
                    $(document).bind("keyup.panel", function (e) {
                        if (e.keyCode == KEY_ESC) {
                            Interface.cPanelClose("", settings.keep, settings.gaCancelEvent)
                        }
                    })
                }
            })
        };
        this.cPanelClose = function (tgt, keep, gaCancelEvent, callback, animate) {
            var shade = $("#cPanel-shade");
            var fadeSpeed = 120;
            var shadeSpeed = 210;
            if (animate == false) {
                fadeSpeed = 0;
                shadeSpeed = 0
            }
            if (tgt === undefined || tgt == "")var tgt = "#" + $(".cPanel-wrap").children(":first").attr("id");
            if ($(tgt).parent().hasClass("cPanel-wrap")) {
                $(tgt).parent().fadeOut(fadeSpeed, function () {
                    $(shade).fadeOut(shadeSpeed, function () {
                        $(document).unbind("keyup.panel");
                        $(window).unbind("resize.panel");
                        $(shade).remove();
                        $(tgt).hide().unwrap();
                        $(".cPanel-wrap").remove();
                        if (!keep) {
                            $(tgt).remove();
                            $(".cPanel-tick").remove()
                        }
                        _enableScroll();
                        $("body").removeClass("modal-cPanel show-drawer force-drawer");
                        $("#drawer-queue-group > li").removeClass("flyout");
                        if (typeof callback == "function") callback()
                    })
                })
            } else {
                $(document).unbind("keyup.panel");
                $(window).unbind("resize.panel");
                $(shade).remove();
                $(tgt).hide().unwrap();
                $(".cPanel-wrap").remove();
                if (!keep) {
                    $(tgt).remove();
                    $(".cPanel-tick").remove()
                }
                _enableScroll();
                $("body").removeClass("modal-cPanel show-drawer force-drawer");
                $("#drawer-queue-group > li").removeClass("flyout");
                if (typeof callback == "function") callback()
            }
            Panel.successCallback = null;
            if (gaCancelEvent) {
                if (Sidebar.addToPlaylistEvent) {
                    Sidebar.addToPlaylistEvent = false
                }
                Analytics.logAndSendEventToGA(gaCancelEvent)
            }
        };
        this.cPanelPosition = function (tgt, animate, speed) {
            if (animate === undefined)var animate = false;
            if (speed === undefined)var speed = 210;
            var padX = Math.round($(tgt).css("padding-left").replace(/[^\d\.]/g, "") * 1 + $(tgt).css("padding-right").replace(/[^\d\.]/g, "") * 1);
            var padY = Math.round($(tgt).css("padding-top").replace(/[^\d\.]/g, "") * 1 + $(tgt).css("padding-bottom").replace(/[^\d\.]/g, "") * 1);
            var posX = Math.round($(window).width() / 2 - $(tgt).width() / 2 - padX / 2);
            var posY = Math.round($(window).height() / 2 - $(tgt).height() / 2 - padY / 2);
            if (animate) {
                $(tgt).css({position: "fixed"});
                $(tgt).animate({top: posY + "px", left: posX + "px"}, speed)
            } else {
                $(tgt).css({position: "fixed", top: posY, left: posX})
            }
        };
        this.elYPos = function (tgt) {
            return $(tgt).offset().top - Interface.getScrollPos()
        };
        this.elXPos = function (tgt, includeWidth) {
            if (includeWidth === undefined)var includeWidth = false;
            return $(tgt).offset().left + (includeWidth ? $(tgt).outerWidth() : 0)
        };
        this.getScrollPos = function () {
            var scrollPos = $("body").scrollTop();
            if ($("html").hasClass("ie") || $("html").hasClass("gecko")) scrollPos = parseInt($("html").scrollTop());
            return scrollPos
        };
        function _initDrawer() {
            var scrollFrame = $("body").outerHeight() - $("#header").outerHeight();
            $("#queue-scroller").css({height: scrollFrame + "px", width: Interface.drawerWidth + "px"}).sCroller();
            if ($("#fac-scroller").length > 0) $("#fac-scroller").css({
                height: scrollFrame + "px",
                width: $("#fac").width() + "px"
            }).sCroller();
            $("#drawer").hover(function () {
                $("body").addClass("drawer-hover")
            }, function () {
                $("body").removeClass("drawer-hover")
            });
            $("#drawer-hide, #drawer-force").unbind("click").click(function (e) {
                _manualDrawer($(e.target).attr("id"))
            });
            $(window).bind("resize.drawer", function () {
                _layoutAdjust()
            });
            _layoutAdjust()
        }

        function _manualDrawer(btnId) {
            if (btnId == "drawer-hide") {
                $("body").removeClass("drawer-hover");
                $("body").addClass("hide-drawer");
                Analytics.logAndSendEventToGA("sidebar:hide:click")
            } else if (btnId == "drawer-force") {
                $("body").removeClass("hide-drawer")
            }
        }

        this.highlightTrack = function (e) {
            if (e === undefined || e.length == 0)var e = $("#drawer-queue li.now-playing");
            if (e.length == 0)return;
            $("body").addClass("force-drawer");
            var currentPos = $(e).position().top - $(".drawer-scroll.sCroller-content").position().top;
            var padTop = parseInt($("#drawer-queue-group").css("padding-top").replace("px", ""));
            currentPos -= padTop;
            $("#queue-scroller").sCroller("scrollTo", currentPos);
            var to = setTimeout(function () {
                clearTimeout(to);
                $(e).addClass("tada");
                setTimeout(function () {
                    $(e).removeClass("tada");
                    $("body").removeClass("force-drawer")
                }, 2100)
            }, 210)
        };
        this.showTrack = function (e) {
            return;
            if ($(e).length == 0)return false;
            var c = $(".active .drawer-scroll");
            var cBottom = $(c).height();
            var eTop = $(e).position().top;
            var eBottom = eTop + $(e).outerHeight();
            var cOrig = $(c).scrollTop() - (cBottom - eBottom);
            if (eBottom > cBottom) {
            }
        };
        function _layoutAdjust() {
            var scrollFrame = $("body").outerHeight() - $("#header").outerHeight();
            $("#queue-scroller").css({
                height: scrollFrame + "px",
                width: Interface.drawerWidth + "px"
            }).sCroller("resize");
            if ($("#fac-scroller").length > 0) $("#fac-scroller").css({
                height: scrollFrame + "px",
                width: $("#fac").width() + "px"
            }).sCroller("resize");
            if ($(window).height() - $("#player").outerHeight() - $("#header").outerHeight() - 20 < 600) $("#brand-col .ad.half-page, body").addClass("ad-scroll"); else $("#brand-col .ad.half-page, body").removeClass("ad-scroll");
            if ($(".friends").length > 0) {
                if ($(".invites-only").length > 0) {
                    var contentFrame = $("body").outerHeight() - $("#header").outerHeight() - $("#player").outerHeight() - $(".page-header").outerHeight() - 88
                } else {
                    var pageFrame = $("body").outerHeight() - $("#header").outerHeight() - $("#player").outerHeight() - $(".page-header").outerHeight() - 100;
                    var contentFrame = $(".friends-grid li:first-child").outerHeight() * $(".friends-grid li").length - 17;
                    if (pageFrame < contentFrame) contentFrame = pageFrame; else if (contentFrame < 340) contentFrame = 340
                }
                $("#invite-scroller").css({height: contentFrame + "px"}).sCroller("resize")
            }
            $("#main").css({"min-height": $("body").outerHeight() - Interface.mainPad + "px"});
            if (scrollFrame < 600) $("#brand-col").addClass("scroll"); else $("#brand-col").removeClass("scroll");
            if ($(".fb-comments iframe").length > 0) {
                var src = $(".fb-comments iframe").attr("src").split("width="), width = Math.round($(".fb-comments").parent().width());
                $(".fb-comments iframe").attr("src", src[0] + "width=" + width)
            }
        }

        this.checkIE8 = function () {
            if (Interface.isIE) {
                if ($("html").hasClass("ie8")) {
                    $("#ie8fix").remove();
                    $("#main").append('<div id="ie8fix"><script src="/_s/selectivizr.js"></script></div>')
                }
            }
        };
        this.clearExtras = function () {
            $("#main").removeClass("vegas")
        };
        this.hideFixedNotice = function (tgt) {
            $("body").removeClass("show-notice");
            $("#fixed-notice p").slideUp(120, function () {
                $(this).remove()
            })
        };
        this.showFixedNotice = function (content, keep) {
            if (keep === undefined || keep == false) {
                $("#fixed-notice").empty().append('<p><a class="close"></a>' + content + "</p>");
                $("#fixed-notice p").hide().unbind("click").click(function () {
                    Interface.hideFixedNotice()
                })
            } else {
                $("#fixed-notice").empty().append('<p class="keep">' + content + "</p>")
            }
            $("body").addClass("show-notice");
            $("#fixed-notice p").slideDown(120)
        };
        this.showSiteNotice = function (content) {
            $("#site-notice").empty().append('<p class="keep">' + content + "</p>");
            $("body").addClass("site-notice");
            $("#site-notice").addClass("show")
        };
        this.hideAdCol = function () {
            $("#skin-wrap, #brand-col").fadeOut(210)
        };
        this.showAdCol = function () {
            $("#skin-wrap, #brand-col").fadeIn(210)
        };
        this.showCoBrand = function (partner) {
            return;
            if (partner.siteName == null || partner.siteName == "")return false;
            $("#partner-notice").empty().append('<p class="keep">You were brought here by ' + partner.siteName + "</p>");
            if (partner.logo != "" && partner.logoWidth != "" && partner.bg != "" && partner.textColor != "") $("#partner-notice p").css({
                background: partner.bg + " url(" + partner.logo + ") 26px center no-repeat",
                color: partner.textColor,
                "padding-left": partner.logoWidth + 37 + "px"
            });
            $("body").addClass("cobrand-notice");
            $("#partner-notice").show();
            $("#partner-notice p").slideDown(120)
        };
        this.hideCoBrand = function () {
            return;
            $("#partner-notice").hide()
        };
        this.initUser = function () {
            Interface.isPro = Util.getProStatus() == Util.TRIAL || Util.getProStatus() == Util.PRO;
            if (Interface.isPro) Interface.showPro()
        };
        this.updateEmailPref = function (toggle) {
            var uid = State.getUserData("uid");
            var cat = $(toggle).attr("data-category");
            if ($(toggle).hasClass("on")) {
                Util.call("/api.php?__call=email.subscribe&email_category=" + cat + "&uid=" + uid);
            } else {
                Util.call("/api.php?__call=email.unsubscribe&email_category=" + cat + "&uid=" + uid)
            }
        };
        this.updateSocialPref = function (toggle) {
            var category = $(toggle).attr("data-category");
            var platform = $(toggle).attr("data-platform");
            var messagePreferencesJSON = $("#messagePreferencesJSON").text();
            var messagePreferences = jQuery.parseJSON(messagePreferencesJSON);
            messagePreferences["message_preferences"][platform][category]["value"] = $(toggle).hasClass("on");
            messagePreferencesJSON = JSON.stringify(messagePreferences);
            var callback = function (data) {
                data = jQuery.parseJSON(data);
                if (data.status != "success") {
                    State.showNotification("Sorry! Could not update your preferences. Please try again later.")
                }
            };
            var postData = {pref: messagePreferencesJSON};
            Util.call("/api.php?__call=user.setMessagePreference&_format=json&_marker=0", callback, postData, true);
            var toggleValue = $(toggle).hasClass("on") ? "on" : "off";
            var trackingEvent = "site:account:" + platform + "_notifications:" + category + ":" + toggleValue;
            Analytics.logAndSendEventToGA([trackingEvent]);
            $("#messagePreferencesJSON").text(messagePreferencesJSON)
        };
        this.showPro = function () {
            $("body").addClass("pro");
            if (!Interface.isAppPage()) {
                $("#my-playlists #user-starred").removeClass("divider").after('<li class="divider"><a href="/offline.php?qt=a">Offline Songs <span class="offline"></span></a></li>')
            }
        };
        this.hidePro = function () {
            $("body").removeClass("pro")
        };
        this.myMusicNotify = function (options) {
            clearTimeout(Interface.notifyTO);
            var settings = $.extend({}, {
                keep: false,
                note: "",
                notePrefix: "",
                timer: State.noteDuration + 1e3
            }, options);
            var classes = "bounceIn" + (settings.notePrefix == "-" ? " remove" : "") + (settings.noteType == "" ? " hide-prefix" : "");
            $("#my-music-notify").find("span").html(settings.note);
            $("#my-music-notify").find("abbr").html(settings.notePrefix);
            $("#my-music").addClass("show-badge");
            $("#my-music-notify").removeClass().addClass(classes);
            setTimeout(function () {
                $("#my-music-notify").addClass("show").removeClass("bounceIn")
            }, 260);
            if (!settings.keep) {
                Interface.notifyTO = setTimeout(function () {
                    $("#my-music-notify").addClass("bounceOut").removeClass("show");
                    setTimeout(function () {
                        $("#my-music-notify").removeClass("bounceOut");
                        $("#my-music").removeClass("show-badge")
                    }, 260)
                }, settings.timer)
            }
        };
        this.bookmarkPage = function () {
            Analytics.logAndSendEventToGA("site:header:more:bookmark:click");
            var bookmarkURL = "http://www.saavn.com";
            var bookmarkTitle = "Saavn";
            try {
                if (window.sidebar && window.sidebar.addPanel) {
                    window.sidebar.addPanel(bookmarkTitle, bookmarkURL, "")
                } else if (window.external && "AddFavorite" in window.external || document.all) {
                    window.external.AddFavorite(bookmarkURL, bookmarkTitle)
                } else {
                    alert("Click OK and press " + (navigator.userAgent.toLowerCase().indexOf("mac") != -1 ? "⌘ Command" : "CTRL") + " + D to bookmark Saavn!")
                }
            } catch (err) {
                alert("Sorry, looks like your browser doesn't support automatic bookmark. Please bookmark Saavn manually!")
            }
        };
        this.fireSearch = function () {
            if ($("body").attr("id") == "home") Home.fireSearch(); else Content.fireExplicitSearch()
        };
        this.initKeyControls = function (t) {
            if (t === undefined)var t = $("body");
            $(t).find("input, textarea").unbind("focus.keyControls").bind("focus.keyControls", function () {
                Interface.keyControls = false
            });
            $(t).find("input, textarea").unbind("blur.keyControls").bind("blur.keyControls", function () {
                Interface.keyControls = true
            });
            $(document).unbind("keydown.player").bind("keydown.player", function (k) {
                if (k.keyCode == KEY_CTRL || k.keyCode == KEY_CMND) {
                    Interface.keyCombo = k.keyCode;
                    $(document).unbind("keyup.player").bind("keyup.player", function (kc) {
                        if (kc.keyCode == Interface.keyCombo) {
                            $(document).unbind("keyup.player");
                            Interface.keyCombo = 0
                        }
                    })
                }
                if (Interface.keyControls == true && !Interface.keyCombo) {
                    switch (k.keyCode) {
                        case KEY_NEXT:
                            if (!$("#fwd").hasClass("disabled") && !$("#player").hasClass("disabled")) {
                                k.preventDefault();
                                State.playNextSong();
                                Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "next:keyboard")
                            }
                            break;
                        case KEY_PREV:
                            if (!$("#rew").hasClass("disabled") && !$("#player").hasClass("disabled") && !State.radioMode) {
                                k.preventDefault();
                                if (Player.timeElapsed >= 10) {
                                    Player.seekSong(0)
                                } else {
                                    State.playPreviousSong();
                                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "prev:keyboard")
                                }
                            }
                            break;
                        case KEY_SPACE:
                            if ($("#play").hasClass("hide")) {
                                if (!$("#pause").hasClass("disabled") && !$("#player").hasClass("disabled")) {
                                    k.preventDefault();
                                    State.pauseSong();
                                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "click_to_pause:keyboard")
                                }
                            } else {
                                if (!$("#play").hasClass("disabled") && !$("#player").hasClass("disabled")) {
                                    k.preventDefault();
                                    if (Player.getState().state == "paused") State.resumeSong(); else {
                                        var song = Player.getCurrentSong();
                                        State.playSong(song)
                                    }
                                    Analytics.logAndSendEventToGA(Player.PREFIX + Player.DELIMITER + "click_to_play:keyboard")
                                }
                            }
                            break
                    }
                }
            })
        };
        this.initRadioUI = function () {
            $("#radio-off").unbind("click").click(function () {
                Analytics.logAndSendEventToGA("site:sidebar:radio:stop_radio:click");
                State.stopRadio()
            });
            $("#radio-home").unbind("click").click(function () {
                if ($(".page-wrap").hasClass("radio")) {
                    Interface.smoothTo(0)
                } else {
                    Analytics.logAndSendEventToGA("site:sidebar:radio:current_station:click");
                    Radio.goToCurrentStation()
                }
            });
            $("#like-big").unbind("click").click(function () {
                if ($(this).hasClass("on"))return;
                Radio.likeSong()
            });
            $("#dislike-big").unbind("click").click(function () {
                Radio.dislikeSong()
            });
            $("#radio-start-big").unbind("click").click(function () {
                if ($("body").hasClass("radio-on") && $("body").hasClass("paused")) $("#play").click(); else Radio.playAlreadyLoadedStation()
            });
            $("#radio-pause-big").unbind("click").click(function () {
                $("#pause").click()
            });
            $("#save-station").unbind("click").click(function () {
                _showRadioSave()
            });
            $("#station-form .save").unbind("click").click(function () {
                if ($(this).hasClass("disabled"))return;
                if ($.trim($("#station-form input").val()) != "") {
                    Radio.saveStation($("#station-form input").val());
                    $(this).addClass("disabled")
                }
            });
            $("#station-form .cancel").unbind("click").click(function () {
                _hideRadioSave()
            });
            $("#radio-add-queue").unbind("click").click(function () {
                Radio.addRadioSongToQueue()
            });
            $("#radio-add-playlist").unbind("click").click(function () {
                Radio.addRadioSongToPlaylist()
            });
            $("#radio-share").unbind("click").click(function () {
                Radio.shareRadioSong()
            });
            $("#radio-star").unbind("click").click(function () {
                Radio.starRadioSong()
            });
            $("#create-station").autoComplete();
            $("#radio-tip").unbind("mousemove").mousemove(function (e) {
                var pos = e.pageY - $(this).find(".cTip-wrap").css({top: e.pageY - Interface.getScrollPos() - 39 + "px"})
            });
            if (State.radioMode == true) {
                $("#radio-mast").addClass("radio-playing");
                $("#radio-start-big").removeClass("cTip dark btn-tip")
            } else {
                $("#radio-mast").removeClass("radio-playing");
                $("#radio-start-big").addClass("cTip dark btn-tip")
            }
            $("#more-stations").unbind("click").click(function () {
                $(this).fadeOut(120, function () {
                    $(this).remove();
                    $("#saved-stations li.hide").css("display", "inline-block").hide().fadeIn(210, function () {
                        $(this).css("display", "inline-block")
                    })
                })
            });
            Interface.rotateRadioImage($(".radio-art-img").attr("data-src"));
            if (Interface.featuredStations || Interface.localStorageSupport() && localStorage.radioHomeClick == "true") {
                setTimeout(function () {
                    Interface.smoothTo($("#featured-stations"), 480, null, 100)
                }, 1200);
                Interface.featuredStations = false;
                localStorage.radioHomeClick = false
            }
            if ($("#twitter-radio-help").length > 0) {
                if ($("#radio-description").length > 0 && State.radioMode) {
                    $("#radio-description").slideUp(340, function () {
                        to = setTimeout(function () {
                            clearTimeout(to);
                            $("#radio-mast header").slideDown(340, function () {
                                $(this).removeClass("hide")
                            })
                        }, 340);
                        $(this).remove()
                    })
                }
                _clearTwitterRadioHelp();
                Interface.twitterRadioHelp = setInterval(function () {
                    _toggleTwitterRadioHelp()
                }, 5e3)
            }
            if (State.isUserLoggedIn()) Radio.loadUserStations();
            State.checkRadioLanguage(State.getLanguage())
        };
        this.radioHeaderToggle = function () {
            if ($("#radio-hdr-toggle").hasClass("on") || State.radioMode == true) {
                State.stopRadio();
                Analytics.logAndSendEventToGA("site:header:radio:last_station:stop_radio:click")
            } else {
                if ($("#radio-start-big").length > 0) Radio.playAlreadyLoadedStation(); else Radio.goToCurrentStation(true);
                var stationInfo = Radio.getStationInfo();
                var stationId = stationInfo.stationId;
                var stationType = stationInfo.stationType;
                var stationName = stationInfo.stationName;
                Analytics.logAndSendEventToGA("site:header:radio:last_station:start_radio:click", "stationId", stationId, "stationName", stationName, "stationType", stationType)
            }
        };
        this.showRadio = function () {
            $("body").addClass("radio-on");
            $("#radio-start-big").removeClass("cTip dark btn-tip");
            $("#player-menu-radio").addClass("disabled");
            setTimeout(function () {
                $("#radio-mast").stop().fadeIn(210)
            }, 260);
            $("#radio-mast").addClass("radio-playing");
            $("#radio-hdr-toggle").addClass("on")
        };
        this.hideRadio = function () {
            $("body").removeClass("radio-on");
            $("#radio-start-big").addClass("cTip dark btn-tip");
            $("#player-menu-radio").removeClass("disabled");
            $("#like-big, #dislike-big").hide();
            $("#radio-start-big").show();
            $("#radio-hdr-toggle").removeClass("on");
            Radio.toggleLJR(false);
            Radio.toggleRJK(false)
        };
        this.rotateRadioImage = function (src) {
            if (src === undefined || $.trim(src) == "")return false;
            if (src != $(".radio-art img").attr("src")) $(".radio-art img").stop(true).fadeOut(340, function () {
                _transitionRadio(src)
            }); else _transitionRadio(src)
        };
        function _transitionRadio(src) {
            $(".radio-art img").attr("src", src).unbind("load").bind("load", function () {
                $(".radio-art img").stop(true, true).fadeIn(340);
                if ($("html").hasClass("ie8")) {
                    $(".radio-art img").show().css({display: "block"});
                    return
                }
                if ($(".mast-blur-container.showing").length < 1) {
                    $(".mast-blur-container:first-child").css({visibility: "hidden"}).html('<img src="' + src + '" />');
                    var img = $(".mast-blur-container:first-child img");
                    $(img).bind("load", function () {
                        $(".mast-blur-container:first-child").hide().stop(true).css({visibility: "visible"}).delay(120).fadeIn(480).addClass("showing")
                    })
                } else {
                    $(".mast-blur-container:not(.showing)").html('<img src="' + src + '" />');
                    var img = $(".mast-blur-container:not(.showing) img");
                    $(img).unbind("load").bind("load", function () {
                        $(".mast-blur-container.showing").stop(true).fadeOut(840, function () {
                            $(".mast-blur-container").toggleClass("showing");
                            $(".mast-blur-container:not(.showing)").empty().css({display: "block"})
                        })
                    })
                }
            })
        }

        function _showRadioSave() {
            $("#station-info").stop().css("z-index", 100).animate({top: "-100px"}, 480);
            $("#create-station-wrap").fadeOut(120);
            $("#station-form").css("z-index", 200);
            $("#station-form input").val($("#station").attr("data-name"));
            $("#station-form input").removeClass("empty");
            $("#station-form fieldset").stop().animate({top: "0px"}, 480)
        }

        function _hideRadioSave(callback) {
            $("#station-info").stop().css("z-index", 200).animate({top: "0px"}, 480, function () {
                $("#create-station-wrap").fadeIn(120)
            });
            $("#station-form").css("z-index", 100);
            $("#station-form fieldset").stop().animate({top: "100px"}, 480, function () {
                $("#station-form input").val("");
                $("#station-form .save").removeClass("disabled");
                if (typeof callback == "function") {
                    callback()
                }
            })
        }

        function _clearTwitterRadioHelp() {
            clearInterval(Interface.twitterRadioHelp)
        }

        function _toggleTwitterRadioHelp() {
            if ($("#twitter-radio-help").hasClass("hide")) {
                $("#twitter-radio-request").addClass("hide").fadeOut(480, function () {
                    $("#twitter-radio-help").removeClass("hide").fadeIn(480).css({display: "block"})
                })
            } else {
                $("#twitter-radio-help").addClass("hide").fadeOut(480, function () {
                    $("#twitter-radio-request").removeClass("hide").fadeIn(480).css({display: "block"})
                })
            }
        }

        $(function () {
            Interface.isIE = $("html").hasClass("ie");
            Interface.mainPad = 0;
            if ($("#drawer").length > 0 && $.fn.sCroller) _initDrawer();
            Interface.isPro = Util.getProStatus() == Util.TRIAL || Util.getProStatus() == Util.PRO;
            if (Interface.isPro) Interface.showPro();
            if ($("#user-json").html()) Interface.initUser();
            if (Interface.isAppPage()) {
                $("#login-btn, #my-music.logged-out, #people-btn.logged-out").click(function () {
                    Panel.showLoginPanel();
                    Analytics.logAndSendEventToGA("header:login:click")
                });
                $("#signup-btn").click(function () {
                    Panel.showSignupPanel();
                    Analytics.logAndSendEventToGA("header:sign-up:click")
                })
            } else if ($("body").attr("id") == "signup") {
                $("#classic-signup-show").click(function () {
                    $(this).hide();
                    $("#classic-signup-fine-print").show();
                    $("#classic-signup-form").slideDown(210)
                })
            } else if ($("body").attr("id") == "login") {
                $("#login-mod input").focus(function () {
                    $("#static-login-btn").slideDown(120)
                })
            }
            $("#bookmark").click(function () {
                Interface.bookmarkPage()
            });
            Interface.initUI()
        })
    };
Interface.isIE = false;
Interface.drawerWidth = 300;
Interface.mainPad = 0;
Interface.queue;
Interface.starred;
Interface.playlists;
Interface.isPro = false;
Interface.notifyTO;
Interface.keyControls = true;
Interface.keyCombo = 0;
Interface.featuredStations = false;
Interface.twitterRadioHelp;
var regError = "Sorry, there was an error with your registration. Please try again!";
var loginError = "Sorry, your login failed. Please try again!";
var infoInt;
var phonenumber_user_callback;
function _staticRegister(redirectUrl) {
    var username = $("#reg_username").val();
    var email = $("#reg_username").val();
    var password = $("#reg_password").val();
    var confirmed_password = $("#reg_confirm_password").val();
    var valid = true;
    var registration_callback;
    $("#signup-form input, #signup-form .pw-label").removeClass("error");
    if (username == "" || $("#reg_username").hasClass("empty")) {
        $("#reg_username").addClass("error");
        valid = false
    }
    if (password == "" || $("#reg_password").hasClass("empty")) {
        $("#reg_password").addClass("error");
        $("#reg_password").parent().addClass("error");
        valid = false
    }
    if (confirmed_password == "" || $("#reg_confirm_password").hasClass("empty") || password != confirmed_password) {
        $("#reg_confirm_password").addClass("error");
        $("#reg_confirm_password").parent().addClass("error");
        valid = false
    }
    var enUsername = encodeURIComponent(username);
    var enEmail = encodeURIComponent(username);
    if (valid) {
        var postData = {_marker: 0, username: enUsername, email: enEmail, password: password};
        if (typeof _context != "undefined" && _context == "socialnetwork") {
            postData["uid"] = owner_uid
        }
        if (typeof redirectUrl == "function") {
            registration_callback = redirectUrl
        } else {
            registration_callback = function (o, status) {
                if (status == Util.SUCCESS) {
                    var xml = typeof o === "string" ? Util.getXMLObj(o) : o;
                    var error = xml.getElementsByTagName("error");
                    if (error.length) {
                        msg = error[0].getAttribute("msg");
                        alert(msg);
                        return
                    }
                    if (!_redirectTo()) window.location.href = redirectUrl
                } else {
                    alert(regError)
                }
            }
        }
        if (!redirectUrl) {
            redirectUrl = "http://" + window.location.hostname
        }
        var isSecure = document.location.protocol == "https:" ? true : false;
        if (isSecure) {
            var url = "/api.php?__call=user.createV2";
            Util.call(url, registration_callback, postData, true)
        } else {
            var url = "https://" + window.location.hostname + "/api.php?__call=user.createV2";
            Util.securecall(url, registration_callback, postData)
        }
    }
}
function _regCallback(o, status) {
    var status = "";
    if (o != "undefined") status = Util.SUCCESS; else status = Util.ERROR;
    if (status == Util.SUCCESS) {
        o = o.trim();
        var xml = Util.getXMLObj(o);
        var error = xml.getElementsByTagName("error");
        if (error.length) {
            return
        }
        var user = xml.getElementsByTagName("user");
        if (user.length) {
            if (!_redirectTo()) window.location.href = "http://" + window.location.hostname
        } else {
            alert(regError)
        }
    } else {
        alert(regError)
    }
}
function _staticLogin(redirectUrl) {
    var username = $("#login_username").val();
    var password = $("#login_password").val();
    var valid = true;
    $("#login-panel input, #login-panel .pw-label").removeClass("error");
    if (username == "" || $("#login_username").hasClass("empty")) {
        $("#login_username").addClass("error");
        valid = false
    }
    if (password == "" || $("#login_password").hasClass("empty")) {
        $("#login_password").addClass("error");
        $("#login_password").parent().addClass("error");
        valid = false
    }
    if (valid) {
        var enUsername = encodeURIComponent(username);
        if (typeof owner_uid == "undefined") {
            var postData = {username: enUsername, password: password}
        } else {
            var postData = {username: enUsername, password: password, uid: owner_uid}
        }
        if (typeof reg_user_callback == "undefined") {
            var reg_user_callback = function (o, status) {
                if (status == Util.SUCCESS) {
                    var xml = typeof o == "string" ? Util.getXMLObj(o) : o;
                    var error = xml.getElementsByTagName("error");
                    if (error.length) {
                        msg = error[0].getAttribute("msg");
                        alert(msg);
                        return
                    }
                    if (!redirectUrl) {
                        redirectUrl = "http://" + window.location.hostname
                    }
                    if (!_redirectTo()) window.location.href = redirectUrl
                } else {
                    alert(loginError);
                    return
                }
            }
        }
        if (typeof redirectUrl == "function") {
            var reg_user_callback = redirectUrl
        }
        Util.call("/api.php?__call=user.login&_marker=0", reg_user_callback, postData, true)
    }
}
function _redirectTo() {
    var query_parameters = window.location.search.substring(1).split("&");
    for (var i = 0; i < query_parameters.length; ++i) {
        var operand = query_parameters[i].split("=");
        if (operand[0] == "redirect_to") {
            window.location.href = "http://" + window.location.hostname + "/" + decodeURIComponent(operand[1]);
            return true
        }
    }
    return false
}
function _forgotPass() {
    var email = $("#forgotpass_email").val();
    var valid = true;
    $("#forgotpass_email").removeClass("error");
    if (Util.validateEml(email) == false || email == "" || $("#forgotpass_email").hasClass("empty")) {
        $("#forgotpass_email").addClass("error");
        valid = false
    }
    if (valid) {
        var enEmail = encodeURIComponent(email);
        var postData = {username: enEmail, email: enEmail};
        Util.call("/api.php?__call=user.forgotPassword&_marker=0", _forgotPassCallback, postData, true)
    }
}
var _forgotPassCallback = function (o, status) {
    if (status == Util.SUCCESS) {
        var xml = Util.getXMLObj(o);
        var error = xml.getElementsByTagName("error");
        if (error.length) {
            alert(error[0].getAttribute("msg"));
            return
        }
        alert("We have sent you an email with a link to reset your password.");
        window.location.href = "http://" + window.location.hostname
    } else {
        var msg = "There has been an error! Please try again.";
        alert(msg)
    }
};
$(function () {
    FBUtil.init();
    if ($("body").hasClass("signup-login")) {
        $("#classic-signup-link").click(function () {
            _showClassicReg()
        });
        $("#static-reg-btn").click(function () {
            _staticRegister()
        });
        $("#reg_username, #reg_password, #reg_confirm_password").keyup(function (event) {
            if (event.keyCode == 13) {
                _staticRegister()
            }
        });
        $("#static-login-btn").click(function () {
            _staticLogin()
        });
        $("#login_password, #login_username").keyup(function (event) {
            if (event.keyCode == 13) {
                _staticLogin()
            }
        });
        $("#forgot-pass-btn").click(function () {
            _forgotPass()
        });
        $("#forgotpass_email").keyup(function (event) {
            if (event.keyCode == 13) {
                _forgotPass()
            }
        });
        $("#static-phone-login-btn").click(function () {
            phone_btn_onclick()
        });
        $(".btn.fb").click(function () {
            FBUtil.login(_regCallback)
        })
    }
    if ($("html").hasClass("mobile")) {
        $(".simple-wrap footer p").html('Not on Saavn yet? <a href="http://d.saavn.com"><strong>Download the app</strong></a> for iPhone, Android, and Java.')
    }
    if ($("body").hasClass("read-only")) {
        var readonly = Util.readOnlyMessage;
        Interface.showFixedNotice(readonly, true)
    }
});
$(window).load(function () {
    if ($("body").hasClass("signup-login")) {
        var FBInt = setInterval(function () {
            _paintFriends();
            clearInterval(FBInt)
        }, 500)
    }
    AccountKit.init({appId: Util.FBID, state: Util.FB_STATE, version: Util.FB_ACCOUNTKIT_VERSION})
});
function _paintFriends() {
    if ($("#signup-view").length > 0) {
        if (FB != undefined) {
            FB.getLoginStatus(function (response) {
                if (response.authResponse) {
                    FB.api("/me/friends", "GET", {fields: "picture,name"}, function (response) {
                        var data = response.data;
                        if (data.length > 1) {
                            $("#fb-pile").append('<h4 class="small with-line"><strong>Your friends already love Saavn.</strong></h4>');
                            for (var i = 0; i < data.length; i++) {
                                var e = '<div class="img" style="background-image: url(' + data[i].picture.data.url + ');" />';
                                $("#fb-pile").append(e)
                            }
                            $("#fb-pile").slideDown(260)
                        }
                    })
                }
            })
        }
    }
}
function _showClassicReg() {
    $("#signup-form").slideDown(210);
    $("#classic-signup-link").parent().fadeOut(184)
}
function loginMobileCallback(response) {
    loginMobileCallback = function () {
    };
    if (response.status === Util.FB_PARTIAL_AUTHENTICATED_STATUS) {
        if (response.state === Util.FB_STATE) {
            var panelLogin = $("#panel_login").val();
            var redirectUrl = panelLogin == "1" ? window.location.href : "http://" + window.location.hostname;
            var url = "/api.php?__call=user.appAccountsLogin";
            var postData = {code: response.code, phone_number: "", _format: "json", api_version: "4"};
            if (typeof phonenumber_user_callback == "undefined") {
                phonenumber_user_callback = function (o, status) {
                    if (status == Util.SUCCESS) {
                        var xml = typeof o === "string" ? Util.getXMLObj(o) : o;
                        var error = xml.getElementsByTagName("error");
                        if (error.length) {
                            msg = error[0].getAttribute("msg");
                            alert(msg);
                            return
                        }
                        if (!_redirectTo()) window.location.href = redirectUrl
                    } else {
                        alert(regError)
                    }
                }
            }
            Util.call(url, phonenumber_user_callback, postData, false)
        } else {
            Util.logInConsole(" STATE NOT SAME ");
            alert("Something went wrong, please try again")
        }
    } else if (response.status === Util.FB_NOT_AUTHENTICATED_STATUS) {
        Util.logInConsole(Util.FB_NOT_AUTHENTICATED_STATUS)
    } else if (response.status === Util.FB_BAD_PARAMS_STATUS) {
        Util.logInConsole(Util.FB_BAD_PARAMS_STATUS);
        alert("Something went wrong, please try again")
    }
}
function phone_btn_onclick() {
    var countryCodeNum = $("#countryCodeNum").val();
    AccountKit.login("PHONE", {countryCode: countryCodeNum}, loginMobileCallback)
}
var _getQueryString = function (str) {
    if (str == "")return {};
    var rraVals = {};
    for (var i = 0; i < str.length; ++i) {
        var keyVals = str[i].split("=");
        if (keyVals.length != 2)continue;
        rraVals[keyVals[0]] = decodeURIComponent(keyVals[1].replace(/\+/g, " "))
    }
    return rraVals
}(window.location.search.substr(1).split("&"));
var Notifications = Notifications || new function () {
        this.intervalId = null;
        this.displayNotifications = false;
        this.fetchFrequency = 1e3 * 60;
        this.isFirstLoad = true;
        this.fetchNotifications = function () {
            var last_notif_ts = Util.getResourceFromLocalStorage("lastNotificationsTs", 0);
            var last_read_ts = Util.getResourceFromLocalStorage("lastReadTs", 0);
            var pageType = Util.getPageType();
            var totalNotificationsDisplayed = $("#notifications").children().length;
            var userJSON = $("#user-json");
            if (userJSON.length == 0) {
                return
            }
            var loggedInUid = JSON.parse(userJSON.text()).uid;
            var apiURL = "/u/" + loggedInUid + "?type=notifications&_marker=0&qt=a&p=1&last_read_ts=" + last_read_ts;
            var fetchAllNotifications = pageType == "owner-profile" && totalNotificationsDisplayed == 0 || this.isFirstLoad;
            if (!fetchAllNotifications) {
                apiURL += "&after_ts=" + last_notif_ts
            }
            var callback = function (data) {
                var elem = $(data);
                $(".tab-notifications").removeClass("hide");
                if (elem.length == 0) {
                    if ($("#notifications").children().length == 0) {
                        $(".tab-notifications").find(".empty-state").removeClass("hide");
                        Analytics.logAndSendEventToGA(["site:inbox:empty_no_data:ui:view"])
                    }
                    return
                } else {
                    var lastMsg = elem[0];
                    Util.setResourceToLocalStorage("lastNotificationsTs", $(lastMsg).attr("data-ts"));
                    $(".tab-notifications").find(".empty-state").addClass("hide")
                }
                var unreadNotifications = 0;
                var i = 0;
                for (i = 0; i < elem.length; i++) {
                    if ($(elem[i]).attr("data-type") == "unread") {
                        unreadNotifications++
                    }
                    var guidToRemove = $(elem[i]).attr("data-guid");
                    if (guidToRemove) {
                        $("[data-guid='" + guidToRemove + "']").remove()
                    }
                }
                if (unreadNotifications > 0) {
                    unreadNotifications += parseInt($("#notify-badge span").text());
                    var maxNotifications = parseInt($("#notif-bell").attr("data-max-notifications"));
                    if (unreadNotifications > maxNotifications) {
                        unreadNotifications = maxNotifications
                    }
                    $("#notify-badge span").text(unreadNotifications);
                    $("#notify-badge").removeClass("hide");
                    $(".notify-nav").addClass("badged")
                }
                $(".tab-notifications").find(".notifications").prepend(data)
            };
            Util.call(apiURL, callback);
            this.isFirstLoad = false
        };
        this.startNotificationsFetch = function () {
            if (!State.isUserLoggedIn()) {
                return
            }
            Notifications.intervalId = setInterval(function () {
                Notifications.fetchNotifications()
            }, Notifications.fetchFrequency)
        };
        this.stopNotificationsFetch = function () {
            clearInterval(Notifications.intervalId)
        }
    };
(function (factory) {
    if (typeof define == "function" && define.amd) define("picker", ["jquery"], factory); else if (typeof exports == "object") module.exports = factory(require("jquery")); else this.Picker = factory(jQuery)
})(function ($) {
    var $window = $(window);
    var $document = $(document);
    var $html = $(document.documentElement);
    var supportsTransitions = document.documentElement.style.transition != null;

    function PickerConstructor(ELEMENT, NAME, COMPONENT, OPTIONS) {
        if (!ELEMENT)return PickerConstructor;
        var IS_DEFAULT_THEME = false, STATE = {id: ELEMENT.id || "P" + Math.abs(~~(Math.random() * new Date))}, SETTINGS = COMPONENT ? $.extend(true, {}, COMPONENT.defaults, OPTIONS) : OPTIONS || {}, CLASSES = $.extend({}, PickerConstructor.klasses(), SETTINGS.klass), $ELEMENT = $(ELEMENT), PickerInstance = function () {
            return this.start()
        }, P = PickerInstance.prototype = {
            constructor: PickerInstance, $node: $ELEMENT, start: function () {
                if (STATE && STATE.start)return P;
                STATE.methods = {};
                STATE.start = true;
                STATE.open = false;
                STATE.type = ELEMENT.type;
                ELEMENT.autofocus = ELEMENT == getActiveElement();
                ELEMENT.readOnly = !SETTINGS.editable;
                ELEMENT.id = ELEMENT.id || STATE.id;
                if (ELEMENT.type != "text") {
                    ELEMENT.type = "text"
                }
                P.component = new COMPONENT(P, SETTINGS);
                P.$root = $('<div class="' + CLASSES.picker + '" id="' + ELEMENT.id + '_root" />');
                prepareElementRoot();
                P.$holder = $(createWrappedComponent()).appendTo(P.$root);
                prepareElementHolder();
                if (SETTINGS.formatSubmit) {
                    prepareElementHidden()
                }
                prepareElement();
                if (SETTINGS.containerHidden) $(SETTINGS.containerHidden).append(P._hidden); else $ELEMENT.after(P._hidden);
                if (SETTINGS.container) $(SETTINGS.container).append(P.$root); else $ELEMENT.after(P.$root);
                P.on({
                    start: P.component.onStart,
                    render: P.component.onRender,
                    stop: P.component.onStop,
                    open: P.component.onOpen,
                    close: P.component.onClose,
                    set: P.component.onSet
                }).on({
                    start: SETTINGS.onStart,
                    render: SETTINGS.onRender,
                    stop: SETTINGS.onStop,
                    open: SETTINGS.onOpen,
                    close: SETTINGS.onClose,
                    set: SETTINGS.onSet
                });
                IS_DEFAULT_THEME = isUsingDefaultTheme(P.$holder[0]);
                if (ELEMENT.autofocus) {
                    P.open()
                }
                return P.trigger("start").trigger("render")
            }, render: function (entireComponent) {
                if (entireComponent) {
                    P.$holder = $(createWrappedComponent());
                    prepareElementHolder();
                    P.$root.html(P.$holder)
                } else P.$root.find("." + CLASSES.box).html(P.component.nodes(STATE.open));
                return P.trigger("render")
            }, stop: function () {
                if (!STATE.start)return P;
                P.close();
                if (P._hidden) {
                    P._hidden.parentNode.removeChild(P._hidden)
                }
                P.$root.remove();
                $ELEMENT.removeClass(CLASSES.input).removeData(NAME);
                setTimeout(function () {
                    $ELEMENT.off("." + STATE.id)
                }, 0);
                ELEMENT.type = STATE.type;
                ELEMENT.readOnly = false;
                P.trigger("stop");
                STATE.methods = {};
                STATE.start = false;
                return P
            }, open: function (dontGiveFocus) {
                if (STATE.open)return P;
                $ELEMENT.addClass(CLASSES.active);
                aria(ELEMENT, "expanded", true);
                setTimeout(function () {
                    P.$root.addClass(CLASSES.opened);
                    aria(P.$root[0], "hidden", false)
                }, 0);
                if (dontGiveFocus !== false) {
                    STATE.open = true;
                    if (IS_DEFAULT_THEME) {
                        $html.css("overflow", "hidden").css("padding-right", "+=" + getScrollbarWidth())
                    }
                    focusPickerOnceOpened();
                    $document.on("click." + STATE.id + " focusin." + STATE.id, function (event) {
                        var target = event.target;
                        if (target != ELEMENT && target != document && event.which != 3) {
                            P.close(target === P.$holder[0])
                        }
                    }).on("keydown." + STATE.id, function (event) {
                        var keycode = event.keyCode, keycodeToMove = P.component.key[keycode], target = event.target;
                        if (keycode == 27) {
                            P.close(true)
                        } else if (target == P.$holder[0] && (keycodeToMove || keycode == 13)) {
                            event.preventDefault();
                            if (keycodeToMove) {
                                PickerConstructor._.trigger(P.component.key.go, P, [PickerConstructor._.trigger(keycodeToMove)])
                            } else if (!P.$root.find("." + CLASSES.highlighted).hasClass(CLASSES.disabled)) {
                                P.set("select", P.component.item.highlight);
                                if (SETTINGS.closeOnSelect) {
                                    P.close(true)
                                }
                            }
                        } else if ($.contains(P.$root[0], target) && keycode == 13) {
                            event.preventDefault();
                            target.click()
                        }
                    })
                }
                return P.trigger("open")
            }, close: function (giveFocus) {
                if (giveFocus) {
                    if (SETTINGS.editable) {
                        ELEMENT.focus()
                    } else {
                        P.$holder.off("focus.toOpen").focus();
                        setTimeout(function () {
                            P.$holder.on("focus.toOpen", handleFocusToOpenEvent)
                        }, 0)
                    }
                }
                $ELEMENT.removeClass(CLASSES.active);
                aria(ELEMENT, "expanded", false);
                setTimeout(function () {
                    P.$root.removeClass(CLASSES.opened + " " + CLASSES.focused);
                    aria(P.$root[0], "hidden", true)
                }, 0);
                if (!STATE.open)return P;
                STATE.open = false;
                if (IS_DEFAULT_THEME) {
                    $html.css("overflow", "").css("padding-right", "-=" + getScrollbarWidth())
                }
                $document.off("." + STATE.id);
                return P.trigger("close")
            }, clear: function (options) {
                return P.set("clear", null, options)
            }, set: function (thing, value, options) {
                var thingItem, thingValue, thingIsObject = $.isPlainObject(thing), thingObject = thingIsObject ? thing : {};
                options = thingIsObject && $.isPlainObject(value) ? value : options || {};
                if (thing) {
                    if (!thingIsObject) {
                        thingObject[thing] = value
                    }
                    for (thingItem in thingObject) {
                        thingValue = thingObject[thingItem];
                        if (thingItem in P.component.item) {
                            if (thingValue === undefined) thingValue = null;
                            P.component.set(thingItem, thingValue, options)
                        }
                        if (thingItem == "select" || thingItem == "clear") {
                            $ELEMENT.val(thingItem == "clear" ? "" : P.get(thingItem, SETTINGS.format)).trigger("change")
                        }
                    }
                    P.render()
                }
                return options.muted ? P : P.trigger("set", thingObject)
            }, get: function (thing, format) {
                thing = thing || "value";
                if (STATE[thing] != null) {
                    return STATE[thing]
                }
                if (thing == "valueSubmit") {
                    if (P._hidden) {
                        return P._hidden.value
                    }
                    thing = "value"
                }
                if (thing == "value") {
                    return ELEMENT.value
                }
                if (thing in P.component.item) {
                    if (typeof format == "string") {
                        var thingValue = P.component.get(thing);
                        return thingValue ? PickerConstructor._.trigger(P.component.formats.toString, P.component, [format, thingValue]) : ""
                    }
                    return P.component.get(thing)
                }
            }, on: function (thing, method, internal) {
                var thingName, thingMethod, thingIsObject = $.isPlainObject(thing), thingObject = thingIsObject ? thing : {};
                if (thing) {
                    if (!thingIsObject) {
                        thingObject[thing] = method
                    }
                    for (thingName in thingObject) {
                        thingMethod = thingObject[thingName];
                        if (internal) {
                            thingName = "_" + thingName
                        }
                        STATE.methods[thingName] = STATE.methods[thingName] || [];
                        STATE.methods[thingName].push(thingMethod)
                    }
                }
                return P
            }, off: function () {
                var i, thingName, names = arguments;
                for (i = 0, namesCount = names.length; i < namesCount; i += 1) {
                    thingName = names[i];
                    if (thingName in STATE.methods) {
                        delete STATE.methods[thingName]
                    }
                }
                return P
            }, trigger: function (name, data) {
                var _trigger = function (name) {
                    var methodList = STATE.methods[name];
                    if (methodList) {
                        methodList.map(function (method) {
                            PickerConstructor._.trigger(method, P, [data])
                        })
                    }
                };
                _trigger("_" + name);
                _trigger(name);
                return P
            }
        };

        function createWrappedComponent() {
            return PickerConstructor._.node("div", PickerConstructor._.node("div", PickerConstructor._.node("div", PickerConstructor._.node("div", P.component.nodes(STATE.open), CLASSES.box), CLASSES.wrap), CLASSES.frame), CLASSES.holder, 'tabindex="-1"')
        }

        function prepareElement() {
            $ELEMENT.data(NAME, P).addClass(CLASSES.input).val($ELEMENT.data("value") ? P.get("select", SETTINGS.format) : ELEMENT.value);
            if (!SETTINGS.editable) {
                $ELEMENT.on("focus." + STATE.id + " click." + STATE.id, function (event) {
                    event.preventDefault();
                    P.open()
                }).on("keydown." + STATE.id, handleKeydownEvent)
            }
            aria(ELEMENT, {haspopup: true, expanded: false, readonly: false, owns: ELEMENT.id + "_root"})
        }

        function prepareElementRoot() {
            aria(P.$root[0], "hidden", true)
        }

        function prepareElementHolder() {
            P.$holder.on({
                keydown: handleKeydownEvent, "focus.toOpen": handleFocusToOpenEvent, blur: function () {
                    $ELEMENT.removeClass(CLASSES.target)
                }, focusin: function (event) {
                    P.$root.removeClass(CLASSES.focused);
                    event.stopPropagation()
                }, "mousedown click": function (event) {
                    var target = event.target;
                    if (target != P.$holder[0]) {
                        event.stopPropagation();
                        if (event.type == "mousedown" && !$(target).is("input, select, textarea, button, option")) {
                            event.preventDefault();
                            P.$holder[0].focus()
                        }
                    }
                }
            }).on("click", "[data-pick], [data-nav], [data-clear], [data-close]", function () {
                var $target = $(this), targetData = $target.data(), targetDisabled = $target.hasClass(CLASSES.navDisabled) || $target.hasClass(CLASSES.disabled), activeElement = getActiveElement();
                activeElement = activeElement && (activeElement.type || activeElement.href);
                if (targetDisabled || activeElement && !$.contains(P.$root[0], activeElement)) {
                    P.$holder[0].focus()
                }
                if (!targetDisabled && targetData.nav) {
                    P.set("highlight", P.component.item.highlight, {nav: targetData.nav})
                } else if (!targetDisabled && "pick" in targetData) {
                    P.set("select", targetData.pick);
                    if (SETTINGS.closeOnSelect) {
                        P.close(true)
                    }
                } else if (targetData.clear) {
                    P.clear();
                    if (SETTINGS.closeOnClear) {
                        P.close(true)
                    }
                } else if (targetData.close) {
                    P.close(true)
                }
            })
        }

        function prepareElementHidden() {
            var name;
            if (SETTINGS.hiddenName === true) {
                name = ELEMENT.name;
                ELEMENT.name = ""
            } else {
                name = [typeof SETTINGS.hiddenPrefix == "string" ? SETTINGS.hiddenPrefix : "", typeof SETTINGS.hiddenSuffix == "string" ? SETTINGS.hiddenSuffix : "_submit"];
                name = name[0] + ELEMENT.name + name[1]
            }
            P._hidden = $("<input " + "type=hidden " + 'name="' + name + '"' + ($ELEMENT.data("value") || ELEMENT.value ? ' value="' + P.get("select", SETTINGS.formatSubmit) + '"' : "") + ">")[0];
            $ELEMENT.on("change." + STATE.id, function () {
                P._hidden.value = ELEMENT.value ? P.get("select", SETTINGS.formatSubmit) : ""
            })
        }

        function focusPickerOnceOpened() {
            if (IS_DEFAULT_THEME && supportsTransitions) {
                P.$holder.find("." + CLASSES.frame).one("transitionend", function () {
                    P.$holder[0].focus()
                })
            } else {
                P.$holder[0].focus()
            }
        }

        function handleFocusToOpenEvent(event) {
            event.stopPropagation();
            $ELEMENT.addClass(CLASSES.target);
            P.$root.addClass(CLASSES.focused);
            P.open()
        }

        function handleKeydownEvent(event) {
            var keycode = event.keyCode, isKeycodeDelete = /^(8|46)$/.test(keycode);
            if (keycode == 27) {
                P.close(true);
                return false
            }
            if (keycode == 32 || isKeycodeDelete || !STATE.open && P.component.key[keycode]) {
                event.preventDefault();
                event.stopPropagation();
                if (isKeycodeDelete) {
                    P.clear().close()
                } else {
                    P.open()
                }
            }
        }

        return new PickerInstance
    }

    PickerConstructor.klasses = function (prefix) {
        prefix = prefix || "picker";
        return {
            picker: prefix,
            opened: prefix + "--opened",
            focused: prefix + "--focused",
            input: prefix + "__input",
            active: prefix + "__input--active",
            target: prefix + "__input--target",
            holder: prefix + "__holder",
            frame: prefix + "__frame",
            wrap: prefix + "__wrap",
            box: prefix + "__box"
        }
    };
    function isUsingDefaultTheme(element) {
        var theme, prop = "position";
        if (element.currentStyle) {
            theme = element.currentStyle[prop]
        } else if (window.getComputedStyle) {
            theme = getComputedStyle(element)[prop]
        }
        return theme == "fixed"
    }

    function getScrollbarWidth() {
        if ($html.height() <= $window.height()) {
            return 0
        }
        var $outer = $('<div style="visibility:hidden;width:100px" />').appendTo("body");
        var widthWithoutScroll = $outer[0].offsetWidth;
        $outer.css("overflow", "scroll");
        var $inner = $('<div style="width:100%" />').appendTo($outer);
        var widthWithScroll = $inner[0].offsetWidth;
        $outer.remove();
        return widthWithoutScroll - widthWithScroll
    }

    PickerConstructor._ = {
        group: function (groupObject) {
            var loopObjectScope, nodesList = "", counter = PickerConstructor._.trigger(groupObject.min, groupObject);
            for (; counter <= PickerConstructor._.trigger(groupObject.max, groupObject, [counter]); counter += groupObject.i) {
                loopObjectScope = PickerConstructor._.trigger(groupObject.item, groupObject, [counter]);
                nodesList += PickerConstructor._.node(groupObject.node, loopObjectScope[0], loopObjectScope[1], loopObjectScope[2])
            }
            return nodesList
        }, node: function (wrapper, item, klass, attribute) {
            if (!item)return "";
            item = $.isArray(item) ? item.join("") : item;
            klass = klass ? ' class="' + klass + '"' : "";
            attribute = attribute ? " " + attribute : "";
            return "<" + wrapper + klass + attribute + ">" + item + "</" + wrapper + ">"
        }, lead: function (number) {
            return (number < 10 ? "0" : "") + number
        }, trigger: function (callback, scope, args) {
            return typeof callback == "function" ? callback.apply(scope, args || []) : callback
        }, digits: function (string) {
            return /\d/.test(string[1]) ? 2 : 1
        }, isDate: function (value) {
            return {}.toString.call(value).indexOf("Date") > -1 && this.isInteger(value.getDate())
        }, isInteger: function (value) {
            return {}.toString.call(value).indexOf("Number") > -1 && value % 1 === 0
        }, ariaAttr: ariaAttr
    };
    PickerConstructor.extend = function (name, Component) {
        $.fn[name] = function (options, action) {
            var componentData = this.data(name);
            if (options == "picker") {
                return componentData
            }
            if (componentData && typeof options == "string") {
                return PickerConstructor._.trigger(componentData[options], componentData, [action])
            }
            return this.each(function () {
                var $this = $(this);
                if (!$this.data(name)) {
                    new PickerConstructor(this, name, Component, options)
                }
            })
        };
        $.fn[name].defaults = Component.defaults
    };
    function aria(element, attribute, value) {
        if ($.isPlainObject(attribute)) {
            for (var key in attribute) {
                ariaSet(element, key, attribute[key])
            }
        } else {
            ariaSet(element, attribute, value)
        }
    }

    function ariaSet(element, attribute, value) {
        element.setAttribute((attribute == "role" ? "" : "aria-") + attribute, value)
    }

    function ariaAttr(attribute, data) {
        if (!$.isPlainObject(attribute)) {
            attribute = {attribute: data}
        }
        data = "";
        for (var key in attribute) {
            var attr = (key == "role" ? "" : "aria-") + key, attrVal = attribute[key];
            data += attrVal == null ? "" : attr + '="' + attribute[key] + '"'
        }
        return data
    }

    function getActiveElement() {
        try {
            return document.activeElement
        } catch (err) {
        }
    }

    return PickerConstructor
});
(function (factory) {
    if (typeof define == "function" && define.amd) define(["picker", "jquery"], factory); else if (typeof exports == "object") module.exports = factory(require("./picker.js"), require("jquery")); else factory(Picker, jQuery)
})(function (Picker, $) {
    var DAYS_IN_WEEK = 7, WEEKS_IN_CALENDAR = 6, _ = Picker._;

    function DatePicker(picker, settings) {
        var calendar = this, element = picker.$node[0], elementValue = element.value, elementDataValue = picker.$node.data("value"), valueString = elementDataValue || elementValue, formatString = elementDataValue ? settings.formatSubmit : settings.format, isRTL = function () {
            return element.currentStyle ? element.currentStyle.direction == "rtl" : getComputedStyle(picker.$root[0]).direction == "rtl"
        };
        calendar.settings = settings;
        calendar.$node = picker.$node;
        calendar.queue = {
            min: "measure create",
            max: "measure create",
            now: "now create",
            select: "parse create validate",
            highlight: "parse navigate create validate",
            view: "parse create validate viewset",
            disable: "deactivate",
            enable: "activate"
        };
        calendar.item = {};
        calendar.item.clear = null;
        calendar.item.disable = (settings.disable || []).slice(0);
        calendar.item.enable = -function (collectionDisabled) {
            return collectionDisabled[0] === true ? collectionDisabled.shift() : -1
        }(calendar.item.disable);
        calendar.set("min", settings.min).set("max", settings.max).set("now");
        if (valueString) {
            calendar.set("select", valueString, {format: formatString, defaultValue: true})
        } else {
            calendar.set("select", null).set("highlight", calendar.item.now)
        }
        calendar.key = {
            40: 7, 38: -7, 39: function () {
                return isRTL() ? -1 : 1
            }, 37: function () {
                return isRTL() ? 1 : -1
            }, go: function (timeChange) {
                var highlightedObject = calendar.item.highlight, targetDate = new Date(highlightedObject.year, highlightedObject.month, highlightedObject.date + timeChange);
                calendar.set("highlight", targetDate, {interval: timeChange});
                this.render()
            }
        };
        picker.on("render", function () {
            picker.$root.find("." + settings.klass.selectMonth).on("change", function () {
                var value = this.value;
                if (value) {
                    picker.set("highlight", [picker.get("view").year, value, picker.get("highlight").date]);
                    picker.$root.find("." + settings.klass.selectMonth).trigger("focus")
                }
            });
            picker.$root.find("." + settings.klass.selectYear).on("change", function () {
                var value = this.value;
                if (value) {
                    picker.set("highlight", [value, picker.get("view").month, picker.get("highlight").date]);
                    picker.$root.find("." + settings.klass.selectYear).trigger("focus")
                }
            })
        }, 1).on("open", function () {
            var includeToday = "";
            if (calendar.disabled(calendar.get("now"))) {
                includeToday = ":not(." + settings.klass.buttonToday + ")"
            }
            picker.$root.find("button" + includeToday + ", select").attr("disabled", false)
        }, 1).on("close", function () {
            picker.$root.find("button, select").attr("disabled", true)
        }, 1)
    }

    DatePicker.prototype.set = function (type, value, options) {
        var calendar = this, calendarItem = calendar.item;
        if (value === null) {
            if (type == "clear") type = "select";
            calendarItem[type] = value;
            return calendar
        }
        calendarItem[type == "enable" ? "disable" : type == "flip" ? "enable" : type] = calendar.queue[type].split(" ").map(function (method) {
            value = calendar[method](type, value, options);
            return value
        }).pop();
        if (type == "select") {
            calendar.set("highlight", calendarItem.select, options)
        } else if (type == "highlight") {
            calendar.set("view", calendarItem.highlight, options)
        } else if (type.match(/^(flip|min|max|disable|enable)$/)) {
            if (calendarItem.select && calendar.disabled(calendarItem.select)) {
                calendar.set("select", calendarItem.select, options)
            }
            if (calendarItem.highlight && calendar.disabled(calendarItem.highlight)) {
                calendar.set("highlight", calendarItem.highlight, options)
            }
        }
        return calendar
    };
    DatePicker.prototype.get = function (type) {
        return this.item[type]
    };
    DatePicker.prototype.create = function (type, value, options) {
        var isInfiniteValue, calendar = this;
        value = value === undefined ? type : value;
        if (value == -Infinity || value == Infinity) {
            isInfiniteValue = value
        } else if ($.isPlainObject(value) && _.isInteger(value.pick)) {
            value = value.obj
        } else if ($.isArray(value)) {
            value = new Date(value[0], value[1], value[2]);
            value = _.isDate(value) ? value : calendar.create().obj
        } else if (_.isInteger(value) || _.isDate(value)) {
            value = calendar.normalize(new Date(value), options)
        } else {
            value = calendar.now(type, value, options)
        }
        return {
            year: isInfiniteValue || value.getFullYear(),
            month: isInfiniteValue || value.getMonth(),
            date: isInfiniteValue || value.getDate(),
            day: isInfiniteValue || value.getDay(),
            obj: isInfiniteValue || value,
            pick: isInfiniteValue || value.getTime()
        }
    };
    DatePicker.prototype.createRange = function (from, to) {
        var calendar = this, createDate = function (date) {
            if (date === true || $.isArray(date) || _.isDate(date)) {
                return calendar.create(date)
            }
            return date
        };
        if (!_.isInteger(from)) {
            from = createDate(from)
        }
        if (!_.isInteger(to)) {
            to = createDate(to)
        }
        if (_.isInteger(from) && $.isPlainObject(to)) {
            from = [to.year, to.month, to.date + from]
        } else if (_.isInteger(to) && $.isPlainObject(from)) {
            to = [from.year, from.month, from.date + to]
        }
        return {from: createDate(from), to: createDate(to)}
    };
    DatePicker.prototype.withinRange = function (range, dateUnit) {
        range = this.createRange(range.from, range.to);
        return dateUnit.pick >= range.from.pick && dateUnit.pick <= range.to.pick
    };
    DatePicker.prototype.overlapRanges = function (one, two) {
        var calendar = this;
        one = calendar.createRange(one.from, one.to);
        two = calendar.createRange(two.from, two.to);
        return calendar.withinRange(one, two.from) || calendar.withinRange(one, two.to) || calendar.withinRange(two, one.from) || calendar.withinRange(two, one.to)
    };
    DatePicker.prototype.now = function (type, value, options) {
        value = new Date;
        if (options && options.rel) {
            value.setDate(value.getDate() + options.rel)
        }
        return this.normalize(value, options)
    };
    DatePicker.prototype.navigate = function (type, value, options) {
        var targetDateObject, targetYear, targetMonth, targetDate, isTargetArray = $.isArray(value), isTargetObject = $.isPlainObject(value), viewsetObject = this.item.view;
        if (isTargetArray || isTargetObject) {
            if (isTargetObject) {
                targetYear = value.year;
                targetMonth = value.month;
                targetDate = value.date
            } else {
                targetYear = +value[0];
                targetMonth = +value[1];
                targetDate = +value[2]
            }
            if (options && options.nav && viewsetObject && viewsetObject.month !== targetMonth) {
                targetYear = viewsetObject.year;
                targetMonth = viewsetObject.month
            }
            targetDateObject = new Date(targetYear, targetMonth + (options && options.nav ? options.nav : 0), 1);
            targetYear = targetDateObject.getFullYear();
            targetMonth = targetDateObject.getMonth();
            while (new Date(targetYear, targetMonth, targetDate).getMonth() !== targetMonth) {
                targetDate -= 1
            }
            value = [targetYear, targetMonth, targetDate]
        }
        return value
    };
    DatePicker.prototype.normalize = function (value) {
        value.setHours(0, 0, 0, 0);
        return value
    };
    DatePicker.prototype.measure = function (type, value) {
        var calendar = this;
        if (!value) {
            value = type == "min" ? -Infinity : Infinity
        } else if (typeof value == "string") {
            value = calendar.parse(type, value)
        } else if (_.isInteger(value)) {
            value = calendar.now(type, value, {rel: value})
        }
        return value
    };
    DatePicker.prototype.viewset = function (type, dateObject) {
        return this.create([dateObject.year, dateObject.month, 1])
    };
    DatePicker.prototype.validate = function (type, dateObject, options) {
        var calendar = this, originalDateObject = dateObject, interval = options && options.interval ? options.interval : 1, isFlippedBase = calendar.item.enable === -1, hasEnabledBeforeTarget, hasEnabledAfterTarget, minLimitObject = calendar.item.min, maxLimitObject = calendar.item.max, reachedMin, reachedMax, hasEnabledWeekdays = isFlippedBase && calendar.item.disable.filter(function (value) {
                if ($.isArray(value)) {
                    var dateTime = calendar.create(value).pick;
                    if (dateTime < dateObject.pick) hasEnabledBeforeTarget = true; else if (dateTime > dateObject.pick) hasEnabledAfterTarget = true
                }
                return _.isInteger(value)
            }).length;
        if (!options || !options.nav && !options.defaultValue)if (!isFlippedBase && calendar.disabled(dateObject) || isFlippedBase && calendar.disabled(dateObject) && (hasEnabledWeekdays || hasEnabledBeforeTarget || hasEnabledAfterTarget) || !isFlippedBase && (dateObject.pick <= minLimitObject.pick || dateObject.pick >= maxLimitObject.pick)) {
            if (isFlippedBase && !hasEnabledWeekdays && (!hasEnabledAfterTarget && interval > 0 || !hasEnabledBeforeTarget && interval < 0)) {
                interval *= -1
            }
            while (calendar.disabled(dateObject)) {
                if (Math.abs(interval) > 1 && (dateObject.month < originalDateObject.month || dateObject.month > originalDateObject.month)) {
                    dateObject = originalDateObject;
                    interval = interval > 0 ? 1 : -1
                }
                if (dateObject.pick <= minLimitObject.pick) {
                    reachedMin = true;
                    interval = 1;
                    dateObject = calendar.create([minLimitObject.year, minLimitObject.month, minLimitObject.date + (dateObject.pick === minLimitObject.pick ? 0 : -1)])
                } else if (dateObject.pick >= maxLimitObject.pick) {
                    reachedMax = true;
                    interval = -1;
                    dateObject = calendar.create([maxLimitObject.year, maxLimitObject.month, maxLimitObject.date + (dateObject.pick === maxLimitObject.pick ? 0 : 1)])
                }
                if (reachedMin && reachedMax) {
                    break
                }
                dateObject = calendar.create([dateObject.year, dateObject.month, dateObject.date + interval])
            }
        }
        return dateObject
    };
    DatePicker.prototype.disabled = function (dateToVerify) {
        var calendar = this, isDisabledMatch = calendar.item.disable.filter(function (dateToDisable) {
            if (_.isInteger(dateToDisable)) {
                return dateToVerify.day === (calendar.settings.firstDay ? dateToDisable : dateToDisable - 1) % 7
            }
            if ($.isArray(dateToDisable) || _.isDate(dateToDisable)) {
                return dateToVerify.pick === calendar.create(dateToDisable).pick
            }
            if ($.isPlainObject(dateToDisable)) {
                return calendar.withinRange(dateToDisable, dateToVerify)
            }
        });
        isDisabledMatch = isDisabledMatch.length && !isDisabledMatch.filter(function (dateToDisable) {
                return $.isArray(dateToDisable) && dateToDisable[3] == "inverted" || $.isPlainObject(dateToDisable) && dateToDisable.inverted
            }).length;
        return calendar.item.enable === -1 ? !isDisabledMatch : isDisabledMatch || dateToVerify.pick < calendar.item.min.pick || dateToVerify.pick > calendar.item.max.pick
    };
    DatePicker.prototype.parse = function (type, value, options) {
        var calendar = this, parsingObject = {};
        if (!value || typeof value != "string") {
            return value
        }
        if (!(options && options.format)) {
            options = options || {};
            options.format = calendar.settings.format
        }
        calendar.formats.toArray(options.format).map(function (label) {
            var formattingLabel = calendar.formats[label], formatLength = formattingLabel ? _.trigger(formattingLabel, calendar, [value, parsingObject]) : label.replace(/^!/, "").length;
            if (formattingLabel) {
                parsingObject[label] = value.substr(0, formatLength)
            }
            value = value.substr(formatLength)
        });
        return [parsingObject.yyyy || parsingObject.yy, +(parsingObject.mm || parsingObject.m) - 1, parsingObject.dd || parsingObject.d]
    };
    DatePicker.prototype.formats = function () {
        function getWordLengthFromCollection(string, collection, dateObject) {
            var word = string.match(/[^\x00-\x7F]+|\w+/)[0];
            if (!dateObject.mm && !dateObject.m) {
                dateObject.m = collection.indexOf(word) + 1
            }
            return word.length
        }

        function getFirstWordLength(string) {
            return string.match(/\w+/)[0].length
        }

        return {
            d: function (string, dateObject) {
                return string ? _.digits(string) : dateObject.date
            }, dd: function (string, dateObject) {
                return string ? 2 : _.lead(dateObject.date)
            }, ddd: function (string, dateObject) {
                return string ? getFirstWordLength(string) : this.settings.weekdaysShort[dateObject.day]
            }, dddd: function (string, dateObject) {
                return string ? getFirstWordLength(string) : this.settings.weekdaysFull[dateObject.day]
            }, m: function (string, dateObject) {
                return string ? _.digits(string) : dateObject.month + 1
            }, mm: function (string, dateObject) {
                return string ? 2 : _.lead(dateObject.month + 1)
            }, mmm: function (string, dateObject) {
                var collection = this.settings.monthsShort;
                return string ? getWordLengthFromCollection(string, collection, dateObject) : collection[dateObject.month]
            }, mmmm: function (string, dateObject) {
                var collection = this.settings.monthsFull;
                return string ? getWordLengthFromCollection(string, collection, dateObject) : collection[dateObject.month]
            }, yy: function (string, dateObject) {
                return string ? 2 : ("" + dateObject.year).slice(2)
            }, yyyy: function (string, dateObject) {
                return string ? 4 : dateObject.year
            }, toArray: function (formatString) {
                return formatString.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)
            }, toString: function (formatString, itemObject) {
                var calendar = this;
                return calendar.formats.toArray(formatString).map(function (label) {
                    return _.trigger(calendar.formats[label], calendar, [0, itemObject]) || label.replace(/^!/, "")
                }).join("")
            }
        }
    }();
    DatePicker.prototype.isDateExact = function (one, two) {
        var calendar = this;
        if (_.isInteger(one) && _.isInteger(two) || typeof one == "boolean" && typeof two == "boolean") {
            return one === two
        }
        if ((_.isDate(one) || $.isArray(one)) && (_.isDate(two) || $.isArray(two))) {
            return calendar.create(one).pick === calendar.create(two).pick
        }
        if ($.isPlainObject(one) && $.isPlainObject(two)) {
            return calendar.isDateExact(one.from, two.from) && calendar.isDateExact(one.to, two.to)
        }
        return false
    };
    DatePicker.prototype.isDateOverlap = function (one, two) {
        var calendar = this, firstDay = calendar.settings.firstDay ? 1 : 0;
        if (_.isInteger(one) && (_.isDate(two) || $.isArray(two))) {
            one = one % 7 + firstDay;
            return one === calendar.create(two).day + 1
        }
        if (_.isInteger(two) && (_.isDate(one) || $.isArray(one))) {
            two = two % 7 + firstDay;
            return two === calendar.create(one).day + 1
        }
        if ($.isPlainObject(one) && $.isPlainObject(two)) {
            return calendar.overlapRanges(one, two)
        }
        return false
    };
    DatePicker.prototype.flipEnable = function (val) {
        var itemObject = this.item;
        itemObject.enable = val || (itemObject.enable == -1 ? 1 : -1)
    };
    DatePicker.prototype.deactivate = function (type, datesToDisable) {
        var calendar = this, disabledItems = calendar.item.disable.slice(0);
        if (datesToDisable == "flip") {
            calendar.flipEnable()
        } else if (datesToDisable === false) {
            calendar.flipEnable(1);
            disabledItems = []
        } else if (datesToDisable === true) {
            calendar.flipEnable(-1);
            disabledItems = []
        } else {
            datesToDisable.map(function (unitToDisable) {
                var matchFound;
                for (var index = 0; index < disabledItems.length; index += 1) {
                    if (calendar.isDateExact(unitToDisable, disabledItems[index])) {
                        matchFound = true;
                        break
                    }
                }
                if (!matchFound) {
                    if (_.isInteger(unitToDisable) || _.isDate(unitToDisable) || $.isArray(unitToDisable) || $.isPlainObject(unitToDisable) && unitToDisable.from && unitToDisable.to) {
                        disabledItems.push(unitToDisable)
                    }
                }
            })
        }
        return disabledItems
    };
    DatePicker.prototype.activate = function (type, datesToEnable) {
        var calendar = this, disabledItems = calendar.item.disable, disabledItemsCount = disabledItems.length;
        if (datesToEnable == "flip") {
            calendar.flipEnable()
        } else if (datesToEnable === true) {
            calendar.flipEnable(1);
            disabledItems = []
        } else if (datesToEnable === false) {
            calendar.flipEnable(-1);
            disabledItems = []
        } else {
            datesToEnable.map(function (unitToEnable) {
                var matchFound, disabledUnit, index, isExactRange;
                for (index = 0; index < disabledItemsCount; index += 1) {
                    disabledUnit = disabledItems[index];
                    if (calendar.isDateExact(disabledUnit, unitToEnable)) {
                        matchFound = disabledItems[index] = null;
                        isExactRange = true;
                        break
                    } else if (calendar.isDateOverlap(disabledUnit, unitToEnable)) {
                        if ($.isPlainObject(unitToEnable)) {
                            unitToEnable.inverted = true;
                            matchFound = unitToEnable
                        } else if ($.isArray(unitToEnable)) {
                            matchFound = unitToEnable;
                            if (!matchFound[3]) matchFound.push("inverted")
                        } else if (_.isDate(unitToEnable)) {
                            matchFound = [unitToEnable.getFullYear(), unitToEnable.getMonth(), unitToEnable.getDate(), "inverted"]
                        }
                        break
                    }
                }
                if (matchFound)for (index = 0; index < disabledItemsCount; index += 1) {
                    if (calendar.isDateExact(disabledItems[index], unitToEnable)) {
                        disabledItems[index] = null;
                        break
                    }
                }
                if (isExactRange)for (index = 0; index < disabledItemsCount; index += 1) {
                    if (calendar.isDateOverlap(disabledItems[index], unitToEnable)) {
                        disabledItems[index] = null;
                        break
                    }
                }
                if (matchFound) {
                    disabledItems.push(matchFound)
                }
            })
        }
        return disabledItems.filter(function (val) {
            return val != null
        })
    };
    DatePicker.prototype.nodes = function (isOpen) {
        var calendar = this, settings = calendar.settings, calendarItem = calendar.item, nowObject = calendarItem.now, selectedObject = calendarItem.select, highlightedObject = calendarItem.highlight, viewsetObject = calendarItem.view, disabledCollection = calendarItem.disable, minLimitObject = calendarItem.min, maxLimitObject = calendarItem.max, tableHead = function (collection, fullCollection) {
            if (settings.firstDay) {
                collection.push(collection.shift());
                fullCollection.push(fullCollection.shift())
            }
            return _.node("thead", _.node("tr", _.group({
                min: 0,
                max: DAYS_IN_WEEK - 1,
                i: 1,
                node: "th",
                item: function (counter) {
                    return [collection[counter], settings.klass.weekdays, 'scope=col title="' + fullCollection[counter] + '"']
                }
            })))
        }((settings.showWeekdaysFull ? settings.weekdaysFull : settings.weekdaysShort).slice(0), settings.weekdaysFull.slice(0)), createMonthNav = function (next) {
            return _.node("div", " ", settings.klass["nav" + (next ? "Next" : "Prev")] + (next && viewsetObject.year >= maxLimitObject.year && viewsetObject.month >= maxLimitObject.month || !next && viewsetObject.year <= minLimitObject.year && viewsetObject.month <= minLimitObject.month ? " " + settings.klass.navDisabled : ""), "data-nav=" + (next || -1) + " " + _.ariaAttr({
                    role: "button",
                    controls: calendar.$node[0].id + "_table"
                }) + " " + 'title="' + (next ? settings.labelMonthNext : settings.labelMonthPrev) + '"')
        }, createMonthLabel = function () {
            var monthsCollection = settings.showMonthsShort ? settings.monthsShort : settings.monthsFull;
            if (settings.selectMonths) {
                return _.node("select", _.group({
                    min: 0, max: 11, i: 1, node: "option", item: function (loopedMonth) {
                        return [monthsCollection[loopedMonth], 0, "value=" + loopedMonth + (viewsetObject.month == loopedMonth ? " selected" : "") + (viewsetObject.year == minLimitObject.year && loopedMonth < minLimitObject.month || viewsetObject.year == maxLimitObject.year && loopedMonth > maxLimitObject.month ? " disabled" : "")]
                    }
                }), settings.klass.selectMonth, (isOpen ? "" : "disabled") + " " + _.ariaAttr({controls: calendar.$node[0].id + "_table"}) + " " + 'title="' + settings.labelMonthSelect + '"')
            }
            return _.node("div", monthsCollection[viewsetObject.month], settings.klass.month)
        }, createYearLabel = function () {
            var focusedYear = viewsetObject.year, numberYears = settings.selectYears === true ? 5 : ~~(settings.selectYears / 2);
            if (numberYears) {
                var minYear = minLimitObject.year, maxYear = maxLimitObject.year, lowestYear = focusedYear - numberYears, highestYear = focusedYear + numberYears;
                if (minYear > lowestYear) {
                    highestYear += minYear - lowestYear;
                    lowestYear = minYear
                }
                if (maxYear < highestYear) {
                    var availableYears = lowestYear - minYear, neededYears = highestYear - maxYear;
                    lowestYear -= availableYears > neededYears ? neededYears : availableYears;
                    highestYear = maxYear
                }
                return _.node("select", _.group({
                    min: lowestYear,
                    max: highestYear,
                    i: 1,
                    node: "option",
                    item: function (loopedYear) {
                        return [loopedYear, 0, "value=" + loopedYear + (focusedYear == loopedYear ? " selected" : "")]
                    }
                }), settings.klass.selectYear, (isOpen ? "" : "disabled") + " " + _.ariaAttr({controls: calendar.$node[0].id + "_table"}) + " " + 'title="' + settings.labelYearSelect + '"')
            }
            return _.node("div", focusedYear, settings.klass.year)
        };
        return _.node("div", (settings.selectYears ? createYearLabel() + createMonthLabel() : createMonthLabel() + createYearLabel()) + createMonthNav() + createMonthNav(1), settings.klass.header) + _.node("table", tableHead + _.node("tbody", _.group({
                    min: 0,
                    max: WEEKS_IN_CALENDAR - 1,
                    i: 1,
                    node: "tr",
                    item: function (rowCounter) {
                        var shiftDateBy = settings.firstDay && calendar.create([viewsetObject.year, viewsetObject.month, 1]).day === 0 ? -7 : 0;
                        return [_.group({
                            min: DAYS_IN_WEEK * rowCounter - viewsetObject.day + shiftDateBy + 1,
                            max: function () {
                                return this.min + DAYS_IN_WEEK - 1
                            },
                            i: 1,
                            node: "td",
                            item: function (targetDate) {
                                targetDate = calendar.create([viewsetObject.year, viewsetObject.month, targetDate + (settings.firstDay ? 1 : 0)]);
                                var isSelected = selectedObject && selectedObject.pick == targetDate.pick, isHighlighted = highlightedObject && highlightedObject.pick == targetDate.pick, isDisabled = disabledCollection && calendar.disabled(targetDate) || targetDate.pick < minLimitObject.pick || targetDate.pick > maxLimitObject.pick, formattedDate = _.trigger(calendar.formats.toString, calendar, [settings.format, targetDate]);
                                return [_.node("div", targetDate.date, function (klasses) {
                                    klasses.push(viewsetObject.month == targetDate.month ? settings.klass.infocus : settings.klass.outfocus);
                                    if (nowObject.pick == targetDate.pick) {
                                        klasses.push(settings.klass.now)
                                    }
                                    if (isSelected) {
                                        klasses.push(settings.klass.selected)
                                    }
                                    if (isHighlighted) {
                                        klasses.push(settings.klass.highlighted)
                                    }
                                    if (isDisabled) {
                                        klasses.push(settings.klass.disabled)
                                    }
                                    return klasses.join(" ")
                                }([settings.klass.day]), "data-pick=" + targetDate.pick + " " + _.ariaAttr({
                                        role: "gridcell",
                                        label: formattedDate,
                                        selected: isSelected && calendar.$node.val() === formattedDate ? true : null,
                                        activedescendant: isHighlighted ? true : null,
                                        disabled: isDisabled ? true : null
                                    })), "", _.ariaAttr({role: "presentation"})]
                            }
                        })]
                    }
                })), settings.klass.table, 'id="' + calendar.$node[0].id + "_table" + '" ' + _.ariaAttr({
                    role: "grid",
                    controls: calendar.$node[0].id,
                    readonly: true
                })) + _.node("div", _.node("button", settings.today, settings.klass.buttonToday, "type=button data-pick=" + nowObject.pick + (isOpen && !calendar.disabled(nowObject) ? "" : " disabled") + " " + _.ariaAttr({controls: calendar.$node[0].id})) + _.node("button", settings.clear, settings.klass.buttonClear, "type=button data-clear=1" + (isOpen ? "" : " disabled") + " " + _.ariaAttr({controls: calendar.$node[0].id})) + _.node("button", settings.close, settings.klass.buttonClose, "type=button data-close=true " + (isOpen ? "" : " disabled") + " " + _.ariaAttr({controls: calendar.$node[0].id})), settings.klass.footer)
    };
    DatePicker.defaults = function (prefix) {
        return {
            labelMonthNext: "Next month",
            labelMonthPrev: "Previous month",
            labelMonthSelect: "Select a month",
            labelYearSelect: "Select a year",
            monthsFull: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            weekdaysFull: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            weekdaysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            today: "Today",
            clear: "Clear",
            close: "Close",
            closeOnSelect: true,
            closeOnClear: true,
            format: "d mmmm, yyyy",
            klass: {
                table: prefix + "table",
                header: prefix + "header",
                navPrev: prefix + "nav--prev",
                navNext: prefix + "nav--next",
                navDisabled: prefix + "nav--disabled",
                month: prefix + "month",
                year: prefix + "year",
                selectMonth: prefix + "select--month",
                selectYear: prefix + "select--year",
                weekdays: prefix + "weekday",
                day: prefix + "day",
                disabled: prefix + "day--disabled",
                selected: prefix + "day--selected",
                highlighted: prefix + "day--highlighted",
                now: prefix + "day--today",
                infocus: prefix + "day--infocus",
                outfocus: prefix + "day--outfocus",
                footer: prefix + "footer",
                buttonClear: prefix + "button--clear",
                buttonToday: prefix + "button--today",
                buttonClose: prefix + "button--close"
            }
        }
    }(Picker.klasses().picker + "__");
    Picker.extend("pickadate", DatePicker)
});